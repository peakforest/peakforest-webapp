/*
 This file is part of MetExploreViz 

 Copyright Â© 2016 INRA 
 Contact: http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 GNU General Public License Usage 
 This file may be used under the terms of the GNU General Public License version 3.0 as 
 published by the Free Software Foundation and appearing in the file LICENSE included in the 
 packaging of this file. 
 Please review the following information to ensure the GNU General Public License version 3.0 
 requirements will be met: http://www.gnu.org/copyleft/gpl.html. 
 If you are unsure which license is appropriate for your use, please contact us 
 at http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact
 Version: 1.2.0.2 
 Build Date: Mon Nov 21 14:42:33 CET 2016 
 */
metExploreD3.GraphNetwork={task:"",delayedInitialisation:function(a){var b={};b.render=function(){var c=d3.select("#"+a);c.append("svg").attr("width","100%").attr("height","100%").attr("class","D3viz").attr("id","D3viz").style("background-color","#fff")};b.render();metExploreD3.GraphLink.delayedInitialisation(a);metExploreD3.GraphNode.delayedInitialisation(a);return b},tick:function(h){if(_metExploreViz.getComparedPanelById(h)!=null||h=="viz"){var s=metExploreD3.getScaleById(h);metExploreD3.GraphLink.tick(h,s);metExploreD3.GraphNode.tick(h);var q=s.getZoomScale();var n=metExploreD3.GraphNetwork.isAnimated(h);var b=_metExploreViz.getSessionById(h);var l=metExploreD3.getGeneralStyle();if(n&&q>0.05&&b.isResizable()){var e=document.getElementById(h).getBoundingClientRect();var a=d3.select("#"+h).select("#D3viz")[0][0].getElementById("graphComponent").getBoundingClientRect();var k=parseInt(d3.select("#"+h).select("#D3viz").style("width"));var j=parseInt(d3.select("#"+h).select("#D3viz").style("height"));if(e.top>a.top||e.left>a.left||e.bottom<a.bottom||e.right<a.right){var f=b.getD3Data().getNodesLength();var r=3000;if(f<l.getReactionThreshold()||!l.isDisplayedLabelsForOpt()){r=3000}metExploreD3.fixDelay(metExploreD3.GraphNetwork.task,r);var d=s.getZoom();var p=0.01*f/100;var o=q-(q*p);d.scale(o);var g=o*k;var m=o*j;var t=(k-g)/2;var c=(j-m)/2;d.translate([t,c]);d.event(d3.select("#"+h).select("#D3viz"));s.setZoomScale(o);s.setXScale(d.x());s.setYScale(d.y())}else{if(!((e.top+j/10>a.top&&e.bottom-j/10<a.bottom)||(e.left+k/10>a.left&&e.right-k/10<a.right))){var f=b.getD3Data().getNodesLength();var r=3000;if(f<l.getReactionThreshold()||!l.isDisplayedLabelsForOpt()){r=3000}metExploreD3.fixDelay(metExploreD3.GraphNetwork.task,r);var d=s.getZoom();if(p==undefined){p=0.01}else{p=p/2}var o=q+(q*p);d.scale(o);var g=o*k;var m=o*j;var t=(k-g)/2;var c=(j-m)/2;d.translate([t,c]);d.event(d3.select("#"+h).select("#D3viz"));s.setZoomScale(o);s.setXScale(d.x());s.setYScale(d.y())}}}}},zoom:function(a){var c=metExploreD3.getScaleById(a);d3.select("#"+a).select("#D3viz").select("#graphComponent").attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")");var b=c.getZoom();c.setZoomScale(d3.event.scale);c.setXScale(b.x());c.setYScale(b.y());metExploreD3.GraphLink.tick(a,c)},zoomIn:function(){_MyThisGraphNode.dblClickable=false;var b=this.parentNode.parentNode.id;var h=metExploreD3.getScaleById(b);var d=h.getZoom();var e=_metExploreViz.getSessionById(b);var g=document.getElementById(b).getBoundingClientRect();var f=d3.select("#"+b).select("#D3viz")[0][0].getElementById("graphComponent").getBoundingClientRect();var d=h.getZoom();var c=parseInt(d3.select("#"+b).select("#D3viz").style("width"));var a=parseInt(d3.select("#"+b).select("#D3viz").style("height"));d.scale(h.getZoomScale()*1.1);d.event(d3.select("#"+b).select("#D3viz"));h.setXScale(d.x());h.setYScale(d.y());h.setZoomScale(h.getZoomScale()*1.1);metExploreD3.GraphLink.tick(b,h)},zoomOut:function(){_MyThisGraphNode.dblClickable=false;var b=this.parentNode.parentNode.id;var h=metExploreD3.getScaleById(b);var d=h.getZoom();var e=_metExploreViz.getSessionById(b);var g=document.getElementById(b).getBoundingClientRect();var f=d3.select("#"+b).select("#D3viz")[0][0].getElementById("graphComponent").getBoundingClientRect();var d=h.getZoom();var c=parseInt(d3.select("#"+b).select("#D3viz").style("width"));var a=parseInt(d3.select("#"+b).select("#D3viz").style("height"));d.scale(h.getZoomScale()*0.9);d.event(d3.select("#"+b).select("#D3viz"));h.setXScale(d.x());h.setYScale(d.y());h.setZoomScale(h.getZoomScale()*0.9);metExploreD3.GraphLink.tick(b,h)},animationButtonOn:function(a){d3.select("#"+a).select("#buttonAnim").select("image").remove();d3.select("#"+a).select("#buttonAnim").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/pause.svg").attr("width","50").attr("height","50").attr("transform","translate(10,10) scale(.5)");metExploreD3.GraphNetwork.setAnimated(a,true)},animationButtonOff:function(a){d3.select("#"+a).select("#buttonAnim").select("image").remove();d3.select("#"+a).select("#buttonAnim").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/play.svg").attr("width","50").attr("height","50").attr("transform","translate(10,10) scale(.5)");metExploreD3.GraphNetwork.setAnimated(a,false)},play:function(g){var h=_metExploreViz.getSessionsSet();var a=this.parentNode.parentNode.id;var f=_metExploreViz.getSessionById(a);if(f!=undefined){var e=metExploreD3.GraphNetwork.isAnimated(a);if(e=="false"){if(f.isLinked()){for(var b in h){if(h[b].isLinked()){metExploreD3.GraphNetwork.animationButtonOn(h[b].getId())}}var c=_metExploreViz.getSessionById("viz").getForce();c.start()}else{metExploreD3.GraphNetwork.animationButtonOn(a);var c=f.getForce();c.start()}}else{if(f.isLinked()){for(var b in h){if(h[b].isLinked()){metExploreD3.GraphNetwork.animationButtonOff(h[b].getId())}}var c=_metExploreViz.getSessionById("viz").getForce();c.stop()}else{metExploreD3.GraphNetwork.animationButtonOff(a);var c=f.getForce();c.stop()}}}},setLink:function(f){that=this;var a=this.parentNode.parentNode.id;var e=_metExploreViz.getSessionById(a);var b=_metExploreViz.getSessionById("viz");if(e!=undefined){var c=e.getForce();var g=d3.select(this).attr("isLink");d3.select(this).select("image").remove();if(g=="false"){metExploreD3.GraphNetwork.link(that)}else{metExploreD3.GraphNetwork.unLink(that)}}},link:function(d){var a=d.parentNode.parentNode.id;var f=_metExploreViz.getSessionById(a);var c=_metExploreViz.getSessionById("viz");var e=metExploreD3.GraphNetwork.isAnimated("viz");d3.select(d).attr("isLink","true");f.setLinked(true);c.setLinked(true);if(e=="true"){metExploreD3.GraphNetwork.animationButtonOn(a)}else{metExploreD3.GraphNetwork.animationButtonOff(a)}var g=d3.select(d).attr("isLink");d3.select(d).select("image").remove();d3.select(d).append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/link.svg").attr("width","50").attr("height","50").attr("transform","translate(10,50) scale(.5)");if(f!=undefined){if(c.getDuplicatedNodesCount()>0){var b=d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(h){return h.getBiologicalType()=="metabolite"});c.getDuplicatedNodes().forEach(function(h){b.filter(function(j){return j.getId()==h}).each(function(j){j.setIsSideCompound(true)})});metExploreD3.GraphNetwork.duplicateSideCompoundsById(c.getDuplicatedNodes(),a);metExploreD3.GraphNetwork.looksLinked();if(f.isLinked()){metExploreD3.GraphNetwork.graphAlignment(a)}}else{metExploreD3.GraphNetwork.graphAlignment(a)}}metExploreD3.GraphNetwork.initCentroids()},unLink:function(b){var a=b.parentNode.parentNode.id;var e=_metExploreViz.getSessionById(a);d3.select(b).append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/unlink.svg").attr("width","50").attr("height","50").attr("transform","translate(10,50) scale(.5)");d3.select(b).attr("isLink","false");e.setLinked(false);metExploreD3.GraphNetwork.looksLinked();var d=metExploreD3.GraphNetwork.isAnimated(a);if(d=="true"){var c=e.getForce();c.start()}},looksLinked:function(){var c=_metExploreViz.getSessionsSet();var b=_metExploreViz.getSessionById("viz");b.setLinked(false);for(var a in c){if(c[a].isLinked()){b.setLinked(true)}}},refreshSvg:function(l){var f=_metExploreViz.getSessionById(l).getD3Data();var o=f.getNodes();metExploreD3.fireEventParentWebSite("refreshCart",o);var n=[];for(var r=0;r<o.length-1;r++){n.push(o[r].name)}n=n.sort();var s=parseInt(metExploreD3.GraphPanel.getHeight(l));var k=parseInt(metExploreD3.GraphPanel.getWidth(l));var x=metExploreD3.getLinkStyle();var p=metExploreD3.getGeneralStyle();var y=metExploreD3.getMetaboliteStyle();var v=metExploreD3.getReactionStyle();var A=Math.max(v.getWidth(),v.getHeight());var t=Math.max(y.getWidth(),y.getHeight());var e=Math.max(A,t);var b=d3.layout.force().friction(0.9).gravity(0.06).charge(-150).linkDistance(function(h){if(h.getSource().getIsSideCompound()||h.getTarget().getIsSideCompound()){return x.getSize()/2+e}else{return x.getSize()+e}}).size([k,s]);var a=_metExploreViz.getSessionById(l);a.setActivity(true);a.setForce(b);var B=d3.scale.linear().domain([0,k]).range([0,k]);var d=d3.scale.linear().domain([s,0]).range([s,0]);if(l=="viz"){metExploreD3.GraphCaption.drawCaption()}if(a.getScale()==undefined){var j=metExploreD3.GraphNetwork;metExploreD3.GraphNetwork.zoomListener=d3.behavior.zoom().x(B).y(d).scaleExtent([0.01,30]).on("zoom",function(w){if(metExploreD3.GraphNetwork.zoomListener.scale()<0.8){d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",true)}else{d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",false)}var h=_metExploreViz.getSessionById(l);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){j.zoom(l)}});var z=new Scale(l);z.setScale(B,d,1,1,1,metExploreD3.GraphNetwork.zoomListener.scale(),metExploreD3.GraphNetwork.zoomListener);metExploreD3.setScale(z,l)}else{var j=metExploreD3.GraphNetwork;metExploreD3.GraphNetwork.zoomListener=d3.behavior.zoom().x(B).y(d).scaleExtent([0.01,30]).on("zoom",function(w){if(metExploreD3.GraphNetwork.zoomListener.scale()<0.8){d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",true)}else{d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",false)}var h=_metExploreViz.getSessionById(this.parentNode.id);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){j.zoom(this.parentNode.id)}});var z=new Scale(l);z.setScale(B,d,1,1,1,metExploreD3.GraphNetwork.zoomListener.scale(),metExploreD3.GraphNetwork.zoomListener);metExploreD3.setScale(z,l)}b.on("start",function(){if(f.getNodes().length>p.getReactionThreshold()&&p.isDisplayedLinksForOpt()){d3.selectAll("path.link").remove()}});b.on("end",function(){var h=metExploreD3.getScaleById(l);if((f.getNodes().length>p.getReactionThreshold()&&p.isDisplayedLinksForOpt())){metExploreD3.GraphLink.reloadLinks(l,f,x,y)}metExploreD3.GraphLink.tick(l,h)});var m=d3.select("#"+l);m.svg=m.select("#D3viz").selectAll("*").remove();_metExploreViz.setLinkedByTypeOfMetabolite(false);var u;var g=false;var c=d3.select("#"+l).select("#D3viz").append("g").datum(function(){return{selected:false,previouslySelected:false}}).attr("id","brush").attr("class","brush").call(d3.svg.brush().x(B).y(d).on("brushstart",function(D){document.addEventListener("mousedown",function(F){if(F.button===1){F.stopPropagation();F.preventDefault();F.stopImmediatePropagation()}});var w=d3.select("#"+l).select("#buttonHand").attr("scrollable");_MyThisGraphNode.activePanel=this.parentNode.parentNode.id;var C=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(d3.event.sourceEvent.button!=1&&w!="true"){if(C!=undefined){if(C.isLinked()){var E=_metExploreViz.getSessionById("viz");if(E!=undefined){var h=E.getForce();if(h!=undefined){h.stop()}}}else{var h=C.getForce();if(h!=undefined){h.stop()}}}g=true;d3.select("#"+l).select("#brush").classed("hide",false);d3.select("#"+l).select("#D3viz").on("mousedown.zoom",null);u=d3.select("#"+l).select("#graphComponent").selectAll("g.node");u.each(function(F){F.previouslySelected=F.isSelected()})}else{var h=C.getForce();if(h!=undefined){h.stop()}d3.select("#"+l).selectAll("#D3viz").style("cursor","all-scroll");d3.selectAll("#brush").classed("hide",true)}}).on("brushend",function(){if(d3.event.sourceEvent.button!=1&&g){var I=d3.event.target.extent();if(I[1][0]-I[0][0]>20||I[1][1]-I[0][1]>20){var F;var I=d3.event.target.extent();var C=metExploreD3.getScaleById(l);var E=C.getZoomScale();var w=metExploreD3.createLoadMask("Selection in progress...",l);if(w!=undefined){metExploreD3.showMask(w);metExploreD3.deferFunction(function(){u.classed("selected",function(P){var O=C.getXScale();var N=C.getYScale();F=(O(I[0][0])<=O(P.x)&&O(P.x)<O(I[1][0]))&&(N(I[0][1])<=N(P.y)&&N(P.y)<N(I[1][1]));if((P.isSelected()==false&&F==true)||(P.isSelected()==true&&F==false&&!P.previouslySelected)){_MyThisGraphNode.selection(P,l)}return F});metExploreD3.hideMask(w);var L=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(L!=undefined){if(L.isLinked()){var M=_metExploreViz.getSessionById("viz");if(M!=undefined){var J=metExploreD3.GraphNetwork.isAnimated(M.getId());if(J=="true"){var K=M.getForce();if(K!=undefined){if((metExploreD3.GraphNetwork.isAnimated(M.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(M.getId())==null)){K.start()}}}}}else{var K=L.getForce();var J=metExploreD3.GraphNetwork.isAnimated(L.getId());if(J=="true"){var K=L.getForce();if(K!=undefined){if((metExploreD3.GraphNetwork.isAnimated(L.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(L.getId())==null)){K.start()}}}}}g=false},100)}}}else{var G=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(G!=undefined){if(G.isLinked()){var D=_metExploreViz.getSessionById("viz");if(D!=undefined){var H=metExploreD3.GraphNetwork.isAnimated(D.getId());if(H=="true"){var h=D.getForce();if(h!=undefined){if((metExploreD3.GraphNetwork.isAnimated(D.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(D.getId())==null)){h.start()}}}}}else{var h=G.getForce();var H=metExploreD3.GraphNetwork.isAnimated(G.getId());if(H=="true"){var h=G.getForce();if(h!=undefined){if(d3.select(metExploreD3.GraphNetwork.isAnimated(G.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(G.getId())==null)){h.start()}}}}}}d3.event.target.clear();d3.select(this).call(d3.event.target);var C=metExploreD3.getScaleById(l);d3.select("#"+l).selectAll("#D3viz").style("cursor","default");d3.select("#"+l).selectAll("#D3viz").call(C.getZoom()).on("dblclick.zoom",null).on("mousedown",null);d3.event.target.extent();d3.selectAll("#brush").classed("hide",false)}));var s=parseInt(metExploreD3.GraphPanel.getHeight(l));var k=parseInt(metExploreD3.GraphPanel.getWidth(l));d3.select("#"+l).select("#D3viz").append("foreignObject").attr("x",k-300).attr("y",100).attr("width","500").attr("height","500").append("xhtml:div").attr("id","tooltip2").classed("tooltip2",true).classed("hide",true);m.svg=d3.select("#"+l).select("#D3viz").call(metExploreD3.GraphNetwork.zoomListener).on("dblclick.zoom",null).attr("pointer-events","all").append("svg:g").attr("class","graphComponent").attr("id","graphComponent");if(a!=undefined){var b=a.getForce();if(a.isResizable()!=undefined&&a.isResizable()!=false){metExploreD3.GraphNetwork.task.cancel()}a.setResizable(true);metExploreD3.GraphNetwork.task=metExploreD3.createDelayedTask(function(){a.setResizable(false)})}d3.select("#"+l).select("#D3viz").attr("animation",function(){if(a.isAnimated()){return true}else{return false}}).append("svg:g").attr("class","buttonAnim").attr("id","buttonAnim").on("click",metExploreD3.GraphNetwork.play).style("cursor","hand").append("image").attr("xlink:href",function(){if(a.isAnimated()){return document.location.href.split("index.html")[0]+"resources/icons/pause.svg"}else{return document.location.href.split("index.html")[0]+"resources/icons/play.svg"}}).attr("width","50").attr("height","50").attr("transform","translate(10,10) scale(.5)");d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonRescale").attr("id","buttonRescale").on("click",function(){metExploreD3.GraphNetwork.rescale(l)}).style("cursor","hand").append("image").attr("xlink:href",function(){return document.location.href.split("index.html")[0]+"resources/icons/rescale.png"}).attr("width","50").attr("height","50").attr("transform","translate(80,10) scale(.5)");d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","whiteBlack").attr("id","whiteBlack").attr("x",(k-100)).attr("y",100).on("click",function(){if(d3.select("#"+l).style("-webkit-filter").search("grayscale")==-1&&d3.select("#"+l).style("filter").search("grayscale")==-1){d3.select("#"+l).style("filter","grayscale(100%)").style("-webkit-filter","grayscale(100%)")}else{d3.select("#"+l).style("filter","").style("-webkit-filter","")}}).style("cursor","hand").style("visibility","hidden").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/blackWhite.png").attr("width","50").attr("height","50").attr("transform","translate("+(k-100)+",100) scale(0.5)");d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","invertColor").attr("id","invertColor").attr("x",(k-100)).attr("y",150).on("click",function(){if(d3.select("#"+l).style("-webkit-filter").search("invert")==-1&&d3.select("#"+l).style("filter").search("invert")==-1){d3.select("#"+l).style("filter","invert(100%)").style("-webkit-filter","invert(100%)")}else{d3.select("#"+l).style("filter","").style("-webkit-filter","")}}).style("cursor","hand").style("visibility","hidden").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/invertColor.svg").attr("width","50").attr("height","50").attr("transform","translate("+(k-100)+",150) scale(0.5)");d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonZoomIn").attr("id","buttonZoomIn").attr("x",(k-60)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomIn).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomin.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(k-60)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonZoomOut").attr("id","buttonZoomOut").attr("x",(k-110)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomOut).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomout.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(k-110)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonHand").attr("id","buttonHand").attr("x",(k-160)).attr("y",10).attr("scrollable","false").on("click",metExploreD3.GraphNetwork.moveGraph).style("opacity",1).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/handcursor.svg").attr("width","50").attr("height","50").attr("transform","translate("+(k-160)+",10) scale(1)");d3.select("#"+l).select("#D3viz").select("buttonHand").style("opacity",0);d3.select("#"+l).on("mouseover",function(){d3.select("#"+l).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",1);d3.select("#"+l).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",1);var w=_metExploreViz.getSessionById(l);if(w.isActive()){var h=d3.select("#"+l).select("#buttonHand").attr("scrollable");if(h=="false"){d3.select("#"+l).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0.2)}else{d3.select("#"+l).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",1)}}}).on("mouseout",function(){d3.select("#"+l).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",0);d3.select("#"+l).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",0);d3.select("#"+l).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0)});if(a.isAnimated()){metExploreD3.GraphNetwork.setAnimated(l,true)}else{metExploreD3.GraphNetwork.setAnimated(l,false)}var x=metExploreD3.getLinkStyle();var y=metExploreD3.getMetaboliteStyle();metExploreD3.GraphLink.refreshLink(l,a,x,y);metExploreD3.GraphNode.refreshNode(l);if(l!="viz"){d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonLink").attr("id","buttonLink").attr("isLink","false").on("click",metExploreD3.GraphNetwork.setLink).style("cursor","hand").append("image").attr("xlink:href",function(){if(a.isLinked()){return document.location.href.split("index.html")[0]+"resources/icons/link.svg"}else{return document.location.href.split("index.html")[0]+"resources/icons/unlink.svg"}}).attr("width","50").attr("height","50").attr("transform","translate(10,50) scale(.5)")}else{metExploreD3.GraphNetwork.looksLinked();if(a.isLinked()){metExploreD3.GraphNetwork.graphAlignment(l)}}var f=a.getD3Data();var b=a.getForce();b.nodes(f.getNodes()).links(f.getLinks()).on("tick",function(D){var w=metExploreD3.getGeneralStyle().useClusters();var C=metExploreD3.getGeneralStyle().isDisplayedConvexhulls();if(w&&C!=false){var h=D.alpha*0.1;f.getNodes().forEach(function(J){if(C=="Compartments"){var K=null;if(J.getBiologicalType()=="metabolite"){K=J.getCompartment()}else{var I=[];for(var H in a.groups){if(a.groups.hasOwnProperty(H)){var F=a.groups[H].values.indexOf(J);if(F!=-1){I.push(a.groups[H].key)}}}if(I.length<2){K=I[0]}}if(K!=null){var G=_metExploreViz.getSessionById(l).getForceCentroids();var E=G.nodes().find(function(L){return L.id==K});J.x+=(E.x-J.x)*h;J.y+=(E.y-J.y)*h}}else{if(C=="Pathways"&&J.getPathways().length<2){var K=a.getGroupByKey(J.getPathways()[0]);if(K!=null){var G=_metExploreViz.getSessionById(l).getForceCentroids();var E=G.nodes().find(function(L){return L.id==J.getPathways()[0]});J.x+=(E.x-J.x)*h;J.y+=(E.y-J.y)*h}}}})}if(b.alpha()>=0.005){setTimeout(metExploreD3.GraphNetwork.tick(l),0)}});if(a.isAnimated()){b.start()}else{b.start();b.stop();metExploreD3.GraphNetwork.tick(l)}var q=p.isDisplayedConvexhulls();if(q&&l=="viz"){metExploreD3.GraphLink.displayConvexhulls(l)}a.setForce(b);metExploreD3.sortCompartmentInBiosource();metExploreD3.GraphNode.colorStoreByCompartment(metExploreD3.GraphNode.node)},rescale:function(b){var h=d3.select("#"+b).select("#D3viz")[0][0].getElementById("graphComponent").getBoundingClientRect();var j=document.getElementById(b).getBoundingClientRect();var g=j.bottom-j.top-20;var n=h.bottom-h.top;var e=metExploreD3.getScaleById(b);var k=e.getZoom();var f=g*k.scale()/n;e.setZoomScale(f);var d=h.right-h.left;var n=h.bottom-h.top;var g=j.bottom-j.top-20;var l=j.right-j.left-20;d3.select("#"+b).select("#D3viz").select("#graphComponent");var m=e.getZoom();m.scale(f);var c=(l/2-((l/2)*m.scale()));var a=(g/2-((g/2)*m.scale()));m.translate([c,a]);d3.select("#"+b).select("#D3viz").select("#graphComponent").attr("transform","translate("+c+","+a+")scale("+f+")");metExploreD3.GraphLink.tick(b,e);metExploreD3.GraphNode.tick(b)},initCentroids:function(){var a="viz";var f=parseInt(metExploreD3.GraphPanel.getHeight(a));var l=parseInt(metExploreD3.GraphPanel.getWidth(a));var e=metExploreD3.getLinkStyle();var k=metExploreD3.getGeneralStyle();var j=_metExploreViz.getSessionById(a);var d=j.getD3Data();var b=d3.layout.force().friction(0.9).gravity(0.08).charge(-4000).theta(0.2).linkDistance(600).size([l,f]);j.setForceCentroids(b);var c=metExploreD3.getGeneralStyle().isDisplayedConvexhulls();var g=[];if(c=="Compartments"){d.getCompartments().forEach(function(h){g.push({id:h.identifier,x:2,y:2})});var m=[];d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(h){return h.getBiologicalType()=="reaction"}).filter(function(p){var o=0;for(var n in j.groups){if(j.groups.hasOwnProperty(n)){if(j.groups[n].values!=undefined){return false}var h=j.groups[n].values.indexOf(p);if(h!=-1){o++}}}return o.length>1}).each(function(h){h.getCompartment().forEach(function(n){h.getCompartment().forEach(function(q){if(n!=q){var o=g.findIndex(function(s){return s.id==n});var p=g.findIndex(function(s){return s.id==q});var r=m.find(function(s){return s.source==o&&s.target==p});if(r==undefined){m.push({source:o,target:p})}}})})})}else{d.getPathways().forEach(function(h){g.push({id:h,x:2,y:2})});var m=[];d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(h){return h.getPathways().length>1}).each(function(h){h.getPathways().forEach(function(n){h.getPathways().forEach(function(p){if(n!=p){var o=g.findIndex(function(s){return s.id==n});var q=g.findIndex(function(s){return s.id==p});var r=m.find(function(s){return s.source==o&&s.target==q});if(r==undefined){m.push({source:o,target:q})}}})})})}b.nodes(g).links(m).start()},moveGraph:function(){_MyThisGraphNode.dblClickable=false;var a=this.parentNode.parentNode.id;var b=d3.select("#"+a).select("#buttonHand").attr("scrollable");if(b=="false"){d3.select("#"+a).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",1);d3.select("#"+a).select("#buttonHand").attr("scrollable",true)}else{d3.select("#"+a).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0.2);d3.select("#"+a).select("#buttonHand").attr("scrollable",false)}},graphAlignment:function(a){var d=_metExploreViz.getSessionById(a);if(a!="viz"){var b=_metExploreViz.getSessionById("viz");d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").each(function(h){var g=this;var f=d3.select(g).select("rect").style("fill");d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").each(function(o){if(o.getId()==h.getId()){h.x=o.x;h.y=o.y;if(o.getMappingDatasLength()>0){o.getMappingDatas().forEach(function(p){if(p.getMapValue()==undefined){h.addMappingData(new MappingData(h,p.getMappingName().valueOf(),p.getConditionName().valueOf(),undefined))}else{h.addMappingData(new MappingData(h,p.getMappingName().valueOf(),p.getConditionName().valueOf(),p.getMapValue().valueOf()))}})}if(h.selected&&!o.isSelected()){_MyThisGraphNode.selection(o,"viz")}if(!h.selected&&o.isSelected()){_MyThisGraphNode.selection(h,a)}var m=d3.select(this).select("rect."+o.getBiologicalType()).style("fill");if(f!=m){d3.select(g).select("rect."+o.getBiologicalType()).style("fill",m);if(o.getBiologicalType()=="metabolite"){var k=metExploreD3.getMetaboliteStyle()}else{var k=metExploreD3.getReactionStyle();var l=metExploreD3.GraphUtils.chooseTextColor(m);d3.select(g).select("text").style("fill",l)}var j=d3.select(this).select("rect."+o.getBiologicalType()).attr("mapped");if(j>0){d3.select(g).insert("rect",":first-child").attr("class","stroke").attr("width",k.getWidth()+4).attr("height",k.getHeight()+4).attr("rx",k.getRX()).attr("ry",k.getRY()).attr("transform","translate(-"+parseInt(k.getWidth()+4)/2+",-"+parseInt(k.getHeight()+4)/2+")").style("opacity","0.5").style("fill","red")}d.setMappingDataType(b.getMappingDataType());d.setMapped(b.isMapped())}else{if(d3.select(this).select("rect.stroke")[0][0]!=null){var n=d3.select(this).select("rect.stroke").style("fill");if(o.getBiologicalType()=="reaction"){d3.select(g).attr("mapped","true").insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select(".reaction").attr("width"))+10).attr("height",parseInt(d3.select(this).select(".reaction").attr("height"))+10).attr("rx",parseInt(d3.select(this).select(".reaction").attr("rx"))+5).attr("ry",parseInt(d3.select(this).select(".reaction").attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select(".reaction").attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select(".reaction").attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red")}else{if(o.getBiologicalType()=="metabolite"){d3.select(g).attr("mapped","true").insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select(".metabolite").attr("width"))+10).attr("height",parseInt(d3.select(this).select(".metabolite").attr("height"))+10).attr("rx",parseInt(d3.select(this).select(".metabolite").attr("rx"))+5).attr("ry",parseInt(d3.select(this).select(".metabolite").attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select(".metabolite").attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select(".metabolite").attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red")}}d.setMappingDataType(b.getMappingDataType());d.setMapped(b.isMapped())}}}})});d.setActiveMapping(b.getActiveMapping().valueOf());d.resetColorMapping();b.getColorMappingsSet().forEach(function(f){d.addColorMapping(f.getName().valueOf(),f.getValue().valueOf())});var c=d.getForce();c.stop();var e=metExploreD3.getScaleById(a);metExploreD3.GraphLink.tick(a,e);metExploreD3.GraphNode.tick(a)}},scaledX:function(a,b){var h=metExploreD3.getSessionsSet();var g;if(b=="viz"){var f;for(var d in sessions){if(sessions[d].getId()=="viz"){f=sessions[d].getId()}}var e=parseInt(d3.select("#"+f).select("#D3viz").style("width"));var c=parseInt(d3.select("#viz").select("#D3viz").style("width"));g=(a*e)/c}else{var f;for(var d in sessions){if(sessions[d].getId()=="viz"){f=sessions[d].getId()}}var e=parseInt(d3.select("#"+b).select("#D3viz").style("width"));var c=parseInt(d3.select("#viz").select("#D3viz").style("width"));g=(a*c)/e}return g},scaledY:function(h,a){var g=metExploreD3.getSessionsSet();var b;if(a=="viz"){var f;for(var d in sessions){if(sessions[d].getId()=="viz"){f=sessions[d].getId()}}var e=parseInt(d3.select("#"+f).select("#D3viz").style("height"));var c=parseInt(d3.select("#viz").select("#D3viz").style("height"));b=(h*e)/c}else{var f;for(var d in sessions){if(sessions[d].getId()=="viz"){f=sessions[d].getId()}}var e=parseInt(d3.select("#"+a).select("#D3viz").style("height"));var c=parseInt(d3.select("#viz").select("#D3viz").style("height"));b=(h*c)/e}return Scaled},addLinkInDrawing:function(j,b,h,n,a,c){var m=_metExploreViz.getSessionById(c);var g=m.getD3Data();g.addLink(j,b,h,n,a);var k=metExploreD3.getMetaboliteStyle();var f=metExploreD3.getLinkStyle();var e=m.getForce();var o=_metExploreViz.getSessionById(c).getMappingDataType()=="Flux";var d={};if(o){d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(p){if(b.getBiologicalType()=="metabolite"){return(p.getSource().getId()==b.getIdentifier()||p.getSource().getId()==h.getId())&&(p.getTarget().getId()==b.getIdentifier()||p.getTarget().getId()==h.getId())}else{return(p.getSource().getId()==b.getId()||p.getSource().getId()==h.getIdentifier())&&(p.getTarget().getId()==b.getId()||p.getTarget().getId()==h.getIdentifier())}}).each(function(r){var p;if(b.getBiologicalType()=="reaction"){p=b.getId()}else{p=h.getId()}var q;if(this.id=="linkRev"){q="linkRev"}else{q="link"}if(d[p]==undefined){d[p]={}}d[p][q]={fill:d3.select(this).style("fill"),strokeDasharray:d3.select(this).style("stroke-dasharray")}});var l=d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("path.link").data(e.links(),function(p){return p.source.id+"-"+p.target.id}).enter().insert("svg:g",":first-child");l.each(function(p){d3.select(this).filter(function(r){var q;if(b.getBiologicalType()=="reaction"){q=b.getId()}else{q=h.getId()}return d[q].link!=undefined}).append("svg:path").attr("class",String).attr("d",function(q){return metExploreD3.GraphLink.funcPathForFlux(q,c,this.id)}).attr("class","link").attr("fill-rule","evenodd").style("stroke",f.getStrokeColor()).style("stroke-width",0.5).style("opacity",0.1).style("stroke-dasharray",function(r){var q;if(b.getBiologicalType()=="reaction"){q=b.getId()}else{q=h.getId()}return d[q].link.strokeDasharray}).style("fill",function(r){var q;if(b.getBiologicalType()=="reaction"){q=b.getId()}else{q=h.getId()}return d[q].link.fill}).on("mouseover",function(w){var v,s,q,u;if(w.getSource().getBiologicalType()=="reaction"){v=w.getSource();s=w.getTarget()}else{v=w.getTarget();s=w.getSource()}q=w.getSource();u=w.getTarget();var z=_metExploreViz.getSessionById("viz").getActiveMapping();var r=_metExploreViz.getMappingByName(z);var y=r.getConditions();var x=v.getMappingDataByNameAndCond(z,y[0]);if(x!=null){var A=x.getMapValue();if(A<0){u=w.getSource();q=w.getTarget()}}if(!document.getElementById("tooltip2").classList.contains("fixed")){var t="Name: "+w.id+"<br/><b>Source:</b> "+q.getName()+"<br/><b>Target:</b> "+u.getName()+((A!=undefined)?"<br/>Flux: "+Math.abs(A):"");t+="<br/>";document.getElementById("tooltip2").innerHTML=t;document.getElementById("tooltip2").classList.remove("hide")}}).on("mouseout",function(q){document.getElementById("tooltip2").classList.add("hide")});d3.select(this).filter(function(r){var q;if(b.getBiologicalType()=="reaction"){q=b.getId()}else{q=h.getId()}return d[q].linkRev!=undefined}).append("svg:path").attr("class",String).attr("id","linkRev").attr("d",function(q){return metExploreD3.GraphLink.funcPathForFlux(q,c,this.id)}).attr("class","link").attr("fill-rule","evenodd").style("stroke",f.getStrokeColor()).style("stroke-width",0.5).style("opacity",0.1).style("stroke-dasharray",function(r){var q;if(b.getBiologicalType()=="reaction"){q=b.getId()}else{q=h.getId()}return d[q].linkRev.strokeDasharray}).style("fill",function(r){var q;if(b.getBiologicalType()=="reaction"){q=b.getId()}else{q=h.getId()}return d[q].linkRev.fill}).on("mouseover",function(w){var v,s,q,u;if(w.getSource().getBiologicalType()=="reaction"){v=w.getSource();s=w.getTarget()}else{v=w.getTarget();s=w.getSource()}q=w.getSource();u=w.getTarget();var z=_metExploreViz.getSessionById("viz").getActiveMapping();var r=_metExploreViz.getMappingByName(z);var y=r.getConditions();var x=v.getMappingDataByNameAndCond(z,y[1]);if(x!=null){var A=x.getMapValue();if(A<0){u=w.getSource();q=w.getTarget()}}if(!document.getElementById("tooltip2").classList.contains("fixed")){var t="Name: "+w.id+"<br/><b>Source: </b>"+q.getName()+"<br/><b>Target: </b>"+u.getName()+((A!=undefined)?"<br/>Flux: "+Math.abs(A):"");t+="<br/>";document.getElementById("tooltip2").innerHTML=t;document.getElementById("tooltip2").classList.remove("hide")}}).on("mouseout",function(q){document.getElementById("tooltip2").classList.add("hide")})})}else{link=d3.select("#"+c).select("#graphComponent").selectAll("path.link").data(e.links(),function(p){return p.source.id+"-"+p.target.id}).enter().insert("path",":first-child").attr("class",String).attr("d",function(p){return metExploreD3.GraphLink.funcPath4(p,c)}).attr("class","link").attr("fill-rule","evenodd").attr("fill",function(p){if(p.interaction=="out"){return f.getMarkerOutColor()}else{return f.getMarkerInColor()}}).style("stroke",f.getStrokeColor()).style("stroke-width",0.5).style("opacity",0.5).attr("x1",b.x).attr("y1",b.y).attr("x2",h.x).attr("y2",h.y)}},addMetaboliteInDrawing:function(l,p,h,m){var d=p+"-"+h;var a=_metExploreViz.getSessionById(m);var e=a.getD3Data();var b=a.getForce();var v=metExploreD3.getMetaboliteStyle();var t=metExploreD3.getGeneralStyle();var q=d3.behavior.drag().on("dragstart",_MyThisGraphNode.dragstart).on("drag",_MyThisGraphNode.dragmove).on("dragend",_MyThisGraphNode.dragend);var w=metExploreD3.getScaleById(m);metExploreD3.fireEventParentWebSite("sideCompound",l);var c=e.addNode(l.getName(),l.getCompartment(),l.getDbIdentifier(),d,l.getReactionReversibility(),l.getBiologicalType(),false,l.getLabelVisible(),l.getSvg(),l.getSvgWidth(),l.getSvgHeight(),l.getIsSideCompound(),undefined,true,p,e.getNodeById(h).getPathways(),undefined,l.getLabel());if(l.getMappingDatasLength()!=0){l.getMappingDatas().forEach(function(y){e.getNodeById(d).addMappingData(new MappingData(l,y.getMappingName(),y.getConditionName(),y.getMapValue()))})}var s=d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("g.node");var o=false;var r=s.filter(function(y){return y.getId()==p});r.each(function(){o=this.getAttribute("mapped")});s=s.data(b.nodes(),function(y){return y.getId()});s.enter().append("svg:g").attr("class","node").attr("duplicated",function(y){return"true"}).call(q).style("fill","white");s.filter(function(y){return y.getBiologicalType()=="metabolite"}).filter(function(y){return y.getId()==d}).style("stroke-opacity",0.5).addNodeForm(v.getWidth()/2,v.getHeight()/2,v.getRX()/2,v.getRY()/2,v.getStrokeColor(),v.getStrokeWidth()/2);s.filter(function(y){return y.getBiologicalType()=="metabolite"}).filter(function(y){return y.getId()==d}).on("mouseenter",function(z){var y=d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).each(function(B){var A=y[0][y.size()-1];this.parentNode.insertBefore(this,A)}).attr("transform","translate("+z.x+", "+z.y+") scale(2)")}).on("mouseover",function(B){B.fixed=true;s.filter(function(C){return C==B}).select(".locker").classed("hide",false).select(".iconlocker").attr("xlink:href",function(C){if(C.isLocked()){return"resources/icons/lock_font_awesome.svg"}else{return"resources/icons/unlock_font_awesome.svg"}});if(B.getBiologicalType()=="reaction"){d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(C){return B.getId()==C.getSource().getId()}).style("stroke","green");d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(C){return B.getId()==C.getTarget().getId()}).style("stroke","red")}else{d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(C){return B.getId()==C.getSource().getId()}).style("stroke","red");d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(C){return B.getId()==C.getTarget().getId()}).style("stroke","green")}var A=w.getXScale();var z=w.getYScale();if(!document.getElementById("tooltip2").classList.contains("fixed")){var y="<b>Name:</b> "+B.getName()+"<br/><b>Biological type:</b> "+B.getBiologicalType()+((B.getCompartment()!=undefined)?"<br/><b>Compartment:</b> "+B.getCompartment():"")+((B.getDbIdentifier()!=undefined)?"<br/><b>Database identifier:</b> "+B.getDbIdentifier():"")+((B.getEC()!=undefined)?"<br/><b>EC number:</b> "+B.getEC():"")+((B.getReactionReversibility()!=undefined)?"<br/><b>Reaction reversibility:</b> "+B.getReactionReversibility():"")+((B.getIsSideCompound()!=undefined)?"<br/><b>SideCompound:</b> "+B.getIsSideCompound():"")+((B.getMappingDatasLength()!=0)?((B.getMappingDatasLength()==1)?"<br/><b>Mapping:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>":"<br/><b>Mappings:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>"):"");B.getMappingDatas().forEach(function(C){y+="<tr><td>"+C.getMappingName()+"</td><td>"+C.getConditionName()+"</td><td>"+C.getMapValue()+"</td></tr>"});y+="</table>";if(B.getSvg()!=undefined&&B.getSvg()!="undefined"&&B.getSvg()!=""){y+='<br/><img src="resources/images/structure_metabolite/'+B.getSvg()+'"/>'}document.getElementById("tooltip2").innerHTML=y;document.getElementById("tooltip2").classList.remove("hide")}}).on("mouseleave",function(z){d3.select(this).attr("transform","translate("+z.x+", "+z.y+") scale(1)");if(!z.isLocked()){z.fixed=false}s.filter(function(A){return A==z}).select(".locker").classed("hide",true);var y=metExploreD3.getLinkStyle();document.getElementById("tooltip2").classList.add("hide");d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(A){return z.getId()==A.getSource().getId()||z.getId()==A.getTarget().getId()}).style("stroke",y.getStrokeColor());if(z.getBiologicalType()=="reaction"){d3.select(this).selectAll("rect").selectAll(".reaction, .fontSelected").transition().duration(750).attr("width",reactionStyle.getWidth()).attr("height",reactionStyle.getHeight()).attr("transform","translate(-"+reactionStyle.getWidth()/2+",-"+reactionStyle.getHeight()/2+")")}else{d3.select(this).selectAll("rect").selectAll(".reaction, .fontSelected").transition().duration(750).attr("width",v.getWidth()).attr("height",v.getHeight()).attr("transform","translate(-"+v.getWidth()/2+",-"+v.getHeight()/2+")")}});var x=s.filter(function(y){return y.getId()==d});metExploreD3.GraphNode.colorStoreByCompartment(x);if(e.getNodes().length<t.getReactionThreshold()||!t.isDisplayedLabelsForOpt()){var n=Math.min(v.getWidth()/2,v.getHeight()/2);s.filter(function(y){return y.getId()==d}).filter(function(y){return y.getLabelVisible()==true}).filter(function(y){return y.getBiologicalType()=="metabolite"}).filter(function(y){return y.getSvg()=="undefined"||y.getSvg()==undefined||y.getSvg()==""}).append("svg:text").attr("fill","black").attr("class",function(y){return y.getBiologicalType()}).text(function(z){var y=z.getName();if(z.getLabel()!=undefined){y=z.getLabel()}return $("<div/>").html(y).text()}).style("font-size",function(y){return Math.min((2*n/2),(2*n/2-3)/this.getComputedTextLength()*10)+"px"}).attr("dy",".3em").style("pointer-events","none").style("opacity",0.5);s.filter(function(y){return y.getId()==d}).filter(function(y){return y.getLabelVisible()==true}).filter(function(y){return y.getBiologicalType()=="metabolite"}).filter(function(y){return y.getSvg()!="undefined"&&y.getSvg()!=undefined&&y.getSvg()!=""}).append("svg:text").attr("fill","black").attr("class",function(y){return y.getBiologicalType()}).text(function(z){var y=z.getName();if(z.getLabel()!=undefined){y=z.getLabel()}return $("<div/>").html(y).text()}).style("font-size",function(y){return Math.min((n)/2,((n-3)/this.getComputedTextLength()*10)/2)+"px"}).attr("dy",".3em").style("pointer-events","none").attr("y",+(3/4*(n/2)));s.filter(function(y){return y.getId()==d}).filter(function(y){return(y.getBiologicalType()=="metabolite"&&y.getSvg()!="undefined"&&y.getSvg()!=undefined&&y.getSvg()!="")}).append("svg").attr("viewBox",function(y){return"0 0 "+n+" "+n}).attr("width",n*8/10+"px").attr("height",n*8/10+"px").attr("x",(-n/2)+(n*1/10)).attr("preserveAspectRatio","xMinYMin").attr("y",(-n/2)+(n*1/10)).attr("class","structure_metabolite").append("image").style("opacity",0.5).attr("xlink:href",function(y){return"resources/images/structure_metabolite/"+y.getSvg()}).attr("width","100%").attr("height","100%");var j=s.filter(function(y){return y.getId()==d}).insert("svg",":first-child").attr("viewBox",function(y){+" "+n}).attr("width",v.getWidth()/2).attr("height",v.getHeight()/2).attr("preserveAspectRatio","xMinYMin").attr("y",-v.getHeight()/2).attr("x",-v.getWidth()/2).attr("class","locker").classed("hide",true);j.append("svg:path").attr("class","backgroundlocker").attr("d",function(z){var y="M"+v.getWidth()/2+","+v.getHeight()/2+" L0,"+v.getHeight()/2+" L0,"+v.getRY()*2/2+" A"+v.getRX()*2/2+","+v.getRY()*2/2+",0 0 1 "+v.getRX()*2/2+",0 L"+v.getWidth()/2+",0";return y}).attr("opacity","0.20").attr("fill","black");j.append("image").attr("class","iconlocker").attr("y",v.getHeight()/4/2-(v.getHeight()/2-v.getRY()*2/2)/8).attr("x",v.getWidth()/4/2-(v.getWidth()/2-v.getRX()*2/2)/8).attr("width","40%").attr("height","40%");s.filter(function(y){return y.getId()==d}).filter(function(y){return y.getLabelVisible()==true}).filter(function(y){return y.getBiologicalType()=="reaction"}).append("svg:text").attr("fill","black").attr("class",function(y){return y.getBiologicalType()}).text(function(z){var y=z.getName();if(z.getLabel()!=undefined){y=z.getLabel()}return $("<div/>").html(y).text()}).style("font-size",function(y){return Math.min(2*n,(n-2)/this.getComputedTextLength()*10)+"px"}).attr("dy",".3em")}if(o!=undefined&&o!=false&&o!="false"){if(o==true||o=="true"){s.filter(function(y){return y.getId()==d}).attr("mapped","true").insert("rect",":first-child").attr("class","stroke").attr("width",v.getWidth()/2+10).attr("height",v.getHeight()/2+10).attr("rx",v.getRX()/2+5).attr("ry",v.getRY()/2+5).attr("transform","translate(-"+parseInt(v.getWidth()/2+10)/2+",-"+parseInt(v.getWidth()/2+10)/2+")").style("opacity","0.5").style("fill","red")}else{var u=o;s.filter(function(y){return y.getId()==d}).attr("mapped",u).style("fill",u)}}var g=100;var f=100;s.filter(function(y){return y.getBiologicalType()=="reaction"}).filter(function(y){return y.getId()==h}).each(function(A){var z=A.x-l.x;var y=A.y-l.y;var B=Math.sqrt(Math.pow(z,2)+Math.pow(y,2));g=A.x-(40*z)/B;f=A.y-(40*y)/B});s.filter(function(y){return y.getBiologicalType()=="metabolite"}).filter(function(y){return y.getId()==d}).attr("transform",function(y){return"translate("+g+","+f+")"}).each(function(y){y.px=g;y.py=f;y.x=g;y.y=f});var k=undefined;a.groups.forEach(function(z){if(k=="compartment"){if(z.key==c.getCompartment()){z.values.push(c)}}else{var y=c.getPathways().find(function(A){return z.key==A});if(y!=undefined){z.values.push(c)}}});if(metExploreD3.GraphNetwork.isAnimated(m)==true||metExploreD3.GraphNetwork.isAnimated(m)=="true"){b.start()}return c},duplicateANode:function(o,b){var p=_metExploreViz.getSessionById(b);p.addDuplicatedNode(o.getId());var c=p.getForce();var j=p.getD3Data();var a,q;q=[];a=[];var d=d3.select("#"+b).select("#D3viz");var e=d3.behavior.drag().on("dragstart",function(r){_MyThisGraphNode.dragstart(r)}).on("drag",function(r){_MyThisGraphNode.dragmove(r)}).on("dragend",_MyThisGraphNode.dragend);var h=metExploreD3.getScaleById(b);d.selectAll("path.link").filter(function(r){return r.getInteraction()!="hiddenForce"}).each(function(t){var r=t.source;var s=t.target;if(r==o){if(a.indexOf(s)==-1){a.push(s)}}else{if(s==o){if(q.indexOf(r)==-1){q.push(r)}}}});a.forEach(function(t){var r=o.getId()+"-"+t.getId();var s=metExploreD3.GraphNetwork.addMetaboliteInDrawing(o,o.getId(),t.getId(),b);metExploreD3.GraphNetwork.addLinkInDrawing(r+"-"+t.getId(),s,t,"in",t.getReactionReversibility(),b)});q.forEach(function(t){var r=o.getId()+"-"+t.getId();var s=metExploreD3.GraphNetwork.addMetaboliteInDrawing(o,o.getId(),t.getId(),b);metExploreD3.GraphNetwork.addLinkInDrawing(t.getId()+"-"+r,t,s,"out",t.getReactionReversibility(),b)});var n=metExploreD3.getMetaboliteStyle();var k=metExploreD3.getReactionStyle();var l=Math.max(k.getWidth(),k.getHeight());var m=Math.max(n.getWidth(),n.getHeight());var f=Math.max(l,m);var g=metExploreD3.getLinkStyle();c.linkDistance(function(r){if(r.getSource().getIsSideCompound()||r.getTarget().getIsSideCompound()){return g.getSize()/2+f}else{return g.getSize()+f}})},duplicateSideCompounds:function(b,c){if(b==undefined){b="viz"}var e=d3.select("#"+b).select("#D3viz");var d=[];var a=metExploreD3.createLoadMask("Duplicate in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){e.selectAll("g.node").filter(function(j){return j.getIsSideCompound()&&j.getBiologicalType()=="metabolite"}).filter(function(j){if(this.getAttribute("duplicated")==undefined){return true}else{return !this.getAttribute("duplicated")}}).each(function(j){metExploreD3.GraphNetwork.duplicateSideCompound(j,b);d.push(j)});metExploreD3.hideMask(a);d.forEach(function(j){metExploreD3.GraphNetwork.removeANode(j,b)});if(_metExploreViz.isLinkedByTypeOfMetabolite()){metExploreD3.GraphLink.linkTypeOfMetabolite()}var h=_metExploreViz.getSessionsSet();var f=_metExploreViz.getSessionById(b);if(c!=undefined){c()}if(b!="viz"&&f.isLinked()){metExploreD3.fireEvent("graphPanel","afterDuplicate")}else{for(var g in h){if(h[g].isLinked()&&h[g].getId()!="viz"){metExploreD3.deferFunction(function(){h[g].setLinked(false);metExploreD3.GraphNetwork.looksLinked();var k=h[g].getForce();var j=_metExploreViz.getSessionById("viz");if(h[g]!=undefined){if(j.getDuplicatedNodesCount()>0){var k=h[g].getForce();h[g].setLinked(true);j.setLinked(true);metExploreD3.GraphNetwork.duplicateSideCompounds(h[g].getId());metExploreD3.GraphNetwork.looksLinked();if(h[g].isLinked()){metExploreD3.GraphNetwork.graphAlignment(h[g].getId())}}else{metExploreD3.GraphNetwork.graphAlignment(h[g].getId());h[g].setLinked(true);j.setLinked(true)}}},100)}}}},1)}metExploreD3.GraphNetwork.initCentroids()},duplicateSideCompoundsById:function(c,b){var e=d3.select("#"+b).select("#D3viz");var d=[];var a=metExploreD3.createLoadMask("Duplicate in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){e.selectAll("g.node").filter(function(f){return c.indexOf(f.getId())!=-1}).filter(function(f){if(this.getAttribute("duplicated")==undefined){return true}else{return !this.getAttribute("duplicated")}}).each(function(f){metExploreD3.GraphNetwork.duplicateSideCompound(f,b);d.push(f)});metExploreD3.hideMask(a);d.forEach(function(f){metExploreD3.GraphNetwork.removeANode(f,b)});if(_metExploreViz.isLinkedByTypeOfMetabolite()){metExploreD3.GraphLink.linkTypeOfMetabolite()}},0)}metExploreD3.GraphNetwork.initCentroids()},duplicateSideCompoundsSelected:function(b){var d=d3.select("#"+b).select("#D3viz");var c=[];var a=metExploreD3.createLoadMask("Duplicate in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){d.selectAll("g.node").filter(function(h){return h.isSelected()&&h.getBiologicalType()=="metabolite"}).filter(function(h){if(this.getAttribute("duplicated")==undefined){return true}else{return !this.getAttribute("duplicated")}}).each(function(j){if(metExploreD3.getMetabolitesSet()!=undefined){var h=metExploreD3.getMetaboliteById(metExploreD3.getMetabolitesSet(),j.getId());h.set("sideCompound",true)}j.setIsSideCompound(true);metExploreD3.GraphNetwork.duplicateSideCompound(j,b);c.push(j)});metExploreD3.hideMask(a);c.forEach(function(h){metExploreD3.GraphNetwork.removeANode(h,b)});if(_metExploreViz.isLinkedByTypeOfMetabolite()){metExploreD3.GraphLink.linkTypeOfMetabolite()}var g=_metExploreViz.getSessionsSet();var e=_metExploreViz.getSessionById(b);if(b!="viz"&&e.isLinked()){metExploreD3.fireEvent("graphPanel","afterDuplicate")}else{for(var f in g){if(g[f].isLinked()&&g[f].getId()!="viz"){metExploreD3.deferFunction(function(){g[f].setLinked(false);metExploreD3.GraphNetwork.looksLinked();var j=g[f].getForce();var h=_metExploreViz.getSessionById("viz");if(g[f]!=undefined){if(h.getDuplicatedNodesCount()>0){var j=g[f].getForce();g[f].setLinked(true);h.setLinked(true);metExploreD3.GraphNetwork.duplicateSideCompoundsSelected(g[f].getId());metExploreD3.GraphNetwork.looksLinked();if(g[f].isLinked()){metExploreD3.GraphNetwork.graphAlignment(g[f].getId())}}else{metExploreD3.GraphNetwork.graphAlignment(g[f].getId());g[f].setLinked(true);h.setLinked(true)}}},100)}}}},0)}metExploreD3.GraphNetwork.initCentroids()},duplicateASideCompoundSelected:function(e,b){var d=d3.select("#"+b).select("#D3viz");var c=[];var a=metExploreD3.createLoadMask("Duplicate in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){d.selectAll("g.node").filter(function(j){if(e.querySelector("rect.metabolite")!=null){return j.getId()==e.querySelector("rect.metabolite").id&&j.isSelected()&&j.getBiologicalType()=="metabolite"}else{return false}}).filter(function(j){if(this.getAttribute("duplicated")==undefined){return true}else{return !this.getAttribute("duplicated")}}).each(function(k){if(metExploreD3.getMetabolitesSet()!=undefined){var j=metExploreD3.getMetaboliteById(metExploreD3.getMetabolitesSet(),k.getId());j.set("sideCompound",true)}k.setIsSideCompound(true);metExploreD3.GraphNetwork.duplicateSideCompound(k,b);c.push(k)});metExploreD3.hideMask(a);c.forEach(function(j){metExploreD3.GraphNetwork.removeANode(j,b)});if(_metExploreViz.isLinkedByTypeOfMetabolite()){metExploreD3.GraphLink.linkTypeOfMetabolite()}var h=_metExploreViz.getSessionsSet();var f=_metExploreViz.getSessionById(b);if(b!="viz"&&f.isLinked()){metExploreD3.fireEvent("graphPanel","afterDuplicate")}else{for(var g in h){if(h[g].isLinked()&&h[g].getId()!="viz"){metExploreD3.deferFunction(function(){h[g].setLinked(false);metExploreD3.GraphNetwork.looksLinked();var k=h[g].getForce();var j=_metExploreViz.getSessionById("viz");if(h[g]!=undefined){if(j.getDuplicatedNodesCount()>0){var k=h[g].getForce();h[g].setLinked(true);j.setLinked(true);metExploreD3.GraphNetwork.duplicateASideCompoundSelected(e,h[g].getId());metExploreD3.GraphNetwork.looksLinked();if(h[g].isLinked()){metExploreD3.GraphNetwork.graphAlignment(h[g].getId())}}else{metExploreD3.GraphNetwork.graphAlignment(h[g].getId());h[g].setLinked(true);j.setLinked(true)}}},100)}}}},0)}metExploreD3.GraphNetwork.initCentroids()},duplicateSideCompound:function(d,a){var e=_metExploreViz.getSessionById(a);var c=d3.select("#"+a).select("#D3viz");if(e!=undefined){if(e.isLinked()){var e=_metExploreViz.getSessionById("viz");if(e!=undefined){var b=e.getForce();if(b!=undefined){if(metExploreD3.GraphNetwork.isAnimated("viz")=="true"||metExploreD3.GraphNetwork.isAnimated("viz")==true){b.resume()}}}}else{var b=e.getForce();if(b!=undefined){if(metExploreD3.GraphNetwork.isAnimated(a)=="true"||metExploreD3.GraphNetwork.isAnimated(a)==true){b.resume()}}}}metExploreD3.GraphNetwork.duplicateANode(d,a);if(e!=undefined){if(b!=undefined){if(metExploreD3.GraphNetwork.isAnimated(a)=="true"||metExploreD3.GraphNetwork.isAnimated(a)==true){b.start()}}}metExploreD3.GraphNetwork.initCentroids()},removeSelectedNode:function(b){var e=_metExploreViz.getSessionById(b);var d=e.getForce();var c=e.getD3Data();var a=metExploreD3.createLoadMask("Remove in process...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){var g=d3.select("#"+b).select("#D3viz");if(h!=undefined){if(h.isLinked()){var h=_metExploreViz.getSessionById("viz");if(h!=undefined){var f=h.getForce();if(f!=undefined){if(metExploreD3.GraphNetwork.isAnimated("viz")=="true"){f.stop()}}}}else{var f=h.getForce();if(f!=undefined){if(metExploreD3.GraphNetwork.isAnimated(b)=="true"){f.stop()}}}}g.selectAll("g.node").filter(function(j){return j.isSelected()}).each(function(j){metExploreD3.GraphNetwork.removeANode(j,b)});metExploreD3.hideMask(a);metExploreD3.GraphNetwork.removeIsolatedNode(b);if(h!=undefined){if(f!=undefined){if(metExploreD3.GraphNetwork.isAnimated(b)=="true"){f.start()}}}},1)}metExploreD3.GraphNetwork.initCentroids()},removeOnlyClickedNode:function(f,b){var e=_metExploreViz.getSessionById(b);var d=e.getForce();var c=e.getD3Data();var a=metExploreD3.createLoadMask("Remove in process...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){var h=d3.select("#"+b).select("#D3viz");if(j!=undefined){if(j.isLinked()){var j=metExploreD3.getSessionById(sessionsStore,"viz");if(j!=undefined){var g=j.getForce();if(g!=undefined){if(metExploreD3.GraphNetwork.isAnimated("viz")=="true"){g.resume()}}}}else{var g=j.getForce();if(g!=undefined){if(metExploreD3.GraphNetwork.isAnimated(b)=="true"){g.resume()}}}}metExploreD3.GraphNetwork.removeASelectedNode(f,b);metExploreD3.GraphNetwork.removeIsolatedNode(b);if(j!=undefined){if(g!=undefined){if(metExploreD3.GraphNetwork.isAnimated(b)=="true"){g.start()}}}metExploreD3.hideMask(a)},100)}},removeASelectedNode:function(e,b){var f=_metExploreViz.getSessionById(b);var a=metExploreD3.createLoadMask("Remove in process...",b);if(a!=undefined){metExploreD3.showMask(a);var d=d3.select("#"+b).select("#D3viz");if(f!=undefined){if(f.isLinked()){var f=metExploreD3.getSessionById(sessionsStore,"viz");if(f!=undefined){var c=f.getForce();if(c!=undefined){if(metExploreD3.GraphNetwork.isAnimated("viz")=="true"){c.resume()}}}}else{var c=f.getForce();if(c!=undefined){if(metExploreD3.GraphNetwork.isAnimated(b)=="true"){c.resume()}}}}metExploreD3.GraphNetwork.removeANode(e,b);if(f!=undefined){if(c!=undefined){if(metExploreD3.GraphNetwork.isAnimated("viz")=="true"){c.start()}}}metExploreD3.hideMask(a)}metExploreD3.GraphNetwork.initCentroids()},removeANode:function(h,b){var g=_metExploreViz.getSessionById(b);var f=g.getForce();var e=g.getD3Data();var a=[];var d=d3.select("#"+b).select("#D3viz");d.selectAll("path.link").filter(function(l){var j=l.source;var k=l.target;if(j==h||k==h){a.push(l)}return(j==h||k==h)}).remove();var c=d.selectAll("g.node");c.filter(function(j){return h==j}).transition().duration(1000).style("opacity",0).remove();setTimeout(function(){var l=g.getSelectedNodes();var j=l.indexOf(h.getId());if(j!=-1){l.splice(j,1)}g.groups.forEach(function(n){if(n.key==h.getCompartment()){var m=n.values.indexOf(h);if(m!=-1){n.values.splice(m,1)}if(n.values.length==0){m=g.groups.indexOf(n);if(m!=-1){g.groups.splice(m,1);d3.select("#"+b).select("#D3viz").select("path#"+n.key).remove()}}}h.getPathways().forEach(function(p){if(n.key==p){var o=n.values.indexOf(h);if(o!=-1){n.values.splice(o,1)}if(n.values.length==0){o=g.groups.indexOf(n);if(o!=-1){g.groups.splice(o,1);d3.select("#"+b).select("#D3viz").select("path#"+n.key).remove()}}}})});var j=f.nodes().indexOf(h);if(j!=-1){f.nodes().splice(j,1)}for(i=0;i<a.length;i++){var k=a[i];var j=f.links().indexOf(k);if(j!=-1){f.links().splice(j,1)}}},1)},removeIsolatedNode:function(b){var g=_metExploreViz.getSessionById(b);var d=g.getForce();var f=g.getD3Data();var h=[];var e=d3.select("#"+b).select("#D3viz");var j=[];var c=f.getNodes().map(function(k){return k.getId()});var a=false;e.selectAll("path.link").each(function(k){var n=k.source;var o=k.target;var l=c.indexOf(n.getId());if(l!=-1){c.splice(l,1)}var m=c.indexOf(o.getId());if(m!=-1){c.splice(m,1)}});e.selectAll("g.node").filter(function(k){return c.indexOf(k.getId())!=-1}).each(function(k){h.push(k)}).transition().duration(1000).style("opacity",0).remove();setTimeout(function(){for(i=0;i<h.length;i++){var l=h[i];g.groups.forEach(function(n){if(n.key==l.getCompartment()){var m=n.values.indexOf(l);if(m!=-1){n.values.splice(m,1)}if(n.values.length==0){m=g.groups.indexOf(n);if(m!=-1){g.groups.splice(m,1);d3.select("#"+b).select("#D3viz").select("path#"+n.key).remove()}}}l.getPathways().forEach(function(p){if(n.key==p){var o=n.values.indexOf(l);if(o!=-1){n.values.splice(o,1)}if(n.values.length==0){o=g.groups.indexOf(n);if(o!=-1){g.groups.splice(o,1);d3.select("#"+b).select("#D3viz").select("path#"+n.key).remove()}}}})});var k=d.nodes().indexOf(l);if(k!=-1){d.nodes().splice(k,1)}}for(i=0;i<h.length;i++){var l=h[i];var k=d.nodes().indexOf(l);if(k!=-1){d.nodes().splice(k,1)}}},10)},removeSideCompounds:function(){var a=d3.select("#viz").select("#D3viz");a.selectAll("g.node").filter(function(b){return b.getBiologicalType()=="metabolite"&&b.getIsSideCompound()}).each(function(b){metExploreD3.GraphNetwork.removeASelectedNode(b,"viz")});metExploreD3.GraphNetwork.removeIsolatedNode("viz");metExploreD3.GraphNetwork.initCentroids()},setAnimated:function(a,b){if(b){d3.select("#"+a).select("#D3viz").attr("animation","true");_metExploreViz.getSessionById(a).setAnimated(true)}else{d3.select("#"+a).select("#D3viz").attr("animation","false");_metExploreViz.getSessionById(a).setAnimated(false)}},isAnimated:function(a){return d3.select("#"+a).select("#D3viz").attr("animation")},selectAllNodes:function(a){return d3.select("#"+a).select("#D3viz").selectAll("g.node")},stopForce:function(b){var a=b.getForce();if(a!=undefined){a.stop();metExploreD3.GraphNetwork.setAnimated(b.getId(),false)}},loadSvg:function(g,l){var n=parseInt(metExploreD3.GraphPanel.getHeight(l));var j=parseInt(metExploreD3.GraphPanel.getWidth(l));var q=metExploreD3.getLinkStyle();var b=g.getForce();var s=metExploreD3.getScaleById(l);if(l=="viz"){metExploreD3.GraphCaption.drawCaption()}if(s==undefined){var f=metExploreD3.GraphNetwork;metExploreD3.GraphNetwork.zoomListener=d3.behavior.zoom().x(t).y(d).scaleExtent([0.01,30]).on("zoom",function(u){if(metExploreD3.GraphNetwork.zoomListener.scale()<0.8){d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",true)}else{d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",false)}var h=_metExploreViz.getSessionById(l);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){f.zoom(l)}});s.add({graphName:l,xScale:t,yScale:d,zoomScale:1,xScaleCompare:1,yScaleCompare:1,zoomScaleCompare:metExploreD3.GraphNetwork.zoomListener.scale(),zoom:metExploreD3.GraphNetwork.zoomListener})}else{var f=metExploreD3.GraphNetwork;var t=d3.scale.linear().domain([0,j]).range([0,j]);var d=d3.scale.linear().domain([n,0]).range([n,0]);metExploreD3.GraphNetwork.zoomListener=d3.behavior.zoom().x(t).y(d).scaleExtent([0.01,30]).on("zoom",function(u){if(metExploreD3.GraphNetwork.zoomListener.scale()<0.8){d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",true)}else{d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",false)}var h=_metExploreViz.getSessionById(this.parentNode.id);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){f.zoom(this.parentNode.id)}});s.setScale(t,d,1,1,1,metExploreD3.GraphNetwork.zoomListener.scale(),metExploreD3.GraphNetwork.zoomListener)}var m=d3.select("#"+l);m.svg=m.select("#D3viz").selectAll("*").remove();var p;var e=false;var c=d3.select("#"+l).select("#D3viz").append("g").datum(function(){return{selected:false,previouslySelected:false}}).attr("id","brush").attr("class","brush").call(d3.svg.brush().x(t).y(d).on("brushstart",function(w){var u=d3.select("#"+l).select("#buttonHand").attr("scrollable");_MyThisGraphNode.activePanel=this.parentNode.parentNode.id;var v=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(d3.event.sourceEvent.button!=1&&u!="true"){if(v!=undefined){if(v.isLinked()){var x=_metExploreViz.getSessionById("viz");if(x!=undefined){var h=x.getForce();if(h!=undefined){h.stop()}}}else{var h=v.getForce();if(h!=undefined){h.stop()}}}e=true;d3.select("#"+l).select("#brush").classed("hide",false);d3.select("#"+l).select("#D3viz").on("mousedown.zoom",null);p=d3.select("#"+l).select("#graphComponent").selectAll("g.node");p.each(function(y){y.previouslySelected=y.isSelected()})}else{var h=v.getForce();if(h!=undefined){h.stop()}d3.select("#"+l).selectAll("#D3viz").style("cursor","all-scroll");d3.selectAll("#brush").classed("hide",true)}}).on("brushend",function(){if(d3.event.sourceEvent.button!=1&&e){var B=d3.event.target.extent();if(B[1][0]-B[0][0]>20||B[1][1]-B[0][1]>20){var y;var B=d3.event.target.extent();var v=metExploreD3.getScaleById(l);var x=v.getZoomScale();var u=metExploreD3.createLoadMask("Selection in progress...",l);if(u!=undefined){metExploreD3.showMask(u);metExploreD3.deferFunction(function(){p.classed("selected",function(I){var H=v.getXScale();var G=v.getYScale();y=(H(B[0][0])<=H(I.x)&&H(I.x)<H(B[1][0]))&&(G(B[0][1])<=G(I.y)&&G(I.y)<G(B[1][1]));if((I.isSelected()==false&&y==true)||(I.isSelected()==true&&y==false&&!I.previouslySelected)){_MyThisGraphNode.selection(I,l)}return y});metExploreD3.hideMask(u);var E=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(E!=undefined){if(E.isLinked()){var F=_metExploreViz.getSessionById("viz");if(F!=undefined){var C=metExploreD3.GraphNetwork.isAnimated(F.getId());if(C=="true"){var D=F.getForce();if(D!=undefined){if((metExploreD3.GraphNetwork.isAnimated(F.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(F.getId())==null)){D.start()}}}}}else{var D=E.getForce();var C=metExploreD3.GraphNetwork.isAnimated(E.getId());if(C=="true"){var D=E.getForce();if(D!=undefined){if((metExploreD3.GraphNetwork.isAnimated(E.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(E.getId())==null)){D.start()}}}}}e=false},100)}}d3.event.target.clear();d3.select(this).call(d3.event.target);var v=metExploreD3.getScaleById(l);d3.select("#"+l).selectAll("#D3viz").style("cursor","default");d3.select("#"+l).selectAll("#D3viz").call(v.getZoom()).on("dblclick.zoom",null).on("mousedown",null)}else{var z=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(z!=undefined){if(z.isLinked()){var w=_metExploreViz.getSessionById("viz");if(w!=undefined){var A=metExploreD3.GraphNetwork.isAnimated(w.getId());if(A=="true"){var h=w.getForce();if(h!=undefined){if((metExploreD3.GraphNetwork.isAnimated(w.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(w.getId())==null)){h.start()}}}}}else{var h=z.getForce();var A=metExploreD3.GraphNetwork.isAnimated(z.getId());if(A=="true"){var h=z.getForce();if(h!=undefined){if(d3.select(metExploreD3.GraphNetwork.isAnimated(z.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(z.getId())==null)){h.start()}}}}}}d3.event.target.clear();d3.select(this).call(d3.event.target);var v=metExploreD3.getScaleById(l);d3.select("#"+l).selectAll("#D3viz").style("cursor","default");d3.select("#"+l).selectAll("#D3viz").call(v.getZoom()).on("dblclick.zoom",null).on("mousedown",null);d3.event.target.extent();d3.selectAll("#brush").classed("hide",false)}));m.svg=d3.select("#"+l).select("#D3viz").call(metExploreD3.GraphNetwork.zoomListener).on("dblclick.zoom",null).attr("pointer-events","all").append("svg:g").attr("class","graphComponent").attr("id","graphComponent");var a=_metExploreViz.getSessionById(l);if(a!=undefined){var b=a.getForce();if(b!=undefined){b.stop();metExploreD3.GraphNetwork.setAnimated(l,false)}if(a.isResizable()!=undefined){metExploreD3.GraphNetwork.task.cancel()}a.setResizable(true);metExploreD3.GraphNetwork.task=metExploreD3.createDelayedTask(function(){a.setResizable(false)})}var o=false;d3.select("#"+l).select("#D3viz").attr("animation",function(){if(o){return"true"}else{return"false"}}).append("svg:g").attr("class","buttonAnim").attr("id","buttonAnim").on("click",metExploreD3.GraphNetwork.play).style("cursor","hand").append("image").attr("xlink:href",function(){if(o){return document.location.href.split("index.html")[0]+"resources/icons/pause.svg"}else{return document.location.href.split("index.html")[0]+"resources/icons/play.svg"}}).attr("width","50").attr("height","50").attr("transform","translate(10,10) scale(.5)");d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonRescale").attr("id","buttonRescale").on("click",function(){metExploreD3.GraphNetwork.rescale(l)}).style("cursor","hand").append("image").attr("xlink:href",function(){return document.location.href.split("index.html")[0]+"resources/icons/rescale.png"}).attr("width","50").attr("height","50").attr("transform","translate(80,10) scale(.5)");d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonZoomIn").attr("id","buttonZoomIn").attr("x",(j-60)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomIn).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomin.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(j-60)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonZoomOut").attr("id","buttonZoomOut").attr("x",(j-110)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomOut).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomout.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(j-110)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonHand").attr("id","buttonHand").attr("x",(j-160)).attr("y",10).attr("scrollable","false").on("click",metExploreD3.GraphNetwork.moveGraph).style("opacity",1).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/handcursor.svg").attr("width","50").attr("height","50").attr("transform","translate("+(j-160)+",10) scale(1)");d3.select("#"+l).select("#D3viz").select("buttonHand").style("opacity",0);d3.select("#"+l).on("mouseover",function(){d3.select("#"+l).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",1);d3.select("#"+l).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",1);var u=_metExploreViz.getSessionById(l);if(u.isActive()){var h=d3.select("#"+l).select("#buttonHand").attr("scrollable");if(h=="false"){d3.select("#"+l).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0.2)}else{d3.select("#"+l).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",1)}}}).on("mouseout",function(){d3.select("#"+l).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",0);d3.select("#"+l).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",0);d3.select("#"+l).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0)});var a=_metExploreViz.getSessionById(l);var q=metExploreD3.getLinkStyle();var r=metExploreD3.getMetaboliteStyle();metExploreD3.GraphLink.loadLink(l,a,q,r);metExploreD3.GraphNode.loadNode(l);var k=document.createElement("div");k.id="tooltip2";k.className="tooltip2";metExploreD3.GraphNetwork.looksLinked();if(a.isLinked()){metExploreD3.GraphNetwork.graphAlignment(l)}metExploreD3.GraphNetwork.tick(l);metExploreD3.sortCompartmentInBiosource();metExploreD3.GraphNode.colorStoreByCompartment(metExploreD3.GraphNode.node)},loadSvgFromJSON:function(m){var o=parseInt(metExploreD3.GraphPanel.getHeight(m));var k=parseInt(metExploreD3.GraphPanel.getWidth(m));var r=metExploreD3.getLinkStyle();var b=d3.layout.force().friction(0.9).gravity(0.06).charge(-150).linkDistance(r.getSize()).size([k,o]);var a=metExploreD3.getSessionById(m);a.setActivity(true);a.setForce(b);if(m=="viz"){metExploreD3.GraphCaption.drawCaption()}var u=d3.scale.linear().domain([0,k]).range([0,k]);var d=d3.scale.linear().domain([o,0]).range([o,0]);if(metExploreD3.getScaleById(m)==undefined){var j=metExploreD3.GraphNetwork;var t=metExploreD3.getScaleById(m);var f=t.getZoom();f=d3.behavior.zoom().x(u).y(d).scaleExtent([0.01,30]).on("zoom",function(v){if(metExploreD3.GraphNetwork.zoomListener.scale()<0.8){d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",true)}else{d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",false)}var h=metExploreD3.getSessionById(m);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){j.zoom(m)}});t.add({graphName:m,xScale:u,yScale:d,zoomScale:1,xScaleCompare:1,yScaleCompare:1,zoomScaleCompare:f.scale(),zoom:f})}else{var j=metExploreD3.GraphNetwork;var t=metExploreD3.getScaleById(m);var f=t.getZoom();f=d3.behavior.zoom().x(u).y(d).scaleExtent([0.01,30]).on("zoom",function(v){if(f.scale()<0.8){d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",true)}else{d3.select("#"+m).select("#D3viz").select("#graphComponent").selectAll("text").classed("hide",false)}var h=metExploreD3.getSessionById(this.parentNode.id);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){j.zoom(this.parentNode.id)}});t.getStoreByGraphName(m).setScale(u,d,1,1,1,f.scale(),f)}var n=d3.select("#"+m);n.svg=n.select("#D3viz").selectAll("*").remove();var q;var g=false;var c=d3.select("#"+m).select("#D3viz").append("g").datum(function(){return{selected:false,previouslySelected:false}}).attr("id","brush").attr("class","brush").call(d3.svg.brush().x(u).y(d).on("brushstart",function(x){var v=d3.select("#"+m).select("#buttonHand").attr("scrollable");_MyThisGraphNode.activePanel=this.parentNode.parentNode.id;var w=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(d3.event.sourceEvent.button!=1&&v!="true"){if(w!=undefined){if(w.isLinked()){var y=_metExploreViz.getSessionById("viz");if(y!=undefined){var h=y.getForce();if(h!=undefined){h.stop()}}}else{var h=w.getForce();if(h!=undefined){h.stop()}}}g=true;d3.select("#"+m).select("#brush").classed("hide",false);d3.select("#"+m).select("#D3viz").on("mousedown.zoom",null);q=d3.select("#"+m).select("#graphComponent").selectAll("g.node");q.each(function(z){z.previouslySelected=z.isSelected()})}else{var h=w.getForce();if(h!=undefined){h.stop()}d3.select("#"+m).selectAll("#D3viz").style("cursor","all-scroll");d3.selectAll("#brush").classed("hide",true)}}).on("brushend",function(){if(d3.event.sourceEvent.button!=1&&g){var C=d3.event.target.extent();if(C[1][0]-C[0][0]>20||C[1][1]-C[0][1]>20){var z;var C=d3.event.target.extent();var w=metExploreD3.getScaleById(m);var y=w.getZoomScale();var v=metExploreD3.createLoadMask("Selection in progress...",m);if(v!=undefined){metExploreD3.showMask(v);metExploreD3.deferFunction(function(){q.classed("selected",function(J){var I=w.getXScale();var H=w.getYScale();z=(I(C[0][0])<=I(J.x)&&I(J.x)<I(C[1][0]))&&(H(C[0][1])<=H(J.y)&&H(J.y)<H(C[1][1]));if((J.isSelected()==false&&z==true)||(J.isSelected()==true&&z==false&&!J.previouslySelected)){_MyThisGraphNode.selection(J,m)}return z});metExploreD3.hideMask(v);var F=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(F!=undefined){if(F.isLinked()){var G=_metExploreViz.getSessionById("viz");if(G!=undefined){var D=metExploreD3.GraphNetwork.isAnimated(G.getId());if(D=="true"){var E=G.getForce();if(E!=undefined){if((metExploreD3.GraphNetwork.isAnimated(G.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(G.getId())==null)){E.start()}}}}}else{var E=F.getForce();var D=metExploreD3.GraphNetwork.isAnimated(F.getId());if(D=="true"){var E=F.getForce();if(E!=undefined){if((metExploreD3.GraphNetwork.isAnimated(F.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(F.getId())==null)){E.start()}}}}}g=false},100)}}d3.event.target.clear();d3.select(this).call(d3.event.target);var w=metExploreD3.getScaleById(m);d3.select("#"+m).selectAll("#D3viz").style("cursor","default");d3.select("#"+m).selectAll("#D3viz").call(w.getZoom()).on("dblclick.zoom",null).on("mousedown",null)}else{var A=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(A!=undefined){if(A.isLinked()){var x=_metExploreViz.getSessionById("viz");if(x!=undefined){var B=metExploreD3.GraphNetwork.isAnimated(x.getId());if(B=="true"){var h=x.getForce();if(h!=undefined){if((metExploreD3.GraphNetwork.isAnimated(x.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(x.getId())==null)){h.start()}}}}}else{var h=A.getForce();var B=metExploreD3.GraphNetwork.isAnimated(A.getId());if(B=="true"){var h=A.getForce();if(h!=undefined){if(d3.select(metExploreD3.GraphNetwork.isAnimated(A.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(A.getId())==null)){h.start()}}}}}}d3.event.target.clear();d3.select(this).call(d3.event.target);var w=metExploreD3.getScaleById(m);d3.select("#"+m).selectAll("#D3viz").style("cursor","default");d3.select("#"+m).selectAll("#D3viz").call(w.getZoom()).on("dblclick.zoom",null).on("mousedown",null);d3.event.target.extent();d3.selectAll("#brush").classed("hide",false)}));var t=metExploreD3.getScaleById(m);var f=t.getZoom();n.svg=d3.select("#"+m).select("#D3viz").call(f).on("dblclick.zoom",null).attr("pointer-events","all").append("svg:g").attr("class","graphComponent").attr("id","graphComponent");var a=_metExploreViz.getSessionById(m);if(a!=undefined){var b=a.getForce();if(b!=undefined){b.stop();metExploreD3.GraphNetwork.setAnimated(m,false)}if(a.isResizable()!=undefined&&a.isResizable()!=false){metExploreD3.GraphNetwork.task.cancel()}a.setResizable(true);metExploreD3.GraphNetwork.task=metExploreD3.createDelayedTask(function(){a.setResizable(false)})}d3.select("#"+m).select("#D3viz").attr("animation","true").append("svg:g").attr("class","buttonAnim").attr("id","buttonAnim").on("click",metExploreD3.GraphNetwork.play).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/pause.svg").attr("width","50").attr("height","50").attr("transform","translate(10,10) scale(.5)");d3.select("#"+m).select("#D3viz").append("svg:g").attr("class","whiteBlack").attr("id","whiteBlack").attr("x",(k-100)).attr("y",100).on("click",function(){if(d3.select("#"+m).style("-webkit-filter").search("grayscale")==-1&&d3.select("#"+m).style("filter").search("grayscale")==-1){d3.select("#"+m).style("filter","grayscale(100%)").style("-webkit-filter","grayscale(100%)")}else{d3.select("#"+m).style("filter","").style("-webkit-filter","")}}).style("cursor","hand").style("visibility","hidden").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/blackWhite.png").attr("width","50").attr("height","50").attr("transform","translate("+(k-100)+",100) scale(0.5)");d3.select("#"+m).select("#D3viz").append("svg:g").attr("class","invertColor").attr("id","invertColor").attr("x",(k-100)).attr("y",150).on("click",function(){if(d3.select("#"+m).style("-webkit-filter").search("invert")==-1&&d3.select("#"+m).style("filter").search("invert")==-1){d3.select("#"+m).style("filter","invert(100%)").style("-webkit-filter","invert(100%)")}else{d3.select("#"+m).style("filter","").style("-webkit-filter","")}}).style("cursor","hand").style("visibility","hidden").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/invertColor.svg").attr("width","50").attr("height","50").attr("transform","translate("+(k-100)+",150) scale(0.5)");d3.select("#"+m).select("#D3viz").append("svg:g").attr("class","buttonZoomIn").attr("id","buttonZoomIn").attr("x",(k-60)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomIn).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomin.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(k-60)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+m).select("#D3viz").append("svg:g").attr("class","buttonZoomOut").attr("id","buttonZoomOut").attr("x",(k-110)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomOut).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomout.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(k-110)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+m).select("#D3viz").append("svg:g").attr("class","buttonHand").attr("id","buttonHand").attr("x",(k-160)).attr("y",10).attr("scrollable","false").on("click",metExploreD3.GraphNetwork.moveGraph).style("opacity",1).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/handcursor.svg").attr("width","50").attr("height","50").attr("transform","translate("+(k-160)+",10) scale(1)");d3.select("#"+m).select("#D3viz").select("buttonHand").style("opacity",0);d3.select("#"+m).on("mouseover",function(){d3.select("#"+m).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",1);d3.select("#"+m).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",1);var v=_metExploreViz.getSessionById(m);if(v.isActive()){var h=d3.select("#"+m).select("#buttonHand").attr("scrollable");if(h=="false"){d3.select("#"+m).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0.2)}else{d3.select("#"+m).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",1)}}}).on("mouseout",function(){d3.select("#"+m).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",0);d3.select("#"+m).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",0);d3.select("#"+m).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0)});metExploreD3.GraphNetwork.setAnimated(m,true);var a=_metExploreViz.getSessionById(m);var r=metExploreD3.getLinkStyle();var s=metExploreD3.getMetaboliteStyle();metExploreD3.GraphLink.refreshLink(m,a,r,s);metExploreD3.GraphNode.refreshNode(m);var l=document.createElement("div");l.id="tooltip2";l.className="tooltip2";document.getElementById("viz").appendChild(l);var p=d3.select(j).attr("isLink");d3.select(j).select("image").remove();d3.select(j).append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/link.svg").attr("width","50").attr("height","50").attr("transform","translate(10,50) scale(.5)");a.setLinked(false);if(m!="viz"){d3.select("#"+m).select("#D3viz").append("svg:g").attr("class","buttonLink").attr("id","buttonLink").attr("isLink","false").on("click",metExploreD3.GraphNetwork.setLink).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/unlink.svg").attr("width","50").attr("height","50").attr("transform","translate(10,50) scale(.5)")}else{metExploreD3.GraphNetwork.looksLinked();if(a.isLinked()){metExploreD3.GraphNetwork.graphAlignment(m)}}var a=metExploreD3.getSessionById(m);var e=a.getD3Data();var b=a.getForce();b.nodes(e.getNodes()).links(e.getLinks()).on("tick",function(){if(b.alpha()>=0.005){setTimeout(metExploreD3.GraphNetwork.tick(m),0)}}).start();a.setForce(b);metExploreD3.sortCompartmentInBiosource();metExploreD3.GraphNode.colorStoreByCompartment(metExploreD3.GraphNode.node)}};