/*
 This file is part of MetExploreViz 

 Copyright Â© 2016 INRA 
 Contact: http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 GNU General Public License Usage 
 This file may be used under the terms of the GNU General Public License version 3.0 as 
 published by the Free Software Foundation and appearing in the file LICENSE included in the 
 packaging of this file. 
 Please review the following information to ensure the GNU General Public License version 3.0 
 requirements will be met: http://www.gnu.org/copyleft/gpl.html. 
 If you are unsure which license is appropriate for your use, please contact us 
 at http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact
 Version: 1.2.0.2 
 Build Date: Mon Nov 21 14:42:33 CET 2016 
 */
metExploreD3.GraphCaption={refreshStyleOfReaction:function(){var a=metExploreD3.getReactionStyle();var b=Math.max(a.getWidth(),a.getHeight());var c=15/b;d3.select("#viz").select("#D3viz").select(".reactionCaption").attr("x",15/2-a.getWidth()*c/2).attr("y",15+15/2-a.getHeight()*c/2).attr("width",a.getWidth()*c).attr("height",a.getHeight()*c).attr("rx",a.getRX()*c).attr("ry",a.getRY()*c).attr("fill","white").attr("transform","translate(15,95)").style("stroke",a.getStrokeColor()).style("stroke-width",2)},refreshStyleOfMetabolite:function(){var b=metExploreD3.getMetaboliteStyle();var c=Math.max(b.getWidth(),b.getHeight());var a=15/c;d3.select("#viz").select("#D3viz").select(".metaboliteCaption").attr("x",15/2-b.getWidth()*a/2).attr("y",15+15/2-b.getHeight()*a/2).attr("width",b.getWidth()*a).attr("height",b.getHeight()*a).attr("rx",b.getRX()*a).attr("ry",b.getRY()*a).attr("fill","white").style("stroke","black").style("stroke-width",2).attr("transform","translate(15,130)")},drawCaption:function(){d3.select("#viz").select("#D3viz").select("#captionComparment").remove();d3.select("#viz").select("#D3viz").select("#captionPathway").remove();d3.select("#viz").select("#D3viz").select(".logoViz").remove();var A=metExploreD3.getReactionStyle();var F=Math.max(A.getWidth(),A.getHeight());var o=15/F;var D=metExploreD3.getMetaboliteStyle();var w=Math.max(D.getWidth(),D.getHeight());var m=15/w;var q=15/2-A.getWidth()*o/2;var p=15;var E=20+15/2-A.getWidth()*o/2;var B=15;var C=metExploreD3.getLinkStyle();var z=Math.sqrt(Math.pow(E-q,2)+Math.pow(B-p,2));var g=(E-q);var f=(B-p);var s=g/Math.abs(g);var r=f/Math.abs(f);var v=(Math.abs(z)*10/2)/Math.abs(g);var e=(Math.abs(z)*10/2)/Math.abs(f);var n=(v<e)?rT=v:rt=e;var i=5;var t=q+g*((z-n)/z);var c=p+f*((z-n)/z);var i=5;var u=q+g*((z-n-i)/z);var l=p+f*((z-n-i)/z);var h=q+g*((z-n-i-i)/z);var k=p+f*((z-n-i-i)/z);var y=u+f*(3/z);var b=l-g*(3/z);var x=u-f*(3/z);var a=l+g*(3/z);var j="M"+q+","+p+"L"+h+","+k+"L"+y+","+b+"L"+x+","+a+"L"+t+","+c+"L"+y+","+b+"L"+x+","+a+"L"+h+","+k+"Z";d3.select("#viz").select("#D3viz").append("svg:path").attr("class",String).attr("d",j).attr("class","linkCaptionRev").attr("fill-rule","evenodd").attr("fill","white").style("stroke",C.getStrokeColor()).style("stroke-width",1.5).style("stroke-linejoin","bevel").attr("transform","translate(15,65)");d3.select("#viz").select("#D3viz").append("svg:text").text("Reversible link").attr("x",20).attr("y",15).attr("transform","translate(30,70)");C=metExploreD3.getLinkStyle();var z=Math.sqrt(Math.pow(E-q,2)+Math.pow(B-p,2));var g=(E-q);var f=(B-p);var s=g/Math.abs(g);var r=f/Math.abs(f);var v=(Math.abs(z)*10/2)/Math.abs(g);var e=(Math.abs(z)*10/2)/Math.abs(f);var n=(v<e)?rT=v:rt=e;var t=q+g*((z-n)/z);var c=p+f*((z-n)/z);var i=5;var u=q+g*((z-n-i)/z);var l=p+f*((z-n-i)/z);var y=u+f*(3/z);var b=l-g*(3/z);var x=u-f*(3/z);var a=l+g*(3/z);j="M"+q+","+p+"L"+u+","+l+"L"+y+","+b+"L"+t+","+c+"L"+x+","+a+"L"+u+","+l+"Z";d3.select("#viz").select("#D3viz").append("svg:path").attr("class",String).attr("d",j).attr("class","linkCaptionRev").attr("fill-rule","evenodd").attr("fill","white").style("stroke",C.getStrokeColor()).style("stroke-width",1.5).style("stroke-linejoin","bevel").attr("transform","translate(15,40)");d3.select("#viz").select("#D3viz").append("svg:text").text("Link").attr("x",20).attr("y",15).attr("transform","translate(30,45)");d3.select("#viz").select("#D3viz").append("svg:text").attr("id","metexplore").text("MetExploreViz").attr("x",$("#viz").width()-130).attr("y",$("#viz").height()-10);d3.select("#viz").select("#D3viz").append("svg:g").attr("class","logoViz").attr("id","logoViz").append("image").attr("xlink:href","resources/icons/metExploreViz_Logo.svg").attr("width","50").attr("height","50").attr("x",$("#viz").width()-110).attr("y",$("#viz").height()-75);d3.select("#viz").select("#D3viz").append("svg:rect").attr("class","reactionCaption").attr("x",15/2-A.getWidth()*o/2).attr("y",15).attr("width",A.getWidth()*o).attr("height",A.getHeight()*o).attr("rx",A.getRX()*o).attr("ry",A.getRY()*o).attr("fill","white").attr("transform","translate(15,95)").style("stroke",A.getStrokeColor()).style("stroke-width",2);d3.select("#viz").select("#D3viz").append("svg:text").text("Reaction").attr("x",20).attr("y",15).attr("transform","translate(30,105)");d3.select("#viz").select("#D3viz").append("svg:rect").attr("class","metaboliteCaption").attr("x",15/2-D.getWidth()*m/2).attr("y",15+15/2-D.getHeight()*m/2).attr("width",D.getWidth()*m).attr("height",D.getHeight()*m).attr("rx",D.getRX()*m).attr("ry",D.getRY()*m).attr("fill","white").style("stroke","black").style("stroke-width",2).attr("transform","translate(15,130)");d3.select("#viz").select("#D3viz").append("svg:text").text("Metabolites").attr("x",20).attr("y",15).attr("transform","translate(30,140)");metExploreD3.GraphCaption.colorPathwayLegend(175);metExploreD3.GraphCaption.colorMetaboliteLegend(175);d3.select("#viz").select("#D3viz").select("#captionComparment").classed("hide",true);d3.select("#viz").select("#D3viz").select("#captionPathway").classed("hide",true);metExploreD3.GraphCaption.majCaption()},majCaption:function(){var b=_metExploreViz.getGeneralStyle();var a=b.isDisplayedCaption();if(a=="Pathways"){d3.select("#viz").select("#D3viz").select("#captionComparment").classed("hide",true);d3.select("#viz").select("#D3viz").select("#captionPathway").classed("hide",false)}else{d3.select("#viz").select("#D3viz").select("#captionComparment").classed("hide",false);d3.select("#viz").select("#D3viz").select("#captionPathway").classed("hide",true)}},colorMetaboliteLegend:function(k){var m=d3.select("#viz").select("#D3viz").append("svg:g").attr("id","captionComparment").attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0);var d=metExploreD3.getReactionStyle();var g=Math.max(d.getWidth(),d.getHeight());var a=20/g;var j=metExploreD3.getMetaboliteStyle();var h=Math.max(j.getWidth(),j.getHeight());var b=20/h;metExploreD3.sortCompartmentInBiosource();var l=metExploreD3.getCompartmentInBiosourceLength();if(l==undefined){l=0}center=128;width=127;frequency=Math.PI*2*0.95/l;var f=k;f+=20;m.append("svg:text").text("Compartments :").attr("x",0).attr("y",0).attr("transform","translate(15,"+f+")");f+=20;for(var e=0;e<l;e++){red=Math.sin(frequency*e+2+l)*width+center;green=Math.sin(frequency*e+0+l)*width+center;blue=Math.sin(frequency*e+4+l)*width+center;var c=metExploreD3.getCompartmentInBiosourceSet()[e];c.setColor(metExploreD3.GraphUtils.RGB2Color(red,green,blue));m.append("svg:line").attr("class","metabolite").attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0).style("stroke",c.getColor()).style("stroke-width",2).attr("transform","translate(15,"+f+")");f+=10;m.append("svg:text").html(c.getName()).attr("x",20).attr("y",-6).attr("transform","translate(30,"+f+")");f+=10}},colorPathwayLegend:function(m){var c=metExploreD3.getPathwaysSet();var q=[];c.forEach(function(i){q.push({key:i})});var n=metExploreD3.getPathwaysLength();if(n==undefined){n=0}center=128;width=127;frequency=Math.PI*2*0.95/n;for(var f=0;f<n;f++){red=Math.sin(frequency*f+2+n)*width+center;green=Math.sin(frequency*f+0+n)*width+center;blue=Math.sin(frequency*f+4+n)*width+center;var a=q[f];a.color=metExploreD3.GraphUtils.RGB2Color(red,green,blue)}var p=d3.select("#viz").select("#D3viz").append("svg:g").attr("id","captionPathway").attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0);var e=metExploreD3.getReactionStyle();var h=Math.max(e.getWidth(),e.getHeight());var b=20/h;var k=metExploreD3.getMetaboliteStyle();var j=Math.max(k.getWidth(),k.getHeight());var d=20/j;var l=_metExploreViz.getSessionById("viz");q.sort(function(r,i){if(r.key<i.key){return -1}if(r.key>i.key){return 1}return 0});var n=q.length;if(n==undefined){n=0}center=128;width=127;frequency=Math.PI*2*0.95/n;var g=m;g+=20;p.append("svg:text").text("Pathways :").attr("x",0).attr("y",0).attr("transform","translate(15,"+g+")");g+=20;for(var f=0;f<n;f++){red=Math.sin(frequency*f+2+n)*width+center;green=Math.sin(frequency*f+0+n)*width+center;blue=Math.sin(frequency*f+4+n)*width+center;var o=q[f];p.append("svg:line").attr("class","metabolite").attr("x1",0).attr("y1",0).attr("x2",15).attr("y2",0).style("stroke",o.color).style("stroke-width",2).attr("transform","translate(15,"+g+")");g+=10;p.append("svg:text").html(o.key).attr("x",20).attr("y",-6).attr("transform","translate(30,"+g+")");g+=10}}};