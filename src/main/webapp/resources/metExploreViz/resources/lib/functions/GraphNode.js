/*
 This file is part of MetExploreViz 

 Copyright Â© 2016 INRA 
 Contact: http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 GNU General Public License Usage 
 This file may be used under the terms of the GNU General Public License version 3.0 as 
 published by the Free Software Foundation and appearing in the file LICENSE included in the 
 packaging of this file. 
 Please review the following information to ensure the GNU General Public License version 3.0 
 requirements will be met: http://www.gnu.org/copyleft/gpl.html. 
 If you are unsure which license is appropriate for your use, please contact us 
 at http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact
 Version: 1.2.0.2 
 Build Date: Mon Nov 21 14:42:33 CET 2016 
 */
metExploreD3.GraphNode={node:"",_MyThisGraphNode:"",panelParent:"",activePanel:"",taskClick:"",charKey:"",ctrlKey:"",groups:"",groupPath:"",groupFill:"",dblClickable:false,delayedInitialisation:function(a){metExploreD3.GraphNode.panelParent=a;_MyThisGraphNode=metExploreD3.GraphNode;activePanel=metExploreD3.GraphNode},selectNeighbours:function(b,a){d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(c){return c.getSource()==b||c.getTarget()==b}).each(function(c){if(c.getSource()==b){if(!c.getTarget().isSelected()){_MyThisGraphNode.selection(c.getTarget(),a)}}else{if(!c.getSource().isSelected()){_MyThisGraphNode.selection(c.getSource(),a)}}})},changeName:function(e){var f=metExploreD3.getMetaboliteStyle();var a=metExploreD3.getReactionStyle();var d;d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").each(function(g){if(e.querySelector("rect.metabolite")!=null){if(g.getId()==e.querySelector("rect.metabolite").id){d=g}}else{if(e.querySelector("rect.reaction")!=null){if(g.getId()==e.querySelector("rect.reaction").id){d=g}}}});if(d){if(d.getBiologicalType()=="metabolite"){var c=f.getDisplayLabel(d,f.getLabel())}else{var c=a.getDisplayLabel(d,a.getLabel())}}if(c){var b=metExploreD3.displayPrompt("New label","Enter new label",function(g,h){if(h!=null&&h!=""&&g=="ok"){d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(i){return d.getId()==i.getId()}).each(function(i){i.setLabel(h);d3.select(this).select("text").remove();metExploreD3.GraphNode.addText(i,"viz")})}})}},dragstart:function(g,c){_MyThisGraphNode.activePanel=d3.event.sourceEvent.target.viewportElement.parentNode.id;if(_MyThisGraphNode.activePanel==""||_MyThisGraphNode.activePanel.search("node")!=-1){_MyThisGraphNode.activePanel=d3.event.sourceEvent.target.parentNode.viewportElement.parentNode.id}d3.event.sourceEvent.stopPropagation();var f=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(f!=undefined){if(d3.event.sourceEvent.target.classList.contains("backgroundlocker")||d3.event.sourceEvent.target.classList.contains("iconlocker")){if(d3.event.sourceEvent.button!=2){g.setLocked(!g.isLocked());g.fixed=g.isLocked();metExploreD3.GraphNode.node.filter(function(d){return d==g}).select(".locker").classed("hide",false).select(".iconlocker").attr("xlink:href",function(i){if(i.isLocked()){return"resources/icons/lock_font_awesome.svg"}else{return"resources/icons/unlock_font_awesome.svg"}})}}else{if(d3.event.sourceEvent.button==2){if(!g.isSelected()){_MyThisGraphNode.selection(g,_MyThisGraphNode.activePanel);if(_MyThisGraphNode.charKey==78&&g.isSelected()){_MyThisGraphNode.selectNeighbours(g,_MyThisGraphNode.activePanel)}}}else{_MyThisGraphNode.selection(g,_MyThisGraphNode.activePanel);if(_MyThisGraphNode.charKey==78&&g.isSelected()){_MyThisGraphNode.selectNeighbours(g,_MyThisGraphNode.activePanel)}}}d3.selectAll("#D3viz").style("cursor","move");var e=f.getForce();e.stop();if(f.isLinked()){var h=_metExploreViz.getSessionsSet();for(var b in h){if(h[b].isLinked()&&_MyThisGraphNode.activePanel!=h[b].getId()){var a=h[b].getForce();a.stop()}}}}},refreshStyleOfReaction:function(){var a=metExploreD3.getReactionStyle();var b=d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(c){return c.getBiologicalType()=="reaction"});b.select("text").remove();b.setNodeForm(a.getWidth(),a.getHeight(),a.getRX(),a.getRY(),a.getStrokeColor(),a.getStrokeWidth());b.each(function(c){metExploreD3.GraphNode.addText(c,"viz")})},refreshStyleOfMetabolite:function(){var i=metExploreD3.getMetaboliteStyle();var d=d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(k){return k.getBiologicalType()=="metabolite"});d.select("text").remove();d.filter(function(k){return !k.getIsSideCompound()}).setNodeForm(i.getWidth(),i.getHeight(),i.getRX(),i.getRY(),undefined,i.getStrokeWidth());d.filter(function(k){return k.getIsSideCompound()}).setNodeForm(i.getWidth()/2,i.getHeight()/2,i.getRX()/2,i.getRY()/2,undefined,i.getStrokeWidth()/2);var a=Math.min(i.getWidth(),i.getHeight());d.each(function(k){metExploreD3.GraphNode.addText(k,"viz")});d.select(".structure_metabolite").attr("viewBox",function(k){console.log(a);return"0 0 "+a+" "+a}).attr("width",a*8/10+"px").attr("height",a*8/10+"px").attr("x",(-a/2)+(a*1/10)).attr("preserveAspectRatio","xMinYMin").attr("y",(-a/2)+(a*1/10));var j=_metExploreViz.getSessionById("viz");var b=j.getForce();var i=metExploreD3.getMetaboliteStyle();var f=metExploreD3.getReactionStyle();var g=Math.max(f.getWidth(),f.getHeight());var h=Math.max(i.getWidth(),i.getHeight());var c=Math.max(g,h);var e=metExploreD3.getLinkStyle();b.linkDistance(function(k){if(k.getSource().getIsSideCompound()||k.getTarget().getIsSideCompound()){return e.getSize()/2+c}else{return e.getSize()+c}})},moveNode:function(b,a){d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(c){if(_MyThisGraphNode.ctrlKey){return c.isSelected()}else{return b.getId()==c.getId()}}).each(function(c){c.px+=d3.event.dx;c.py+=d3.event.dy;c.x+=d3.event.dx;c.y+=d3.event.dy})},dragmove:function(g,c){if(!g.isSelected()&&!(d3.event.sourceEvent.target.classList.contains("backgroundlocker")||d3.event.sourceEvent.target.classList.contains("iconlocker"))){_MyThisGraphNode.selection(g,_MyThisGraphNode.activePanel);if(_MyThisGraphNode.charKey==78&&g.isSelected()){_MyThisGraphNode.selectNeighbours(g,_MyThisGraphNode.activePanel)}}_MyThisGraphNode.moveNode(g,_MyThisGraphNode.activePanel);_MyThisGraphNode.tick(_MyThisGraphNode.activePanel);var f=metExploreD3.getScaleById(_MyThisGraphNode.activePanel);metExploreD3.GraphLink.tick(_MyThisGraphNode.activePanel,f);var e=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(e.isLinked()){var h=_metExploreViz.getSessionsSet();for(var b in h){if(h[b].isLinked()&&_MyThisGraphNode.activePanel!=h[b].getId()){var a=metExploreD3.getScaleById(h[b].getId());_MyThisGraphNode.moveNode(g,h[b].getId());_MyThisGraphNode.tick(h[b].getId());metExploreD3.GraphLink.tick(h[b].getId(),a)}}}},dragend:function(h,e){var j=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);var c=_metExploreViz.getSessionById("viz");if(j!=undefined){if(j.isLinked()){var g=_metExploreViz.getSessionsSet();for(var l in g){if(g[l].isLinked()&&_MyThisGraphNode.activePanel!=g[l].getId()){var k=metExploreD3.GraphNetwork.isAnimated(c.getId());if(k=="true"){var f=c.getForce();if((metExploreD3.GraphNetwork.isAnimated(_MyThisGraphNode.panelParent)=="true")||(metExploreD3.GraphNetwork.isAnimated(_MyThisGraphNode.panelParent)==null)){f.resume()}}_MyThisGraphNode.tick(g[l].getId());var n=metExploreD3.getScaleById(g[l].getId());metExploreD3.GraphLink.tick(g[l].getId(),n)}}}else{var b=metExploreD3.GraphNetwork.isAnimated(_MyThisGraphNode.activePanel);if(b=="true"){var a=j.getForce();if((metExploreD3.GraphNetwork.isAnimated(_MyThisGraphNode.activePanel)=="true")||(metExploreD3.GraphNetwork.isAnimated(_MyThisGraphNode.activePanel)==null)){a.resume()}}_MyThisGraphNode.tick(_MyThisGraphNode.activePanel);var m=metExploreD3.getScaleById(_MyThisGraphNode.activePanel);metExploreD3.GraphLink.tick(_MyThisGraphNode.activePanel,m)}d3.selectAll("#D3viz").style("cursor","default")}},fixNodeOnRefresh:function(c,a){var b=_metExploreViz.getSessionById(a);if(b!=undefined){if(c.isSelected()){_MyThisGraphNode.selectNode(c,a)}else{_MyThisGraphNode.unSelectNode(c,a)}setTimeout(function(){if(b.isLinked()){var e=_metExploreViz.getSessionsSet();for(var d in e){if(e[d].isLinked()&&a!=e[d].getId()){d3.select("#"+e[d].getId()).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(f){return c.getId()==f.getId()}).each(function(f){f.setIsSelected(!f.isSelected())});if(c.isSelected()){_MyThisGraphNode.selectNode(c,e[d].getId())}else{_MyThisGraphNode.unSelectNode(c,e[d].getId())}}}}},200)}},selection:function(c,a){var b=_metExploreViz.getSessionById(a);if(b!=undefined){d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return c.getId()==d.getId()}).each(function(d){d.setIsSelected(!d.isSelected())});if(c.isSelected()){_MyThisGraphNode.selectNode(c,a)}else{_MyThisGraphNode.unSelectNode(c,a)}setTimeout(function(){if(b.isLinked()){var e=_metExploreViz.getSessionsSet();for(var d in e){if(e[d].isLinked()&&a!=e[d].getId()){d3.select("#"+e[d].getId()).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(f){return c.getId()==f.getId()}).each(function(f){f.setIsSelected(!f.isSelected())});if(c.isSelected()){_MyThisGraphNode.selectNode(c,e[d].getId())}else{_MyThisGraphNode.unSelectNode(c,e[d].getId())}}}}},200)}},selectNode:function(i,b){var c=metExploreD3.getReactionStyle();var h=_metExploreViz.getSessionById(b);var g=metExploreD3.getMetabolitesSet();var a=metExploreD3.getReactionsSet();var f="<b>Name:</b> "+i.getName()+"<br/><b>Biological type:</b> "+i.getBiologicalType()+((i.getCompartment()!=undefined)?"<br/><b>Compartment:</b> "+i.getCompartment():"")+((i.getDbIdentifier()!=undefined)?"<br/><b>Database identifier:</b> "+i.getDbIdentifier():"")+((i.getEC()!=undefined)?"<br/><b>EC number:</b> "+i.getEC():"")+((i.getReactionReversibility()!=undefined)?"<br/><b>Reaction reversibility:</b> "+i.getReactionReversibility():"")+((i.getIsSideCompound()!=undefined)?"<br/><b>SideCompound:</b> "+i.getIsSideCompound():"")+((i.getMappingDatasLength()!=0)?((i.getMappingDatasLength()==1)?"<br/><b>Mapping:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>":"<br/><b>Mappings:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>"):"");i.getMappingDatas().forEach(function(d){f+="<tr><td>"+d.getMappingName()+"</td><td>"+d.getConditionName()+"</td><td>"+d.getMapValue()+"</td></tr>"});f+="</table>";if(i.getSvg()!=""&&i.getSvg()!=undefined&&i.getSvg()!="undefined"){f+='<br/><img src="resources/images/structure_metabolite/'+i.getSvg()+'"/>'}document.getElementById("tooltip2").innerHTML=f;document.getElementById("tooltip2").classList.remove("hide");document.getElementById("tooltip2").classList.add("fixed");d3.select("#"+b).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return i.getId()==d.getId()}).each(function(d){h.addSelectedNode(d.getId());if(d.getBiologicalType()=="reaction"){d3.select(this).select("text").style("fill","white")}});var e=d3.select("#"+b).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return i.getId()==d.getId()}).select(".fontSelected").style("fill-opacity","0.4");_MyThisGraphNode.addText(i,b)},unSelectNode:function(f,b){var e=_metExploreViz.getSessionById(b);var c=metExploreD3.getMetabolitesSet();var a=metExploreD3.getReactionsSet();d3.select("#"+b).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return f.getId()==d.getId()}).select(".fontSelected").style("fill-opacity","0");d3.select("#"+b).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return f.getId()==d.getId()}).each(function(h){e.removeSelectedNode(h.getId());if(h.getBiologicalType()=="reaction"){var g;var d=metExploreD3.GraphUtils.chooseTextColor(this.style.getPropertyValue("fill"));d3.select(this).select("text").style("fill",d)}})},addText:function(e,a){var c=metExploreD3.getMetaboliteStyle();var b=metExploreD3.getReactionStyle();var g=_metExploreViz.getSessionById("viz");if(e.getBiologicalType()=="metabolite"){var f=Math.min(c.getWidth(),c.getHeight());if(d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return e.getId()==d.getId()}).select("text")==""){d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return e.getId()==d.getId()}).append("svg:text").attr("fill","black").attr("class",function(h){return h.getBiologicalType()}).each(function(n){var k=d3.select(this);var h=c.getDisplayLabel(n,c.getLabel());h=h.split(" ");k.text("");for(var j=0;j<h.length;j++){var l=$("<div/>").html(h[j]).text();var m=k.append("tspan").text(l);if(j>0){m.attr("x",0).attr("dy","5")}}}).style("font-size",c.getFontSize()).style("paint-order","stroke").style("stroke-width",1).style("stroke","white").style("stroke-opacity","0.7").attr("dy",".4em").style("font-weight","bold").style("pointer-events","none").attr("y",f/2+3)}if(e.getSvg()!="undefined"&&e.getSvg()!=undefined&&e.getSvg()!=""){if(d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return e.getId()==d.getId()}).select("image").empty()){d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return e.getId()==d.getId()}).append("svg").attr("viewBox",function(h){return"0 0 "+f+" "+f}).attr("width",f*8/10+"px").attr("height",f*8/10+"px").attr("x",(-f/2)+(f*1/10)).attr("preserveAspectRatio","xMinYMin").attr("y",(-f/2)+(f*1/10)).attr("class","structure_metabolite").append("image").attr("xlink:href",function(h){return"resources/images/structure_metabolite/"+h.getSvg()}).attr("width","100%").attr("height","100%")}}}if(e.getLabelVisible()==true&&e.getBiologicalType()=="reaction"){if(d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return e.getId()==d.getId()}).text()==""){d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(d){return e.getId()==d.getId()}).append("svg:text").attr("fill","black").attr("class",function(h){return h.getBiologicalType()}).text(function(i){var h=$("<div/>").html(b.getDisplayLabel(i,b.getLabel())).text();if(h==""){var h=$("<div/>").html(b.getDisplayLabel(i,b.getLabel())).text()}return h}).style("font-size",function(h){if(b.getDisplayLabel(h,b.getLabel())=="NA"){return 6}return Math.min(b.getWidth(),(b.getWidth()-b.getWidth()/10)/this.getComputedTextLength()*10)+"px"}).style("font-weight","bold").attr("dy",".3em")}}},addTextAllPanels:function(){var b=_metExploreViz.getSessionsSet();for(var a in b){d3.select("#"+b[a].getId()).select("#D3viz").select("#graphComponent").selectAll("g.node").each(function(c){metExploreD3.GraphNode.addText(c,b[a].getId())})}},removeText:function(a){d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").select("text").remove()},removeTextAllPanels:function(a){var c=_metExploreViz.getSessionsSet();for(var b in c){metExploreD3.GraphNode.removeText(c[b].getId())}},searchNode:function(d){var a=d.toUpperCase();var b=d3.select("#viz").select("#D3viz").select("#graphComponent");var c=b.selectAll("g.node").filter(function(k,h){var g=false;if(k.getName()!=undefined){g=k.getName().toUpperCase().indexOf(a)>-1}if(k.getLabel()!=undefined){g=k.getLabel().toUpperCase().indexOf(a)>-1}var j=false;if(k.getEC()!=undefined){j=k.getEC().toUpperCase().indexOf(a)>-1}var f=false;if(k.getDbIdentifier()!=undefined){f=k.getDbIdentifier().toUpperCase().indexOf(a)>-1}var e=false;if(k.getCompartment()!=undefined){e=k.getCompartment().toUpperCase().indexOf(a)>-1}var l=false;if(k.getBiologicalType()!=undefined){l=k.getBiologicalType().toUpperCase().indexOf(a)>-1}return g||j||f||e||l});if(c.size()==0){metExploreD3.displayMessage("Warning",'The node "'+d+"\" doesn't exist.")}else{c.each(function(e){if(!e.isSelected()){_MyThisGraphNode.selection(e,"viz")}})}},refreshNode:function(n){var e=metExploreD3.getReactionStyle();var j=metExploreD3.getMetaboliteStyle();var l=metExploreD3.getGeneralStyle();var k=_metExploreViz.getSessionById(n);var i=_metExploreViz.getSessionById("viz");d3.select("body").on("keydown",function(){_MyThisGraphNode.charKey=d3.event.keyCode;_MyThisGraphNode.ctrlKey=d3.event.ctrlKey;if(_MyThisGraphNode.charKey==65&&_MyThisGraphNode.ctrlKey){d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("g.node").each(function(h){if(!h.isSelected()){_MyThisGraphNode.selection(h,n)}})}}).on("keyup",function(h){if(_MyThisGraphNode.charKey==46&&k.getSelectedNodes().length>0){metExploreD3.displayMessageYesNo("Selected nodes","Do you want remove selected nodes?",function(o){if(o=="yes"){metExploreD3.GraphNetwork.removeSelectedNode("viz")}})}_MyThisGraphNode.charKey="none";_MyThisGraphNode.ctrlKey=d3.event.ctrlKey});metExploreD3.GraphNode.panelParent=n;_MyThisGraphNode=metExploreD3.GraphNode;var b=d3.behavior.drag().on("dragstart",_MyThisGraphNode.dragstart).on("drag",_MyThisGraphNode.dragmove).on("dragend",_MyThisGraphNode.dragend);var d=k.getD3Data();var g=parseInt(d3.select("#"+_MyThisGraphNode.panelParent).select("#D3viz").style("height"));var m=parseInt(d3.select("#"+_MyThisGraphNode.panelParent).select("#D3viz").style("width"));d3.selectAll("#D3viz").on("mouseup",this.unselectIfDBClick);var c=metExploreD3.getScaleById(n);metExploreD3.GraphNode.node=d3.select("#"+metExploreD3.GraphNode.panelParent).select("#D3viz").select("#graphComponent").selectAll("g.node").data(d.getNodes()).enter().append("svg:g").attr("class","node").attr("id",function(h){return"node"+h.getId()}).call(b).style("fill","white");metExploreD3.GraphNode.node.filter(function(h){return !h.isDuplicated()}).on("mouseenter",function(s){var p=d3.select(this).attr("transform");var r=p.substring(p.indexOf("scale"),p.length);var q=r.substring(6,r.indexOf(")"));if(isNaN(q)){q=1}var o=d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).attr("transform","translate("+s.x+", "+s.y+") scale("+q*2+")");var h=d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("path.link");if(s.getBiologicalType()=="reaction"){h.filter(function(t){return s.getId()==t.getSource().getId()}).style("stroke","green").style("stroke-width","1.5");h.filter(function(t){return s.getId()==t.getTarget().getId()}).style("stroke","red").style("stroke-width","1.5")}else{h.filter(function(t){return s.getId()==t.getSource().getId()}).style("stroke","red").style("stroke-width","1.5");h.filter(function(t){return s.getId()==t.getTarget().getId()}).style("stroke","green").style("stroke-width","1.5")}}).on("mouseover",function(r){var h=d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).each(function(t){var s=h[0][h.size()-1];this.parentNode.insertBefore(this,s)});r.fixed=true;metExploreD3.GraphNode.node.filter(function(s){return s==r}).select(".locker").classed("hide",false).select(".iconlocker").attr("xlink:href",function(s){if(s.isLocked()){return"resources/icons/lock_font_awesome.svg"}else{return"resources/icons/unlock_font_awesome.svg"}});var q=c.getXScale();var p=c.getYScale();if(!document.getElementById("tooltip2").classList.contains("fixed")){var o="<b>Name:</b> "+r.getName()+"<br/><b>Biological type:</b> "+r.getBiologicalType()+((r.getCompartment()!=undefined)?"<br/><b>Compartment:</b> "+r.getCompartment():"")+((r.getDbIdentifier()!=undefined)?"<br/><b>Database identifier:</b> "+r.getDbIdentifier():"")+((r.getEC()!=undefined)?"<br/><b>EC number: </b>"+r.getEC():"")+((r.getReactionReversibility()!=undefined)?"<br/><b>Reaction reversibility:</b> "+r.getReactionReversibility():"")+((r.getIsSideCompound()!=undefined)?"<br/><b>SideCompound:</b> "+r.getIsSideCompound():"")+((r.getMappingDatasLength()!=0)?((r.getMappingDatasLength()==1)?"<br/><b>Mapping:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>":"<br/><b>Mappings:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>"):"");r.getMappingDatas().forEach(function(s){o+="<tr><td>"+s.getMappingName()+"</td><td>"+s.getConditionName()+"</td><td>"+s.getMapValue()+"</td></tr>"});o+="</table>";if(r.getSvg()!=undefined&&r.getSvg()!="undefined"&&r.getSvg()!=""){o+='<br/><img src="resources/images/structure_metabolite/'+r.getSvg()+'"/>'}document.getElementById("tooltip2").innerHTML=o;document.getElementById("tooltip2").classList.remove("hide")}}).on("mouseleave",function(s){var o=d3.select(this).attr("transform");var r=o.substring(o.indexOf("scale"),o.length);var q=r.substring(6,r.indexOf(")"));if(isNaN(q)){q=1}metExploreD3.GraphNode.node.filter(function(t){return t==s}).select(".locker").classed("hide",true);var h=d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).attr("transform","translate("+s.x+", "+s.y+") scale("+q/2+")");if(!s.isLocked()){s.fixed=false}var p=metExploreD3.getLinkStyle();document.getElementById("tooltip2").classList.add("hide");d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(t){return s.getId()==t.getSource().getId()||s.getId()==t.getTarget().getId()}).style("stroke",p.getStrokeColor()).style("stroke-width","0.5");if(s.getBiologicalType()=="reaction"){d3.select(this).selectAll("rect").selectAll(".reaction, .fontSelected").transition().duration(750).attr("width",e.getWidth()).attr("height",e.getHeight()).attr("transform","translate(-"+e.getWidth()/2+",-"+e.getHeight()/2+")")}else{d3.select(this).selectAll("rect").selectAll(".metabolite, .fontSelected").transition().duration(750).attr("width",j.getWidth()).attr("height",j.getHeight()).attr("transform","translate(-"+j.getWidth()/2+",-"+j.getHeight()/2+")")}});metExploreD3.GraphNode.node.filter(function(h){return h.isDuplicated()}).on("mouseenter",function(s){var p=d3.select(this).attr("transform");var r=p.substring(p.indexOf("scale"),p.length);var q=r.substring(6,r.indexOf(")"));if(isNaN(q)){q=1}var o=d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).attr("transform","translate("+s.x+", "+s.y+") scale("+q*2+")");var h=d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("path.link");if(s.getBiologicalType()=="reaction"){h.filter(function(t){return s.getId()==t.getSource().getId()}).style("stroke","green").style("stroke-width","1.5");h.filter(function(t){return s.getId()==t.getTarget().getId()}).style("stroke","red").style("stroke-width","1.5")}else{h.filter(function(t){return s.getId()==t.getSource().getId()}).style("stroke","red").style("stroke-width","1.5");h.filter(function(t){return s.getId()==t.getTarget().getId()}).style("stroke","green").style("stroke-width","1.5")}}).on("mouseover",function(r){var h=d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).each(function(t){var s=h[0][h.size()-1];this.parentNode.insertBefore(this,s)});r.fixed=true;metExploreD3.GraphNode.node.filter(function(s){return s==r}).select(".locker").classed("hide",false).select(".iconlocker").attr("xlink:href",function(s){if(s.isLocked()){return"resources/icons/lock_font_awesome.svg"}else{return"resources/icons/unlock_font_awesome.svg"}});if(r.getBiologicalType()=="reaction"){d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(s){return r.getId()==s.getSource().getId()}).style("stroke","green");d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(s){return r.getId()==s.getTarget().getId()}).style("stroke","red")}else{d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(s){return r.getId()==s.getSource().getId()}).style("stroke","red");d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(s){return r.getId()==s.getTarget().getId()}).style("stroke","green")}var q=c.getXScale();var p=c.getYScale();if(!document.getElementById("tooltip2").classList.contains("fixed")){var o="<b>Name:</b> "+r.getName()+"<br/><b>Biological type:</b> "+r.getBiologicalType()+((r.getCompartment()!=undefined)?"<br/><b>Compartment:</b> "+r.getCompartment():"")+((r.getDbIdentifier()!=undefined)?"<br/><b>Database identifier:</b> "+r.getDbIdentifier():"")+((r.getEC()!=undefined)?"<br/><b>EC number:</b> "+r.getEC():"")+((r.getReactionReversibility()!=undefined)?"<br/><b>Reaction reversibility:</b> "+r.getReactionReversibility():"")+((r.getIsSideCompound()!=undefined)?"<br/><b>SideCompound:</b> "+r.getIsSideCompound():"")+((r.getMappingDatasLength()!=0)?((r.getMappingDatasLength()==1)?"<br/><b>Mapping:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>":"<br/><b>Mappings:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>"):"");r.getMappingDatas().forEach(function(s){o+="<tr><td>"+s.getMappingName()+"</td><td>"+s.getConditionName()+"</td><td>"+s.getMapValue()+"</td></tr>"});o+="</table>";if(r.getSvg()!=undefined&&r.getSvg()!="undefined"&&r.getSvg()!=""){o+='<br/><img src="resources/images/structure_metabolite/'+r.getSvg()+'"/>'}document.getElementById("tooltip2").innerHTML=o;document.getElementById("tooltip2").classList.remove("hide")}}).on("mouseleave",function(s){var o=d3.select(this).attr("transform");var r=o.substring(o.indexOf("scale"),o.length);var q=r.substring(6,r.indexOf(")"));if(isNaN(q)){q=1}metExploreD3.GraphNode.node.filter(function(t){return t==s}).select(".locker").classed("hide",true);var h=d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).attr("transform","translate("+s.x+", "+s.y+") scale("+q/2+")");if(!s.isLocked()){s.fixed=false}var p=metExploreD3.getLinkStyle();document.getElementById("tooltip2").classList.add("hide");d3.select("#"+n).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(t){return s.getId()==t.getSource().getId()||s.getId()==t.getTarget().getId()}).style("stroke",p.getStrokeColor()).style("stroke-width","0.5");if(s.getBiologicalType()=="reaction"){d3.select(this).selectAll("rect").selectAll(".reaction, .fontSelected").transition().duration(750).attr("width",e.getWidth()).attr("height",e.getHeight()).attr("transform","translate(-"+e.getWidth()/2+",-"+e.getHeight()/2+")")}else{d3.select(this).selectAll("rect").selectAll(".reaction, .fontSelected").transition().duration(750).attr("width",j.getWidth()).attr("height",j.getHeight()).attr("transform","translate(-"+j.getWidth()/2+",-"+j.getHeight()/2+")")}});metExploreD3.GraphNode.node.filter(function(h){return h.getBiologicalType()=="metabolite"}).filter(function(h){return !h.isDuplicated()}).addNodeForm(j.getWidth(),j.getHeight(),j.getRX(),j.getRY(),j.getStrokeColor(),j.getStrokeWidth());metExploreD3.GraphNode.node.filter(function(h){return h.getBiologicalType()=="metabolite"}).filter(function(h){return h.isDuplicated()}).style("stroke-opacity",0.5).addNodeForm(j.getWidth()/2,j.getHeight()/2,j.getRX()/2,j.getRY()/2,j.getStrokeColor(),j.getStrokeWidth()/2);metExploreD3.GraphNode.node.filter(function(h){return h.getBiologicalType()=="reaction"}).addNodeForm(e.getWidth(),e.getHeight(),e.getRX(),e.getRY(),e.getStrokeColor(),e.getStrokeWidth());if(d.getNodes().length<l.getReactionThreshold()||!l.isDisplayedLabelsForOpt()){var a=Math.min(j.getWidth(),j.getHeight());metExploreD3.GraphNode.node.filter(function(h){return h.getLabelVisible()==true}).filter(function(h){return h.getBiologicalType()=="metabolite"}).filter(function(h){return h.getSvg()=="undefined"||h.getSvg()==undefined||h.getSvg()==""}).append("svg:text").attr("fill","black").attr("class",function(h){return h.getBiologicalType()}).each(function(s){var p=d3.select(this);var h=j.getDisplayLabel(s,j.getLabel());h=h.split(" ");p.text("");for(var o=0;o<h.length;o++){var q=$("<div/>").html(h[o]).text();var r=p.append("tspan").text(q);if(o>0){r.attr("x",0).attr("dy","5")}}}).style("font-size",j.getFontSize()).style("paint-order","stroke").style("stroke-width",1).style("stroke","white").style("stroke-opacity","0.7").attr("dy",".4em").style("font-weight","bold").style("pointer-events","none").attr("y",a/2+3);metExploreD3.GraphNode.node.filter(function(h){return h.getLabelVisible()==true}).filter(function(h){return h.getBiologicalType()=="metabolite"}).filter(function(h){return h.getSvg()!="undefined"&&h.getSvg()!=undefined&&h.getSvg()!=""}).append("svg:text").attr("fill","black").attr("class",function(h){return h.getBiologicalType()}).each(function(s){var p=d3.select(this);var h=j.getDisplayLabel(s,j.getLabel());h=h.split(" ");p.text("");for(var o=0;o<h.length;o++){var q=$("<div/>").html(h[o]).text();var r=p.append("tspan").text(q);if(o>0){r.attr("x",0).attr("dy","7")}}}).style("font-size",j.getFontSize()).style("paint-order","stroke").style("stroke-width",1).style("stroke","white").style("stroke-opacity","0.7").attr("dy",".4em").style("font-weight","bold").style("pointer-events","none").attr("y",a/2+3);metExploreD3.GraphNode.node.filter(function(h){return(h.getBiologicalType()=="metabolite"&&h.getSvg()!="undefined"&&h.getSvg()!=undefined&&h.getSvg()!="")}).append("svg").attr("viewBox",function(h){return"0 0 "+a+" "+a}).attr("width",a*8/10+"px").attr("height",a*8/10+"px").attr("x",(-a/2)+(a*1/10)).attr("preserveAspectRatio","xMinYMin").attr("y",(-a/2)+(a*1/10)).attr("class","structure_metabolite").append("image").attr("xlink:href",function(h){return"resources/images/structure_metabolite/"+h.getSvg()}).attr("width","100%").attr("height","100%");var f=metExploreD3.GraphNode.node.insert("svg",":first-child").attr("viewBox",function(h){+" "+a}).attr("width",function(h){if(h.getBiologicalType()=="metabolite"){return j.getWidth()}if(h.getBiologicalType()=="reaction"){return e.getWidth()}}).attr("height",function(h){if(h.getBiologicalType()=="metabolite"){return j.getHeight()}if(h.getBiologicalType()=="reaction"){return e.getHeight()}}).attr("preserveAspectRatio","xMinYMin").attr("y",function(h){if(h.getBiologicalType()=="metabolite"){return -j.getHeight()}if(h.getBiologicalType()=="reaction"){return -e.getHeight()}}).attr("x",function(h){if(h.getBiologicalType()=="metabolite"){return -j.getWidth()}if(h.getBiologicalType()=="reaction"){return -e.getWidth()}}).attr("class","locker").classed("hide",true);f.append("svg:path").attr("class","backgroundlocker").attr("d",function(o){if(o.getBiologicalType()=="metabolite"){var h="M"+j.getWidth()+","+j.getHeight()+" L0,"+j.getHeight()+" L0,"+j.getRY()*2+" A"+j.getRX()*2+","+j.getRY()*2+",0 0 1 "+j.getRX()*2+",0 L"+j.getWidth()+",0";return h}if(o.getBiologicalType()=="reaction"){var h="M"+e.getWidth()+","+e.getHeight()+" L0,"+e.getHeight()+" L0,"+e.getRY()*2+" A"+e.getRX()*2+","+e.getRY()*2+",0 0 1 "+e.getRX()*2+",0 L"+e.getWidth()+",0";return h}}).attr("opacity","0.20").attr("fill","black");f.append("image").attr("class","iconlocker").attr("y",function(h){if(h.getBiologicalType()=="metabolite"){return j.getHeight()/4-(j.getHeight()-j.getRY()*2)/8}if(h.getBiologicalType()=="reaction"){return e.getHeight()/4-(e.getHeight()-e.getRY()*2)/8}}).attr("x",function(h){if(h.getBiologicalType()=="metabolite"){return j.getWidth()/4-(j.getWidth()-j.getRX()*2)/8}if(h.getBiologicalType()=="reaction"){return e.getWidth()/4-(e.getWidth()-e.getRX()*2)/8}}).attr("width","40%").attr("height","40%");metExploreD3.GraphNode.node.filter(function(h){return h.getLabelVisible()==true}).filter(function(h){return h.getBiologicalType()=="reaction"}).append("svg:text").attr("fill","black").attr("class",function(h){return h.getBiologicalType()}).text(function(o){var h=$("<div/>").html(e.getDisplayLabel(o,e.getLabel())).text();if(h==""){var h=$("<div/>").html(e.getDisplayLabel(o,e.getLabel())).text()}return h}).style("font-size",function(h){if(e.getDisplayLabel(h,e.getLabel())=="NA"){return 6}return Math.min(e.getWidth(),(e.getWidth()-e.getWidth()/10)/this.getComputedTextLength()*10)+"px"}).style("font-weight","bold").attr("dy",".3em")}metExploreD3.GraphNode.node.filter(function(h){return h.isSelected()}).each(function(h){_MyThisGraphNode.fixNodeOnRefresh(h,"viz")});metExploreD3.GraphNode.node.filter(function(h){return h.isLocked()}).each(function(h){h.fixed=true});metExploreD3.GraphNode.node.filter(function(h){return h.getMappingDatasLength()>0&&k.getActiveMapping()!=""}).filter(function(o){var h=o.getMappingDataByNameAndCond(k.getActiveMapping(),k.isMapped());return(h!=null&&k.getColorMappingById(h.getMapValue())!=null)}).attr("mapped",function(s){var h=s.getMappingDataByNameAndCond(k.getActiveMapping(),k.isMapped());if(k.getMappingDataType()=="Continuous"){if(k.getColorMappingsSet()[0]<k.getColorMappingsSet()[1]){maxValue=k.getColorMappingsSet()[1];minValue=k.getColorMappingsSet()[0]}else{maxValue=k.getColorMappingsSet()[0];minValue=k.getColorMappingsSet()[1]}var p=_metExploreViz.getGeneralStyle();var t=p.getColorMinMappingContinuous();var r=p.getColorMaxMappingContinuous();var q=d3.scale.linear().domain([parseFloat(minValue),parseFloat(maxValue)]).range([t,r]);return q(parseFloat(h.getMapValue()))}var o=k.getColorMappingById(h.getMapValue()).getValue();return o}).style("fill",function(s){var h=s.getMappingDataByNameAndCond(k.getActiveMapping(),k.isMapped());d3.select(this).insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select("."+s.getBiologicalType()).attr("width"))+10).attr("height",parseInt(d3.select(this).select("."+s.getBiologicalType()).attr("height"))+10).attr("rx",parseInt(d3.select(this).select("."+s.getBiologicalType()).attr("rx"))+5).attr("ry",parseInt(d3.select(this).select("."+s.getBiologicalType()).attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select("."+s.getBiologicalType()).attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select("."+s.getBiologicalType()).attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red");if(k.getMappingDataType()=="Continuous"){if(parseFloat(k.getColorMappingsSet()[0].getName())<parseFloat(k.getColorMappingsSet()[1].getName())){maxValue=parseFloat(k.getColorMappingsSet()[1].getName());minValue=parseFloat(k.getColorMappingsSet()[0].getName())}else{maxValue=parseFloat(k.getColorMappingsSet()[0].getName());minValue=parseFloat(k.getColorMappingsSet()[1].getName())}var p=_metExploreViz.getGeneralStyle();var t=p.getColorMinMappingContinuous();var r=p.getColorMaxMappingContinuous();var q=d3.scale.linear().domain([parseFloat(minValue),parseFloat(maxValue)]).range([t,r]);return q(parseFloat(h.getMapValue()))}var o=k.getColorMappingById(h.getMapValue()).getValue();return o})},tick:function(a){d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").attr("cx",function(f){return f.x}).attr("cy",function(f){return f.y}).attr("transform",function(i){var h=1;if(d3.select(this)!=null){var g=d3.select(this).attr("transform");if(d3.select(this).attr("transform")!=null){var f=g.indexOf("scale(");if(f!=-1){h=parseInt(g.substring(f+6,g.length-1))}}}return"translate("+i.x+","+i.y+") scale("+h+")"});if(a=="viz"){var e=_metExploreViz.getSessionsSet();var c=_metExploreViz.getSessionById(a);if(c.isLinked()){for(var b in e){if(e[b].isLinked()&&a!=e[b].getId()&&d3.select("#"+e[b].getId()).select("#D3viz").select("#graphComponent")[0][0]!=null){d3.select("#"+e[b].getId()).select("#D3viz").select("#graphComponent").selectAll("g.node").each(function(f){d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").each(function(g){if(g.getId()==f.getId()){f.x=g.x;f.y=g.y}})});var d=metExploreD3.getScaleById(e[b].getId());metExploreD3.GraphLink.tick(e[b].getId(),d);_MyThisGraphNode.tick(e[b].getId())}}}}},selectNodeData:function(a){return d3.select(a).datum()},selectNodeFromGrid:function(a){d3.select("#viz").select("#D3viz").selectAll("g.node").filter(function(b){return b.getDbIdentifier()==a||b.getId()==a}).each(function(b){if(!b.isSelected()){_MyThisGraphNode.selection(b,"viz")}})},colorStoreByCompartment:function(b){for(var a=0;a<metExploreD3.getCompartmentInBiosourceLength();a++){b.filter(function(c){return(c.getBiologicalType()=="metabolite"&&c.getCompartment()==metExploreD3.getCompartmentInBiosourceSet()[a].getIdentifier())}).selectAll("rect").style("stroke",metExploreD3.getCompartmentInBiosourceSet()[a].getColor())}},unselectIfDBClick:function(){var c=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(d3.event.target==d3.select("#D3viz")[0][0]){document.getElementById("tooltip2").classList.remove("fixed")}if(_MyThisGraphNode.dblClickable&&d3.event.button==0){_MyThisGraphNode.activePanel=this.parentNode.id;d3.select(this).select("#graphComponent").selectAll("g.node").filter(function(e){return e.isSelected()}).each(function(e){_MyThisGraphNode.selection(e,_MyThisGraphNode.activePanel)});c.removeAllSelectedNodes()}else{if(d3.event.button==0){_MyThisGraphNode.dblClickable=true;_MyThisGraphNode.taskClick=metExploreD3.createDelayedTask(function(){_MyThisGraphNode.dblClickable=false});metExploreD3.fixDelay(_MyThisGraphNode.taskClick,400)}else{}}if(_MyThisGraphNode.dblClickable&&d3.event.button==1){_MyThisGraphNode.activePanel=this.parentNode.id;d3.select(this).select("#graphComponent").selectAll("g.node").filter(function(e){return e.isLocked()}).each(function(e){e.fixed=false})}else{if(d3.event.button==1){_MyThisGraphNode.dblClickable=true;_MyThisGraphNode.taskClick=metExploreD3.createDelayedTask(function(){_MyThisGraphNode.dblClickable=false});metExploreD3.fixDelay(_MyThisGraphNode.taskClick,400)}else{}}if(c!=undefined){if(c.isLinked()){var d=_metExploreViz.getSessionById("viz");if(d!=undefined){var a=metExploreD3.GraphNetwork.isAnimated(d.getId());if(a=="true"){var b=d.getForce();if(b!=undefined){if(metExploreD3.GraphNetwork.isAnimated(d.getId())=="true"||metExploreD3.GraphNetwork.isAnimated(d.getId())==null){b.start()}}}}}else{var b=c.getForce();var a=metExploreD3.GraphNetwork.isAnimated(c.getId());if(a=="true"){var b=c.getForce();if(b!=undefined){if((metExploreD3.GraphNetwork.isAnimated(c.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(c.getId())==null)){b.start()}}}}}},loadNode:function(o){var e=metExploreD3.getReactionStyle();var k=metExploreD3.getMetaboliteStyle();var m=metExploreD3.getGeneralStyle();var l=_metExploreViz.getSessionById(o);var j=_metExploreViz.getSessionById("viz");d3.select("body").on("keydown",function(){_MyThisGraphNode.charKey=d3.event.keyCode;_MyThisGraphNode.ctrlKey=d3.event.ctrlKey;if(_MyThisGraphNode.charKey==65&&_MyThisGraphNode.ctrlKey){d3.select("#"+o).select("#D3viz").select("#graphComponent").selectAll("g.node").each(function(h){if(!h.isSelected()){_MyThisGraphNode.selection(h,o)}})}}).on("keyup",function(h){if(_MyThisGraphNode.charKey==46&&l.getSelectedNodes().length>0){metExploreD3.displayMessageYesNo("Selected nodes","Do you want remove selected nodes?",function(i){if(i=="yes"){metExploreD3.GraphNetwork.removeSelectedNode("viz")}})}_MyThisGraphNode.charKey="none";_MyThisGraphNode.ctrlKey=d3.event.ctrlKey});metExploreD3.GraphNode.panelParent=o;_MyThisGraphNode=metExploreD3.GraphNode;var d=l.getD3Data();var g=parseInt(d3.select("#"+_MyThisGraphNode.panelParent).select("#D3viz").style("height"));var n=parseInt(d3.select("#"+_MyThisGraphNode.panelParent).select("#D3viz").style("width"));d3.selectAll("#D3viz").on("mouseup",this.unselectIfDBClick);var c=metExploreD3.getScaleById(o);var b=d3.behavior.drag().on("dragstart",_MyThisGraphNode.dragstart).on("drag",_MyThisGraphNode.dragmove).on("dragend",_MyThisGraphNode.dragend);metExploreD3.GraphNode.node=d3.select("#"+metExploreD3.GraphNode.panelParent).select("#D3viz").select("#graphComponent").selectAll("g.node").data(d.getNodes()).enter().append("svg:g").attr("class","node").attr("id",function(h){return"node"+h.getId()}).call(b).style("fill",function(h){if(h.isSelected()==false){return"white"}else{return"grey"}}).on("mouseenter",function(s){var p=d3.select(this).attr("transform");var r=p.substring(p.indexOf("scale"),p.length);var q=r.substring(6,r.indexOf(")"));if(isNaN(q)){q=1}var i=d3.select("#"+o).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).attr("transform","translate("+s.x+", "+s.y+") scale("+q/2+")");var h=d3.select("#"+o).select("#D3viz").select("#graphComponent").selectAll("path.link");if(s.getBiologicalType()=="reaction"){h.filter(function(t){return s.getId()==t.getSource().getId()}).style("stroke","green").style("stroke-width","1.5");h.filter(function(t){return s.getId()==t.getTarget().getId()}).style("stroke","red").style("stroke-width","1.5")}else{h.filter(function(t){return s.getId()==t.getSource().getId()}).style("stroke","red").style("stroke-width","1.5");h.filter(function(t){return s.getId()==t.getTarget().getId()}).style("stroke","green").style("stroke-width","1.5")}}).on("mouseover",function(r){var h=d3.select("#"+o).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).each(function(t){var s=h[0][h.size()-1];this.parentNode.insertBefore(this,s)});r.fixed=true;metExploreD3.GraphNode.node.filter(function(s){return s==r}).select(".locker").classed("hide",false).select(".iconlocker").attr("xlink:href",function(s){if(s.isLocked()){return"resources/icons/lock_font_awesome.svg"}else{return"resources/icons/unlock_font_awesome.svg"}});var q=c.getXScale();var p=c.getYScale();if(!document.getElementById("tooltip2").classList.contains("fixed")){var i="<b>Name:</b> "+r.getName()+"<br/><b>Biological type:</b> "+r.getBiologicalType()+((r.getCompartment()!=undefined)?"<br/><b>Compartment:</b> "+r.getCompartment():"")+((r.getDbIdentifier()!=undefined)?"<br/><b>Database identifier:</b> "+r.getDbIdentifier():"")+((r.getEC()!=undefined)?"<br/><b>EC number:</b> "+r.getEC():"")+((r.getReactionReversibility()!=undefined)?"<br/><b>Reaction reversibility:</b> "+r.getReactionReversibility():"")+((r.getIsSideCompound()!=undefined)?"<br/><b>SideCompound:</b> "+r.getIsSideCompound():"")+((r.getMappingDatasLength()!=0)?((r.getMappingDatasLength()==1)?"<br/><b>Mapping:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>":"<br/><b>Mappings:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>"):"");r.getMappingDatas().forEach(function(s){i+="<tr><td>"+s.getMappingName()+"</td><td>"+s.getConditionName()+"</td><td>"+s.getMapValue()+"</td></tr>"});i+="</table>";if(r.getSvg()!=undefined&&r.getSvg()!="undefined"&&r.getSvg()!=""){i+='<br/><img src="resources/images/structure_metabolite/'+r.getSvg()+'"/>'}document.getElementById("tooltip2").innerHTML=i;document.getElementById("tooltip2").classList.remove("hide")}}).on("mouseleave",function(s){var i=d3.select(this).attr("transform");var r=i.substring(i.indexOf("scale"),i.length);var q=r.substring(6,r.indexOf(")"));if(isNaN(q)){q=1}metExploreD3.GraphNode.node.filter(function(t){return t==s}).select(".locker").classed("hide",true);var h=d3.select("#"+o).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).attr("transform","translate("+s.x+", "+s.y+") scale("+q/2+")");if(!s.isLocked()){s.fixed=false}var p=metExploreD3.getLinkStyle();document.getElementById("tooltip2").classList.add("hide");d3.select("#"+o).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(t){return s.getId()==t.getSource().getId()||s.getId()==t.getTarget().getId()}).style("stroke",p.getStrokeColor()).style("stroke-width","0.5");if(s.getBiologicalType()=="reaction"){d3.select(this).selectAll("rect").selectAll(".reaction, .fontSelected").transition().duration(750).attr("width",e.getWidth()).attr("height",e.getHeight()).attr("transform","translate(-"+e.getWidth()/2+",-"+e.getHeight()/2+")")}else{d3.select(this).selectAll("rect").selectAll(".reaction, .fontSelected").transition().duration(750).attr("width",k.getWidth()).attr("height",k.getHeight()).attr("transform","translate(-"+k.getWidth()/2+",-"+k.getHeight()/2+")")}}).filter(function(h){return h.getMappingDatasLength()>0&&l.getActiveMapping()!=""}).attr("mapped",function(i){var h=i.getMappingDataByNameAndCond(l.getActiveMapping(),l.isMapped());return l.getColorMappingById(h.getMapValue())}).style("fill",function(i){var h=i.getMappingDataByNameAndCond(l.getActiveMapping(),l.isMapped());return l.getColorMappingById(h.getMapValue())});metExploreD3.GraphNode.node.filter(function(h){return h.getBiologicalType()=="metabolite"}).append("rect").attr("class",function(h){return h.getBiologicalType()}).attr("id",function(h){return h.getId()}).attr("identifier",function(h){return h.getId()}).attr("width",k.getWidth()).attr("height",k.getHeight()).attr("rx",k.getRX()).attr("ry",k.getRY()).attr("transform","translate(-"+k.getWidth()/2+",-"+k.getHeight()/2+")").style("stroke",k.getStrokeColor()).style("stroke-width",k.getStrokeWidth());metExploreD3.GraphNode.node.filter(function(h){return h.getBiologicalType()=="metabolite"}).append("rect").attr("class","fontSelected").attr("width",k.getWidth()).attr("height",k.getHeight()).attr("rx",k.getRX()).attr("ry",k.getRY()).attr("transform","translate(-"+k.getWidth()/2+",-"+k.getHeight()/2+")").style("fill-opacity","0").style("fill","#000");metExploreD3.GraphNode.node.filter(function(h){return h.getBiologicalType()=="reaction"}).append("rect").attr("class",function(h){return h.getBiologicalType()}).attr("id",function(h){return h.getId()}).attr("width",e.getWidth()).attr("height",e.getHeight()).attr("rx",e.getRX()).attr("ry",e.getRY()).attr("transform","translate(-"+e.getWidth()/2+",-"+e.getHeight()/2+")").style("stroke",e.getStrokeColor()).style("stroke-width",e.getStrokeWidth());metExploreD3.GraphNode.node.filter(function(h){return h.getBiologicalType()=="reaction"}).append("rect").attr("class","fontSelected").attr("width",e.getWidth()).attr("height",e.getHeight()).attr("rx",e.getRX()).attr("ry",e.getRY()).attr("transform","translate(-"+e.getWidth()/2+",-"+e.getHeight()/2+")").style("fill-opacity","0").style("fill","#000");metExploreD3.sortCompartmentInBiosource();for(var f=0;f<metExploreD3.getCompartmentInBiosourceLength();f++){metExploreD3.GraphNode.node.filter(function(h){return(h.getBiologicalType()=="metabolite"&&h.getCompartment()==metExploreD3.getCompartmentInBiosourceSet()[f].getIdentifier())}).selectAll("rect").style("stroke",metExploreD3.getCompartmentInBiosourceSet()[f].getColor())}if(d.getNodes().length<m.getReactionThreshold()||!m.isDisplayedLabelsForOpt()){var a=Math.min(k.getWidth(),k.getHeight());metExploreD3.GraphNode.node.filter(function(h){return h.getLabelVisible()==true}).filter(function(h){return h.getBiologicalType()=="metabolite"}).filter(function(h){return h.getSvg()=="undefined"||h.getSvg()==undefined||h.getSvg()==""}).append("svg:text").attr("fill","black").attr("class",function(h){return h.getBiologicalType()}).each(function(t){var q=d3.select(this);var h=k.getDisplayLabel(t,k.getLabel());h=h.split(" ");q.text("");for(var p=0;p<h.length;p++){var r=$("<div/>").html(h[p]).text();var s=q.append("tspan").text(r);if(p>0){s.attr("x",0).attr("dy","5")}}}).style("font-size",k.getFontSize()).style("paint-order","stroke").style("stroke-width",1).style("stroke","white").style("stroke-opacity","0.7").attr("dy",".4em").style("font-weight","bold").style("pointer-events","none").attr("y",a/2+3);metExploreD3.GraphNode.node.filter(function(h){return h.getLabelVisible()==true}).filter(function(h){return h.getBiologicalType()=="metabolite"}).filter(function(h){return h.getSvg()!="undefined"&&h.getSvg()!=undefined&&h.getSvg()!=""}).append("svg:text").attr("fill","black").attr("class",function(h){return h.getBiologicalType()}).each(function(t){var q=d3.select(this);var h=k.getDisplayLabel(t,k.getLabel());h=h.split(" ");q.text("");for(var p=0;p<h.length;p++){var r=$("<div/>").html(h[p]).text();var s=q.append("tspan").text(r);if(p>0){s.attr("x",0).attr("dy","7")}}}).style("font-size",k.getFontSize()).style("paint-order","stroke").style("stroke-width",1).style("stroke","white").style("stroke-opacity","0.7").attr("dy",".4em").style("font-weight","bold").style("pointer-events","none").attr("y",a/2+3);metExploreD3.GraphNode.node.filter(function(h){return(h.getBiologicalType()=="metabolite"&&h.getSvg()!="undefined"&&h.getSvg()!=undefined&&h.getSvg()!="")}).append("svg").attr("viewBox",function(h){return"0 0 "+a+" "+a}).attr("width",a*8/10+"px").attr("height",a*8/10+"px").attr("x",(-a/2)+(a*1/10)).attr("preserveAspectRatio","xMinYMin").attr("y",(-a/2)+(a*1/10)).attr("class","structure_metabolite").append("image").attr("xlink:href",function(h){return"resources/images/structure_metabolite/"+h.getSvg()}).attr("width","100%").attr("height","100%");metExploreD3.GraphNode.node.filter(function(h){return h.getLabelVisible()==true}).filter(function(h){return h.getBiologicalType()=="reaction"}).append("svg:text").attr("fill","black").attr("class",function(h){return h.getBiologicalType()}).text(function(i){var h=$("<div/>").html(e.getDisplayLabel(i,e.getLabel())).text();if(h==""){var h=$("<div/>").html(e.getDisplayLabel(i,e.getLabel())).text()}return h}).style("font-size",function(h){if(e.getDisplayLabel(h,e.getLabel())=="NA"){return 6}return Math.min(e.getWidth(),(e.getWidth()-e.getWidth()/10)/this.getComputedTextLength()*10)+"px"}).style("font-weight","bold").attr("dy",".3em")}metExploreD3.GraphNode.loadPath(metExploreD3.GraphNode.panelParent)},loadSideCompounds:function(b,a){var c=[];b.forEach(function(f){var e=_metExploreViz.getSessionById("viz").getD3Data().getNodeByDbIdentifier(f);if(e!=null){if(metExploreD3.getMetabolitesSet()!=undefined){var d=metExploreD3.getMetaboliteById(metExploreD3.getMetabolitesSet(),e.getId());if(d!=null){d.set("sideCompound",true)}}e.setIsSideCompound(true);c.push(e)}});if(a!=undefined){a()}return c.length>0},setIsSideCompoundById:function(h,f){var e=_metExploreViz.getSessionById("viz").getD3Data();var a=e.getNodes();if(a!=undefined){var d=e.getNodeById(h);if(d!=undefined){d.setIsSideCompound(f)}var g=_metExploreViz.getSessionsSet();for(var b in g){if(g[b].getId()!="viz"){var c=g[b].getD3Data().getNodeById(h);c.setIsSideCompound(f);if(c!=undefined){c.setIsSideCompound(f)}}}}},setIsReversibleById:function(c,g){var f=_metExploreViz.getSessionById("viz").getD3Data();var a=f.getNodes();if(a!=undefined){var e=f.getNodeById(c);if(e!=undefined){e.setReactionReversibility(g)}var h=_metExploreViz.getSessionsSet();for(var b in h){if(h[b].getId()!="viz"){var d=h[b].getD3Data().getNodeById(c);d.setReactionReversibility(g);if(d!=undefined){d.setReactionReversibility(g)}}}}},loadPath:function(d,c){var e=_metExploreViz.getSessionById(d);if(c=="Compartments"){var b=d3.select("#"+d).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(f){return f.getBiologicalType()=="metabolite"});e.groups=metExploreD3.getCompartmentsGroup();metExploreD3.GraphNetwork.initCentroids()}else{e.groups=metExploreD3.getPathwaysGroup();metExploreD3.GraphNetwork.initCentroids()}metExploreD3.GraphNode.groupPath=function(l){var k=metExploreD3.getScaleById("viz");if(l.values!=undefined){if(l.values.length>0){if(l.values.length>2){return"M"+d3.geom.hull(l.values.map(function(m){return[m.x,m.y]})).join("L")+"Z"}else{var j=[];l.values.forEach(function(i){j.push([i.x,i.y])});var g,f;for(var h=l.values.length;h<3;h++){g=l.values[0].x*(1+0.00001*h);f=l.values[0].y*(1+0.000011*h);j.push([g,f])}return"M"+d3.geom.hull(j).join("L")+"Z"}}}};metExploreD3.GraphNode.groupFill=function(o,l){var h;if(c=="Compartments"){for(var k=0;k<metExploreD3.getCompartmentInBiosourceLength();k++){if(o.key==metExploreD3.getCompartmentInBiosourceSet()[k].getName()){h=metExploreD3.getCompartmentInBiosourceSet()[k].getColor()}}return h}else{var g=metExploreD3.getPathwaysLength();if(g==undefined){g=0}center=128;width=127;frequency=Math.PI*2*0.95/g;var n=Math.sin(frequency*l+2+g)*width+center;var m=Math.sin(frequency*l+0+g)*width+center;var f=Math.sin(frequency*l+4+g)*width+center;var h=metExploreD3.GraphUtils.RGB2Color(n,m,f);o.color=h;return h}};var a="M0,0L10,10Z";d3.select("#"+d).select("#D3viz").selectAll("path.convexhull").data(e.groups).enter().insert("path",":first-child").attr("class",String).attr("d",function(f){return a}).attr("class",function(f){return f.key}).classed("convexhull",true).attr("id",function(f){return f.key}).style("fill",metExploreD3.GraphNode.groupFill).style("stroke",metExploreD3.GraphNode.groupFill).style("stroke-width",40).style("stroke-linejoin","round").style("opacity",0.15)},fixSelectedNode:function(){metExploreD3.GraphNode.node.filter(function(a){return a.isSelected()}).each(function(a){a.setLocked(true);a.fixed=a.isLocked()})}};