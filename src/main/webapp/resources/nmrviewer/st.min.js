!function(){var d={version:"0.0.3"};d.util={};d.util.cache=function(){var g={},r=[],m=function(u,w){var t=u.length;for(var v=0;v<t;v++){if(u[v]===w){return v}}return -1},s=function(t){if((t).toString()==="[object Object]"){return $.param(t)}else{return(t).toString()}},j=function(v){var u;if((u=m(r,v))>-1){r.splice(u,1);delete g[v]}},l=function(){g={};r=[]},q=function(t,u){if(r.indexOf(t)===-1){r.push(t)}g[t]=u},n=function(t){return g.hasOwnProperty(t)},i=function(){if(arguments.length>0){j(arguments[0])}else{l()}return $.extend(true,{},g)},p=function(v){var u=[];var t;t=new RegExp("\\b"+v+"\\b","i");$.each(u,function(w,x){if(x.match(t)){u.push(x)}});return u},h=function(t){var u;if(g[t]!==undefined){if((g[t]).toString()==="[object Object]"){u=$.extend(true,{},g[t])}else{u=g[t]}}return u},k=function(t){return s(t)},o=function(){return r};return{add:q,get:h,getKey:k,exists:n}};d.util.colors=function(){var h={0:"blue",1:"red",2:"green",3:"orange",4:"yellow",5:"black"},j={};j.size=function(){var m=-1,l;for(l in this){if(this.hasOwnProperty(l)){m++}}return m};var i=function(m){if(j[m]){return j[m]}var l=k();j[m]=l;return j[m]},g=function(l){if(j[l]){delete j[l]}},k=function(){var n=Object.keys(h).length;var l=j.size();var m=l%n;return h[m]};return{get:i,remove:g}};d.util.hashcode=function(l){var k=0,h,j,g;if(l.length==0){return k}for(h=0,g=l.length;h<g;h++){j=l.charCodeAt(h);k=((k<<5)-k)+j;k|=0}return k};d.util.domain=function(h,i){var g=h.domain();if(g[0]>g[1]){return[i[1],i[0]]}return[i[0],i[1]]};d.util.mol2svg=function(B,z){var t=B||200,C=z||200,r=null,q=null,i=0,u=d.util.cache();var s=function(h,H){var G;var w=d3.select(H);var y=u.getKey(h);if(u.exists(y)){var x=u.get(y);A(x,w)}else{G=$.when($.get(h)).fail(function(){console.log("Request failed for: "+h)}).then(function(J){u.add(y,J);try{A(J,w)}catch(I){console.log("Mol2Svg Error:"+I);w.html("")}})}return G};var A=function(w,G){var K=w.split(/\r\n|\n/),x=K[3].match(/\d+/g),h=parseFloat(x[0]),y=parseFloat(x[1]);var H=E(K,h),I=n(K,h,y);g(K,H,h+y);var J=k(H,G);v(H,I,J);o(H,i,J)};var E=function(h,H){var w=[];var G=4;for(var x=G;x<H+G;x++){var y=h[x].match(/-*\d+\.\d+|\w+/g);w.push({x:parseFloat(y[0]),y:parseFloat(y[1]),symbol:y[3],mass:0,charge:0})}return w};var n=function(h,I,x){var H=[];var G=4;for(var w=I+G;w<I+x+G;w++){var y=h[w].match(/\d+/g);H.push({a1:parseInt(y[0])-1,a2:parseInt(y[1])-1,order:parseInt(y[2]),stereo:parseInt(y[3])})}return H};var g=function(x,G,H){var J=4;for(var y=H+J;y<x.length;y++){if(x[y].indexOf("M  ISO")!==-1){var I=x[y].match(/-*\d+/g);for(var w=0,h=1;w<I[0];w++,h+=2){G[I[h]-1].mass=parseInt(I[h+1],10)}}else{if(x[y].indexOf("M  CHG")!==-1){var I=x[y].match(/-*\d+/g);for(var w=0,h=1;w<I[0];w++,h+=2){G[I[h]-1].charge=parseInt(I[h+1],10)}}}}};var k=function(y,w){var H=d3.extent(y,function(L){return L.x});var G=d3.extent(y,function(L){return L.y});var x=[20,20,20,20];var I=t-x[1]-x[3];var K=C-x[0]-x[2];var h=(H[1]-H[0])/(G[1]-G[0]);if(h>1){K/=h}else{I*=h}r=d3.scale.linear().domain([H[0],H[1]]).range([0,I]);q=d3.scale.linear().domain([G[0],G[1]]).range([K,0]);var J=w.append("svg:svg").attr("width",I+x[1]+x[3]).attr("height",K+x[0]+x[2]).append("svg:g").attr("transform","translate("+x[3]+","+x[0]+")");return J};var v=function(J,L,x){for(var T=0;T<L.length;T++){var aa=J[L[T].a1],Y=J[L[T].a2];var P=Y.x-aa.x,O=Y.y-aa.y,R=Math.sqrt(P*P+O*O),N=(P/R)*(0.2),M=(O/R)*(0.2);var V=aa.x+N,H=aa.y+M,U=Y.x-N,G=Y.y-M;i+=l(r(V),q(H),r(U),q(G));var X,y,K,Q=[];if(L[T].order===1){if(L[T].stereo===1){var I=l(V,H,U,G);X=0.1;y=X*(G-H)/I;K=X*(V-U)/I;Q=[[V,H],[U+y,G+K],[U-y,G-K]];x.append("svg:path").style("fill","black").style("stroke-width",1).attr("d",j(Q))}else{if(L[T].stereo===6){X=0.2;y=X*(G-H)/R;K=X*(V-U)/R;var w=U+y-V,Z=G+K-H,h=U-y-V,W=G-K-H;for(var S=0.05;S<=1;S+=0.15){Q.push([V+w*S,H+Z*S],[V+h*S,H+W*S])}x.append("svg:path").style("fill","none").style("stroke-width",1).attr("d",F(Q)).attr("stroke","black")}else{if(L[T].stereo===4){X=0.2;y=X*(G-H)/R;K=X*(V-U)/R;var w=U+y-V,Z=G+K-H,h=U-y-V,W=G-K-H;for(var S=0.05;S<=1;S+=0.1){if(Q.length%2===0){Q.push([V+w*S,H+Z*S])}else{Q.push([V+h*S,H+W*S])}}x.append("svg:path").attr("d",D(Q)).attr("fill","none").style("stroke-width",1).attr("stroke","black")}else{Q=[[V,H],[U,G]];x.append("svg:path").attr("d",p(Q)).attr("stroke-width","1").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black")}}}}else{if(L[T].order===2){X=0.1;y=X*(G-H)/R;K=X*(V-U)/R;Q=[[V+y,H+K],[U+y,G+K],[V-y,H-K],[U-y,G-K]];x.append("svg:path").attr("d",p(Q)).attr("stroke-width","1").style("fill","none").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black")}else{if(L[T].order===3){X=0.15;y=X*(G-H)/R;K=X*(V-U)/R;Q=[[V,H],[U,G],[V+y,H+K],[U+y,G+K],[V-y,H-K],[U-y,G-K]];x.append("svg:path").attr("d",p(Q)).attr("stroke-width","1").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black")}}}}i/=L.length};var o=function(h,y,I){for(var x=0;x<h.length;x++){var H=h[x];var w=d3.rgb(m[H.symbol]);var G=I.append("svg:g").attr("transform","translate("+r(H.x)+","+q(H.y)+")");G.append("svg:circle").attr("r",Math.ceil(y/3)).attr("fill","white").attr("opacity","1");G.append("text").attr("dy",Math.ceil(y/4.5)).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size",Math.ceil(y/1.5)).attr("fill",w).text(H.symbol);if(H.charge!==0){var J=H.charge;if(J<0){J=(J===-1)?"-":(J+"-")}else{J=(J===+1)?"+":(J+"+")}G.append("text").attr("dx",+1*Math.ceil(y/3)).attr("dy",-1*Math.ceil(y/4.5)).attr("text-anchor","left").attr("font-family","sans-serif").attr("fill",w).attr("font-size",Math.ceil(y/3)).text(J)}if(H.mass!==0){G.append("text").attr("dx",-2*Math.ceil(y/3)).attr("dy",-1*Math.ceil(y/4.5)).attr("text-anchor","left").attr("font-family","sans-serif").attr("font-size",Math.ceil(y/3)).attr("fill",w).text(H.mass)}}};var l=function(w,y,h,x){return Math.sqrt((h-w)*(h-w)+(x-y)*(x-y))};var p=d3.svg.line().interpolate(function(w){var x=w[0][0]+","+w[0][1];for(var h=1;h<w.length;h++){if(h%2===0){x+="M"+w[h][0]+","+w[h][1]}else{x+="L"+w[h][0]+","+w[h][1]}}return x}).x(function(h){return r(h[0])}).y(function(h){return q(h[1])});var j=d3.svg.line().x(function(h){return r(h[0])}).y(function(h){return q(h[1])});var F=d3.svg.line().interpolate(function(w){var x=w[0][0]+","+w[0][1];for(var h=1;h<w.length;h++){if(h%2===0){x+="M"+w[h][0]+","+w[h][1]}else{x+="L"+w[h][0]+","+w[h][1]}}return x}).x(function(h){return r(h[0])}).y(function(h){return q(h[1])});var D=d3.svg.line().interpolate("cardinal").x(function(h){return r(h[0])}).y(function(h){return q(h[1])});var m={H:"#000000",He:"#FFC0CB",Li:"#B22222",B:"#00FF00",C:"#000000",N:"#8F8FFF",O:"#F00000",F:"#DAA520",Na:"#0000FF",Mg:"#228B22",Al:"#808090",Si:"#DAA520",P:"#FFA500",S:"#FFC832",Cl:"#00FF00",Ca:"#808090",Ti:"#808090",Cr:"#808090",Mn:"#808090",Fe:"#FFA500",Ni:"#A52A2A",Cu:"#A52A2A",Zn:"#A52A2A",Br:"#A52A2A",Ag:"#808090",I:"#A020F0",Ba:"#FFA500",Au:"#DAA520"};return{draw:s}};d.util.spinner=function(g){if($(".st-spinner").length){return $(".st-spinner")}$(g).append('<div class="st-spinner"><div class="st-bounce1"></div><div class="st-bounce2"></div><div class="st-bounce3"></div></div>');return $(".st-spinner")};d.util.compare=function(h){var g=function(j,i){if(j[h]<i[h]){return -1}if(j[h]>i[h]){return 1}return 0};return g};d.annotation={TOOLTIP:"tooltip",TOOLTIP_MOL:"tooltip_mol",ANNOTATION:"annotation",ANNOTATION_COLOR:"annotation_color"};d.parser={};d.parser.jdx=function(g,h){d3.text(g,function(l){var E="##",o="END",D="XYDATA",n="(X++(Y..Y))",p="YFACTOR",C="FIRSTX",m="LASTX";var q=[];var t={},F=false,B=[];var v,G,x,w;var k=l.split(/\r\n|\r|\n/g);for(var A in k){var s=k[A];if(s.indexOf(E)===0){v=s.split(/=\s(.*)/);if(v.length<2){continue}G=v[0].slice(2);w=v[1].split(/\$\$(.*)/)[0].trim();if(G===D&&w===n){F=true}else{if(G===o){if(F){if(parseFloat(t[C])>parseFloat(t[m])){B.reverse()}t[x]=B;q.push(t);t={};F=false;B=[]}F=false}else{t[G]=w}}x=G}else{if(F){var u=s.match(/(\+|-)*\d+\.*\d*/g);for(var z=1;z<u.length;z++){var r=t[p]*u[z];B.push(r)}}}}h(q)})};d.data={};function f(){return{opts:{title:"",src:[],anno:[],x:"x",y:"y",xlimits:[],ylimits:[],annoTypes:[],annoTexts:[]},raw:{gxlim:[Number.MAX_VALUE,Number.MIN_VALUE],gylim:[Number.MAX_VALUE,Number.MIN_VALUE],ids:{},series:[],minima:0,annoGroups:{}},title:function(g){if(g&&typeof g==="string"){this.opts.title=g}else{console.log("Invalid title option.")}return this},y:function(g){if(g&&typeof g==="string"){this.opts.y=g}else{console.log("Invalid y accessor option.")}return this},xlimits:function(g){if(g&&g instanceof Array){this.opts.xlimits=g}else{console.log("Invalid x domain limits.")}return this},ylimits:function(g){if(g&&g instanceof Array){this.opts.ylimits=g}else{console.log("Invalid y domain limits.")}return this},add:function(g,h){if(g instanceof Array){if(!h||h instanceof Array){this.opts.src.push.apply(this.opts.src,g);this.opts.anno.push.apply(this.opts.anno,h)}else{console.log("Raw data and annotation data must be of the same type.")}}else{this.opts.src.push(g);this.opts.anno.push(h)}},annotationColumn:function(g,h){if(g.toUpperCase() in d.annotation){this.opts.annoTypes.push(g);this.opts.annoTexts.push(h)}else{console.log("Unknown annotation type: "+g)}},remove:function(g){var l=[];if(!g&&g!==0){for(var k in this.raw.ids){l.push(k)}this.raw.ids={};this.raw.series=[];this.raw.gxlim=[Number.MAX_VALUE,Number.MIN_VALUE];this.raw.gylim=[Number.MAX_VALUE,Number.MIN_VALUE];return l}if(!(g instanceof Array)){g=[g]}else{g.sort()}for(k in g){var j=g[k];if(isNaN(j)){for(var k in this.raw.series){if(this.raw.series[k].id===j){this.raw.series.splice(k,1);l.push(this.raw.ids[j]);delete this.raw.ids[j];break}}}else{if(j-k<this.raw.series.length){var h=this.raw.series.splice(j-k,1);l.push(h[0].id);delete this.raw.ids[h[0].id]}}}if(this.raw.series.length===0){this.raw.gxlim=[Number.MAX_VALUE,Number.MIN_VALUE];this.raw.gylim=[Number.MAX_VALUE,Number.MIN_VALUE]}return l},id:function(g){return this.raw.series[g].id},titleat:function(g){return this.raw.series[g].title},accs:function(g){return this.raw.series[g].accs},push:function(k){var j=this;var h=[];for(var g in this.opts.src){if(typeof this.opts.src[g]!=="string"){this.fetch(this.opts.src[g],this.opts.anno[g])}else{h.push(this.fetch(this.opts.src[g],this.opts.anno[g]))}}$.when.apply($,h).done(function(){if(!j.opts.src.length){return}j.opts.src=[];j.opts.anno=[];if(j.raw.gxlim[0]===j.raw.gxlim[1]){j.raw.gxlim[0]-=j.raw.gxlim[0]/100;j.raw.gxlim[1]+=j.raw.gxlim[1]/100}if(j.raw.gylim[0]===j.raw.gylim[1]){j.raw.gylim[0]-=j.raw.gylim[0]/100;j.raw.gylim[1]+=j.raw.gylim[1]/100}k()})},fetch:function(k,h){var l=this;var j=null;if(typeof k==="string"){if(typeof h==="string"&&h){j=$.when($.get(k),$.get(h)).fail(function(){console.log("Fetch failed for: "+k+"\n"+h)}).then(function(n,o){if(typeof n==="string"){n=$.parseJSON(n)}if(n[0] instanceof Array){for(var m in n[0]){l.seriesfetch(n[0][m],o[0][m])}}else{l.seriesfetch(n[0],o[0])}})}else{j=$.when($.get(k)).fail(function(){console.log("Fetch failed for: "+k)}).then(function(n){if(typeof n==="string"){n=$.parseJSON(n)}if(n instanceof Array){if(!h){h=[]}for(var m in n){l.seriesfetch(n[m],h[m])}}else{l.seriesfetch(n,h)}})}}else{if(typeof h==="string"&&h){j=$.when($.get(h)).fail(function(){console.log("Fetch failed for: "+h)}).then(function(n){if(k instanceof Array){if(!h){h=[]}for(var m in k){l.seriesfetch(k[m],n[m])}}else{l.seriesfetch(k,n)}})}else{if(k instanceof Array){for(var g in k){l.seriesfetch(k[g],h[g])}}else{l.seriesfetch(k,h)}}}return j},reset:function(){for(var h in this.raw.series){var g=this.raw.series[h];g.size=[0,g.data.length,0]}}}}function c(i,h,g,j){var k=[];if(g.length===2){if(isNaN(g[0])&&isNaN(g[1])){k=[h[g[0]],h[g[1]]]}else{if(typeof g[0]==="number"&&typeof g[1]==="number"){k=[g[0],g[1]]}else{if(!j||j===""){k=d3.extent(i)}else{k=d3.extent(i,function(l){return l[j]})}}}}else{if(!j||j===""){k=d3.extent(i)}else{k=d3.extent(i,function(l){return l[j]})}}k[0]=parseFloat(k[0]);k[1]=parseFloat(k[1]);return k}d.data.set=function(){var g=f();g.x=function(h){if(h&&typeof h==="string"){this.opts.x=h}else{console.log("Invalid y accessor option.")}return this};g.get=function(k,h){var l=[];var m=[h.invert(0),h.invert(k)];m=d.util.domain(h,m);for(var o in this.raw.series){var p=this.raw.series[o];var q=[];for(var n in p.data){var r=p.x(n);if(r>=m[0]&&r<=m[1]){q.push(p.data[n])}}l.push(q)}return l};g.bin=function(w,z,u){var q=[];var o=[z.invert(0),z.invert(w)];o=d.util.domain(z,o);var k=1;var m=0;for(var A in this.raw.series){var B=this.raw.series[A].size;B[2]=Math.ceil(w/k);if(m<B[2]){m=B[2]}}var p=Math.abs(o[1]-o[0])/(m-1);for(var A in this.raw.series){var t=this.raw.series[A];var h=t.data.length;var B=t.size;var n=[];var l=0;while(B[0]>0){var s=t.x(B[0]);if(s<o[0]){break}B[0]-=1}while(B[1]<h){var s=t.x(B[1]);if(s>o[1]){break}B[1]+=1}for(var y=B[0];y<B[1];y++){var s=t.x(y);if(s<o[0]){B[0]=y;continue}else{if(s>o[1]){B[1]=y;break}}var v=Math.floor((s-o[0])/p);var r=n[v-l];var C=t.data[y];if(r){if(u){if(r[t.accs[1]]<C[t.accs[1]]){n[v-l]=r}else{if(r.annos&&!C.annos){C.annos=r.annos}n[v-l]=C}}else{if(Math.abs(r[t.accs[1]])>Math.abs(C[t.accs[1]])){n[v-l]=r}else{if(r.annos&&!C.annos){C.annos=r.annos}n[v-l]=C}}}else{l=v-n.length;n[v-l]=C}}if(l>0){B[2]=n.length}t.size=B;q.push(n)}return q};g.seriesfetch=function(D,r){var x=d.util.hashcode((new Date().getTime()*Math.random())+"");x="st"+x;var H=D[g.opts.title];var h=[];var l=[];var v=[];var k=this.opts.x;var p=this.opts.y;if(!H||H.length===0){H=x}if(x in this.raw.ids){console.log("SpeckTackle: Non unique identifier: "+x);return}var n="";if(k.lastIndexOf(".")!==-1){n=k.substr(0,k.lastIndexOf("."));k=k.substr(k.lastIndexOf(".")+1);p=p.substr(p.lastIndexOf(".")+1)}var F=(n==="")?D:D[n];if(!(F instanceof Array)){var E=[];for(var A in F[k]){var y={};y[k]=F[k][A];y[p]=F[p][A];E.push(y)}F=E}h=c(F,D,this.opts.xlimits,k);l=c(F,D,this.opts.ylimits,p);v=[0,F.length,0];if(r){F.sort(d.util.compare(k));var s=d3.bisector(function(i){return i[k]}).left;var t=this.opts.annoTypes.length;for(var A in r){if(r[A].length-2!==t){continue}var q=r[A][0];if(!(q in this.raw.annoGroups)){this.raw.annoGroups[q]=0}var o=r[A][1];var B=s(F,o);if(B!==-1&&o===F[B][k]){var u=F[B];if(!u.annos){u.annos={}}var m=u.annos;if(!(q in m)){m[q]={}}var C=m[q];for(var z=0;z<t;z++){var w=this.opts.annoTypes[z];var G=r[A][z+2];if(w===d.annotation.ANNOTATION){C.annotation=G}else{if(w===d.annotation.TOOLTIP){if(!C.tooltip){C.tooltip={}}C.tooltip[this.opts.annoTexts[z]]=G}else{if(w===d.annotation.TOOLTIP_MOL){if(G!==""){if(!C.tooltipmol){C.tooltipmol={}}C.tooltipmol[this.opts.annoTexts[z]]=G}}}}}}}}if(h[0]<this.raw.gxlim[0]){this.raw.gxlim[0]=h[0]}if(l[0]<this.raw.gylim[0]){this.raw.gylim[0]=l[0]}if(h[1]>this.raw.gxlim[1]){this.raw.gxlim[1]=h[1]}if(l[1]>this.raw.gylim[1]){this.raw.gylim[1]=l[1]}this.raw.ids[x]=true;this.raw.series.push({id:x,title:H,xlim:h,ylim:l,accs:[k,p],size:v,data:F,x:function(j){return this.data[j][this.accs[0]]},y:function(j){return this.data[j][this.accs[1]]}})};return g};d.data.array=function(){var g=f();g.get=function(l,k){var m=[];var n=[k.invert(0),k.invert(l)];n=d.util.domain(k,n);for(var r in this.raw.series){var s=this.raw.series[r];var h=s.data.length;var t=(s.xlim[1]-s.xlim[0])/h;var q=s.size;var u=[];while(s.size[0]>0){var v=s.size[0]*t+s.xlim[0];if(v<n[0]){break}s.size[0]-=1}while(s.size[1]<h){var v=s.size[1]*t+s.xlim[0];if(v>n[1]){break}s.size[1]+=1}for(var p=s.size[0];p<s.size[1];p++){var v=p*t+s.xlim[0];if(v<n[0]){q[0]=p;continue}else{if(v>n[1]){q[1]=p;break}}var w=s.data[p];var o={x:v};o[s.accs[1]]=w;u.push(o)}s.size=q;m.push(u)}return m};g.bin=function(F,J,A){var u=[];var q=[J.invert(0),J.invert(F)];q=d.util.domain(J,q);var l=1;var n=0;for(var K in this.raw.series){var N=this.raw.series[K].size;N[2]=Math.ceil(F/l);if(n<N[2]){n=N[2]}}var t=Math.abs(q[1]-q[0])/(n-1);for(var K in this.raw.series){var z=this.raw.series[K];var h=z.data.length;var M=(z.xlim[1]-z.xlim[0])/h;var N=z.size;var p=[];var m=0;while(z.size[0]>0){var y=z.size[0]*M+z.xlim[0];if(y<q[0]){break}z.size[0]-=1}while(z.size[1]<h){var y=z.size[1]*M+z.xlim[0];if(y>q[1]){break}z.size[1]+=1}for(var I=z.size[0];I<z.size[1];I++){var y=I*M+z.xlim[0];if(y<q[0]){N[0]=I;continue}else{if(y>q[1]){N[1]=I;break}}var D=Math.floor((y-q[0])/t);var v=p[D-m];var H=z.data[I];if(v){if(A){if(v[z.accs[1]]<H){p[D-m]=v}else{var E={x:y};E[z.accs[1]]=H;var w=p[D-m];if(w.annos){E.annos=p[D-m].annos}p[D-m]=E}}else{if(Math.abs(v[z.accs[1]])>Math.abs(H)){p[D-m]=v}else{var E={x:y};E[z.accs[1]]=H;var w=p[D-m];if(w.annos){E.annos=w.annos}p[D-m]=E}}}else{m=D-p.length;p[D-m]={x:y};p[D-m][z.accs[1]]=H}if(z.annos&&Object.keys(z.annos).length){if(I in z.annos&&!p[D-m].annos){var B=p[D-m];var s=z.annos[I];var r=s[0];if(!(r in this.raw.annoGroups)){this.raw.annoGroups[r]=0}if(!B.annos){B.annos={}}var o=B.annos;if(!(r in o)){o[r]={}}var L=o[r];for(var G=0;G<s.length;G++){var C=this.opts.annoTypes[G];var O=s[G+2];if(C===d.annotation.ANNOTATION){L.annotation=O}else{if(C===d.annotation.TOOLTIP){if(!L.tooltip){L.tooltip={}}L.tooltip[this.opts.annoTexts[G]]=O}else{if(C===d.annotation.TOOLTIP_MOL){if(O!==""){if(!L.tooltipmol){L.tooltipmol={}}L.tooltipmol[this.opts.annoTexts[G]]=O}}}}}p[D-m]=B}}}if(m>0){N[2]=p.length}z.size=N;u.push(p)}return u};g.seriesfetch=function(u,p){var j=d.util.hashcode((new Date().getTime()*Math.random())+"");j="st"+j;var s=u[this.opts.title];var t=[];var q=[];var v=[];var h="x";var r=this.opts.y;if(!s||s.length===0){s=j}if(j in this.raw.ids){console.log("SpeckTackle: Non unique identifier: "+j);return}var o=(r==="")?u:u[r];t=c(o,u,this.opts.xlimits,h);q=c(o,u,this.opts.ylimits);v=[0,o.length,0];var l={};if(p){var k=this.opts.annoTypes.length;for(var n in p){if(p[n].length-2!==k){continue}var m=p[n][1];if(m<v[1]){l[m]=p[n]}}}if(t[0]<this.raw.gxlim[0]){this.raw.gxlim[0]=t[0]}if(q[0]<this.raw.gylim[0]){this.raw.gylim[0]=q[0]}if(t[1]>this.raw.gxlim[1]){this.raw.gxlim[1]=t[1]}if(q[1]>this.raw.gylim[1]){this.raw.gylim[1]=q[1]}this.raw.ids[j]=true;this.raw.series.push({id:j,title:s,xlim:t,ylim:q,accs:[h,r],size:v,annos:l,data:o,x:function(w){return w},y:function(w){return this.data[w][this.accs[1]]}})};return g};d.chart={};function e(){return{opts:{title:"",xlabel:"",ylabel:"",xreverse:false,yreverse:false,legend:false,labels:false,margins:[80,80,80,100]},data:null,timeout:null,colors:d.util.colors(),mol2svg:d.util.mol2svg(250,250),title:function(g){if(g&&typeof g==="string"){this.opts.title=g}else{console.log("Invalid title option.")}return this},xlabel:function(g){if(g&&typeof g==="string"){this.opts.xlabel=g}else{console.log("Invalid x-axis label option.")}return this},ylabel:function(g){if(g&&typeof g==="string"){this.opts.ylabel=g}else{console.log("Invalid y-axis label option.")}return this},xreverse:function(g){if(g&&typeof g==="boolean"){this.opts.xreverse=g}else{console.log("Invalid x-axis reverse option.")}return this},yreverse:function(g){if(g&&typeof g==="boolean"){this.opts.yreverse=g}else{console.log("Invalid y-axis reverse option.")}return this},legend:function(g){if(g&&typeof g==="boolean"){this.opts.legend=g}else{console.log("Invalid legend option.")}return this},labels:function(g){if(g&&typeof g==="boolean"){this.opts.labels=g}else{console.log("Invalid labels option.")}return this},margins:function(g){if(g&&g instanceof Array&&g.length===4){this.opts.margins=g}else{console.log("Invalid margins array.")}return this},render:function(g){this.target=g;var j=this.opts.margins;this.width=$(g).width()-j[1]-j[3];this.height=$(g).height()-j[0]-j[2];if(this.width<=0){console.log("Invalid chart width: "+this.width);return}else{if(this.height<=0){console.log("Invalid chart height: "+this.height);return}}var h=this;this.panel=d3.select(g).append("svg:svg").attr("class","st-base").attr("width",this.width+j[1]+j[3]).attr("height",this.height+j[0]+j[2]).on("mousedown.zoom",function(){h.mouseDown(this)}).on("mousemove.zoom",function(){h.mouseMove(this)}).on("mouseup.zoom",function(){h.mouseUp()}).on("mouseout",function(){h.mouseOut(this)}).on("dblclick.zoom",function(){h.mouseDbl(this)});this.canvas=this.panel.append("svg:g").attr("transform","translate("+j[3]+","+j[0]+")");this.canvas.append("svg:clipPath").attr("id","clip-"+this.target).append("svg:rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height);this.selection=this.canvas.append("svg:rect").attr("class","st-selection").attr("clip-path","url(#clip-"+this.target+")").attr("x",0).attr("y",0).attr("width",0).attr("height",0).style("pointer-events","none").attr("display","none");this.scales={};if(this.opts.xreverse){this.scales.x=d3.scale.linear().domain([1,0]).range([0,this.width])}else{this.scales.x=d3.scale.linear().domain([0,1]).range([0,this.width])}if(this.opts.yreverse){this.scales.y=d3.scale.linear().domain([1,0]).range([this.height,0])}else{this.scales.y=d3.scale.linear().domain([0,1]).range([this.height,0])}if(!$("#st-tooltips").length){this.tooltips=d3.select("body").append("div").attr("width",$(g).width()).attr("height",$(g).height()).style("pointer-events","none").attr("id","st-tooltips").style("position","absolute").style("opacity",0);this.tooltips.append("div").attr("id","tooltips-meta").style("height","50%").style("width","100%");this.tooltips.append("div").attr("id","tooltips-mol").style("height","50%").style("width","100%")}else{this.tooltips=d3.select("#st-tooltips")}if(typeof this.behavior=="function"){this.behavior()}this.renderAxes();if(this.opts.title&&this.opts.title.length!==0){if(j[0]<20){console.log("Not enough space for chart title: increase top margin (min 20)")}else{this.panel.append("text").attr("class","st-title").attr("x",j[3]+(this.width/2)).attr("y",j[0]*0.75).attr("text-anchor","middle").attr("font-size","large").text(this.opts.title)}}if(this.opts.labels){if(j[1]<60){console.log("Not enough space for label option: increase right margin (min 60)");return}var k=this.canvas.append("g").attr("id","st-options");k.append("text").attr("x",this.width).attr("y",this.height-(this.height/4)).text("Options");var i=k.append("g");i.append("svg:circle").attr("cx",this.width+5).attr("cy",this.height-(this.height/5)).attr("r",2).style("fill","#333333").style("stroke","#333333");i.append("text").attr("x",this.width+12).attr("y",this.height-(this.height/5)+2).text("Labels").attr("id","st-label").style("cursor","pointer");i.on("mousedown",function(){var l=d3.select(this);if(l.style("stroke")==="none"){l.style("stroke","#333333")}else{l.style("stroke","none")}b(h)})}},renderAxes:function(){var i=this.opts.margins;var g=d3.format(".4g");var h=d3.format(",.2g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(true).tickFormat(g).orient("bottom");this.yaxis=d3.svg.axis().scale(this.scales.y).ticks(4).tickFormat(h).orient("left");this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis);this.canvas.append("svg:g").attr("class","st-yaxis").attr("transform","translate(-25, 0)").call(this.yaxis);if(this.opts.xlabel!==""){this.panel.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",i[2]/2)}if(this.opts.ylabel!==""){this.panel.select(".st-yaxis").append("text").text(this.opts.ylabel).attr("transform","rotate (-90)").attr("text-anchor","middle").attr("x",0-this.height/2).attr("y",0-i[3]/2)}},renderlabels:function(N){if(!this.opts.labels){return}var r=this.panel.select("#st-label");if(r.style("stroke")==="none"||!this.data){this.canvas.selectAll(".st-labels").remove();return}var o=[this.scales.x.invert(0),this.scales.x.invert(this.width)];o=d.util.domain(this.scales.x,o);var L=50;var z=Math.ceil(this.width/L);var p=Math.abs(o[1]-o[0])/(z-1);var D=[];var I=d3.format(".2f");var E;var w;if(this.data.raw.minima){w=10;E=function(i,g){return i>g}}else{w=-5;E=function(i,g){return i<g}}var C=0;var B=0;for(var H=0;H<N.length;H++){var u=N[H];var v=this.data.accs(H);var k=u[0];C=C+u.length;for(var G=1;G<u.length;G++){var m=u[G];var t=k[v[0]];var s=k[v[1]];var B=B+s;if(E(m[v[1]],s)){var A=Math.floor((t-o[0])/p);var q=D[A];if(q){if(E(q[v[1]],s)){D[A]=k}}else{D[A]=k}}k=m}}B=B/C;this.canvas.selectAll(".st-labels").remove();var K=this.canvas.append("g").attr("class","st-toto").attr("text-anchor","middle");var J=this.canvas.append("g").attr("class","st-labels").attr("text-anchor","middle");var O=0;var l=0;for(var H in D){if(D[H]&&E(B,D[H][v[1]])){var t=D[H][v[0]];var M=this.scales.x(t);var h=this.scales.y(D[H][v[1]]);if(Math.abs(M-O)<20&&Math.abs(h-l)<20){O=M;l=h;continue}O=M;l=h;var F="#333333";if(h<0){h=0;F="gray"}J.append("text").attr("x",M).attr("y",h+w).style("fill",F).text(I(t))}}},rendergroups:function(){if(Object.keys(this.data.raw.annoGroups).length===0){return}var g=this;var j=this.canvas.select("#st-options");var i=0;if(j[0][0]===null){j=this.canvas.append("g").attr("id","st-options");j.append("text").attr("x",this.width).attr("y",this.height-(this.height/4)).text("Options")}else{i=15}var h=j.append("g");h.append("svg:circle").attr("cx",this.width+5).attr("cy",this.height-(this.height/5)+i).attr("r",2).style("fill","#333333").style("stroke","#333333");h.append("text").attr("x",this.width+12).attr("y",this.height-(this.height/5)+2+i).text("Groups").attr("id","st-groups").style("cursor","pointer");h.on("mouseup",function(){var l=d3.select(this);if(l.style("stroke")==="none"){l.style("stroke","#333333");var k=d3.select(g.target).append("div").attr("id","st-popup").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY+5+"px").style("opacity",0.9).style("background-color","white");var n=[];for(var m in g.data.raw.annoGroups){n.push(m)}k.append("ul").selectAll("li").data(n).enter().append("li").style("display","block").style("cursor","pointer").html(function(o){if(g.data.raw.annoGroups[o]){return"<strong>"+o+"</strong>"}return o}).on("mousedown",function(o){for(m in g.data.raw.annoGroups){if(m==o&&!g.data.raw.annoGroups[o]){g.data.raw.annoGroups[o]=1}else{g.data.raw.annoGroups[m]=0}}g.mouseDbl();l.style("stroke","none");$("#st-popup").remove()})}else{l.style("stroke","none");$("#st-popup").remove()}})},mouseDown:function(g){var j=d3.mouse(g);var i=this.opts.margins[3];var h=this.opts.margins[0];this.panel.select(".st-selection").attr("x",j[0]-i).attr("xs",j[0]-i).attr("y",j[1]-h).attr("ys",j[1]-h).attr("width",1).attr("height",1).attr("display","inline")},mouseMove:function(h){var p=this.panel.select(".st-selection");if(p.attr("display")==="inline"){var g=d3.mouse(h)[0]-this.opts.margins[3],o=d3.mouse(h)[1]-this.opts.margins[0],i=parseInt(p.attr("width"),10),k=parseInt(p.attr("height"),10),n=g-parseInt(p.attr("x"),10),m=o-parseInt(p.attr("y"),10),j=parseInt(p.attr("xs"),10),l=parseInt(p.attr("ys"),10);if((n<0&&m<0)||(n*2<i&&m*2<k)){p.attr("x",g);p.attr("width",j-g);p.attr("y",o);p.attr("height",l-o)}else{if(n<0||(n*2<i)){p.attr("x",g);p.attr("width",j-g);p.attr("height",m)}else{if(m<0||(m*2<k)){p.attr("y",o);p.attr("height",l-o);p.attr("width",n)}else{p.attr("width",n);p.attr("height",m)}}}}},mouseUp:function(){var i=5;var k=this.panel.select(".st-selection");if(parseInt(k.attr("width"))>i&&parseInt(k.attr("height"))>i){var h=parseFloat(k.attr("x"));var m=parseFloat(k.attr("y"));var j=parseFloat(k.attr("width"));var g=parseFloat(k.attr("height"));j=this.scales.x.invert(h+j);g=this.scales.y.invert(m+g);h=this.scales.x.invert(h);m=this.scales.y.invert(m);if(this.data){var l=this.data.raw.gylim[0];if(g<l){g=l}}this.scales.x.domain([h,j]).nice();this.scales.y.domain([g,m]).nice();k.attr("display","none");this.canvas.select(".st-xaxis").call(this.xaxis);this.canvas.select(".st-yaxis").call(this.yaxis);b(this)}else{k.attr("display","none")}},mouseOut:function(i){var g=this.panel.select(".st-selection");var j=d3.mouse(i)[0],h=d3.mouse(i)[1];if(j<0||h<0||j>$(this.target).width()||h>$(this.target).height()){g.attr("display","none")}},mouseDbl:function(k){if(k){var l=d3.mouse(k)[0]-this.opts.margins[3],j=d3.mouse(k)[1]-this.opts.margins[0];if(l<0||l>this.width||j<0||j>this.height){return}}if(this.data===null){var h=d.util.domain(this.scales.x,[0,1]);var m=d.util.domain(this.scales.y,[0,1]);this.scales.x.domain(h).nice();this.scales.y.domain(m).nice();this.canvas.select(".st-xaxis").call(this.xaxis);this.canvas.select(".st-yaxis").call(this.yaxis);return}var i=d.util.domain(this.scales.x,this.data.raw.gxlim);var g=d.util.domain(this.scales.y,this.data.raw.gylim);this.scales.x.domain(i).nice();this.scales.y.domain(g).nice();this.canvas.select(".st-xaxis").call(this.xaxis);this.canvas.select(".st-yaxis").call(this.yaxis);this.data.reset();b(this)},mouseOverAction:function(g,h,l,q){this.tooltips.style("display","inline");this.tooltips.transition().duration(300).style("opacity",0.9);var n=d3.format(".2f");this.tooltips.style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-10+"px").style("opacity",0.9).style("border","dashed").style("border-width","1px").style("padding","3px").style("border-radius","10px").style("z-index","10").style("background-color","white");var m=n(h[l[0]]);var k=n(h[l[1]]);d3.selectAll("#tooltips-meta").html(this.opts.xlabel+": "+m+"<br/>"+this.opts.ylabel+": "+k+"<br/>");var i=this;if(q&&q!==""&&h.annos){if(!(q in h.annos)){return}var j=h.annos[q];var r=d3.selectAll("#tooltips-meta").html();for(var p in j.tooltip){r+=p+": "+j.tooltip[p]+"<br/>"}d3.selectAll("#tooltips-meta").html(r+"<br/>");if(!j.tooltipmol){return}var o=d.util.spinner("#tooltips-meta");this.timeout=setTimeout(function(){var t=[];d3.selectAll("#tooltips-mol").style("display","none");for(var u in j.tooltipmol){var s="#tooltips-mol-"+u;d3.selectAll("#tooltips-mol").append("div").attr("id","tooltips-mol-"+u).style("float","left").style("height","100%").style("width","50%");d3.selectAll(s).html("<em>"+u+"</em><br/>");var v=i.mol2svg.draw(j.tooltipmol[u],s);t.push(v)}$.when.apply($,t).done(function(){o.css("display","none");d3.selectAll("#tooltips-mol").style("display","inline")}).fail(function(){o.css("display","none")})},500)}else{d3.selectAll("#tooltips-mol").html("")}},mouseOutAction:function(){clearTimeout(this.timeout);d3.selectAll("#tooltips-mol").html("");this.tooltips.transition().duration(300).style("opacity",0);this.tooltips.style("display","none")},renderLegend:function(){d3.select(this.target).select(".st-legend").remove();var o=d3.select(this.target).append("div").attr("class","st-legend").style("top",-(this.height+this.opts.margins[2])+"px").style("left",this.width+this.opts.margins[3]+"px").style("width",this.opts.margins[1]+40+"px").style("height",(this.height/2)-30+"px").style("position","relative");o=o.append("div").style("position","absolute").style("overflow","scroll").style("top",0+"px").style("left",0+"px").style("width",this.opts.margins[1]+70+"px").style("bottom",-30+"px");var g=this.colors;var m=this;var j=this.data.raw.series.length;var p=o.append("svg:svg").attr("height",j*20+"px");for(var l=0;l<j;l++){var h=this.data.raw.series[l].id;var n=this.data.raw.series[l].title;var k=p.append("g").attr("stid",h).style("cursor","pointer");k.append("svg:rect").attr("x",5).attr("y",function(){return l*20}).attr("width",10).attr("height",10).style("fill",function(){return g.get(h)});k.append("text").attr("x",20).attr("y",function(){return l*20+9}).text(function(){return n});k.on("mouseover",function(){d3.select(this).style("fill","red");var q=d3.select(this).attr("stid");m.canvas.selectAll("."+q).style("stroke-width",2);for(var i in m.data.raw.ids){if(i!==q){m.canvas.selectAll("."+i).style("opacity",0.1)}}});k.on("mouseout",function(){d3.select(this).style("fill","black");var q=d3.select(this).attr("stid");m.canvas.selectAll("."+q).style("stroke-width",1);for(var i in m.data.raw.ids){if(i!==q){m.canvas.selectAll("."+i).style("opacity",1)}}})}},load:function(j){if(!j){console.log("Missing data object.");return}else{if(typeof j.push!=="function"||typeof j.add!=="function"||typeof j.remove!=="function"){console.log("Invalid data object.");return}}var i=this;this.data=j;var h=j.add;j.add=function(){try{h.apply(this,arguments);i.data.push(function(){i.xscale();i.yscale();i.canvas.select(".st-xaxis").call(i.xaxis);i.canvas.select(".st-yaxis").call(i.yaxis);b(i);i.rendergroups();if(i.opts.legend){i.renderLegend()}})}catch(k){console.log("Data load failed: "+k)}};var g=j.remove;j.remove=function(){var l=g.apply(this,arguments);for(var k in l){i.colors.remove(l[k]);i.canvas.selectAll("."+l[k]).remove()}if(i.opts.legend){i.renderLegend()}}}}}function b(g){if(typeof g.renderdata=="function"&&typeof g.renderlabels=="function"&&g.data!==null){try{var i=g.renderdata();g.renderlabels(i)}catch(h){g.data.remove();console.log("Error rendering the data: "+h)}}}d.chart.series=function(){var g=e();g.xscale=function(){var h=this.data.raw.gxlim;if(this.opts.xreverse){h=[h[1],h[0]]}this.scales.x.domain(h).nice()};g.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()};g.behavior=function(){this.xpointer=this.panel.append("text").attr("x",this.opts.margins[3]).attr("y",this.opts.margins[0]).attr("font-size","x-small").text("");var i=this;var h=d3.format(".4g");this.plotted=[];this.panel.on("mousemove",function(){var t=d3.mouse(this)[0]-i.opts.margins[3];var q=i.scales.x.invert(t);var k=i.scales.x.domain();if(i.opts.xreverse){var n=function(){return q<k[0]&&q>=k[1]}}else{var n=function(){return q>=k[0]&&q<k[1]}}if(n()){i.xpointer.text("x = "+h(q));for(var o=0;o<i.plotted.length;o++){var s=i.data.accs(o);var r=d3.bisector(function(j){return j[s[0]]}).left;var m=r(i.plotted[o],q);if(m>i.plotted[o].length-1){m=i.plotted[o].length-1}var l=i.plotted[o][m];if(l){var p=i.scales.y(l[s[1]]);if(p<0){p=0}else{if(p>i.height){p=i.height}}i.canvas.select("."+i.data.id(o)+"focus").attr("display","inline").attr("transform","translate("+i.scales.x(l[s[0]])+","+p+")")}}}else{i.xpointer.text("");for(var o=0;o<i.plotted.length;o++){i.canvas.select("."+i.data.id(o)+"focus").attr("display","none")}}})};g.renderdata=function(){var k=this.data.bin(this.width,this.scales.x);this.plotted=k;var o=this;for(var l=0;l<k.length;l++){var m=k[l];var h=this.data.id(l);var p=this.data.accs(l);var j=this.colors.get(h);var q=d3.svg.line().interpolate("cardinal-open").x(function(i){return o.scales.x(i[p[0]])}).y(function(i){return o.scales.y(i[p[1]])});this.canvas.selectAll("."+h).remove();var n=this.canvas.append("g").attr("class",h);n.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",j).style("fill","none").style("stroke-width",1).attr("d",q(m));n.append("svg:circle").attr("class",h+"focus").style("stroke",j).style("fill","none").attr("r",3).attr("cx",0).attr("cy",0).attr("display","none");n.selectAll("."+h+".circle").data(m).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",j).style("stroke",j).attr("opacity",0).attr("r",3).attr("cx",function(i){return o.scales.x(i[p[0]])}).attr("cy",function(i){return o.scales.y(i[p[1]])}).on("mouseover",function(i){d3.select(this).attr("opacity",0.8);o.mouseOverAction(this,i,p)}).on("mouseout",function(){d3.select(this).attr("opacity","0");o.mouseOutAction()})}return k};return g};d.chart.ms=function(){var g=e();g.xscale=function(){this.scales.x.domain(this.data.raw.gxlim).nice()};g.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()};g.behavior=function(){};g.renderdata=function(){var k=this.data.bin(this.width,this.scales.x);var q="";for(var r in this.data.raw.annoGroups){if(this.data.raw.annoGroups[r]){q=r;break}}var o=this;for(var l=0;l<k.length;l++){var m=k[l];var h=this.data.id(l);var p=this.data.accs(l);var j=o.colors.get(h);this.canvas.selectAll("."+h).remove();var n=this.canvas.append("g").attr("class",h);n.selectAll("."+h+".line").data(m).enter().append("svg:line").attr("clip-path","url(#clip-"+this.target+")").attr("x1",function(i){return o.scales.x(i[p[0]])}).attr("y1",function(i){return o.scales.y(i[p[1]])}).attr("x2",function(i){return o.scales.x(i[p[0]])}).attr("y2",o.scales.y(0)).style("stroke",j).each(function(i){if(i.annos){if(!(q in i.annos)){return}n.append("text").attr("class",h+".anno").attr("x",o.scales.x(i[p[0]])).attr("y",o.scales.y(i[p[1]])-5).attr("text-anchor","middle").attr("font-size","small").attr("fill",j).text(i.annos[q].annotation)}}).on("mouseover",function(i){d3.select(this).attr("stroke-width",2);o.mouseOverAction(this,i,p,q)}).on("mouseout",function(){d3.select(this).attr("stroke-width",null);o.mouseOutAction()})}this.canvas.selectAll(".zeroline").remove();if(this.data.raw.gylim[0]<0){this.canvas.append("svg:line").attr("class","zeroline").attr("clip-path","url(#clip-"+this.target+")").attr("x1",this.scales.x(this.data.raw.gxlim[0])).attr("y1",this.scales.y(0)).attr("x2",this.scales.x(this.data.raw.gxlim[1])).attr("y2",this.scales.y(0)).style("stroke","#333333")}return k};return g};d.chart.ir=function(){var g=e();g.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()};g.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()};g.behavior=function(){this.scales.x.domain([1,0]);this.xpointer=this.panel.append("text").attr("x",this.opts.margins[3]).attr("y",this.opts.margins[0]).attr("font-size","x-small").text("");var i=this;var h=d3.format(".4g");this.plotted=[];this.panel.on("mousemove",function(){var r=d3.mouse(this)[0]-i.opts.margins[3];var o=i.scales.x.invert(r);var s=i.scales.x.domain();if(o<s[0]&&o>=s[1]){i.xpointer.text("x = "+h(o));for(var m=0;m<i.plotted.length;m++){var q=i.data.accs(m);var p=d3.bisector(function(j){return j[q[0]]}).left;var l=p(i.plotted[m],o);if(l>i.plotted[m].length-1){l=i.plotted[m].length-1}var k=i.plotted[m][l];if(k){var n=i.scales.y(k[q[1]]);if(n<0){n=0}else{if(n>i.height){n=i.height}}i.canvas.select("."+i.data.id(m)+"focus").attr("display","inline").attr("transform","translate("+i.scales.x(k[q[0]])+","+n+")")}}}else{i.xpointer.text("");for(var m=0;m<i.plotted.length;m++){i.canvas.select("."+i.data.id(m)+"focus").attr("display","none")}}})};g.renderdata=function(){var k=this.data.bin(this.width,this.scales.x,true);var q="";for(var r in this.data.raw.annoGroups){if(this.data.raw.annoGroups[r]){q=r;break}}this.data.raw.minima=1;this.plotted=k;var o=this;for(var l=0;l<k.length;l++){var m=k[l];var h=this.data.id(l);var p=this.data.accs(l);var j=this.colors.get(h);var s=d3.svg.line().interpolate("cardinal-open").x(function(i){return o.scales.x(i[p[0]])}).y(function(i){return o.scales.y(i[p[1]])});this.canvas.selectAll("."+h).remove();var n=this.canvas.append("g").attr("class",h);n.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",j).style("fill","none").attr("d",s(m));n.append("svg:circle").attr("class",h+"focus").style("stroke",j).style("fill","none").attr("r",3).attr("cx",0).attr("cy",0).attr("display","none");n.selectAll("."+h+".circle").data(m).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",j).style("stroke",j).attr("opacity",0).attr("r",3).attr("cx",function(i){return o.scales.x(i[p[0]])}).attr("cy",function(i){return o.scales.y(i[p[1]])}).each(function(i){if(i.annos){if(!(q in i.annos)){return}n.append("text").attr("class",h+".anno").attr("x",o.scales.x(i[p[0]])).attr("y",o.scales.y(i[p[1]])+20).attr("text-anchor","middle").attr("font-size","small").attr("fill",j).text(i.annos[q].annotation)}}).on("mouseover",function(i){d3.select(this).attr("opacity",0.8);o.mouseOverAction(this,i,p,q)}).on("mouseout",function(){d3.select(this).attr("opacity","0");o.mouseOutAction()})}return k};return g};d.chart.nmr=function(){var g=e();g.render=function(h){this.target=h;var k=this.opts.margins;this.width=$(h).width()-k[1]-k[3];this.height=$(h).height()-k[0]-k[2];if(this.width<=0){console.log("Invalid chart width: "+this.width);return}else{if(this.height<=0){console.log("Invalid chart height: "+this.height);return}}var i=this;this.scales={x:d3.scale.linear().domain([1,0]).range([0,this.width]),y:d3.scale.linear().range([this.height,0])};this.panel=d3.select(h).append("svg:svg").attr("class","st-base").attr("width",this.width+k[1]+k[3]).attr("height",this.height+k[0]+k[2]);a(i);this.canvas=this.panel.append("svg:g").attr("transform","translate("+k[3]+","+k[0]+")");this.canvas.append("svg:clipPath").attr("id","clip-"+this.target).append("svg:rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height);this.selection=this.canvas.append("svg:rect").attr("class","st-selection").attr("clip-path","url(#clip-"+this.target+")").attr("x",0).attr("y",0).attr("width",0).attr("height",0).style("pointer-events","none").attr("display","none");this.renderAxes();if(this.opts.title&&this.opts.title.length!==0){if(k[0]<20){console.log("Not enough space for chart title: increase top margin (min 20)")}else{this.panel.append("text").attr("class","st-title").attr("x",k[3]+(this.width/2)).attr("y",k[0]*0.75).attr("text-anchor","middle").attr("font-size","large").text(this.opts.title)}}if(this.opts.labels){if(k[1]<60){console.log("Not enough space for label option: increase right margin (min 60)");return}var l=this.canvas.append("g").attr("id","st-options");l.append("text").attr("x",this.width).attr("y",this.height-(this.height/4)).text("Options");var j=l.append("g");j.append("svg:circle").attr("cx",this.width+5).attr("cy",this.height-(this.height/5)).attr("r",2).style("fill","#333333").style("stroke","#333333");j.append("text").attr("x",this.width+12).attr("y",this.height-(this.height/5)+2).text("Labels").attr("id","st-label").style("cursor","pointer");j.on("mousedown",function(){var m=d3.select(this);if(m.style("stroke")==="none"){m.style("stroke","#333333")}else{m.style("stroke","none")}b(i)})}return this};g.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()};g.yscale=function(){this.scales.y.domain(this.data.raw.gylim)};g.renderAxes=function(){var i=this.opts.margins;var h=d3.format(".4g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(true).tickFormat(h).orient("bottom");this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis);if(this.opts.xlabel!==""){this.panel.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",i[2]/2)}};g.mouseDown=function(h){var j=d3.mouse(h);var i=this.opts.margins[3];this.panel.select(".st-selection").attr("x",j[0]-i).attr("xs",j[0]-i).attr("width",1).attr("height",this.height).attr("display","inline")};g.mouseMove=function(l){var k=this.panel.select(".st-selection");if(k.attr("display")==="inline"){var m=d3.mouse(l)[0]-this.opts.margins[3],h=parseInt(k.attr("width"),10),j=m-parseInt(k.attr("x"),10),i=parseInt(k.attr("xs"),10);if(j<1&&(j*2)<h){k.attr("x",m);k.attr("width",i-m)}else{k.attr("width",j)}}};g.mouseUp=function(){var i=5;var k=this.panel.select(".st-selection");if(parseInt(k.attr("width"))>i){var h=parseFloat(k.attr("x"));var j=parseFloat(k.attr("width"));j=this.scales.x.invert(h+j);h=this.scales.x.invert(h);this.scales.x.domain([h,j]).nice();k.attr("display","none");this.canvas.select(".st-xaxis").call(this.xaxis);b(this)}else{k.attr("display","none")}};g.mouseDbl=function(i){if(i){var j=d3.mouse(i)[0]-this.opts.margins[3],h=d3.mouse(i)[1]-this.opts.margins[0];if(j<0||j>this.width||h<0||h>this.height){return}}if(this.data===null){this.scales.x.domain([1,0]).nice();this.scales.y.domain([0,1]).nice();this.canvas.select(".st-xaxis").call(this.xaxis);return}this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice();this.scales.y.domain(this.data.raw.gylim);this.canvas.select(".st-xaxis").call(this.xaxis);b(this)};g.load=function(k){if(!k){console.log("Missing data object.");return}else{if(typeof k.push!=="function"||typeof k.add!=="function"||typeof k.remove!=="function"){console.log("Invalid data object.");return}}var j=this;this.data=k;var i=k.add;k.add=function(){i.apply(this,arguments);j.data.push(function(){j.xscale();j.yscale();a(j);j.canvas.select(".st-xaxis").call(j.xaxis);b(j);j.rendergroups();if(j.opts.legend){j.renderLegend()}})};var h=k.remove;k.remove=function(){var m=h.apply(this,arguments);for(var l in m){j.colors.remove(m[l]);j.canvas.selectAll("."+m[l]).remove()}if(j.opts.legend){j.renderLegend()}}};g.renderdata=function(){var k=this.data.bin(this.width,this.scales.x);var q="";for(var r in this.data.raw.annoGroups){if(this.data.raw.annoGroups[r]){q=r;break}}var o=this;for(var l=0;l<k.length;l++){var m=k[l];var h=this.data.id(l);var p=this.data.accs(l);var t=d3.svg.line().x(function(i){return o.scales.x(i[p[0]])}).y(function(i){return o.scales.y(i[p[1]])});this.canvas.selectAll("."+h).remove();var n=this.canvas.append("g").attr("class",h);var j=n.append("g").attr("transform","translate("+this.width+", 0)");var s=j.selectAll(".gLine").append("path").attr("class","gLine").attr("stroke","red").attr("fill","transparent").attr("stroke-width","10px");n.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",this.colors.get(h)).style("fill","none").style("stroke-width",1).attr("d",t(m));n.data(m).each(function(i){if(i.annos){if(!(q in i.annos)){return}n.append("text").attr("class",h+".anno").attr("x",o.scales.x(i[p[0]])).attr("y",o.scales.y(i[p[1]])-5).attr("text-anchor","middle").attr("font-size","small").attr("fill",color).text(i.annos[q].annotation)}})}return k};return g};function a(h){var g=d3.behavior.zoom().y(h.scales.y).center([0,h.scales.y(0)]).on("zoom",function(){b(h)});h.panel.call(g).on("mousedown.zoom",function(){h.mouseDown(this)}).on("mousemove.zoom",function(){h.mouseMove(this)}).on("mouseup.zoom",function(){h.mouseUp()}).on("mouseout",function(){h.mouseOut(this)}).on("dblclick.zoom",function(){h.mouseDbl(this)})}d.chart.nmr2d=function(){var g=e();g.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()};g.yscale=function(){this.scales.y.domain([this.data.raw.gylim[1],this.data.raw.gylim[0]]).nice()};g.behavior=function(){this.scales.x.domain([1,0]);this.scales.y.domain([1,0]);var i=this.canvas.append("svg:rect").attr("class","st-selection").attr("y",0).attr("width",1).attr("height",this.height).style("pointer-events","none").attr("visibility","hidden");var h=this.canvas.append("svg:rect").attr("class","st-selection").attr("x",0).attr("width",this.width).attr("height",1).style("pointer-events","none").attr("visibility","hidden");var j=this;d3.select(".st-base").on("mousemove",function(){var l=d3.mouse(this)[0]-j.opts.margins[3];var k=d3.mouse(this)[1]-j.opts.margins[0];if(l<0||l>j.width||k<0||k>j.height){i.attr("visibility","hidden");h.attr("visibility","hidden")}else{i.attr("x",l);h.attr("y",k);i.attr("visibility","visible");h.attr("visibility","visible")}}).append("svg:rect").attr("class","st-mouse-capture").style("visibility","hidden").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height)};g.renderAxes=function(){var i=this.opts.margins;var h=d3.format(".3g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(true).tickFormat(h).tickSize(-this.height).tickPadding(5).orient("bottom");this.yaxis=d3.svg.axis().scale(this.scales.y).ticks(6).tickFormat(h).tickSize(-this.width).tickPadding(5).orient("right");this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis);this.canvas.append("svg:g").attr("class","st-yaxis").attr("transform","translate("+this.width+",0)").call(this.yaxis);if(this.opts.xlabel!==""){d3.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",i[2]/2)}if(this.opts.ylabel!==""){d3.select(".st-yaxis").append("text").text(this.opts.ylabel).attr("transform","rotate (-90)").attr("text-anchor","middle").attr("x",0-this.height/2).attr("y",i[1]/2)}};g.renderdata=function(){var n=this.data.get(this.width,this.scales.x);var l=this;for(var k=0;k<n.length;k++){var j=n[k];var o=this.data.id(k);var h=this.data.accs(k);this.canvas.selectAll("."+o).remove();var m=this.canvas.append("g").attr("class",o);m.selectAll("."+o+".circle").data(j).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",this.colors.get(o)).style("stroke",this.colors.get(o)).attr("r",3).attr("cx",function(i){return l.scales.x(i[h[0]])}).attr("cy",function(i){return l.scales.y(i[h[1]])}).on("mouseover",function(i){l.mouseOverAction(this,i,h)}).on("mouseout",function(){l.mouseOutAction()})}};return g};d.parser.raw=function(g,h,i){$.ajax({type:"POST",url:h,data:g,contentType:"application/json",success:function(j){console.log("Request successful");i(j)}})};d.parser.rawGet=function(h,i,g,j){$.ajax({type:"GET",url:g+"/"+h+"?mode"+i,success:function(k){console.log("Request successful");j(k)}})};if(typeof define==="function"&&define.amd){define(d)}else{if(typeof module==="object"&&module.exports){module.exports=d}else{this.st=d}}}();