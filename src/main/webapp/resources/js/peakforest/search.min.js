var reopenDetailsModal=false;var reopenDetailsSheet=false;var hideSpectraScoreZero=true;var filterCpd=0;var filterNMR=[];var filterLCMS=[];var filterLCMSMS=[];var isCountMaxResults=false;checkIfReOpenDetailsModal=function(){if(reopenDetailsModal){$("#modalShowCompound").modal("show");reopenDetailsModal=false}};$("body").on("hidden.bs.modal",".modal",function(){$(this).removeData("bs.modal")});$("#search").focus(function(){this.selectionStart=this.selectionEnd=this.value.length});var searchResultsHeight=0;var isCompoundEntityOpen=false;function openCompoundEntity(a,b){isCompoundEntityOpen=true;$.get("sheet-compound/"+a+"/"+b,function(c){$("#divEntityDetails").html(c);$("#compoundResultsTable").hide();$("#spectrumResultsTable").hide();$("#metadataResultsTable").hide();$("#searchForm").hide();$("#searchPagination").hide();$("#divCloseEntity").show();$("#divEntityDetails").show();console.log("entity: ready!");var d=190;$("#entityBody").height($(window).height()-d);$("#entityBody").css("overflow","auto");$("#search-results").css("overflow","hidden");searchResultsHeight=$("#search-results").height();$("#search-results").removeAttr("style")})}function closeCompoundEntity(){isCompoundEntityOpen=false;$("#divCloseEntity").hide();$("#divEntityDetails").html("");$("#divEntityDetails").hide();if($("#compoundResultsTable tr").size()>0){$("#compoundResultsTable").show()}if($("#spectrumResultsTable tr").size()>0){$("#spectrumResultsTable").show()}if($("#metadataResultsTable tr").size()>0){$("#metadataResultsTable").show()}$("#searchForm").show();$("#searchPagination").show();$("#search-results").css("overflow","auto");$("#search-results").height(searchResultsHeight)}var numberMaxResults=10;var compoundsData=new Array();var spectrumData=new Array();var metadataData=new Array();var isMainQueryAnsync=false;var divSearch="search";var inputSearch=$("input#search");if(($(inputSearch).length)&&($("#search").val()!="")){loadSearchResults()}var inputSearchNMR=$("input#searchNMR");if(($(inputSearchNMR).length)&&($("#searchNMR").val()!="")){divSearch="searchNMR";isMainQueryAnsync=true;loadSearchResults()}var inputSearchLCMS=$("input#searchLCMS");if(($(inputSearchLCMS).length)&&($("#searchLCMS").val()!="")){divSearch="searchLCMS";isMainQueryAnsync=true;loadSearchResults()}var inputSearchLCMSMS=$("input#searchLCMSMS");if(($(inputSearchLCMSMS).length)&&($("#searchLCMSMS").val()!="")){divSearch="searchLCMSMS";isMainQueryAnsync=true;loadSearchResults()}var totalElementFound=0;function loadSearchResults(){$(".loadSearchResults").show();$("#compoundResultsTable").hide();$("#spectrumResultsTable").hide();$("#metadataResultsTable").hide();$("#noSearchResults").hide();$("#noLCMSSearchResults").hide();$("#noNMRSearchResults").hide();var d=$.trim($("#"+divSearch).val());if(/^PF(c|s)\d{3,}$/.test(d)){document.location=d;return}var b="query="+d;b=getSearchRequestFormated(b,d);if($.isEmptyObject(compoundsData)&&$.isEmptyObject(spectrumData)&&$.isEmptyObject(metadataData)){var c=[];var a=[];$.ajax({type:"post",url:"search",dataType:"json",async:isMainQueryAnsync,data:b,success:function(n){if(n.success){var g=0;var f=0;var k=0;var e=[];if(n.hasOwnProperty("compoundNames")){$.each(n.compoundNames,function(){try{if(this.compound.id in e){throw false}var p=this.compound.formula;var r=p+"";try{$.each($.unique(p.match(/\d/g)),function(v,w){var u=new RegExp(w,"g");r=r.replace(u,"<sub>"+w+"</sub>")});r=r.replace("</sub><sub>","")}catch(s){}var q="?";if(this.compound.hasOwnProperty("parent")){q="chemical"}if(this.compound.hasOwnProperty("children")){q="generic"}var t=this.compound.containSpectra;var o={name:this.name,id:this.compound.id,formula:r,exactMass:roundNumber(this.compound.monoisotopicMass,7),molWeight:roundNumber(this.compound.averageMass,7),inchikey:this.compound.inChIKey,type:q,spectra:t,pfID:this.compound.pfID};e[this.compound.id]=o;c.push(o);g++}catch(s){console.log(s)}})}if(n.hasOwnProperty("compounds")){$.each(n.compounds,function(){var o=this.mainName;var q=this.formula;var s=q+"";try{$.each($.unique(q.match(/\d/g)),function(w,x){var v=new RegExp(x,"g");s=s.replace(v,"<sub>"+x+"</sub>")});s=s.replace("</sub><sub>","")}catch(t){}var r="?";if(this.hasOwnProperty("parent")){r="chemical"}if(this.hasOwnProperty("children")){r="generic"}var u=this.containSpectra;var p={name:o,id:this.id,formula:s,exactMass:roundNumber(this.monoisotopicMass,7),molWeight:roundNumber(this.averageMass,7),inchikey:this.inChIKey,type:r,spectra:u,pfID:this.pfID};c.push(p);g++})}if(n.hasOwnProperty("nmrCandidates")){var l={};$.each(n.nmrSpectra,function(){l[this.id]=this});$.each(n.nmrCandidates,function(){var v=this.key;v=Number(v.replace("pf:",""));var u=l[v];if(u!==undefined){var o="nmr-light";var w=u.peaks.length;if(w>10){o="nmr-avg"}if(w>20){o="nmr-big"}var p={};if(u.label=="reference"&&u.listOfCompounds.length==1){var q=u.listOfCompounds[0].inChIKey;var t=u.listOfCompounds[0].id;var s="?";if(u.listOfCompounds[0].type==101){s="chemical"}if(u.listOfCompounds[0].type==100){s="generic"}p={id:t,inchikey:q,type:s}}var r={id:u.id,name:u.massBankLikeName,score:this.score,type:"nmr",img:o,compound:p,sampleNMRTubeConditionsMetadata:u.sampleNMRTubeConditionsMetadata,pfID:u.pfID};a.push(r);f++}})}var h=false;var j=false;var m=false;if(n.hasOwnProperty("nmrSpectra")&&!n.hasOwnProperty("nmrCandidates")){$.each(n.nmrSpectra,function(){h=true;var s=this;if(s!==undefined){var u="nmr-light";var v=s.peaks.length;if(v>10){u="nmr-avg"}if(v>20){u="nmr-big"}var q={};if(s.label=="reference"&&s.listOfCompounds.length==1){var t=s.listOfCompounds[0].inChIKey;var o=s.listOfCompounds[0].id;var p="?";if(s.listOfCompounds[0].type==101){p="chemical"}if(s.listOfCompounds[0].type==100){p="generic"}q={id:o,inchikey:t,type:p}}var r={id:s.id,name:s.massBankLikeName,score:roundNumber(this.matchingScore,3),type:"nmr",img:u,compound:q,sampleNMRTubeConditionsMetadata:s.sampleNMRTubeConditionsMetadata,pfID:s.pfID};a.push(r);f++}})}if(n.hasOwnProperty("lcmsSpectra")||n.hasOwnProperty("lcmsmsSpectra")){var i=[];if(n.hasOwnProperty("lcmsSpectra")){i=i.concat(n.lcmsSpectra)}if(n.hasOwnProperty("lcmsmsSpectra")){i=i.concat(n.lcmsmsSpectra)}$.each(i,function(){j=true;var s=this;if(s!==undefined){var u="lcms-light";var v=s.peaks.length;if(v>10){u="lcms-avg"}if(v>20){u="lcms-big"}var q={};if(s.label=="reference"&&s.listOfCompounds.length==1){var t=s.listOfCompounds[0].inChIKey;var o=s.listOfCompounds[0].id;var p="?";if(s.listOfCompounds[0].type==101){p="chemical"}if(s.listOfCompounds[0].type==100){p="generic"}q={id:o,inchikey:t,type:p}}var r={id:s.id,name:s.massBankName,score:roundNumber(this.matchingScore,3),type:"lcms",img:u,compound:q,pfID:s.pfID};a.push(r);f++}})}if(h||j){a.sort(function(p,o){return o.score-p.score})}compoundsData=c;spectrumData=a;totalElementFound=g+f+k;filterSearchResults(0,totalElementFound)}else{subjects=[];filterSearchResults(0,0)}},error:function(e){subjects=[];console.log(e);filterSearchResults(0,0)}})}}function filterSearchResults(a,j){a=parseInt(a);j=parseInt(j);setTimeout(function(){var i=location.href;if(i.indexOf("#")>0){i=i.substr(0,i.indexOf("#"))}location.href=i+"#"+a+"-"+j},20);$(".loadSearchResults").show();$("#compoundResultsTable").hide();$("#spectrumResultsTable").hide();$("#spectrumNMRResultsTable").hide();$("#spectrumLCMSResultsTable").hide();$("#spectrumLCMSMSResultsTable").hide();$("#metadataResultsTable").hide();$("#noSearchResults").hide();var k=0;var f=0;var g=new Array();var l=new Array();var b=new Array();var d=false;var c=false;for(var e=0;e<filterNMR.length;e++){if(filterNMR[e]!=null){c=true}}var h=false;for(var e=0;e<filterLCMS.length;e++){if(filterLCMS[e]!=null){h=true}}$.each(spectrumData,function(u,t){if(f>=a){if(c){var p=true;var v=true;var o=true;var r=true;for(var q=0;q<filterNMR.length;q++){if(filterNMR[q]!=null){var n=filterNMR[q];if(n.hasOwnProperty("mfs")){if(!((t.name).toLowerCase().indexOf("-"+n.mfs+"mhz")>=0)){p=false;break}}if(n.hasOwnProperty("pulseq")){if(!((t.name).toUpperCase().indexOf("; "+n.pulseq.toUpperCase()+"")>=0)){v=false;break}}if(n.hasOwnProperty("cpd")){if(!((t.name).toUpperCase().indexOf(""+n.cpd.toUpperCase()+"")>=0)){o=false;break}}if(n.hasOwnProperty("solvent")){if(!((t.sampleNMRTubeConditionsMetadata.solventNMR).toUpperCase().indexOf(""+n.solvent.toUpperCase()+"")>=0)){r=false;break}}}}if(p&&v&&o&&r){l.push(t);k++}}else{if(h){var s=true;var m=true;var o=true;for(var q=0;q<filterLCMS.length;q++){if(filterLCMS[q]!=null){var n=filterLCMS[q];if(n.hasOwnProperty("ioniztionMethod")){if(!((t.name).toUpperCase().indexOf("; LC-"+n.ioniztionMethod+"-")>=0)){s=false;break}}if(n.hasOwnProperty("ionAnalyzer")){if(!((t.name).toUpperCase().indexOf("-"+n.ionAnalyzer.toUpperCase()+"; MS;")>=0)){m=false;break}}if(n.hasOwnProperty("cpd")){if(!((t.name).toUpperCase().indexOf(""+n.cpd.toUpperCase()+"")>=0)){o=false;break}}}}if(s&&m&&o){l.push(t);k++}}else{l.push(t);k++}}if(k>=numberMaxResults){displaySearchResults(g,l,b,a,j);d=true;return false}}f++;if(k>=numberMaxResults){displaySearchResults(g,l,b,a,j);d=true;return false}});if(k>=numberMaxResults){displaySearchResults(g,l,b,a,j);d=true;return false}$.each(compoundsData,function(i,m){if(f>=a){g.push(m);k++;if(k>=numberMaxResults){displaySearchResults(g,l,b,a,j);d=true;return false}}f++});if(!d){displaySearchResults(g,l,b,a,j)}return true}checkIfLoadSubPage=function(){var a=location.href;if(a.indexOf("#")>0){a=a.substr((a.indexOf("#")+1),a.length);var b=a.split("-");if(b.length==2){filterSearchResults(b[0],b[1])}}};if(!isMainQueryAnsync){setTimeout(function(){checkIfLoadSubPage()},50)}var firstLoadTabData=true;function displaySearchResults(i,l,d,c,k){if(firstLoadTabData){$("table").unbind("appendCache applyWidgetId applyWidgets sorton update updateCell").removeClass("tablesorter").find("thead th").unbind("click mousedown").removeClass("header headerSortDown headerSortUp")}var e=false;$(".loadSearchResults").hide();$("#noNMRSearchResults").hide();$("#noLCMSSearchResults").hide();$("#noSearchResults").hide();$("#compoundResultsTableBody").empty();if(!$.isEmptyObject(i)){$("#templateCompounds").tmpl(i).appendTo("#compoundResultsTableBody");$("#compoundResultsTable").show();$.each($(".compoundFormula"),function(n,m){$(m).html($(m).text())})}$("#spectrumResultsTableBody").empty();$("#spectrumNMRResultsTableBody").empty();$("#spectrumLCMSResultsTableBody").empty();$("#spectrumLCMSMSResultsTableBody").empty();if(!$.isEmptyObject(l)){if($($("tbody#spectrumResultsTableBody")).length){$("#templateSpectra").tmpl(l).appendTo("#spectrumResultsTableBody");$("#spectrumResultsTable").show();hideSpectraScoreZeroF("spectrumResultsTableBody")}else{if($($("tbody#spectrumNMRResultsTableBody")).length){$("#templateNMRSpectra").tmpl(l).appendTo("#spectrumNMRResultsTableBody");$("#spectrumNMRResultsTable").show();$("#searchNMRfilterDiv").show();hideSpectraScoreZeroF("spectrumNMRResultsTableBody")}if($($("tbody#spectrumLCMSResultsTableBody")).length){$("#templateLCMSSpectra").tmpl(l).appendTo("#spectrumLCMSResultsTableBody");$("#spectrumLCMSResultsTable").show();$("#searchLCMSfilterDiv").show();hideSpectraScoreZeroF("spectrumLCMSResultsTableBody")}if($($("tbody#spectrumLCMSMSResultsTableBody")).length){$("#templateLCMSMSSpectra").tmpl(l).appendTo("#spectrumLCMSMSResultsTableBody");$("#spectrumLCMSMSResultsTable").show();$("#searchLCMSMSfilterDiv").show();hideSpectraScoreZeroF("spectrumLCMSMSResultsTableBody")}}}if($.isEmptyObject(i)&&$.isEmptyObject(l)){$("#noSearchResults").show();$("#noNMRSearchResults").show();$("#noLCMSSearchResults").show();$("#noLCMSMSSearchResults").show();$("#"+divSearch+"Pagination").html("");return true}computeDisplayCpdInCartList();var a=false;var h=c/numberMaxResults;var g=Math.ceil(k/numberMaxResults);var f="";if(h==0){f+='<li class="disabled"><a href="#">&laquo;</a></li>';e=true}else{f+='<li><a href="#" onclick="filterSearchResults(0, '+k+');">&laquo;</a></li>'}if(h>=3){if(h!=3){f+='<li class="disabled"><a href="#">&hellip;</a></li>'}var j=c-numberMaxResults-(2*numberMaxResults);f+='<li><a href="#" onclick="filterSearchResults('+j+", "+k+');">'+(h-2)+"</a></li>"}if(h>=2){var j=c-numberMaxResults-(1*numberMaxResults);f+='<li><a href="#" onclick="filterSearchResults('+j+", "+k+');">'+(h-1)+"</a></li>"}if(h>=1){a=true;var j=c-numberMaxResults;f+='<li><a href="#" onclick="filterSearchResults('+j+", "+k+');">'+(h)+"</a></li>"}f+='<li class="active"><a href="#">'+(h+1)+"</a></li>";if((h+1)<g){a=true;var b=c+numberMaxResults;f+='<li><a href="#" onclick="filterSearchResults('+b+", "+k+');">'+(h+2)+"</a></li>"}if((h+2)<g){var b=c+numberMaxResults+(1*numberMaxResults);f+='<li><a href="#" onclick="filterSearchResults('+b+", "+k+');">'+(h+3)+"</a></li>"}if((h+3)<g){var b=c+numberMaxResults+(2*numberMaxResults);f+='<li><a href="#" onclick="filterSearchResults('+b+", "+k+');">'+(h+4)+"</a></li>"}if((h+4)<g){f+='<li class="disabled"><a href="#">&hellip;</a></li>'}if((h+1)==g){f+='<li class="disabled"><a href="#">&raquo;</a></li>'}else{var b=(g)*numberMaxResults-numberMaxResults;f+='<li><a href="#" onclick="filterSearchResults('+b+", "+k+');">&raquo;</a></li>'}if(a){$("#"+divSearch+"Pagination").html(f);$("#"+divSearch+"Pagination").show()}if(firstLoadTabData){setTimeout(function(){$("#compoundResultsTable").tablesorter();$("#spectrumResultsTable").tablesorter();$("#spectrumNMRResultsTable").tablesorter();$("#spectrumLCMSResultsTable").tablesorter();$("#spectrumLCMSMSResultsTable").tablesorter()},150)}setTimeout(function(){$("table").trigger("update")},300);setTimeout(resizeMainPanel(),50);firstLoadTabData=false;if(!isCountMaxResults){countMaxResults()}return true}$("#searchButton").click(function(){if($("#search").val()!=""){$("#searchForm").submit()}});var autoCompleteLoadingPanelTimeout;function showAutocompleteLoadingPanel(a){if(a){clearTimeout(autoCompleteLoadingPanelTimeout);autoCompleteLoadingPanelTimeout=setTimeout(function(){$("#autoCompleteLoadingPanel").css("display","block")},500)}else{clearTimeout(autoCompleteLoadingPanelTimeout);$("#autoCompleteLoadingPanel").css("display","none")}}var subjects=[];$("#search").typeahead({dynamic:true,delay:0,source:function(a,b){return searchAjax(b)}});$("#search").bind("keypress",function(f){var d=f.keyCode||f.which;if(d==13&&$("#search").val()!=""){$("#searchForm").submit()}if(d==32&&$("#search").val()!=""){var c=$("#search").parent().find("ul");if($(c).is(":visible")){var b=$(c).find("li");for(var a=0;a<b.length;a++){if($(b[a]).hasClass("active")&&a>0){$("#search").val($(b[a]).text())}}}}}).focus();searchAjax=function(b){var a=[];var c=($("#search").val()).trim();a.push(c);if(c.length>2){showAutocompleteLoadingPanel(true);$.ajax({type:"post",url:"search",dataType:"json",async:true,data:"query="+($("#search").val()).trim()+"&quick=true",success:function(d){if(d.success){$.each(d.compoundNames,function(){if($.inArray(this.name,a)===-1){a.push(this.name)}});$.each(d.compounds,function(){if(this.inChIKey.indexOf(c)){if($.inArray(this.inChIKey,a)===-1){a.push(this.inChIKey)}}if(this.formula.indexOf(c)){if($.inArray(this.formula,a)===-1){a.push(this.formula)}}});a=matchingSpectraKeywords(c,a)}if(a.length==1){a=new Array()}b(a);showAutocompleteLoadingPanel(false)},error:function(d){subjects=[];console.log(d);a=new Array();b(a);showAutocompleteLoadingPanel(false)}})}};matchingSpectraKeywords=function(a,d){var g="";var e=a.split(" ");for(var c in e){var b=e[c];if(b.toLowerCase().startsWith("nm")){g=g+"NMR"}else{if(b.toLowerCase().startsWith("40")){g=g+"400"}else{if(b.toLowerCase().startsWith("50")){g=g+"500"}else{if(b.toLowerCase().startsWith("60")){g=g+"600"}else{if(b.toLowerCase().startsWith("70")){g=g+"700"}else{if(b.toLowerCase().startsWith("75")){g=g+"750"}else{if(b.toLowerCase().startsWith("80")){g=g+"800"}else{if(b.toLowerCase().startsWith("85")){g=g+"850"}else{if(b.toLowerCase().startsWith("90")){g=g+"900"}else{if(b.toLowerCase().startsWith("10")){g=g+"1000"}else{if(b.toLowerCase().startsWith("12")){g=g+"1200"}else{if(b.toLowerCase().startsWith("pr")){g=g+"proton"}else{if(b.toLowerCase().startsWith("no")){d.push("NOESY-1D");d.push("NOESY-2D");g=g+" "}else{if(b.toLowerCase().startsWith("cp")){g=g+"CPMG"}else{if(b.toLowerCase().startsWith("car")){g=g+"Carbon-13"}else{if(b.toLowerCase().startsWith("co")){g=g+"COSY-2D"}else{if(b.toLowerCase().startsWith("jr")){g=g+"JRES"}else{if(b.toLowerCase().startsWith("to")){g=g+"TOCSY-2D"}else{if(b.toLowerCase().startsWith("hm")){g=g+"HMBC-2D"}else{if(b.toLowerCase().startsWith("hs")){g=g+"HSQC-2D"}else{if(b.toLowerCase().startsWith("lc")){g=g+"LC-MS"}else{if(b.toLowerCase().startsWith("to")){g=g+"TOF"}else{if(b.toLowerCase().startsWith("qt")){g=g+"QTOF"}else{if(b.toLowerCase().startsWith("qq")){g=g+"QQQ"}else{if(b.toLowerCase().startsWith("lc-msm")||b.toLowerCase().startsWith("lc-ms2")){g=g+"LC-MSMS"}else{if(b.toLowerCase().startsWith("pos")){g=g+"positive"}else{if(b.toLowerCase().startsWith("neg")){g=g+"negative"}else{if(b.toLowerCase().startsWith("hig")){g=g+"High"}else{if(b.toLowerCase().startsWith("low")){g=g+"Low"}else{g=g+b}}}}}}}}}}}}}}}}}}}}}}}}}}}}}g=g+" "}var f=(g.trim());if($.inArray(f,d)===-1){d.push(f)}return d};var isAdvancedModalLoaded=false;$("#advancedBtn").click(function(){if(isAdvancedModalLoaded){$("#advancedModal").modal("show");loadRawQuery()}else{$("#advancedModal .modal-dialog").load("search-advanced-modal",function(){$("#advancedModal").modal("show");isAdvancedModalLoaded=true})}});$("#filterNMRtype").change(function(){var a=$("#filterNMRtype").val();switch(a){case"1":$(".filterType").hide();$("#filterNMRmagneticValue").show();break;case"2":$(".filterType").hide();$("#filterNMRpulseqValue").show();break;case"3":$(".filterType").hide();$("#filterNMRtextValue").show();break;case"4":$(".filterType").hide();$("#filterNMRsolventValue").show();break}});hideshow=function(b){var a=$("#"+b);if($(a).is(":visible")){$("#"+b).hide()}else{$("#"+b).show()}};addNMRfilter=function(){var b=$("#filterNMRtype").val();var c="";var a="";switch(b){case"1":var c=$("#filterNMRmagneticValue").val();filterNMR[filterCpd]={mfs:c};a='<span id="filter'+filterCpd+'"><span class="label label-warning ">'+TXT_LABEL__MAGNETIC_FIELD+": "+c+' | <a href="#" onclick="removeNMRfilter('+filterCpd+');"class="">&times;</a></span><span>&nbsp;</span></span>';break;case"2":var c=$("#filterNMRpulseqValue").val();filterNMR[filterCpd]={pulseq:c};a='<span id="filter'+filterCpd+'"><span class="label label-warning ">'+TXT_LABEL__PULSE_SEQ+": "+c+' | <a href="#" onclick="removeNMRfilter('+filterCpd+');"class="">&times;</a></span><span>&nbsp;</span></span>';break;case"3":var c=$("#filterNMRtextValue").val();filterNMR[filterCpd]={cpd:c};a='<span id="filter'+filterCpd+'"><span class="label label-warning ">'+TXT_LABEL__CPD_NAME+": "+c+' | <a href="#" onclick="removeNMRfilter('+filterCpd+');"class="">&times;</a></span><span>&nbsp;</span></span>';break;case"4":var c=$("#filterNMRsolventValue").val();filterNMR[filterCpd]={solvent:c};a='<span id="filter'+filterCpd+'"><span class="label label-warning ">'+TXT_LABEL__SOLVENT+": "+c+' | <a href="#" onclick="removeNMRfilter('+filterCpd+');"class="">&times;</a></span><span>&nbsp;</span></span>';break}$("#filterNMRdisplay").append(a);filterSearchResults(0,totalElementFound);filterCpd++};removeNMRfilter=function(a){filterNMR[a]=null;filterSearchResults(0,totalElementFound);$("#filter"+a).remove()};var isNMRModalLoaded=false;openNMRtoolbox=function(){if(isNMRModalLoaded){$("#NMRModal").modal("show");loadRawQueryNMR()}else{$("#NMRModal .modal-dialog").load("peakmatching-nmr-query-modal",function(){$("#NMRModal").modal("show");isNMRModalLoaded=true})}};$("#peakmatchingNMRmodalBtn").click(function(){openNMRtoolbox()});$("#searchNMR").click(function(){openNMRtoolbox()});$("#filterLCMStype").change(function(){var a=$("#filterLCMStype").val();switch(a){case"1":$(".filterType").hide();$("#filterLCMIonizationMethodValue").show();break;case"2":$(".filterType").hide();$("#filterLCMStextIonAnalyzerValue").show();break;case"3":$(".filterType").hide();$("#filterLCMStextCpdNameValue").show();break}});addLCMSfilter=function(){var b=$("#filterLCMStype").val();var c="";var a="";switch(b){case"1":var c=$("#filterLCMIonizationMethodValue").val();filterLCMS[filterCpd]={ioniztionMethod:c};a='<span id="filter'+filterCpd+'"><span class="label label-warning ">'+TXT_LABEL__IONIZATION_METHOD+": "+c+' | <a href="#" onclick="removeLCMSfilter('+filterCpd+');"class="">&times;</a></span><span>&nbsp;</span></span>';break;case"2":var c=$("#filterLCMStextIonAnalyzerValue").val();filterLCMS[filterCpd]={ionAnalyzer:c};a='<span id="filter'+filterCpd+'"><span class="label label-warning ">'+TXT_LABEL__ION_ANALYZER+": "+c+' | <a href="#" onclick="removeLCMSfilter('+filterCpd+');"class="">&times;</a></span><span>&nbsp;</span></span>';break;case"3":var c=$("#filterLCMStextCpdNameValue").val();filterLCMS[filterCpd]={cpd:c};a='<span id="filter'+filterCpd+'"><span class="label label-warning ">'+TXT_LABEL__CPD_NAME+": "+c+' | <a href="#" onclick="removeLCMSfilter('+filterCpd+');"class="">&times;</a></span><span>&nbsp;</span></span>';break}$("#filterLCMSdisplay").append(a);filterSearchResults(0,totalElementFound);filterCpd++};removeLCMSfilter=function(a){filterLCMS[a]=null;filterSearchResults(0,totalElementFound);$("#filter"+a).remove()};var isLCMSModalLoaded=false;openLCMStoolbox=function(){if(isLCMSModalLoaded){$("#LCMSModal").modal("show");loadRawQueryLCMS()}else{$("#LCMSModal .modal-dialog").load("peakmatching-lcms-query-modal",function(){$("#LCMSModal").modal("show");isLCMSModalLoaded=true})}};$("#peakmatchingLCMSmodalBtn").click(function(){openLCMStoolbox()});$("#searchLCMS").click(function(){openLCMStoolbox()});$("#filterLCMSMStype").change(function(){var a=$("#filterLCMSMStype").val();switch(a){case"1":$(".filterType").hide();$("#filterLCMSMSIonizationMethodValue").show();break;case"2":$(".filterType").hide();$("#filterLCMSMStextIonAnalyzerValue").show();break;case"3":$(".filterType").hide();$("#filterLCMSMStextCpdNameValue").show();break}});addLCMSMSfilter=function(){var b=$("#filterLCMSMStype").val();var c="";var a="";switch(b){case"1":var c=$("#filterLCMSMSIonizationMethodValue").val();filterLCMSMS[filterCpd]={ioniztionMethod:c};a='<span id="filter'+filterCpd+'"><span class="label label-warning ">'+TXT_LABEL__IONIZATION_METHOD+": "+c+' | <a href="#" onclick="removeLCMSMSfilter('+filterCpd+');"class="">&times;</a></span><span>&nbsp;</span></span>';break;case"2":var c=$("#filterLCMSMStextIonAnalyzerValue").val();filterLCMSMS[filterCpd]={ionAnalyzer:c};a='<span id="filter'+filterCpd+'"><span class="label label-warning ">'+TXT_LABEL__ION_ANALYZER+": "+c+' | <a href="#" onclick="removeLCMSMSfilter('+filterCpd+');"class="">&times;</a></span><span>&nbsp;</span></span>';break;case"3":var c=$("#filterLCMSMStextCpdNameValue").val();filterLCMSMS[filterCpd]={cpd:c};a='<span id="filter'+filterCpd+'"><span class="label label-warning ">'+TXT_LABEL__CPD_NAME+": "+c+' | <a href="#" onclick="removeLCMSMSfilter('+filterCpd+');"class="">&times;</a></span><span>&nbsp;</span></span>';break}$("#filterLCMSMSdisplay").append(a);filterSearchResults(0,totalElementFound);filterCpd++};removeLCMSMSfilter=function(a){filterLCMSMS[a]=null;filterSearchResults(0,totalElementFound);$("#filter"+a).remove()};var isLCMSMSModalLoaded=false;openLCMSMStoolbox=function(){if(isLCMSMSModalLoaded){$("#LCMSMSModal").modal("show");loadRawQueryLCMSMS()}else{$("#LCMSMSModal .modal-dialog").load("peakmatching-lcmsms-query-modal",function(){$("#LCMSMSModal").modal("show");isLCMSMSModalLoaded=true})}};$("#peakmatchingLCMSMSmodalBtn").click(function(){openLCMSMStoolbox()});$("#searchLCMSMS").click(function(){openLCMSMStoolbox()});$(document).ready(function(){$("#link-pm-nmr").click(function(){if(($($("#searchNMR")).length)&&$("#searchNMR").val().trim()==""){$("#peakmatchingNMRmodalBtn").click()}});$("#link-pm-lcms").click(function(){if(($($("#searchLCMS")).length)&&$("#searchLCMS").val().trim()==""){$("#peakmatchingLCMSmodalBtn").click()}});$("#link-pm-lcmsms").click(function(){if(($($("#searchLCMSMS")).length)&&$("#searchLCMSMS").val().trim()==""){$("#peakmatchingLCMSMSmodalBtn").click()}})});function hideSpectraScoreZeroF(a){if(hideSpectraScoreZero){var b=false;$.each($("#"+a+" tr"),function(){var c=$(this);if($($(c).find("td")[1]).html()=="0"){$(c).hide();b=true}});if(b){$("#"+a+"").append('<tr id="lineBtnShowMore"><td colspan="4"><button class="btn btn-primary" onclick="showSpectraScoreZero(\''+a+'\')"><i class="fa fa-eye"></i> '+_txt_btn_showMode+"</button></td></tr>");setTimeout(function(){if($("#searchPagination").find("li.active a").html()=="1"){$("#searchPagination").hide()}},50)}}}function showSpectraScoreZero(a){hideSpectraScoreZero=false;$("#searchPagination").show();$("#lineBtnShowMore").remove();$("#"+a+" tr").show()}function countMaxResults(){var a="query="+b;var b=$.trim($("#"+divSearch).val());var a=getSearchRequestFormated(a,b);a="query="+b;$.ajax({type:"post",url:"search-count",dataType:"json",async:true,data:a,success:function(c){$("#searchExtraInfo").html(c+" relevant results.")},error:function(c){console.log(c)}});isCountMaxResults=true;return}function getSearchRequestFormated(a,j){if(j.startsWith('"')&&j.endsWith('"')){a="query="+$.trim((j).replace(/"/g,""))}else{if(j.indexOf(":")>-1){var c="";var i=null;var g=-1;var l="";var d="";var b="";var h=j.split(" ");var f=false;$.each(h,function(o,s){if(s!=""){var p=s.split(":");if(p!=null&&p.length==2){var e=p[0];var m=p[1];switch(e){case"AVM":var n=m.split("d");var q=n[0];var t=n[1];i="compounds";g=Utils_SEARCH_COMPOUND_AVERAGE_MASS;l=q;d=t;f=true;break;case"MIM":var n=m.split("d");var q=n[0];var t=n[1];i="compounds";g=Utils_SEARCH_COMPOUND_MONOISOTOPIC_MASS;l=q;d=t;f=true;break;case"mode":b=m;i="compounds";break;case"FOR":i="compounds";g=Utils_SEARCH_COMPOUND_FORMULA;l=m;d="";f=true;break;case"NMR":i="nmr-spectra";var r=JSON.parse(m.replace(/=/g,":"));c=r.pl;g=-1;l=r.d;d=r.mm+"-"+r.pH;break;case"LC-MS":case"LCMS":i="lcms-spectra";var r=JSON.parse(m.replace(/=/g,":"));c=r.pl+";"+r.rtl+";"+r.col;g=-1;l=r.pol+";"+r.res+";"+r.algo;d=r.dM+";"+r.dT;break;case"LC-MSMS":case"LCMSMS":i="lcmsms-spectra";var r=JSON.parse(m.replace(/=/g,":"));c=JSON.stringify(r.pl);g=-1;l=r.pol+";"+r.res+";";d=r.P+";"+r.dP+";"+r.dPL;if(r.hasOwnProperty("dmz")){d+=""+r.dmz+";"+r.intexp+";"+r.mzexp+";"}break;default:qFilerEntity="compounds";g=-1;break}}else{c+=s+" "}}});if($.trim(c)==""&&!f){a="query="+$.trim(j)}else{try{a="query="+$.trim(c)+"&filterEntity="+i+"&filerType="+g+"&filterVal="+l+"&filterVal2="+d+"&filterVal3="+b}catch(k){a="query="+$.trim(j)}}}}return a};