/*!
 * Handsontable 0.12.1
 * Handsontable is a JavaScript library for editable tables with basic copy-paste compatibility with Excel and Google Docs
 *
 * Copyright 2012-2014 Marcin Warpechowski
 * Licensed under the MIT license.
 * http://handsontable.com/
 *
 * Date: Thu Dec 04 2014 15:17:59 GMT+0100 (CET)
 */
;var Handsontable=function(b,c){c=c||{};var a=new Handsontable.Core(b,c);a.init();return a};Handsontable.helper={};Handsontable.plugins={};(function(window,Handsontable){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length>>>0;var from=Number(arguments[1])||0;from=(from<0)?Math.ceil(from):Math.floor(from);if(from<0){from+=len}for(;from<len;from++){if(from in this&&this[from]===elt){return from}}return -1}}if(!Array.prototype.filter){Array.prototype.filter=function(fun,thisp){if(typeof this==="undefined"||this===null){throw new TypeError()}if(typeof fun!=="function"){throw new TypeError()}thisp=thisp||this;if(isNodeList(thisp)){thisp=convertNodeListToArray(thisp)}var len=thisp.length,res=[],i,val;for(i=0;i<len;i+=1){if(thisp.hasOwnProperty(i)){val=thisp[i];if(fun.call(thisp,val,i,thisp)){res.push(val)}}}return res;function isNodeList(object){return/NodeList/i.test(object.item)}function convertNodeListToArray(nodeList){var array=[];for(var i=0,len=nodeList.length;i<len;i++){array[i]=nodeList[i]}return array}}}if(!Array.isArray){Array.isArray=function(arg){return Object.prototype.toString.call(arg)==="[object Array]"}}if(!Object.keys){Object.keys=(function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!({toString:null}).propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){if(typeof obj!=="object"&&(typeof obj!=="function"||obj===null)){throw new TypeError("Object.keys called on non-object")}var result=[],prop,i;for(prop in obj){if(hasOwnProperty.call(obj,prop)){result.push(prop)}}if(hasDontEnumBug){for(i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i])){result.push(dontEnums[i])}}}return result}}())}if(typeof WeakMap==="undefined"){(function(){var defineProperty=Object.defineProperty;try{var properDefineProperty=true;defineProperty(function(){},"foo",{})}catch(e){properDefineProperty=false}var counter=+(new Date)%1000000000;var WeakMap=function(){this.name="__st"+(Math.random()*1000000000>>>0)+(counter+++"__");if(!properDefineProperty){this._wmCache=[]}};if(properDefineProperty){WeakMap.prototype={set:function(key,value){var entry=key[this.name];if(entry&&entry[0]===key){entry[1]=value}else{defineProperty(key,this.name,{value:[key,value],writable:true})}},get:function(key){var entry;return(entry=key[this.name])&&entry[0]===key?entry[1]:undefined},"delete":function(key){this.set(key,undefined)}}}else{WeakMap.prototype={set:function(key,value){if(typeof key=="undefined"||typeof value=="undefined"){return}for(var i=0,len=this._wmCache.length;i<len;i++){if(this._wmCache[i].key==key){this._wmCache[i].value=value;return}}this._wmCache.push({key:key,value:value})},get:function(key){if(typeof key=="undefined"){return}for(var i=0,len=this._wmCache.length;i<len;i++){if(this._wmCache[i].key==key){return this._wmCache[i].value}}return},"delete":function(key){if(typeof key=="undefined"){return}for(var i=0,len=this._wmCache.length;i<len;i++){if(this._wmCache[i].key==key){Array.prototype.slice.call(this._wmCache,i,1)}}}}}window.WeakMap=WeakMap})()}Handsontable.activeGuid=null;Handsontable.Core=function(rootElement,userSettings){var priv,datamap,grid,selection,editorManager,instance=this,GridSettings=function(){},eventManager=Handsontable.eventManager(instance);Handsontable.helper.extend(GridSettings.prototype,DefaultSettings.prototype);Handsontable.helper.extend(GridSettings.prototype,userSettings);Handsontable.helper.extend(GridSettings.prototype,expandType(userSettings));this.rootElement=rootElement;this.container=document.createElement("DIV");this.container.className="htContainer";rootElement.insertBefore(this.container,rootElement.firstChild);this.guid="ht_"+Handsontable.helper.randomString();if(!this.rootElement.id||this.rootElement.id.substring(0,3)==="ht_"){this.rootElement.id=this.guid}priv={cellSettings:[],columnSettings:[],columnsSettingConflicts:["data","width"],settings:new GridSettings(),selRange:null,isPopulated:null,scrollable:null,firstRun:true};grid={alter:function(action,index,amount,source,keepEmptyRows){var delta;amount=amount||1;switch(action){case"insert_row":delta=datamap.createRow(index,amount);if(delta){if(selection.isSelected()&&priv.selRange.from.row>=index){priv.selRange.from.row=priv.selRange.from.row+delta;selection.transformEnd(delta,0)}else{selection.refreshBorders()}}break;case"insert_col":delta=datamap.createCol(index,amount);if(delta){if(Handsontable.helper.isArray(instance.getSettings().colHeaders)){var spliceArray=[index,0];spliceArray.length+=delta;Array.prototype.splice.apply(instance.getSettings().colHeaders,spliceArray)}if(selection.isSelected()&&priv.selRange.from.col>=index){priv.selRange.from.col=priv.selRange.from.col+delta;selection.transformEnd(0,delta)}else{selection.refreshBorders()}}break;case"remove_row":index=instance.runHooksAndReturn("modifyCol",index);datamap.removeRow(index,amount);priv.cellSettings.splice(index,amount);grid.adjustRowsAndCols();selection.refreshBorders();break;case"remove_col":datamap.removeCol(index,amount);for(var row=0,len=datamap.getAll().length;row<len;row++){if(row in priv.cellSettings){priv.cellSettings[row].splice(index,amount)}}if(Handsontable.helper.isArray(instance.getSettings().colHeaders)){if(typeof index=="undefined"){index=-1}instance.getSettings().colHeaders.splice(index,amount)}grid.adjustRowsAndCols();selection.refreshBorders();break;default:throw new Error('There is no such action "'+action+'"');break}if(!keepEmptyRows){grid.adjustRowsAndCols()}},adjustRowsAndCols:function(){var r,rlen,emptyRows,emptyCols;rlen=instance.countRows();if(rlen<priv.settings.minRows){for(r=0;r<priv.settings.minRows-rlen;r++){datamap.createRow(instance.countRows(),1,true)}}emptyRows=instance.countEmptyRows(true);if(emptyRows<priv.settings.minSpareRows){for(;emptyRows<priv.settings.minSpareRows&&instance.countRows()<priv.settings.maxRows;emptyRows++){datamap.createRow(instance.countRows(),1,true)}}emptyCols=instance.countEmptyCols(true);if(!priv.settings.columns&&instance.countCols()<priv.settings.minCols){for(;instance.countCols()<priv.settings.minCols;emptyCols++){datamap.createCol(instance.countCols(),1,true)}}if(!priv.settings.columns&&instance.dataType==="array"&&emptyCols<priv.settings.minSpareCols){for(;emptyCols<priv.settings.minSpareCols&&instance.countCols()<priv.settings.maxCols;emptyCols++){datamap.createCol(instance.countCols(),1,true)}}var rowCount=instance.countRows();var colCount=instance.countCols();if(rowCount===0||colCount===0){selection.deselect()}if(selection.isSelected()){var selectionChanged;var fromRow=priv.selRange.from.row;var fromCol=priv.selRange.from.col;var toRow=priv.selRange.to.row;var toCol=priv.selRange.to.col;if(fromRow>rowCount-1){fromRow=rowCount-1;selectionChanged=true;if(toRow>fromRow){toRow=fromRow}}else{if(toRow>rowCount-1){toRow=rowCount-1;selectionChanged=true;if(fromRow>toRow){fromRow=toRow}}}if(fromCol>colCount-1){fromCol=colCount-1;selectionChanged=true;if(toCol>fromCol){toCol=fromCol}}else{if(toCol>colCount-1){toCol=colCount-1;selectionChanged=true;if(fromCol>toCol){fromCol=toCol}}}if(selectionChanged){instance.selectCell(fromRow,fromCol,toRow,toCol)}}},populateFromArray:function(start,input,end,source,method,direction,deltas){var r,rlen,c,clen,setData=[],current={};rlen=input.length;if(rlen===0){return false}var repeatCol,repeatRow,cmax,rmax;switch(method){case"shift_down":repeatCol=end?end.col-start.col+1:0;repeatRow=end?end.row-start.row+1:0;input=Handsontable.helper.translateRowsToColumns(input);for(c=0,clen=input.length,cmax=Math.max(clen,repeatCol);c<cmax;c++){if(c<clen){for(r=0,rlen=input[c].length;r<repeatRow-rlen;r++){input[c].push(input[c][r%rlen])}input[c].unshift(start.col+c,start.row,0);instance.spliceCol.apply(instance,input[c])}else{input[c%clen][0]=start.col+c;instance.spliceCol.apply(instance,input[c%clen])}}break;case"shift_right":repeatCol=end?end.col-start.col+1:0;repeatRow=end?end.row-start.row+1:0;for(r=0,rlen=input.length,rmax=Math.max(rlen,repeatRow);r<rmax;r++){if(r<rlen){for(c=0,clen=input[r].length;c<repeatCol-clen;c++){input[r].push(input[r][c%clen])}input[r].unshift(start.row+r,start.col,0);instance.spliceRow.apply(instance,input[r])}else{input[r%rlen][0]=start.row+r;instance.spliceRow.apply(instance,input[r%rlen])}}break;case"overwrite":default:current.row=start.row;current.col=start.col;var iterators={row:0,col:0},selected={row:(end&&start)?(end.row-start.row+1):1,col:(end&&start)?(end.col-start.col+1):1};if(["up","left"].indexOf(direction)!==-1){iterators={row:Math.ceil(selected.row/rlen)||1,col:Math.ceil(selected.col/input[0].length)||1}}else{if(["down","right"].indexOf(direction)!==-1){iterators={row:1,col:1}}}for(r=0;r<rlen;r++){if((end&&current.row>end.row)||(!priv.settings.allowInsertRow&&current.row>instance.countRows()-1)||(current.row>=priv.settings.maxRows)){break}current.col=start.col;clen=input[r]?input[r].length:0;for(c=0;c<clen;c++){if((end&&current.col>end.col)||(!priv.settings.allowInsertColumn&&current.col>instance.countCols()-1)||(current.col>=priv.settings.maxCols)){break}if(!instance.getCellMeta(current.row,current.col).readOnly){var result,value=input[r][c],index={row:r,col:c};if(source==="autofill"){result=instance.runHooksAndReturn("beforeAutofillInsidePopulate",index,direction,input,deltas,iterators,selected);if(result){iterators=typeof(result.iterators)!=="undefined"?result.iterators:iterators;value=typeof(result.value)!=="undefined"?result.value:value}}setData.push([current.row,current.col,value])}current.col++;if(end&&c===clen-1){c=-1;if(["down","right"].indexOf(direction)!==-1){iterators.col++}else{if(["up","left"].indexOf(direction)!==-1){if(iterators.col>1){iterators.col--}}}}}current.row++;iterators.col=1;if(end&&r===rlen-1){r=-1;if(["down","right"].indexOf(direction)!==-1){iterators.row++}else{if(["up","left"].indexOf(direction)!==-1){if(iterators.row>1){iterators.row--}}}}}instance.setDataAtCell(setData,null,null,source||"populateFromArray");break}}};this.selection=selection={inProgress:false,selectedHeader:{cols:false,rows:false},setSelectedHeaders:function(rows,cols){instance.selection.selectedHeader.rows=rows;instance.selection.selectedHeader.cols=cols},begin:function(){instance.selection.inProgress=true},finish:function(){var sel=instance.getSelected();Handsontable.hooks.run(instance,"afterSelectionEnd",sel[0],sel[1],sel[2],sel[3]);Handsontable.hooks.run(instance,"afterSelectionEndByProp",sel[0],instance.colToProp(sel[1]),sel[2],instance.colToProp(sel[3]));instance.selection.inProgress=false},isInProgress:function(){return instance.selection.inProgress},setRangeStart:function(coords,keepEditorOpened){Handsontable.hooks.run(instance,"beforeSetRangeStart",coords);priv.selRange=new WalkontableCellRange(coords,coords,coords);selection.setRangeEnd(coords,null,keepEditorOpened)},setRangeEnd:function(coords,scrollToCell,keepEditorOpened){Handsontable.hooks.run(instance,"beforeSetRangeEnd",coords);instance.selection.begin();priv.selRange.to=new WalkontableCellCoords(coords.row,coords.col);if(!priv.settings.multiSelect){priv.selRange.from=coords}instance.view.wt.selections.current.clear();instance.view.wt.selections.current.add(priv.selRange.highlight);instance.view.wt.selections.area.clear();if(selection.isMultiple()){instance.view.wt.selections.area.add(priv.selRange.from);instance.view.wt.selections.area.add(priv.selRange.to)}if(priv.settings.currentRowClassName||priv.settings.currentColClassName){instance.view.wt.selections.highlight.clear();instance.view.wt.selections.highlight.add(priv.selRange.from);instance.view.wt.selections.highlight.add(priv.selRange.to)}Handsontable.hooks.run(instance,"afterSelection",priv.selRange.from.row,priv.selRange.from.col,priv.selRange.to.row,priv.selRange.to.col);Handsontable.hooks.run(instance,"afterSelectionByProp",priv.selRange.from.row,datamap.colToProp(priv.selRange.from.col),priv.selRange.to.row,datamap.colToProp(priv.selRange.to.col));if(scrollToCell!==false&&instance.view.mainViewIsActive()){instance.view.scrollViewport(coords)}selection.refreshBorders(null,keepEditorOpened)},refreshBorders:function(revertOriginal,keepEditor){if(!keepEditor){editorManager.destroyEditor(revertOriginal)}instance.view.render();if(selection.isSelected()&&!keepEditor){editorManager.prepareEditor()}},isMultiple:function(){var isMultiple=!(priv.selRange.to.col===priv.selRange.from.col&&priv.selRange.to.row===priv.selRange.from.row),modifier=Handsontable.hooks.execute(instance,"afterIsMultipleSelection",isMultiple);if(isMultiple){return modifier}},transformStart:function(rowDelta,colDelta,force,keepEditorOpened){var delta=new WalkontableCellCoords(rowDelta,colDelta);instance.runHooks("modifyTransformStart",delta);if(priv.selRange.highlight.row+rowDelta>instance.countRows()-1){if(force&&priv.settings.minSpareRows>0){instance.alter("insert_row",instance.countRows())}else{if(priv.settings.autoWrapCol){delta.row=1-instance.countRows();delta.col=priv.selRange.highlight.col+delta.col==instance.countCols()-1?1-instance.countCols():1}}}else{if(priv.settings.autoWrapCol&&priv.selRange.highlight.row+delta.row<0&&priv.selRange.highlight.col+delta.col>=0){delta.row=instance.countRows()-1;delta.col=priv.selRange.highlight.col+delta.col==0?instance.countCols()-1:-1}}if(priv.selRange.highlight.col+delta.col>instance.countCols()-1){if(force&&priv.settings.minSpareCols>0){instance.alter("insert_col",instance.countCols())}else{if(priv.settings.autoWrapRow){delta.row=priv.selRange.highlight.row+delta.row==instance.countRows()-1?1-instance.countRows():1;delta.col=1-instance.countCols()}}}else{if(priv.settings.autoWrapRow&&priv.selRange.highlight.col+delta.col<0&&priv.selRange.highlight.row+delta.row>=0){delta.row=priv.selRange.highlight.row+delta.row==0?instance.countRows()-1:-1;delta.col=instance.countCols()-1}}var totalRows=instance.countRows();var totalCols=instance.countCols();var coords=new WalkontableCellCoords(priv.selRange.highlight.row+delta.row,priv.selRange.highlight.col+delta.col);if(coords.row<0){coords.row=0}else{if(coords.row>0&&coords.row>=totalRows){coords.row=totalRows-1}}if(coords.col<0){coords.col=0}else{if(coords.col>0&&coords.col>=totalCols){coords.col=totalCols-1}}selection.setRangeStart(coords,keepEditorOpened)},transformEnd:function(rowDelta,colDelta){var delta=new WalkontableCellCoords(rowDelta,colDelta);instance.runHooks("modifyTransformEnd",delta);var totalRows=instance.countRows();var totalCols=instance.countCols();var coords=new WalkontableCellCoords(priv.selRange.to.row+delta.row,priv.selRange.to.col+delta.col);if(coords.row<0){coords.row=0}else{if(coords.row>0&&coords.row>=totalRows){coords.row=totalRows-1}}if(coords.col<0){coords.col=0}else{if(coords.col>0&&coords.col>=totalCols){coords.col=totalCols-1}}selection.setRangeEnd(coords)},isSelected:function(){return(priv.selRange!==null)},inInSelection:function(coords){if(!selection.isSelected()){return false}return priv.selRange.includes(coords)},deselect:function(){if(!selection.isSelected()){return}instance.selection.inProgress=false;priv.selRange=null;instance.view.wt.selections.current.clear();instance.view.wt.selections.area.clear();if(priv.settings.currentRowClassName||priv.settings.currentColClassName){instance.view.wt.selections.highlight.clear()}editorManager.destroyEditor();selection.refreshBorders();Handsontable.hooks.run(instance,"afterDeselect")},selectAll:function(){if(!priv.settings.multiSelect){return}selection.setRangeStart(new WalkontableCellCoords(0,0));selection.setRangeEnd(new WalkontableCellCoords(instance.countRows()-1,instance.countCols()-1),false)},empty:function(){if(!selection.isSelected()){return}var topLeft=priv.selRange.getTopLeftCorner();var bottomRight=priv.selRange.getBottomRightCorner();var r,c,changes=[];for(r=topLeft.row;r<=bottomRight.row;r++){for(c=topLeft.col;c<=bottomRight.col;c++){if(!instance.getCellMeta(r,c).readOnly){changes.push([r,c,""])}}}instance.setDataAtCell(changes)}};this.init=function(){Handsontable.hooks.run(instance,"beforeInit");if(Handsontable.mobileBrowser){Handsontable.Dom.addClass(instance.rootElement,"mobile")}this.updateSettings(priv.settings,true);this.view=new Handsontable.TableView(this);editorManager=new Handsontable.EditorManager(instance,priv,selection,datamap);this.forceFullRender=true;this.view.render();if(typeof priv.firstRun==="object"){Handsontable.hooks.run(instance,"afterChange",priv.firstRun[0],priv.firstRun[1]);priv.firstRun=false}Handsontable.hooks.run(instance,"afterInit")};function ValidatorsQueue(){var resolved=false;return{validatorsInQueue:0,addValidatorToQueue:function(){this.validatorsInQueue++;resolved=false},removeValidatorFormQueue:function(){this.validatorsInQueue=this.validatorsInQueue-1<0?0:this.validatorsInQueue-1;this.checkIfQueueIsEmpty()},onQueueEmpty:function(){},checkIfQueueIsEmpty:function(){if(this.validatorsInQueue==0&&resolved==false){resolved=true;this.onQueueEmpty()}}}}function validateChanges(changes,source,callback){var waitingForValidator=new ValidatorsQueue();waitingForValidator.onQueueEmpty=resolve;for(var i=changes.length-1;i>=0;i--){if(changes[i]===null){changes.splice(i,1)}else{var row=changes[i][0];var col=datamap.propToCol(changes[i][1]);var logicalCol=instance.runHooksAndReturn("modifyCol",col);var cellProperties=instance.getCellMeta(row,logicalCol);if(cellProperties.type==="numeric"&&typeof changes[i][3]==="string"){if(changes[i][3].length>0&&(/^-?[\d\s]*(\.|\,)?\d*$/.test(changes[i][3])||cellProperties.format)){var len=changes[i][3].length;if(typeof cellProperties.language=="undefined"){numeral.language("en")}else{if(changes[i][3].indexOf(".")===len-3&&changes[i][3].indexOf(",")===-1){numeral.language("en")}else{numeral.language(cellProperties.language)}}changes[i][3]=numeral().unformat(changes[i][3]||"0")}}if(instance.getCellValidator(cellProperties)){waitingForValidator.addValidatorToQueue();instance.validateCell(changes[i][3],cellProperties,(function(i,cellProperties){return function(result){if(typeof result!=="boolean"){throw new Error("Validation error: result is not boolean")}if(result===false&&cellProperties.allowInvalid===false){changes.splice(i,1);cellProperties.valid=true;--i}waitingForValidator.removeValidatorFormQueue()}})(i,cellProperties),source)}}}waitingForValidator.checkIfQueueIsEmpty();function resolve(){var beforeChangeResult;if(changes.length){beforeChangeResult=Handsontable.hooks.execute(instance,"beforeChange",changes,source);if(typeof beforeChangeResult==="function"){console.warn("Your beforeChange callback returns a function. It's not supported since Handsontable 0.12.1 (and the returned function will not be executed).")}else{if(beforeChangeResult===false){changes.splice(0,changes.length)}}}callback()}}function applyChanges(changes,source){var i=changes.length-1;if(i<0){return}for(;0<=i;i--){if(changes[i]===null){changes.splice(i,1);continue}if(changes[i][2]==null&&changes[i][3]==null){continue}if(priv.settings.allowInsertRow){while(changes[i][0]>instance.countRows()-1){datamap.createRow()}}if(instance.dataType==="array"&&priv.settings.allowInsertColumn){while(datamap.propToCol(changes[i][1])>instance.countCols()-1){datamap.createCol()}}datamap.set(changes[i][0],changes[i][1],changes[i][3])}instance.forceFullRender=true;grid.adjustRowsAndCols();Handsontable.hooks.run(instance,"beforeChangeRender",changes,source);selection.refreshBorders(null,true);Handsontable.hooks.run(instance,"afterChange",changes,source||"edit")}this.validateCell=function(value,cellProperties,callback,source){var validator=instance.getCellValidator(cellProperties);if(Object.prototype.toString.call(validator)==="[object RegExp]"){validator=(function(validator){return function(value,callback){callback(validator.test(value))}})(validator)}if(typeof validator=="function"){value=Handsontable.hooks.execute(instance,"beforeValidate",value,cellProperties.row,cellProperties.prop,source);instance._registerTimeout(setTimeout(function(){validator.call(cellProperties,value,function(valid){cellProperties.valid=valid;valid=Handsontable.hooks.execute(instance,"afterValidate",valid,value,cellProperties.row,cellProperties.prop,source);callback(valid)});return value},0))}else{cellProperties.valid=true;callback(true)}};function setDataInputToArray(row,prop_or_col,value){if(typeof row==="object"){return row}else{return[[row,prop_or_col,value]]}}this.setDataAtCell=function(row,col,value,source){var input=setDataInputToArray(row,col,value),i,ilen,changes=[],prop;for(i=0,ilen=input.length;i<ilen;i++){if(typeof input[i]!=="object"){throw new Error("Method `setDataAtCell` accepts row number or changes array of arrays as its first parameter")}if(typeof input[i][1]!=="number"){throw new Error("Method `setDataAtCell` accepts row and column number as its parameters. If you want to use object property name, use method `setDataAtRowProp`")}prop=datamap.colToProp(input[i][1]);changes.push([input[i][0],prop,datamap.get(input[i][0],prop),input[i][2]])}if(!source&&typeof row==="object"){source=col}validateChanges(changes,source,function(){applyChanges(changes,source)})};this.setDataAtRowProp=function(row,prop,value,source){var input=setDataInputToArray(row,prop,value),i,ilen,changes=[];for(i=0,ilen=input.length;i<ilen;i++){changes.push([input[i][0],input[i][1],datamap.get(input[i][0],input[i][1]),input[i][2]])}if(!source&&typeof row==="object"){source=prop}validateChanges(changes,source,function(){applyChanges(changes,source)})};this.listen=function(){Handsontable.activeGuid=instance.guid;if(document.activeElement&&document.activeElement!==document.body){document.activeElement.blur()}else{if(!document.activeElement){document.body.focus()}}};this.unlisten=function(){Handsontable.activeGuid=null};this.isListening=function(){return Handsontable.activeGuid===instance.guid};this.destroyEditor=function(revertOriginal){selection.refreshBorders(revertOriginal)};this.populateFromArray=function(row,col,input,endRow,endCol,source,method,direction,deltas){if(!(typeof input==="object"&&typeof input[0]==="object")){throw new Error("populateFromArray parameter `input` must be an array of arrays")}return grid.populateFromArray(new WalkontableCellCoords(row,col),input,typeof endRow==="number"?new WalkontableCellCoords(endRow,endCol):null,source,method,direction,deltas)};this.spliceCol=function(col,index,amount){return datamap.spliceCol.apply(datamap,arguments)};this.spliceRow=function(row,index,amount){return datamap.spliceRow.apply(datamap,arguments)};this.getSelected=function(){if(selection.isSelected()){return[priv.selRange.from.row,priv.selRange.from.col,priv.selRange.to.row,priv.selRange.to.col]}};this.getSelectedRange=function(){if(selection.isSelected()){return priv.selRange}};this.render=function(){if(instance.view){instance.forceFullRender=true;selection.refreshBorders(null,true)}};this.loadData=function(data){if(typeof data==="object"&&data!==null){if(!(data.push&&data.splice)){data=[data]}}else{if(data===null){data=[];var row;for(var r=0,rlen=priv.settings.startRows;r<rlen;r++){row=[];for(var c=0,clen=priv.settings.startCols;c<clen;c++){row.push(null)}data.push(row)}}else{throw new Error("loadData only accepts array of objects or array of arrays ("+typeof data+" given)")}}priv.isPopulated=false;GridSettings.prototype.data=data;if(priv.settings.dataSchema instanceof Array||data[0] instanceof Array){instance.dataType="array"}else{if(typeof priv.settings.dataSchema==="function"){instance.dataType="function"}else{instance.dataType="object"}}datamap=new Handsontable.DataMap(instance,priv,GridSettings);clearCellSettingCache();grid.adjustRowsAndCols();Handsontable.hooks.run(instance,"afterLoadData");if(priv.firstRun){priv.firstRun=[null,"loadData"]}else{Handsontable.hooks.run(instance,"afterChange",null,"loadData");instance.render()}priv.isPopulated=true;function clearCellSettingCache(){priv.cellSettings.length=0}};this.getData=function(r,c,r2,c2){if(typeof r==="undefined"){return datamap.getAll()}else{return datamap.getRange(new WalkontableCellCoords(r,c),new WalkontableCellCoords(r2,c2),datamap.DESTINATION_RENDERER)}};this.getCopyableData=function(startRow,startCol,endRow,endCol){return datamap.getCopyableText(new WalkontableCellCoords(startRow,startCol),new WalkontableCellCoords(endRow,endCol))};this.updateSettings=function(settings,init){var i,clen;if(typeof settings.rows!=="undefined"){throw new Error("'rows' setting is no longer supported. do you mean startRows, minRows or maxRows?")}if(typeof settings.cols!=="undefined"){throw new Error("'cols' setting is no longer supported. do you mean startCols, minCols or maxCols?")}for(i in settings){if(i==="data"){continue}else{if(Handsontable.hooks.hooks[i]!==void 0||Handsontable.hooks.legacy[i]!==void 0){if(typeof settings[i]==="function"||Handsontable.helper.isArray(settings[i])){instance.addHook(i,settings[i])}}else{if(!init&&settings.hasOwnProperty(i)){GridSettings.prototype[i]=settings[i]}}}}if(settings.data===void 0&&priv.settings.data===void 0){instance.loadData(null)}else{if(settings.data!==void 0){instance.loadData(settings.data)}else{if(settings.columns!==void 0){datamap.createMap()}}}clen=instance.countCols();priv.cellSettings.length=0;if(clen>0){var proto,column;for(i=0;i<clen;i++){priv.columnSettings[i]=Handsontable.helper.columnFactory(GridSettings,priv.columnsSettingConflicts);proto=priv.columnSettings[i].prototype;if(GridSettings.prototype.columns){column=GridSettings.prototype.columns[i];Handsontable.helper.extend(proto,column);Handsontable.helper.extend(proto,expandType(column))}}}if(typeof settings.cell!=="undefined"){for(i in settings.cell){var cell=settings.cell[i];instance.setCellMetaObject(cell.row,cell.col,cell)}}Handsontable.hooks.run(instance,"afterCellMetaReset");if(typeof settings.className!=="undefined"){if(GridSettings.prototype.className){Handsontable.Dom.removeClass(instance.rootElement,GridSettings.prototype.className)}if(settings.className){Handsontable.Dom.addClass(instance.rootElement,settings.className)}}if(typeof settings.height!="undefined"){var height=settings.height;if(typeof height=="function"){height=height()}instance.rootElement.style.height=height+"px"}if(typeof settings.width!="undefined"){var width=settings.width;if(typeof width=="function"){width=width()}instance.rootElement.style.width=width+"px"}if(height){instance.rootElement.style.overflow="auto"}if(!init){Handsontable.hooks.run(instance,"afterUpdateSettings")}grid.adjustRowsAndCols();if(instance.view&&!priv.firstRun){instance.forceFullRender=true;selection.refreshBorders(null,true)}};this.getValue=function(){var sel=instance.getSelected();if(GridSettings.prototype.getValue){if(typeof GridSettings.prototype.getValue==="function"){return GridSettings.prototype.getValue.call(instance)}else{if(sel){return instance.getData()[sel[0]][GridSettings.prototype.getValue]}}}else{if(sel){return instance.getDataAtCell(sel[0],sel[1])}}};function expandType(obj){if(!obj.hasOwnProperty("type")){return}var type,expandedType={};if(typeof obj.type==="object"){type=obj.type}else{if(typeof obj.type==="string"){type=Handsontable.cellTypes[obj.type];if(type===void 0){throw new Error('You declared cell type "'+obj.type+'" as a string that is not mapped to a known object. Cell type must be an object or a string mapped to an object in Handsontable.cellTypes')}}}for(var i in type){if(type.hasOwnProperty(i)&&!obj.hasOwnProperty(i)){expandedType[i]=type[i]}}return expandedType}this.getSettings=function(){return priv.settings};this.clear=function(){selection.selectAll();selection.empty()};this.alter=function(action,index,amount,source,keepEmptyRows){grid.alter(action,index,amount,source,keepEmptyRows)};this.getCell=function(row,col,topmost){return instance.view.getCellAtCoords(new WalkontableCellCoords(row,col),topmost)};this.getCoords=function(elem){return this.view.wt.wtTable.getCoords.call(this.view.wt.wtTable,elem)};this.colToProp=function(col){return datamap.colToProp(col)};this.propToCol=function(prop){return datamap.propToCol(prop)};this.getDataAtCell=function(row,col){return datamap.get(row,datamap.colToProp(col))};this.getDataAtRowProp=function(row,prop){return datamap.get(row,prop)};this.getDataAtCol=function(col){var out=[];return out.concat.apply(out,datamap.getRange(new WalkontableCellCoords(0,col),new WalkontableCellCoords(priv.settings.data.length-1,col),datamap.DESTINATION_RENDERER))};this.getDataAtProp=function(prop){var out=[];return out.concat.apply(out,datamap.getRange(new WalkontableCellCoords(0,datamap.propToCol(prop)),new WalkontableCellCoords(priv.settings.data.length-1,datamap.propToCol(prop)),datamap.DESTINATION_RENDERER))};this.getSourceDataAtCol=function(col){var out=[],data=priv.settings.data;for(var i=0;i<data.length;i++){out.push(data[i][col])}return out};this.getSourceDataAtRow=function(row){return priv.settings.data[row]};this.getDataAtRow=function(row){var data=datamap.getRange(new WalkontableCellCoords(row,0),new WalkontableCellCoords(row,this.countCols()-1),datamap.DESTINATION_RENDERER);return data[0]};this.removeCellMeta=function(row,col,key){var cellMeta=instance.getCellMeta(row,col);if(cellMeta[key]!=undefined){delete priv.cellSettings[row][col][key]}};this.setCellMetaObject=function(row,col,prop){if(typeof prop==="object"){for(var key in prop){var value=prop[key];this.setCellMeta(row,col,key,value)}}};this.setCellMeta=function(row,col,key,val){if(!priv.cellSettings[row]){priv.cellSettings[row]=[]}if(!priv.cellSettings[row][col]){priv.cellSettings[row][col]=new priv.columnSettings[col]()}priv.cellSettings[row][col][key]=val;Handsontable.hooks.run(instance,"afterSetCellMeta",row,col,key,val)};this.getCellMeta=function(row,col){var prop=datamap.colToProp(col),cellProperties;row=translateRowIndex(row);col=translateColIndex(col);if(!priv.columnSettings[col]){priv.columnSettings[col]=Handsontable.helper.columnFactory(GridSettings,priv.columnsSettingConflicts)}if(!priv.cellSettings[row]){priv.cellSettings[row]=[]}if(!priv.cellSettings[row][col]){priv.cellSettings[row][col]=new priv.columnSettings[col]()}cellProperties=priv.cellSettings[row][col];cellProperties.row=row;cellProperties.col=col;cellProperties.prop=prop;cellProperties.instance=instance;Handsontable.hooks.run(instance,"beforeGetCellMeta",row,col,cellProperties);Handsontable.helper.extend(cellProperties,expandType(cellProperties));if(cellProperties.cells){var settings=cellProperties.cells.call(cellProperties,row,col,prop);if(settings){Handsontable.helper.extend(cellProperties,settings);Handsontable.helper.extend(cellProperties,expandType(settings))}}Handsontable.hooks.run(instance,"afterGetCellMeta",row,col,cellProperties);return cellProperties};function translateRowIndex(row){return Handsontable.hooks.execute(instance,"modifyRow",row)}function translateColIndex(col){return Handsontable.hooks.execute(instance,"modifyCol",col)}var rendererLookup=Handsontable.helper.cellMethodLookupFactory("renderer");this.getCellRenderer=function(row,col){var renderer=rendererLookup.call(this,row,col);return Handsontable.renderers.getRenderer(renderer)};this.getCellEditor=Handsontable.helper.cellMethodLookupFactory("editor");this.getCellValidator=Handsontable.helper.cellMethodLookupFactory("validator");this.validateCells=function(callback){var waitingForValidator=new ValidatorsQueue();waitingForValidator.onQueueEmpty=callback;var i=instance.countRows()-1;while(i>=0){var j=instance.countCols()-1;while(j>=0){waitingForValidator.addValidatorToQueue();instance.validateCell(instance.getDataAtCell(i,j),instance.getCellMeta(i,j),function(){waitingForValidator.removeValidatorFormQueue()},"validateCells");j--}i--}waitingForValidator.checkIfQueueIsEmpty()};this.getRowHeader=function(row){if(row===void 0){var out=[];for(var i=0,ilen=instance.countRows();i<ilen;i++){out.push(instance.getRowHeader(i))}return out}else{if(Object.prototype.toString.call(priv.settings.rowHeaders)==="[object Array]"&&priv.settings.rowHeaders[row]!==void 0){return priv.settings.rowHeaders[row]}else{if(typeof priv.settings.rowHeaders==="function"){return priv.settings.rowHeaders(row)}else{if(priv.settings.rowHeaders&&typeof priv.settings.rowHeaders!=="string"&&typeof priv.settings.rowHeaders!=="number"){return row+1}else{return priv.settings.rowHeaders}}}}};this.hasRowHeaders=function(){return !!priv.settings.rowHeaders};this.hasColHeaders=function(){if(priv.settings.colHeaders!==void 0&&priv.settings.colHeaders!==null){return !!priv.settings.colHeaders}for(var i=0,ilen=instance.countCols();i<ilen;i++){if(instance.getColHeader(i)){return true}}return false};this.getColHeader=function(col){if(col===void 0){var out=[];for(var i=0,ilen=instance.countCols();i<ilen;i++){out.push(instance.getColHeader(i))}return out}else{var baseCol=col;col=Handsontable.hooks.execute(instance,"modifyCol",col);if(priv.settings.columns&&priv.settings.columns[col]&&priv.settings.columns[col].title){return priv.settings.columns[col].title}else{if(Object.prototype.toString.call(priv.settings.colHeaders)==="[object Array]"&&priv.settings.colHeaders[col]!==void 0){return priv.settings.colHeaders[col]}else{if(typeof priv.settings.colHeaders==="function"){return priv.settings.colHeaders(col)}else{if(priv.settings.colHeaders&&typeof priv.settings.colHeaders!=="string"&&typeof priv.settings.colHeaders!=="number"){return Handsontable.helper.spreadsheetColumnLabel(baseCol)}else{return priv.settings.colHeaders}}}}}};this._getColWidthFromSettings=function(col){var cellProperties=instance.getCellMeta(0,col);var width=cellProperties.width;if(width===void 0||width===priv.settings.width){width=cellProperties.colWidths}if(width!==void 0&&width!==null){switch(typeof width){case"object":width=width[col];break;case"function":width=width(col);break}if(typeof width==="string"){width=parseInt(width,10)}}return width};this.getColWidth=function(col){var width=instance._getColWidthFromSettings(col);if(!width){width=50}width=Handsontable.hooks.execute(instance,"modifyColWidth",width,col);return width};this._getRowHeightFromSettings=function(row){var height=priv.settings.rowHeights;if(height!==void 0&&height!==null){switch(typeof height){case"object":height=height[row];break;case"function":height=height(row);break}if(typeof height==="string"){height=parseInt(height,10)}}return height};this.getRowHeight=function(row){var height=instance._getRowHeightFromSettings(row);height=Handsontable.hooks.execute(instance,"modifyRowHeight",height,row);return height};this.countRows=function(){return priv.settings.data.length};this.countCols=function(){if(instance.dataType==="object"||instance.dataType==="function"){if(priv.settings.columns&&priv.settings.columns.length){return priv.settings.columns.length}else{return datamap.colToPropCache.length}}else{if(instance.dataType==="array"){if(priv.settings.columns&&priv.settings.columns.length){return priv.settings.columns.length}else{if(priv.settings.data&&priv.settings.data[0]&&priv.settings.data[0].length){return priv.settings.data[0].length}else{return 0}}}}};this.rowOffset=function(){return instance.view.wt.wtTable.getFirstRenderedRow()};this.colOffset=function(){return instance.view.wt.wtTable.getFirstRenderedColumn()};this.countRenderedRows=function(){return instance.view.wt.drawn?instance.view.wt.wtTable.getRenderedRowsCount():-1};this.countVisibleRows=function(){return instance.view.wt.drawn?instance.view.wt.wtTable.getVisibleRowsCount():-1};this.countVisibleCols=function(){return instance.view.wt.drawn?instance.view.wt.wtTable.columnStrategy.countVisible():-1};this.countEmptyRows=function(ending){var i=instance.countRows()-1,empty=0,row;while(i>=0){row=Handsontable.hooks.execute(this,"modifyRow",i);if(instance.isEmptyRow(row)){empty++}else{if(ending){break}}i--}return empty};this.countEmptyCols=function(ending){if(instance.countRows()<1){return 0}var i=instance.countCols()-1,empty=0;while(i>=0){if(instance.isEmptyCol(i)){empty++}else{if(ending){break}}i--}return empty};this.isEmptyRow=function(r){return priv.settings.isEmptyRow.call(instance,r)};this.isEmptyCol=function(c){return priv.settings.isEmptyCol.call(instance,c)};this.selectCell=function(row,col,endRow,endCol,scrollToCell){if(typeof row!=="number"||row<0||row>=instance.countRows()){return false}if(typeof col!=="number"||col<0||col>=instance.countCols()){return false}if(typeof endRow!=="undefined"){if(typeof endRow!=="number"||endRow<0||endRow>=instance.countRows()){return false}if(typeof endCol!=="number"||endCol<0||endCol>=instance.countCols()){return false}}var coords=new WalkontableCellCoords(row,col);priv.selRange=new WalkontableCellRange(coords,coords,coords);if(document.activeElement&&document.activeElement!==document.documentElement&&document.activeElement!==document.body){document.activeElement.blur()}instance.listen();if(typeof endRow==="undefined"){selection.setRangeEnd(priv.selRange.from,scrollToCell)}else{selection.setRangeEnd(new WalkontableCellCoords(endRow,endCol),scrollToCell)}instance.selection.finish();return true};this.selectCellByProp=function(row,prop,endRow,endProp,scrollToCell){arguments[1]=datamap.propToCol(arguments[1]);if(typeof arguments[3]!=="undefined"){arguments[3]=datamap.propToCol(arguments[3])}return instance.selectCell.apply(instance,arguments)};this.deselectCell=function(){selection.deselect()};this.destroy=function(){instance._clearTimeouts();if(instance.view){instance.view.destroy()}Handsontable.Dom.empty(instance.rootElement);eventManager.clear();Handsontable.hooks.run(instance,"afterDestroy");Handsontable.hooks.destroy(instance);for(var i in instance){if(instance.hasOwnProperty(i)){if(typeof instance[i]==="function"){if(i!=="runHooks"&&i!=="runHooksAndReturn"){instance[i]=postMortem}}else{if(i!=="guid"){instance[i]=null}}}}priv=null;datamap=null;grid=null;selection=null;editorManager=null;instance=null;GridSettings=null};function postMortem(){throw new Error("This method cannot be called because this Handsontable instance has been destroyed")}this.getActiveEditor=function(){return editorManager.getActiveEditor()};this.getInstance=function(){return instance};this.addHook=function(key,fn){Handsontable.hooks.add(key,fn,instance)};this.addHookOnce=function(key,fn){Handsontable.hooks.once(key,fn,instance)};this.removeHook=function(key,fn){Handsontable.hooks.remove(key,fn,instance)};this.runHooks=function(key,p1,p2,p3,p4,p5,p6){Handsontable.hooks.run(instance,key,p1,p2,p3,p4,p5,p6)};this.runHooksAndReturn=function(key,p1,p2,p3,p4,p5,p6){return Handsontable.hooks.execute(instance,key,p1,p2,p3,p4,p5,p6)};this.timeouts=[];this._registerTimeout=function(handle){this.timeouts.push(handle)};this._clearTimeouts=function(){for(var i=0,ilen=this.timeouts.length;i<ilen;i++){clearTimeout(this.timeouts[i])}};this.version="0.12.1"};var DefaultSettings=function(){};DefaultSettings.prototype={data:void 0,dataSchema:void 0,width:void 0,height:void 0,startRows:5,startCols:5,rowHeaders:null,colHeaders:null,colWidths:void 0,columns:void 0,cells:void 0,cell:[],minRows:0,minCols:0,maxRows:Infinity,maxCols:Infinity,minSpareRows:0,minSpareCols:0,allowInsertRow:true,allowInsertColumn:true,allowRemoveRow:true,allowRemoveColumn:true,multiSelect:true,fillHandle:true,fixedRowsTop:0,fixedColumnsLeft:0,outsideClickDeselects:true,enterBeginsEditing:true,enterMoves:{row:1,col:0},tabMoves:{row:0,col:1},autoWrapRow:false,autoWrapCol:false,copyRowsLimit:1000,copyColsLimit:1000,pasteMode:"overwrite",currentRowClassName:void 0,currentColClassName:void 0,stretchH:"none",isEmptyRow:function(r){var val;for(var c=0,clen=this.countCols();c<clen;c++){val=this.getDataAtCell(r,c);if(val!==""&&val!==null&&typeof val!=="undefined"){return false}}return true},isEmptyCol:function(c){var val;for(var r=0,rlen=this.countRows();r<rlen;r++){val=this.getDataAtCell(r,c);if(val!==""&&val!==null&&typeof val!=="undefined"){return false}}return true},observeDOMVisibility:true,allowInvalid:true,invalidCellClassName:"htInvalid",placeholder:false,placeholderCellClassName:"htPlaceholder",readOnlyCellClassName:"htDimmed",commentedCellClassName:"htCommentCell",fragmentSelection:false,readOnly:false,type:"text",copyable:true,debug:false,wordWrap:true,noWordWrapClassName:"htNoWrap",contextMenu:void 0,undo:void 0,columnSorting:void 0,manualColumnMove:void 0,manualColumnResize:void 0,manualRowMove:void 0,manualRowResize:void 0,viewportRowRenderingOffset:10,groups:void 0};Handsontable.DefaultSettings=DefaultSettings;(function(window){function MultiMap(){var map={arrayMap:[],weakMap:new WeakMap()};return{get:function(key){if(canBeAnArrayMapKey(key)){return map.arrayMap[key]}else{if(canBeAWeakMapKey(key)){return map.weakMap.get(key)}}},set:function(key,value){if(canBeAnArrayMapKey(key)){map.arrayMap[key]=value}else{if(canBeAWeakMapKey(key)){map.weakMap.set(key,value)}else{throw new Error("Invalid key type")}}},"delete":function(key){if(canBeAnArrayMapKey(key)){delete map.arrayMap[key]}else{if(canBeAWeakMapKey(key)){map.weakMap["delete"](key)}}}};function canBeAnArrayMapKey(obj){return obj!==null&&!isNaNSymbol(obj)&&(typeof obj=="string"||typeof obj=="number")}function canBeAWeakMapKey(obj){return obj!==null&&(typeof obj=="object"||typeof obj=="function")}function isNaNSymbol(obj){return obj!==obj}}if(!window.MultiMap){window.MultiMap=MultiMap}})(window);if(!window.Handsontable){var Handsontable={}}Handsontable.Dom={};Handsontable.Dom.enableImmediatePropagation=function(event){if(event!=null&&event.isImmediatePropagationEnabled==null){event.stopImmediatePropagation=function(){this.isImmediatePropagationEnabled=false;this.cancelBubble=true};event.isImmediatePropagationEnabled=true;event.isImmediatePropagationStopped=function(){return !this.isImmediatePropagationEnabled}}};Handsontable.Dom.closest=function(elem,nodeNames,until){while(elem!=null&&elem!==until){if(elem.nodeType===1&&nodeNames.indexOf(elem.nodeName)>-1){return elem}elem=elem.parentNode}return null};Handsontable.Dom.isChildOf=function(child,parent){var node=child.parentNode;var queriedParents=[];if(typeof parent==="string"){queriedParents=Array.prototype.slice.call(document.querySelectorAll(parent),0)}else{queriedParents.push(parent)}while(node!=null){if(queriedParents.indexOf(node)>-1){return true}node=node.parentNode}return false};Handsontable.Dom.index=function(elem){var i=0;if(elem.previousSibling){while(elem=elem.previousSibling){++i}}return i};if(document.documentElement.classList){Handsontable.Dom.hasClass=function(ele,cls){return ele.classList.contains(cls)};Handsontable.Dom.addClass=function(ele,cls){if(cls){ele.classList.add(cls)}};Handsontable.Dom.removeClass=function(ele,cls){ele.classList.remove(cls)}}else{Handsontable.Dom.hasClass=function(ele,cls){return ele.className.match(new RegExp("(\\s|^)"+cls+"(\\s|$)"))};Handsontable.Dom.addClass=function(ele,cls){if(ele.className==""){ele.className=cls}else{if(!this.hasClass(ele,cls)){ele.className+=" "+cls}}};Handsontable.Dom.removeClass=function(ele,cls){if(this.hasClass(ele,cls)){var reg=new RegExp("(\\s|^)"+cls+"(\\s|$)");ele.className=ele.className.replace(reg," ").trim()}}}Handsontable.Dom.removeTextNodes=function(elem,parent){if(elem.nodeType===3){parent.removeChild(elem)}else{if(["TABLE","THEAD","TBODY","TFOOT","TR"].indexOf(elem.nodeName)>-1){var childs=elem.childNodes;for(var i=childs.length-1;i>=0;i--){this.removeTextNodes(childs[i],elem)}}}};Handsontable.Dom.empty=function(element){var child;while(child=element.lastChild){element.removeChild(child)}};Handsontable.Dom.HTML_CHARACTERS=/(<(.*)>|&(.*);)/;Handsontable.Dom.fastInnerHTML=function(element,content){if(this.HTML_CHARACTERS.test(content)){element.innerHTML=content}else{this.fastInnerText(element,content)}};if(document.createTextNode("test").textContent){Handsontable.Dom.fastInnerText=function(element,content){var child=element.firstChild;if(child&&child.nodeType===3&&child.nextSibling===null){child.textContent=content}else{this.empty(element);element.appendChild(document.createTextNode(content))}}}else{Handsontable.Dom.fastInnerText=function(element,content){var child=element.firstChild;if(child&&child.nodeType===3&&child.nextSibling===null){child.data=content}else{this.empty(element);element.appendChild(document.createTextNode(content))}}}Handsontable.Dom.isVisible=function(elem){var next=elem;while(next!==document.documentElement){if(next===null){return false}else{if(next.nodeType===11){if(next.host){if(next.host.impl){return Handsontable.Dom.isVisible(next.host.impl)}else{if(next.host){return Handsontable.Dom.isVisible(next.host)}else{throw new Error("Lost in Web Components world")}}}else{return false}}else{if(next.style.display==="none"){return false}}}next=next.parentNode}return true};Handsontable.Dom.offset=function(elem){if(this.hasCaptionProblem()&&elem.firstChild&&elem.firstChild.nodeName==="CAPTION"){var box=elem.getBoundingClientRect();return{top:box.top+(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0),left:box.left+(window.pageXOffset||document.documentElement.scrollLeft)-(document.documentElement.clientLeft||0)}}var offsetLeft=elem.offsetLeft,offsetTop=elem.offsetTop,lastElem=elem;while(elem=elem.offsetParent){if(elem===document.body){break}offsetLeft+=elem.offsetLeft;offsetTop+=elem.offsetTop;lastElem=elem}if(lastElem&&lastElem.style.position==="fixed"){offsetLeft+=window.pageXOffset||document.documentElement.scrollLeft;offsetTop+=window.pageYOffset||document.documentElement.scrollTop}return{left:offsetLeft,top:offsetTop}};Handsontable.Dom.getWindowScrollTop=function(){var res=window.scrollY;if(res==void 0){res=document.documentElement.scrollTop}return res};Handsontable.Dom.getWindowScrollLeft=function(){var res=window.scrollX;if(res==void 0){res=document.documentElement.scrollLeft}return res};Handsontable.Dom.getScrollTop=function(elem){if(elem===window){return Handsontable.Dom.getWindowScrollTop(elem)}else{return elem.scrollTop}};Handsontable.Dom.getScrollLeft=function(elem){if(elem===window){return Handsontable.Dom.getWindowScrollLeft(elem)}else{return elem.scrollLeft}};Handsontable.Dom.getComputedStyle=function(elem){return elem.currentStyle||document.defaultView.getComputedStyle(elem)};Handsontable.Dom.outerWidth=function(elem){return elem.offsetWidth};Handsontable.Dom.outerHeight=function(elem){if(this.hasCaptionProblem()&&elem.firstChild&&elem.firstChild.nodeName==="CAPTION"){return elem.offsetHeight+elem.firstChild.offsetHeight}else{return elem.offsetHeight}};Handsontable.Dom.innerHeight=function(elem){return elem.clientHeight||elem.innerHeight};Handsontable.Dom.innerWidth=function(elem){return elem.clientWidth||elem.innerWidth};Handsontable.Dom.addEvent=function(element,event,callback){if(window.addEventListener){element.addEventListener(event,callback,false)}else{element.attachEvent("on"+event,callback)}};Handsontable.Dom.removeEvent=function(element,event,callback){if(window.removeEventListener){element.removeEventListener(event,callback,false)}else{element.detachEvent("on"+event,callback)}};(function(){var hasCaptionProblem;function detectCaptionProblem(){var TABLE=document.createElement("TABLE");TABLE.style.borderSpacing=0;TABLE.style.borderWidth=0;TABLE.style.padding=0;var TBODY=document.createElement("TBODY");TABLE.appendChild(TBODY);TBODY.appendChild(document.createElement("TR"));TBODY.firstChild.appendChild(document.createElement("TD"));TBODY.firstChild.firstChild.innerHTML="<tr><td>t<br>t</td></tr>";var CAPTION=document.createElement("CAPTION");CAPTION.innerHTML="c<br>c<br>c<br>c";CAPTION.style.padding=0;CAPTION.style.margin=0;TABLE.insertBefore(CAPTION,TBODY);document.body.appendChild(TABLE);hasCaptionProblem=(TABLE.offsetHeight<2*TABLE.lastChild.offsetHeight);document.body.removeChild(TABLE)}Handsontable.Dom.hasCaptionProblem=function(){if(hasCaptionProblem===void 0){detectCaptionProblem()}return hasCaptionProblem};Handsontable.Dom.getCaretPosition=function(el){if(el.selectionStart){return el.selectionStart}else{if(document.selection){el.focus();var r=document.selection.createRange();if(r==null){return 0}var re=el.createTextRange(),rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint("EndToStart",re);return rc.text.length}}return 0};Handsontable.Dom.getSelectionEndPosition=function(el){if(el.selectionEnd){return el.selectionEnd}else{if(document.selection){var r=document.selection.createRange();if(r==null){return 0}var re=el.createTextRange();return re.text.indexOf(r.text)+r.text.length}}};Handsontable.Dom.setCaretPosition=function(el,pos,endPos){if(endPos===void 0){endPos=pos}if(el.setSelectionRange){el.focus();el.setSelectionRange(pos,endPos)}else{if(el.createTextRange){var range=el.createTextRange();range.collapse(true);range.moveEnd("character",endPos);range.moveStart("character",pos);range.select()}}};var cachedScrollbarWidth;function walkontableCalculateScrollbarWidth(){var inner=document.createElement("p");inner.style.width="100%";inner.style.height="200px";var outer=document.createElement("div");outer.style.position="absolute";outer.style.top="0px";outer.style.left="0px";outer.style.visibility="hidden";outer.style.width="200px";outer.style.height="150px";outer.style.overflow="hidden";outer.appendChild(inner);(document.body||document.documentElement).appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow="scroll";var w2=inner.offsetWidth;if(w1==w2){w2=outer.clientWidth}(document.body||document.documentElement).removeChild(outer);return(w1-w2)}Handsontable.Dom.getScrollbarWidth=function(){if(cachedScrollbarWidth===void 0){cachedScrollbarWidth=walkontableCalculateScrollbarWidth()}return cachedScrollbarWidth};var isIE8=!(document.createTextNode("test").textContent);Handsontable.Dom.isIE8=function(){return isIE8};var isIE9=!!(document.documentMode);Handsontable.Dom.isIE9=function(){return isIE9};var isSafari=(/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor));Handsontable.Dom.isSafari=function(){return isSafari};Handsontable.Dom.setOverlayPosition=function(overlayElem,left,top){if(isIE8||isIE9){overlayElem.style.top=top;overlayElem.style.left=left}else{if(isSafari){overlayElem.style["-webkit-transform"]="translate3d("+left+","+top+",0)"}else{overlayElem.style.transform="translate3d("+left+","+top+",0)"}}};Handsontable.Dom.getCssTransform=function(elem){var transform;if(elem.style.transform&&(transform=elem.style.transform)!=""){return["transform",transform]}else{if(elem.style["-webkit-transform"]&&(transform=elem.style["-webkit-transform"])!=""){return["-webkit-transform",transform]}else{return -1}}};Handsontable.Dom.resetCssTransform=function(elem){if(elem.transform&&elem.transform!=""){elem.transform=""}else{if(elem["-webkit-transform"]&&elem["-webkit-transform"]!=""){elem["-webkit-transform"]=""}}}})();if(!window.Handsontable){var Handsontable={}}Handsontable.countEventManagerListeners=0;Handsontable.eventManager=function(instance){if(!instance){throw new Error("instance not defined")}if(!instance.eventListeners){instance.eventListeners=[]}var addEvent=function(element,event,callback){var callbackProxy=function(event){if(event.target==void 0&&event.srcElement!=void 0){if(event.definePoperty){event.definePoperty("target",{value:event.srcElement})}else{event.target=event.srcElement}}if(event.preventDefault==void 0){if(event.definePoperty){event.definePoperty("preventDefault",{value:function(){this.returnValue=false}})}else{event.preventDefault=function(){this.returnValue=false}}}callback.call(this,event)};instance.eventListeners.push({element:element,event:event,callback:callback,callbackProxy:callbackProxy});if(window.addEventListener){element.addEventListener(event,callbackProxy,false)}else{element.attachEvent("on"+event,callbackProxy)}Handsontable.countEventManagerListeners++},removeEvent=function(element,event,callback){var len=instance.eventListeners.length;while(len--){var tmpEv=instance.eventListeners[len];if(tmpEv.event==event&&tmpEv.element==element){if(callback&&callback!=tmpEv.callback){continue}instance.eventListeners.splice(len,1);if(tmpEv.element.removeEventListener){tmpEv.element.removeEventListener(tmpEv.event,tmpEv.callbackProxy,false)}else{tmpEv.element.detachEvent("on"+tmpEv.event,tmpEv.callbackProxy)}Handsontable.countEventManagerListeners--}}},clearEvents=function(){var len=instance.eventListeners.length;while(len--){var event=instance.eventListeners[len];removeEvent(event.element,event.event,event.callback)}},fireEvent=function(element,type){var options={bubbles:true,cancelable:(type!=="mousemove"),view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,button:0,relatedTarget:undefined};var event;if(document.createEvent){event=document.createEvent("MouseEvents");event.initMouseEvent(type,options.bubbles,options.cancelable,options.view,options.detail,options.screenX,options.screenY,options.clientX,options.clientY,options.ctrlKey,options.altKey,options.shiftKey,options.metaKey,options.button,options.relatedTarget||document.body.parentNode)}else{event=document.createEventObject()}if(element.dispatchEvent){element.dispatchEvent(event)}else{element.fireEvent("on"+type,event)}};return{addEventListener:addEvent,removeEventListener:removeEvent,clear:clearEvents,fireEvent:fireEvent}};Handsontable.TableView=function(instance){var that=this;this.eventManager=Handsontable.eventManager(instance);this.instance=instance;this.settings=instance.getSettings();var originalStyle=instance.rootElement.getAttribute("style");if(originalStyle){instance.rootElement.setAttribute("data-originalstyle",originalStyle)}Handsontable.Dom.addClass(instance.rootElement,"handsontable");var table=document.createElement("TABLE");table.className="htCore";this.THEAD=document.createElement("THEAD");table.appendChild(this.THEAD);this.TBODY=document.createElement("TBODY");table.appendChild(this.TBODY);instance.table=table;instance.container.insertBefore(table,instance.container.firstChild);this.eventManager.addEventListener(instance.rootElement,"mousedown",function(event){if(!that.isTextSelectionAllowed(event.target)){clearTextSelection();event.preventDefault();window.focus()}});this.eventManager.addEventListener(document.documentElement,"keyup",function(event){if(instance.selection.isInProgress()&&!event.shiftKey){instance.selection.finish()}});var isMouseDown;this.isMouseDown=function(){return isMouseDown};this.eventManager.addEventListener(document.documentElement,"mouseup",function(event){if(instance.selection.isInProgress()&&event.which===1){instance.selection.finish()}isMouseDown=false;if(Handsontable.helper.isOutsideInput(document.activeElement)){instance.unlisten()}});this.eventManager.addEventListener(document.documentElement,"mousedown",function(event){var next=event.target;if(isMouseDown){return}if(next!==that.wt.wtTable.spreader){while(next!==document.documentElement){if(next===null){return}if(next===instance.rootElement){return}next=next.parentNode}}if(that.settings.outsideClickDeselects){instance.deselectCell()}else{instance.destroyEditor()}});this.eventManager.addEventListener(table,"selectstart",function(event){if(that.settings.fragmentSelection){return}event.preventDefault()});var clearTextSelection=function(){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else{if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}}else{if(document.selection){document.selection.empty()}}};var selections=[new WalkontableSelection({className:"current",border:{width:2,color:"#5292F7",cornerVisible:function(){return that.settings.fillHandle&&!that.isCellEdited()&&!instance.selection.isMultiple()},multipleSelectionHandlesVisible:function(){return !that.isCellEdited()&&!instance.selection.isMultiple()}}}),new WalkontableSelection({className:"area",border:{width:1,color:"#89AFF9",cornerVisible:function(){return that.settings.fillHandle&&!that.isCellEdited()&&instance.selection.isMultiple()},multipleSelectionHandlesVisible:function(){return !that.isCellEdited()&&instance.selection.isMultiple()}}}),new WalkontableSelection({className:"highlight",highlightRowClassName:that.settings.currentRowClassName,highlightColumnClassName:that.settings.currentColClassName}),new WalkontableSelection({className:"fill",border:{width:1,color:"red"}})];selections.current=selections[0];selections.area=selections[1];selections.highlight=selections[2];selections.fill=selections[3];var walkontableConfig={debug:function(){return that.settings.debug},table:table,stretchH:this.settings.stretchH,data:instance.getDataAtCell,totalRows:instance.countRows,totalColumns:instance.countCols,fixedColumnsLeft:function(){return that.settings.fixedColumnsLeft},fixedRowsTop:function(){return that.settings.fixedRowsTop},renderAllRows:that.settings.renderAllRows,rowHeaders:function(){var arr=[];if(instance.hasRowHeaders()){arr.push(function(index,TH){that.appendRowHeader(index,TH)})}Handsontable.hooks.run(instance,"afterGetRowHeaderRenderers",arr);return arr},columnHeaders:function(){var arr=[];if(instance.hasColHeaders()){arr.push(function(index,TH){that.appendColHeader(index,TH)})}Handsontable.hooks.run(instance,"afterGetColumnHeaderRenderers",arr);return arr},columnWidth:instance.getColWidth,rowHeight:instance.getRowHeight,cellRenderer:function(row,col,TD){var prop=that.instance.colToProp(col),cellProperties=that.instance.getCellMeta(row,col),renderer=that.instance.getCellRenderer(cellProperties);var value=that.instance.getDataAtRowProp(row,prop);renderer(that.instance,TD,row,col,prop,value,cellProperties);Handsontable.hooks.run(that.instance,"afterRenderer",TD,row,col,prop,value,cellProperties)},selections:selections,hideBorderOnMouseDownOver:function(){return that.settings.fragmentSelection},onCellMouseDown:function(event,coords,TD,wt){instance.listen();that.activeWt=wt;isMouseDown=true;Handsontable.hooks.run(instance,"beforeOnCellMouseDown",event,coords,TD);Handsontable.Dom.enableImmediatePropagation(event);if(!event.isImmediatePropagationStopped()){if(event.button===2&&instance.selection.inInSelection(coords)){}else{if(event.shiftKey){if(coords.row>=0&&coords.col>=0){instance.selection.setRangeEnd(coords)}}else{if(coords.row<0||coords.col<0){if(coords.row<0){instance.selectCell(0,coords.col,instance.countRows()-1,coords.col);instance.selection.setSelectedHeaders(false,true)}if(coords.col<0){instance.selectCell(coords.row,0,coords.row,instance.countCols()-1);instance.selection.setSelectedHeaders(true,false)}}else{instance.selection.setRangeStart(coords)}}}Handsontable.hooks.run(instance,"afterOnCellMouseDown",event,coords,TD);that.activeWt=that.wt}},onCellMouseOver:function(event,coords,TD,wt){that.activeWt=wt;if(coords.row>=0&&coords.col>=0){if(isMouseDown){instance.selection.setRangeEnd(coords)}}else{if(isMouseDown){if(coords.row<0){instance.selection.setRangeEnd(new WalkontableCellCoords(instance.countRows()-1,coords.col));instance.selection.setSelectedHeaders(false,true)}if(coords.col<0){instance.selection.setRangeEnd(new WalkontableCellCoords(coords.row,instance.countCols()-1));instance.selection.setSelectedHeaders(true,false)}}}Handsontable.hooks.run(instance,"afterOnCellMouseOver",event,coords,TD);that.activeWt=that.wt},onCellCornerMouseDown:function(event){event.preventDefault();Handsontable.hooks.run(instance,"afterOnCellCornerMouseDown",event)},beforeDraw:function(force){that.beforeRender(force)},onDraw:function(force){that.onDraw(force)},onScrollVertically:function(){instance.runHooks("afterScrollVertically")},onScrollHorizontally:function(){instance.runHooks("afterScrollHorizontally")},onBeforeDrawBorders:function(corners,borderClassName){instance.runHooks("beforeDrawBorders",corners,borderClassName)},onBeforeTouchScroll:function(){instance.runHooks("beforeTouchScroll")},onAfterMomentumScroll:function(){instance.runHooks("afterMomentumScroll")},viewportRowCalculatorOverride:function(calc){if(that.settings.viewportRowRenderingOffset){calc.renderStartRow=Math.max(calc.renderStartRow-that.settings.viewportRowRenderingOffset,0);calc.renderEndRow=Math.min(calc.renderEndRow+that.settings.viewportRowRenderingOffset,instance.countRows()-1)}instance.runHooks("afterViewportRowCalculatorOverride",calc)}};Handsontable.hooks.run(instance,"beforeInitWalkontable",walkontableConfig);this.wt=new Walkontable(walkontableConfig);this.activeWt=this.wt;this.eventManager.addEventListener(that.wt.wtTable.spreader,"mousedown",function(event){if(event.target===that.wt.wtTable.spreader&&event.which===3){Handsontable.helper.stopPropagation(event)}});this.eventManager.addEventListener(that.wt.wtTable.spreader,"contextmenu",function(event){if(event.target===that.wt.wtTable.spreader&&event.which===3){Handsontable.helper.stopPropagation(event)}});this.eventManager.addEventListener(document.documentElement,"click",function(){if(that.settings.observeDOMVisibility){if(that.wt.drawInterrupted){that.instance.forceFullRender=true;that.render()}}})};Handsontable.TableView.prototype.isTextSelectionAllowed=function(el){if(Handsontable.helper.isInput(el)){return(true)}if(this.settings.fragmentSelection&&Handsontable.Dom.isChildOf(el,this.TBODY)){return(true)}return false};Handsontable.TableView.prototype.isCellEdited=function(){var activeEditor=this.instance.getActiveEditor();return activeEditor&&activeEditor.isOpened()};Handsontable.TableView.prototype.beforeRender=function(force){if(force){Handsontable.hooks.run(this.instance,"beforeRender",this.instance.forceFullRender)}};Handsontable.TableView.prototype.onDraw=function(force){if(force){Handsontable.hooks.run(this.instance,"afterRender",this.instance.forceFullRender)}};Handsontable.TableView.prototype.render=function(){this.wt.draw(!this.instance.forceFullRender);this.instance.forceFullRender=false};Handsontable.TableView.prototype.getCellAtCoords=function(coords,topmost){var td=this.wt.getCell(coords,topmost);if(td<0){return null}else{return td}};Handsontable.TableView.prototype.scrollViewport=function(coords){this.wt.scrollViewport(coords)};Handsontable.TableView.prototype.appendRowHeader=function(row,TH){var DIV=document.createElement("DIV"),SPAN=document.createElement("SPAN");DIV.className="relative";SPAN.className="rowHeader";if(row>-1){Handsontable.Dom.fastInnerHTML(SPAN,this.instance.getRowHeader(row))}else{Handsontable.Dom.fastInnerText(SPAN,"\u00A0")}DIV.appendChild(SPAN);Handsontable.Dom.empty(TH);TH.appendChild(DIV);Handsontable.hooks.run(this.instance,"afterGetRowHeader",row,TH)};Handsontable.TableView.prototype.appendColHeader=function(col,TH){var DIV=document.createElement("DIV"),SPAN=document.createElement("SPAN");DIV.className="relative";SPAN.className="colHeader";if(col>-1){Handsontable.Dom.fastInnerHTML(SPAN,this.instance.getColHeader(col))}else{Handsontable.Dom.fastInnerText(SPAN,"\u00A0")}DIV.appendChild(SPAN);Handsontable.Dom.empty(TH);TH.appendChild(DIV);Handsontable.hooks.run(this.instance,"afterGetColHeader",col,TH)};Handsontable.TableView.prototype.maximumVisibleElementWidth=function(leftOffset){var workspaceWidth=this.wt.wtViewport.getWorkspaceWidth();var maxWidth=workspaceWidth-leftOffset;return maxWidth>0?maxWidth:0};Handsontable.TableView.prototype.maximumVisibleElementHeight=function(topOffset){var workspaceHeight=this.wt.wtViewport.getWorkspaceHeight();var maxHeight=workspaceHeight-topOffset;return maxHeight>0?maxHeight:0};Handsontable.TableView.prototype.mainViewIsActive=function(){return this.wt===this.activeWt};Handsontable.TableView.prototype.destroy=function(){this.wt.destroy();this.eventManager.clear()};(function(Handsontable){function RegisteredEditor(editorClass){var clazz,instances;instances={};clazz=editorClass;this.getInstance=function(hotInstance){if(!(hotInstance.guid in instances)){instances[hotInstance.guid]=new clazz(hotInstance)}return instances[hotInstance.guid]}}var registeredEditorNames={};var registeredEditorClasses=new WeakMap();Handsontable.editors={registerEditor:function(editorName,editorClass){var editor=new RegisteredEditor(editorClass);if(typeof editorName==="string"){registeredEditorNames[editorName]=editor}registeredEditorClasses.set(editorClass,editor)},getEditor:function(editorName,hotInstance){var editor;if(typeof editorName=="function"){if(!(registeredEditorClasses.get(editorName))){this.registerEditor(null,editorName)}editor=registeredEditorClasses.get(editorName)}else{if(typeof editorName=="string"){editor=registeredEditorNames[editorName]}else{throw Error('Only strings and functions can be passed as "editor" parameter ')}}if(!editor){throw Error('No editor registered under name "'+editorName+'"')}return editor.getInstance(hotInstance)}}})(Handsontable);(function(Handsontable){Handsontable.EditorManager=function(instance,priv,selection){var that=this;var keyCodes=Handsontable.helper.keyCode;var destroyed=false;var eventManager=Handsontable.eventManager(instance);var activeEditor;var init=function(){function onKeyDown(event){if(!instance.isListening()){return}Handsontable.hooks.run(instance,"beforeKeyDown",event);if(destroyed){return}Handsontable.Dom.enableImmediatePropagation(event);if(!event.isImmediatePropagationStopped()){priv.lastKeyCode=event.keyCode;if(selection.isSelected()){var ctrlDown=(event.ctrlKey||event.metaKey)&&!event.altKey;if(!activeEditor.isWaiting()){if(!Handsontable.helper.isMetaKey(event.keyCode)&&!ctrlDown&&!that.isEditorOpened()){that.openEditor("");return}}var rangeModifier=event.shiftKey?selection.setRangeEnd:selection.setRangeStart;switch(event.keyCode){case keyCodes.A:if(ctrlDown){selection.selectAll();event.preventDefault();Handsontable.helper.stopPropagation(event)}break;case keyCodes.ARROW_UP:if(that.isEditorOpened()&&!activeEditor.isWaiting()){that.closeEditorAndSaveChanges(ctrlDown)}moveSelectionUp(event.shiftKey);event.preventDefault();Handsontable.helper.stopPropagation(event);break;case keyCodes.ARROW_DOWN:if(that.isEditorOpened()&&!activeEditor.isWaiting()){that.closeEditorAndSaveChanges(ctrlDown)}moveSelectionDown(event.shiftKey);event.preventDefault();Handsontable.helper.stopPropagation(event);break;case keyCodes.ARROW_RIGHT:if(that.isEditorOpened()&&!activeEditor.isWaiting()){that.closeEditorAndSaveChanges(ctrlDown)}moveSelectionRight(event.shiftKey);event.preventDefault();Handsontable.helper.stopPropagation(event);break;case keyCodes.ARROW_LEFT:if(that.isEditorOpened()&&!activeEditor.isWaiting()){that.closeEditorAndSaveChanges(ctrlDown)}moveSelectionLeft(event.shiftKey);event.preventDefault();Handsontable.helper.stopPropagation(event);break;case keyCodes.TAB:var tabMoves=typeof priv.settings.tabMoves==="function"?priv.settings.tabMoves(event):priv.settings.tabMoves;if(event.shiftKey){selection.transformStart(-tabMoves.row,-tabMoves.col)}else{selection.transformStart(tabMoves.row,tabMoves.col,true)}event.preventDefault();Handsontable.helper.stopPropagation(event);break;case keyCodes.BACKSPACE:case keyCodes.DELETE:selection.empty(event);that.prepareEditor();event.preventDefault();break;case keyCodes.F2:that.openEditor();event.preventDefault();break;case keyCodes.ENTER:if(that.isEditorOpened()){if(activeEditor.state!==Handsontable.EditorState.WAITING){that.closeEditorAndSaveChanges(ctrlDown)}moveSelectionAfterEnter(event.shiftKey)}else{if(instance.getSettings().enterBeginsEditing){that.openEditor()}else{moveSelectionAfterEnter(event.shiftKey)}}event.preventDefault();event.stopImmediatePropagation();break;case keyCodes.ESCAPE:if(that.isEditorOpened()){that.closeEditorAndRestoreOriginalValue(ctrlDown)}event.preventDefault();break;case keyCodes.HOME:if(event.ctrlKey||event.metaKey){rangeModifier(new WalkontableCellCoords(0,priv.selRange.from.col))}else{rangeModifier(new WalkontableCellCoords(priv.selRange.from.row,0))}event.preventDefault();Handsontable.helper.stopPropagation(event);break;case keyCodes.END:if(event.ctrlKey||event.metaKey){rangeModifier(new WalkontableCellCoords(instance.countRows()-1,priv.selRange.from.col))}else{rangeModifier(new WalkontableCellCoords(priv.selRange.from.row,instance.countCols()-1))}event.preventDefault();Handsontable.helper.stopPropagation(event);break;case keyCodes.PAGE_UP:selection.transformStart(-instance.countVisibleRows(),0);event.preventDefault();Handsontable.helper.stopPropagation(event);break;case keyCodes.PAGE_DOWN:selection.transformStart(instance.countVisibleRows(),0);event.preventDefault();Handsontable.helper.stopPropagation(event);break}}}}instance.addHook("afterDocumentKeyDown",function(originalEvent){onKeyDown(originalEvent)});eventManager.addEventListener(document,"keydown",function(ev){instance.runHooks("afterDocumentKeyDown",ev)});function onDblClick(event,coords,elem){if(elem.nodeName=="TD"){that.openEditor()}}instance.view.wt.update("onCellDblClick",onDblClick);instance.addHook("afterDestroy",function(){destroyed=true});function moveSelectionAfterEnter(shiftKey){var enterMoves=typeof priv.settings.enterMoves==="function"?priv.settings.enterMoves(event):priv.settings.enterMoves;if(shiftKey){selection.transformStart(-enterMoves.row,-enterMoves.col)}else{selection.transformStart(enterMoves.row,enterMoves.col,true)}}function moveSelectionUp(shiftKey){if(shiftKey){selection.transformEnd(-1,0)}else{selection.transformStart(-1,0)}}function moveSelectionDown(shiftKey){if(shiftKey){selection.transformEnd(1,0)}else{selection.transformStart(1,0)}}function moveSelectionRight(shiftKey){if(shiftKey){selection.transformEnd(0,1)}else{selection.transformStart(0,1)}}function moveSelectionLeft(shiftKey){if(shiftKey){selection.transformEnd(0,-1)}else{selection.transformStart(0,-1)}}};this.destroyEditor=function(revertOriginal){this.closeEditor(revertOriginal)};this.getActiveEditor=function(){return activeEditor};this.prepareEditor=function(){if(activeEditor&&activeEditor.isWaiting()){this.closeEditor(false,false,function(dataSaved){if(dataSaved){that.prepareEditor()}});return}var row=priv.selRange.highlight.row;var col=priv.selRange.highlight.col;var prop=instance.colToProp(col);var td=instance.getCell(row,col);var originalValue=instance.getDataAtCell(row,col);var cellProperties=instance.getCellMeta(row,col);var editorClass=instance.getCellEditor(cellProperties);activeEditor=Handsontable.editors.getEditor(editorClass,instance);activeEditor.prepare(row,col,prop,td,originalValue,cellProperties)};this.isEditorOpened=function(){return activeEditor.isOpened()};this.openEditor=function(initialValue){if(!activeEditor.cellProperties.readOnly){activeEditor.beginEditing(initialValue)}};this.closeEditor=function(restoreOriginalValue,ctrlDown,callback){if(!activeEditor){if(callback){callback(false)}}else{activeEditor.finishEditing(restoreOriginalValue,ctrlDown,callback)}};this.closeEditorAndSaveChanges=function(ctrlDown){return this.closeEditor(false,ctrlDown)};this.closeEditorAndRestoreOriginalValue=function(ctrlDown){return this.closeEditor(true,ctrlDown)};init()}})(Handsontable);(function(Handsontable){var registeredRenderers={};Handsontable.renderers={registerRenderer:function(rendererName,rendererFunction){registeredRenderers[rendererName]=rendererFunction},getRenderer:function(rendererName){if(typeof rendererName=="function"){return rendererName}if(typeof rendererName!="string"){throw Error('Only strings and functions can be passed as "renderer" parameter ')}if(!(rendererName in registeredRenderers)){throw Error('No editor registered under name "'+rendererName+'"')}return registeredRenderers[rendererName]}}})(Handsontable);Handsontable.helper.isPrintableChar=function(keyCode){return((keyCode==32)||(keyCode>=48&&keyCode<=57)||(keyCode>=96&&keyCode<=111)||(keyCode>=186&&keyCode<=192)||(keyCode>=219&&keyCode<=222)||keyCode>=226||(keyCode>=65&&keyCode<=90))};Handsontable.helper.isMetaKey=function(keyCode){var keyCodes=Handsontable.helper.keyCode;var metaKeys=[keyCodes.ARROW_DOWN,keyCodes.ARROW_UP,keyCodes.ARROW_LEFT,keyCodes.ARROW_RIGHT,keyCodes.HOME,keyCodes.END,keyCodes.DELETE,keyCodes.BACKSPACE,keyCodes.F1,keyCodes.F2,keyCodes.F3,keyCodes.F4,keyCodes.F5,keyCodes.F6,keyCodes.F7,keyCodes.F8,keyCodes.F9,keyCodes.F10,keyCodes.F11,keyCodes.F12,keyCodes.TAB,keyCodes.PAGE_DOWN,keyCodes.PAGE_UP,keyCodes.ENTER,keyCodes.ESCAPE,keyCodes.SHIFT,keyCodes.CAPS_LOCK,keyCodes.ALT];return metaKeys.indexOf(keyCode)!=-1};Handsontable.helper.isCtrlKey=function(keyCode){var keys=Handsontable.helper.keyCode;return[keys.CONTROL_LEFT,224,keys.COMMAND_LEFT,keys.COMMAND_RIGHT].indexOf(keyCode)!=-1};Handsontable.helper.stringify=function(value){switch(typeof value){case"string":case"number":return value+"";case"object":if(value===null){return""}else{return value.toString()}case"undefined":return"";default:return value.toString()}};Handsontable.helper.spreadsheetColumnLabel=function(index){var dividend=index+1;var columnLabel="";var modulo;while(dividend>0){modulo=(dividend-1)%26;columnLabel=String.fromCharCode(65+modulo)+columnLabel;dividend=parseInt((dividend-modulo)/26,10)}return columnLabel};Handsontable.helper.isNumeric=function(n){var t=typeof n;return t=="number"?!isNaN(n)&&isFinite(n):t=="string"?!n.length?false:n.length==1?/\d/.test(n):/^\s*[+-]?\s*(?:(?:\d+(?:\.\d+)?(?:e[+-]?\d+)?)|(?:0x[a-f\d]+))\s*$/i.test(n):t=="object"?!!n&&typeof n.valueOf()=="number"&&!(n instanceof Date):false};Handsontable.helper.isDescendant=function(parent,child){var node=child.parentNode;while(node!=null){if(node==parent){return true}node=node.parentNode}return false};Handsontable.helper.randomString=function(){return walkontableRandomString()};Handsontable.helper.inherit=function(Child,Parent){Parent.prototype.constructor=Parent;Child.prototype=new Parent();Child.prototype.constructor=Child;return Child};Handsontable.helper.extend=function(target,extension){for(var i in extension){if(extension.hasOwnProperty(i)){target[i]=extension[i]}}};Handsontable.helper.deepExtend=function(target,extension){for(var key in extension){if(extension.hasOwnProperty(key)){if(extension[key]&&typeof extension[key]==="object"){if(!target[key]){if(Handsontable.helper.isArray(extension[key])){target[key]=[]}else{target[key]={}}}Handsontable.helper.deepExtend(target[key],extension[key])}else{target[key]=extension[key]}}}};Handsontable.helper.deepClone=function(obj){if(typeof obj==="object"){return JSON.parse(JSON.stringify(obj))}else{return obj}};Handsontable.helper.getPrototypeOf=function(obj){var prototype;if(typeof obj.__proto__=="object"){prototype=obj.__proto__}else{var oldConstructor,constructor=obj.constructor;if(typeof obj.constructor=="function"){oldConstructor=constructor;if(delete obj.constructor){constructor=obj.constructor;obj.constructor=oldConstructor}}prototype=constructor?constructor.prototype:null}return prototype};Handsontable.helper.columnFactory=function(GridSettings,conflictList){function ColumnSettings(){}Handsontable.helper.inherit(ColumnSettings,GridSettings);for(var i=0,len=conflictList.length;i<len;i++){ColumnSettings.prototype[conflictList[i]]=void 0}return ColumnSettings};Handsontable.helper.translateRowsToColumns=function(input){var i,ilen,j,jlen,output=[],olen=0;for(i=0,ilen=input.length;i<ilen;i++){for(j=0,jlen=input[i].length;j<jlen;j++){if(j==olen){output.push([]);olen++}output[j].push(input[i][j])}}return output};Handsontable.helper.to2dArray=function(arr){var i=0,ilen=arr.length;while(i<ilen){arr[i]=[arr[i]];i++}};Handsontable.helper.extendArray=function(arr,extension){var i=0,ilen=extension.length;while(i<ilen){arr.push(extension[i]);i++}};Handsontable.helper.isInput=function(element){var inputs=["INPUT","SELECT","TEXTAREA"];return inputs.indexOf(element.nodeName)>-1};Handsontable.helper.isOutsideInput=function(element){return Handsontable.helper.isInput(element)&&element.className.indexOf("handsontableInput")==-1};Handsontable.helper.keyCode={MOUSE_LEFT:1,MOUSE_RIGHT:3,MOUSE_MIDDLE:2,BACKSPACE:8,COMMA:188,INSERT:45,DELETE:46,END:35,ENTER:13,ESCAPE:27,CONTROL_LEFT:91,COMMAND_LEFT:17,COMMAND_RIGHT:93,ALT:18,HOME:36,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,SPACE:32,SHIFT:16,CAPS_LOCK:20,TAB:9,ARROW_RIGHT:39,ARROW_LEFT:37,ARROW_UP:38,ARROW_DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,A:65,X:88,C:67,V:86};Handsontable.helper.isObject=function(obj){return Object.prototype.toString.call(obj)=="[object Object]"};Handsontable.helper.isArray=function(obj){return Array.isArray?Array.isArray(obj):Object.prototype.toString.call(obj)=="[object Array]"};Handsontable.helper.pivot=function(arr){var pivotedArr=[];if(!arr||arr.length==0||!arr[0]||arr[0].length==0){return pivotedArr}var rowCount=arr.length;var colCount=arr[0].length;for(var i=0;i<rowCount;i++){for(var j=0;j<colCount;j++){if(!pivotedArr[j]){pivotedArr[j]=[]}pivotedArr[j][i]=arr[i][j]}}return pivotedArr};Handsontable.helper.proxy=function(fun,context){return function(){return fun.apply(context,arguments)}};Handsontable.helper.cellMethodLookupFactory=function(methodName,allowUndefined){allowUndefined=typeof allowUndefined=="undefined"?true:allowUndefined;return function cellMethodLookup(row,col){return(function getMethodFromProperties(properties){if(!properties){return}else{if(properties.hasOwnProperty(methodName)&&properties[methodName]!==void 0){return properties[methodName]}else{if(properties.hasOwnProperty("type")&&properties.type){var type;if(typeof properties.type!="string"){throw new Error("Cell type must be a string ")}type=translateTypeNameToObject(properties.type);if(type.hasOwnProperty(methodName)){return type[methodName]}else{if(allowUndefined){return}}}}}return getMethodFromProperties(Handsontable.helper.getPrototypeOf(properties))})(typeof row=="number"?this.getCellMeta(row,col):row)};function translateTypeNameToObject(typeName){var type=Handsontable.cellTypes[typeName];if(typeof type=="undefined"){throw new Error('You declared cell type "'+typeName+'" as a string that is not mapped to a known object. Cell type must be an object or a string mapped to an object in Handsontable.cellTypes')}return type}};Handsontable.helper.toString=function(obj){return""+obj};Handsontable.helper.isMobileBrowser=function(userAgent){if(!userAgent){userAgent=navigator.userAgent}return(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent))};Handsontable.helper.isTouchSupported=function(){return("ontouchstart" in window)};Handsontable.helper.stopPropagation=function(event){if(typeof(event.stopPropagation)==="function"){event.stopPropagation()}else{event.cancelBubble=true}};Handsontable.helper.pageX=function(event){if(event.pageX){return event.pageX}var scrollLeft=Handsontable.Dom.getWindowScrollLeft();var cursorX=event.clientX+scrollLeft;return cursorX};Handsontable.helper.pageY=function(event){if(event.pageY){return event.pageY}var scrollTop=Handsontable.Dom.getWindowScrollTop();var cursorY=event.clientY+scrollTop;return cursorY};(function(Handsontable){Handsontable.DataMap=function(instance,priv,GridSettings){this.instance=instance;this.priv=priv;this.GridSettings=GridSettings;this.dataSource=this.instance.getSettings().data;if(this.dataSource[0]){this.duckSchema=this.recursiveDuckSchema(this.dataSource[0])}else{this.duckSchema={}}this.createMap()};Handsontable.DataMap.prototype.DESTINATION_RENDERER=1;Handsontable.DataMap.prototype.DESTINATION_CLIPBOARD_GENERATOR=2;Handsontable.DataMap.prototype.recursiveDuckSchema=function(obj){var schema;if(!Handsontable.helper.isArray(obj)){schema={};for(var i in obj){if(obj.hasOwnProperty(i)){if(typeof obj[i]==="object"&&!Handsontable.helper.isArray(obj[i])){schema[i]=this.recursiveDuckSchema(obj[i])}else{schema[i]=null}}}}else{schema=[]}return schema};Handsontable.DataMap.prototype.recursiveDuckColumns=function(schema,lastCol,parent){var prop,i;if(typeof lastCol==="undefined"){lastCol=0;parent=""}if(typeof schema==="object"&&!Handsontable.helper.isArray(schema)){for(i in schema){if(schema.hasOwnProperty(i)){if(schema[i]===null){prop=parent+i;this.colToPropCache.push(prop);this.propToColCache.set(prop,lastCol);lastCol++}else{lastCol=this.recursiveDuckColumns(schema[i],lastCol,i+".")}}}}return lastCol};Handsontable.DataMap.prototype.createMap=function(){var i,ilen,schema=this.getSchema();if(typeof schema==="undefined"){throw new Error("trying to create `columns` definition but you didnt' provide `schema` nor `data`")}this.colToPropCache=[];this.propToColCache=new MultiMap();var columns=this.instance.getSettings().columns;if(columns){for(i=0,ilen=columns.length;i<ilen;i++){if(typeof columns[i].data!="undefined"){this.colToPropCache[i]=columns[i].data;this.propToColCache.set(columns[i].data,i)}}}else{this.recursiveDuckColumns(schema)}};Handsontable.DataMap.prototype.colToProp=function(col){col=Handsontable.hooks.execute(this.instance,"modifyCol",col);if(this.colToPropCache&&typeof this.colToPropCache[col]!=="undefined"){return this.colToPropCache[col]}else{return col}};Handsontable.DataMap.prototype.propToCol=function(prop){var col;if(typeof this.propToColCache.get(prop)!=="undefined"){col=this.propToColCache.get(prop)}else{col=prop}col=Handsontable.hooks.execute(this.instance,"modifyCol",col);return col};Handsontable.DataMap.prototype.getSchema=function(){var schema=this.instance.getSettings().dataSchema;if(schema){if(typeof schema==="function"){return schema()}return schema}return this.duckSchema};Handsontable.DataMap.prototype.createRow=function(index,amount,createdAutomatically){var row,colCount=this.instance.countCols(),numberOfCreatedRows=0,currentIndex;if(!amount){amount=1}if(typeof index!=="number"||index>=this.instance.countRows()){index=this.instance.countRows()}currentIndex=index;var maxRows=this.instance.getSettings().maxRows;while(numberOfCreatedRows<amount&&this.instance.countRows()<maxRows){if(this.instance.dataType==="array"){row=[];for(var c=0;c<colCount;c++){row.push(null)}}else{if(this.instance.dataType==="function"){row=this.instance.getSettings().dataSchema(index)}else{row={};Handsontable.helper.deepExtend(row,this.getSchema())}}if(index===this.instance.countRows()){this.dataSource.push(row)}else{this.dataSource.splice(index,0,row)}numberOfCreatedRows++;currentIndex++}Handsontable.hooks.run(this.instance,"afterCreateRow",index,numberOfCreatedRows,createdAutomatically);this.instance.forceFullRender=true;return numberOfCreatedRows};Handsontable.DataMap.prototype.createCol=function(index,amount,createdAutomatically){if(this.instance.dataType==="object"||this.instance.getSettings().columns){throw new Error("Cannot create new column. When data source in an object, you can only have as much columns as defined in first data row, data schema or in the 'columns' setting.If you want to be able to add new columns, you have to use array datasource.")}var rlen=this.instance.countRows(),data=this.dataSource,constructor,numberOfCreatedCols=0,currentIndex;if(!amount){amount=1}currentIndex=index;var maxCols=this.instance.getSettings().maxCols;while(numberOfCreatedCols<amount&&this.instance.countCols()<maxCols){constructor=Handsontable.helper.columnFactory(this.GridSettings,this.priv.columnsSettingConflicts);if(typeof index!=="number"||index>=this.instance.countCols()){for(var r=0;r<rlen;r++){if(typeof data[r]==="undefined"){data[r]=[]}data[r].push(null)}this.priv.columnSettings.push(constructor)}else{for(var r=0;r<rlen;r++){data[r].splice(currentIndex,0,null)}this.priv.columnSettings.splice(currentIndex,0,constructor)}numberOfCreatedCols++;currentIndex++}Handsontable.hooks.run(this.instance,"afterCreateCol",index,numberOfCreatedCols,createdAutomatically);this.instance.forceFullRender=true;return numberOfCreatedCols};Handsontable.DataMap.prototype.removeRow=function(index,amount){if(!amount){amount=1}if(typeof index!=="number"){index=-amount}index=(this.instance.countRows()+index)%this.instance.countRows();var logicRows=this.physicalRowsToLogical(index,amount);var actionWasNotCancelled=Handsontable.hooks.execute(this.instance,"beforeRemoveRow",index,amount);if(actionWasNotCancelled===false){return}var data=this.dataSource;var newData=data.filter(function(row,index){return logicRows.indexOf(index)==-1});data.length=0;Array.prototype.push.apply(data,newData);Handsontable.hooks.run(this.instance,"afterRemoveRow",index,amount);this.instance.forceFullRender=true};Handsontable.DataMap.prototype.removeCol=function(index,amount){if(this.instance.dataType==="object"||this.instance.getSettings().columns){throw new Error("cannot remove column with object data source or columns option specified")}if(!amount){amount=1}if(typeof index!=="number"){index=-amount}index=(this.instance.countCols()+index)%this.instance.countCols();var actionWasNotCancelled=Handsontable.hooks.execute(this.instance,"beforeRemoveCol",index,amount);if(actionWasNotCancelled===false){return}var data=this.dataSource;for(var r=0,rlen=this.instance.countRows();r<rlen;r++){data[r].splice(index,amount)}this.priv.columnSettings.splice(index,amount);Handsontable.hooks.run(this.instance,"afterRemoveCol",index,amount);this.instance.forceFullRender=true};Handsontable.DataMap.prototype.spliceCol=function(col,index,amount){var elements=4<=arguments.length?[].slice.call(arguments,3):[];var colData=this.instance.getDataAtCol(col);var removed=colData.slice(index,index+amount);var after=colData.slice(index+amount);Handsontable.helper.extendArray(elements,after);var i=0;while(i<amount){elements.push(null);i++}Handsontable.helper.to2dArray(elements);this.instance.populateFromArray(index,col,elements,null,null,"spliceCol");return removed};Handsontable.DataMap.prototype.spliceRow=function(row,index,amount){var elements=4<=arguments.length?[].slice.call(arguments,3):[];var rowData=this.instance.getSourceDataAtRow(row);var removed=rowData.slice(index,index+amount);var after=rowData.slice(index+amount);Handsontable.helper.extendArray(elements,after);var i=0;while(i<amount){elements.push(null);i++}this.instance.populateFromArray(row,index,[elements],null,null,"spliceRow");return removed};Handsontable.DataMap.prototype.get=function(row,prop){row=Handsontable.hooks.execute(this.instance,"modifyRow",row);if(typeof prop==="string"&&prop.indexOf(".")>-1){var sliced=prop.split(".");var out=this.dataSource[row];if(!out){return null}for(var i=0,ilen=sliced.length;i<ilen;i++){out=out[sliced[i]];if(typeof out==="undefined"){return null}}return out}else{if(typeof prop==="function"){return prop(this.dataSource.slice(row,row+1)[0])}else{return this.dataSource[row]?this.dataSource[row][prop]:null}}};var copyableLookup=Handsontable.helper.cellMethodLookupFactory("copyable",false);Handsontable.DataMap.prototype.getCopyable=function(row,prop){if(copyableLookup.call(this.instance,row,this.propToCol(prop))){return this.get(row,prop)}return""};Handsontable.DataMap.prototype.set=function(row,prop,value,source){row=Handsontable.hooks.execute(this.instance,"modifyRow",row,source||"datamapGet");if(typeof prop==="string"&&prop.indexOf(".")>-1){var sliced=prop.split(".");var out=this.dataSource[row];for(var i=0,ilen=sliced.length-1;i<ilen;i++){if(typeof out[sliced[i]]==="undefined"){out[sliced[i]]={}}out=out[sliced[i]]}out[sliced[i]]=value}else{if(typeof prop==="function"){prop(this.dataSource.slice(row,row+1)[0],value)}else{this.dataSource[row][prop]=value}}};Handsontable.DataMap.prototype.physicalRowsToLogical=function(index,amount){var totalRows=this.instance.countRows();var physicRow=(totalRows+index)%totalRows;var logicRows=[];var rowsToRemove=amount;var row;while(physicRow<totalRows&&rowsToRemove){row=Handsontable.hooks.execute(this.instance,"modifyRow",physicRow);logicRows.push(row);rowsToRemove--;physicRow++}return logicRows};Handsontable.DataMap.prototype.clear=function(){for(var r=0;r<this.instance.countRows();r++){for(var c=0;c<this.instance.countCols();c++){this.set(r,this.colToProp(c),"")}}};Handsontable.DataMap.prototype.getAll=function(){return this.dataSource};Handsontable.DataMap.prototype.getRange=function(start,end,destination){var r,rlen,c,clen,output=[],row;var getFn=destination===this.DESTINATION_CLIPBOARD_GENERATOR?this.getCopyable:this.get;rlen=Math.max(start.row,end.row);clen=Math.max(start.col,end.col);for(r=Math.min(start.row,end.row);r<=rlen;r++){row=[];for(c=Math.min(start.col,end.col);c<=clen;c++){row.push(getFn.call(this,r,this.colToProp(c)))}output.push(row)}return output};Handsontable.DataMap.prototype.getText=function(start,end){return SheetClip.stringify(this.getRange(start,end,this.DESTINATION_RENDERER))};Handsontable.DataMap.prototype.getCopyableText=function(start,end){return SheetClip.stringify(this.getRange(start,end,this.DESTINATION_CLIPBOARD_GENERATOR))}})(Handsontable);(function(Handsontable){Handsontable.renderers.cellDecorator=function(instance,TD,row,col,prop,value,cellProperties){if(cellProperties.className){if(TD.className){TD.className=TD.className+" "+cellProperties.className}else{TD.className=cellProperties.className}}if(cellProperties.readOnly){Handsontable.Dom.addClass(TD,cellProperties.readOnlyCellClassName)}if(cellProperties.valid===false&&cellProperties.invalidCellClassName){Handsontable.Dom.addClass(TD,cellProperties.invalidCellClassName)}if(cellProperties.wordWrap===false&&cellProperties.noWordWrapClassName){Handsontable.Dom.addClass(TD,cellProperties.noWordWrapClassName)}if(!value&&cellProperties.placeholder){Handsontable.Dom.addClass(TD,cellProperties.placeholderCellClassName)}}})(Handsontable);(function(Handsontable){var TextRenderer=function(instance,TD,row,col,prop,value,cellProperties){Handsontable.renderers.cellDecorator.apply(this,arguments);if(!value&&cellProperties.placeholder){value=cellProperties.placeholder}var escaped=Handsontable.helper.stringify(value);if(cellProperties.rendererTemplate){Handsontable.Dom.empty(TD);var TEMPLATE=document.createElement("TEMPLATE");TEMPLATE.setAttribute("bind","{{}}");TEMPLATE.innerHTML=cellProperties.rendererTemplate;HTMLTemplateElement.decorate(TEMPLATE);TEMPLATE.model=instance.getSourceDataAtRow(row);TD.appendChild(TEMPLATE)}else{Handsontable.Dom.fastInnerText(TD,escaped)}};Handsontable.renderers.TextRenderer=TextRenderer;Handsontable.renderers.registerRenderer("text",TextRenderer)})(Handsontable);(function(Handsontable){var clonableWRAPPER=document.createElement("DIV");clonableWRAPPER.className="htAutocompleteWrapper";var clonableARROW=document.createElement("DIV");clonableARROW.className="htAutocompleteArrow";clonableARROW.appendChild(document.createTextNode("\u25BC"));var wrapTdContentWithWrapper=function(TD,WRAPPER){WRAPPER.innerHTML=TD.innerHTML;Handsontable.Dom.empty(TD);TD.appendChild(WRAPPER)};var AutocompleteRenderer=function(instance,TD,row,col,prop,value,cellProperties){var WRAPPER=clonableWRAPPER.cloneNode(true);var ARROW=clonableARROW.cloneNode(true);Handsontable.renderers.TextRenderer(instance,TD,row,col,prop,value,cellProperties);TD.appendChild(ARROW);Handsontable.Dom.addClass(TD,"htAutocomplete");if(!TD.firstChild){TD.appendChild(document.createTextNode("\u00A0"))}if(!instance.acArrowListener){var eventManager=Handsontable.eventManager(instance);instance.acArrowListener=function(event){if(Handsontable.Dom.hasClass(event.target,"htAutocompleteArrow")){instance.view.wt.getSetting("onCellDblClick",null,new WalkontableCellCoords(row,col),TD)}};eventManager.addEventListener(instance.rootElement,"mousedown",instance.acArrowListener);instance.addHookOnce("afterDestroy",function(){eventManager.clear()})}};Handsontable.AutocompleteRenderer=AutocompleteRenderer;Handsontable.renderers.AutocompleteRenderer=AutocompleteRenderer;Handsontable.renderers.registerRenderer("autocomplete",AutocompleteRenderer)})(Handsontable);(function(Handsontable){var clonableINPUT=document.createElement("INPUT");clonableINPUT.className="htCheckboxRendererInput";clonableINPUT.type="checkbox";clonableINPUT.setAttribute("autocomplete","off");var CheckboxRenderer=function(instance,TD,row,col,prop,value,cellProperties){var eventManager=Handsontable.eventManager(instance);if(typeof cellProperties.checkedTemplate==="undefined"){cellProperties.checkedTemplate=true}if(typeof cellProperties.uncheckedTemplate==="undefined"){cellProperties.uncheckedTemplate=false}Handsontable.Dom.empty(TD);var INPUT=clonableINPUT.cloneNode(false);if(value===cellProperties.checkedTemplate||value===Handsontable.helper.stringify(cellProperties.checkedTemplate)){INPUT.checked=true;TD.appendChild(INPUT)}else{if(value===cellProperties.uncheckedTemplate||value===Handsontable.helper.stringify(cellProperties.uncheckedTemplate)){TD.appendChild(INPUT)}else{if(value===null){INPUT.className+=" noValue";TD.appendChild(INPUT)}else{Handsontable.Dom.fastInnerText(TD,"#bad value#")}}}if(cellProperties.readOnly){eventManager.addEventListener(INPUT,"click",function(event){event.preventDefault()})}else{eventManager.addEventListener(INPUT,"mousedown",function(event){Handsontable.helper.stopPropagation(event)});eventManager.addEventListener(INPUT,"mouseup",function(event){Handsontable.helper.stopPropagation(event)});eventManager.addEventListener(INPUT,"change",function(){if(this.checked){instance.setDataAtRowProp(row,prop,cellProperties.checkedTemplate)}else{instance.setDataAtRowProp(row,prop,cellProperties.uncheckedTemplate)}})}if(!instance.CheckboxRenderer||!instance.CheckboxRenderer.beforeKeyDownHookBound){instance.CheckboxRenderer={beforeKeyDownHookBound:true};instance.addHook("beforeKeyDown",function(event){Handsontable.Dom.enableImmediatePropagation(event);if(event.keyCode==Handsontable.helper.keyCode.SPACE||event.keyCode==Handsontable.helper.keyCode.ENTER){var cell,checkbox,cellProperties;var selRange=instance.getSelectedRange();var topLeft=selRange.getTopLeftCorner();var bottomRight=selRange.getBottomRightCorner();for(var row=topLeft.row;row<=bottomRight.row;row++){for(var col=topLeft.col;col<=bottomRight.col;col++){cell=instance.getCell(row,col);cellProperties=instance.getCellMeta(row,col);checkbox=cell.querySelectorAll("input[type=checkbox]");if(checkbox.length>0&&!cellProperties.readOnly){if(!event.isImmediatePropagationStopped()){event.stopImmediatePropagation();event.preventDefault()}for(var i=0,len=checkbox.length;i<len;i++){checkbox[i].checked=!checkbox[i].checked;eventManager.fireEvent(checkbox[i],"change")}}}}}})}};Handsontable.CheckboxRenderer=CheckboxRenderer;Handsontable.renderers.CheckboxRenderer=CheckboxRenderer;Handsontable.renderers.registerRenderer("checkbox",CheckboxRenderer)})(Handsontable);(function(Handsontable){var NumericRenderer=function(instance,TD,row,col,prop,value,cellProperties){if(Handsontable.helper.isNumeric(value)){if(typeof cellProperties.language!=="undefined"){numeral.language(cellProperties.language)}value=numeral(value).format(cellProperties.format||"0");Handsontable.Dom.addClass(TD,"htNumeric")}Handsontable.renderers.TextRenderer(instance,TD,row,col,prop,value,cellProperties)};Handsontable.NumericRenderer=NumericRenderer;Handsontable.renderers.NumericRenderer=NumericRenderer;Handsontable.renderers.registerRenderer("numeric",NumericRenderer)})(Handsontable);(function(Handosntable){var PasswordRenderer=function(instance,TD,row,col,prop,value,cellProperties){Handsontable.renderers.TextRenderer.apply(this,arguments);value=TD.innerHTML;var hash;var hashLength=cellProperties.hashLength||value.length;var hashSymbol=cellProperties.hashSymbol||"*";for(hash="";hash.split(hashSymbol).length-1<hashLength;hash+=hashSymbol){}Handsontable.Dom.fastInnerHTML(TD,hash)};Handosntable.PasswordRenderer=PasswordRenderer;Handosntable.renderers.PasswordRenderer=PasswordRenderer;Handosntable.renderers.registerRenderer("password",PasswordRenderer)})(Handsontable);(function(Handsontable){function HtmlRenderer(instance,TD,row,col,prop,value,cellProperties){Handsontable.renderers.cellDecorator.apply(this,arguments);Handsontable.Dom.fastInnerHTML(TD,value)}Handsontable.renderers.registerRenderer("html",HtmlRenderer);Handsontable.renderers.HtmlRenderer=HtmlRenderer})(Handsontable);(function(Handsontable){Handsontable.EditorState={VIRGIN:"STATE_VIRGIN",EDITING:"STATE_EDITING",WAITING:"STATE_WAITING",FINISHED:"STATE_FINISHED"};function BaseEditor(instance){this.instance=instance;this.state=Handsontable.EditorState.VIRGIN;this._opened=false;this._closeCallback=null;this.init()}BaseEditor.prototype._fireCallbacks=function(result){if(this._closeCallback){this._closeCallback(result);this._closeCallback=null}};BaseEditor.prototype.init=function(){};BaseEditor.prototype.getValue=function(){throw Error("Editor getValue() method unimplemented")};BaseEditor.prototype.setValue=function(newValue){throw Error("Editor setValue() method unimplemented")};BaseEditor.prototype.open=function(){throw Error("Editor open() method unimplemented")};BaseEditor.prototype.close=function(){throw Error("Editor close() method unimplemented")};BaseEditor.prototype.prepare=function(row,col,prop,td,originalValue,cellProperties){this.TD=td;this.row=row;this.col=col;this.prop=prop;this.originalValue=originalValue;this.cellProperties=cellProperties;this.state=Handsontable.EditorState.VIRGIN};BaseEditor.prototype.extend=function(){var baseClass=this.constructor;function Editor(){baseClass.apply(this,arguments)}function inherit(Child,Parent){function Bridge(){}Bridge.prototype=Parent.prototype;Child.prototype=new Bridge();Child.prototype.constructor=Child;return Child}return inherit(Editor,baseClass)};BaseEditor.prototype.saveValue=function(val,ctrlDown){if(ctrlDown){var sel=this.instance.getSelected(),tmp;if(sel[0]>sel[2]){tmp=sel[0];sel[0]=sel[2];sel[2]=tmp}if(sel[1]>sel[3]){tmp=sel[1];sel[1]=sel[3];sel[3]=tmp}this.instance.populateFromArray(sel[0],sel[1],val,sel[2],sel[3],"edit")}else{this.instance.populateFromArray(this.row,this.col,val,null,null,"edit")}};BaseEditor.prototype.beginEditing=function(initialValue){if(this.state!=Handsontable.EditorState.VIRGIN){return}this.instance.view.scrollViewport(new WalkontableCellCoords(this.row,this.col));this.instance.view.render();this.state=Handsontable.EditorState.EDITING;initialValue=typeof initialValue=="string"?initialValue:this.originalValue;this.setValue(Handsontable.helper.stringify(initialValue));this.open();this._opened=true;this.focus();this.instance.view.render()};BaseEditor.prototype.finishEditing=function(restoreOriginalValue,ctrlDown,callback){if(callback){var previousCloseCallback=this._closeCallback;this._closeCallback=function(result){if(previousCloseCallback){previousCloseCallback(result)}callback(result)}}if(this.isWaiting()){return}if(this.state==Handsontable.EditorState.VIRGIN){var that=this;this.instance._registerTimeout(setTimeout(function(){that._fireCallbacks(true)},0));return}if(this.state==Handsontable.EditorState.EDITING){if(restoreOriginalValue){this.cancelChanges();return}var val=[[String.prototype.trim.call(this.getValue())]];this.state=Handsontable.EditorState.WAITING;this.saveValue(val,ctrlDown);if(this.instance.getCellValidator(this.cellProperties)){var that=this;this.instance.addHookOnce("afterValidate",function(result){that.state=Handsontable.EditorState.FINISHED;that.discardEditor(result)})}else{this.state=Handsontable.EditorState.FINISHED;this.discardEditor(true)}}};BaseEditor.prototype.cancelChanges=function(){this.state=Handsontable.EditorState.FINISHED;this.discardEditor()};BaseEditor.prototype.discardEditor=function(result){if(this.state!==Handsontable.EditorState.FINISHED){return}if(result===false&&this.cellProperties.allowInvalid!==true){this.instance.selectCell(this.row,this.col);this.focus();this.state=Handsontable.EditorState.EDITING;this._fireCallbacks(false)}else{this.close();this._opened=false;this.state=Handsontable.EditorState.VIRGIN;this._fireCallbacks(true)}};BaseEditor.prototype.isOpened=function(){return this._opened};BaseEditor.prototype.isWaiting=function(){return this.state===Handsontable.EditorState.WAITING};Handsontable.editors.BaseEditor=BaseEditor})(Handsontable);(function(Handsontable){var TextEditor=Handsontable.editors.BaseEditor.prototype.extend();TextEditor.prototype.init=function(){var that=this;this.createElements();this.eventManager=new Handsontable.eventManager(this);this.bindEvents();this.autoResize=autoResize();this.instance.addHook("afterDestroy",function(){that.destroy()})};TextEditor.prototype.getValue=function(){return this.TEXTAREA.value};TextEditor.prototype.setValue=function(newValue){this.TEXTAREA.value=newValue};var onBeforeKeyDown=function onBeforeKeyDown(event){var instance=this;var that=instance.getActiveEditor();var keyCodes=Handsontable.helper.keyCode;var ctrlDown=(event.ctrlKey||event.metaKey)&&!event.altKey;Handsontable.Dom.enableImmediatePropagation(event);if(event.target!==that.TEXTAREA||event.isImmediatePropagationStopped()){return}if(event.keyCode===17||event.keyCode===224||event.keyCode===91||event.keyCode===93){event.stopImmediatePropagation();return}switch(event.keyCode){case keyCodes.ARROW_RIGHT:if(Handsontable.Dom.getCaretPosition(that.TEXTAREA)!==that.TEXTAREA.value.length){event.stopImmediatePropagation()}break;case keyCodes.ARROW_LEFT:if(Handsontable.Dom.getCaretPosition(that.TEXTAREA)!==0){event.stopImmediatePropagation()}break;case keyCodes.ENTER:var selected=that.instance.getSelected();var isMultipleSelection=!(selected[0]===selected[2]&&selected[1]===selected[3]);if((ctrlDown&&!isMultipleSelection)||event.altKey){if(that.isOpened()){that.setValue(that.getValue()+"\n");that.focus()}else{that.beginEditing(that.originalValue+"\n")}event.stopImmediatePropagation()}event.preventDefault();break;case keyCodes.A:case keyCodes.X:case keyCodes.C:case keyCodes.V:if(ctrlDown){event.stopImmediatePropagation()}break;case keyCodes.BACKSPACE:case keyCodes.DELETE:case keyCodes.HOME:case keyCodes.END:event.stopImmediatePropagation();break}};TextEditor.prototype.open=function(){this.refreshDimensions();this.instance.addHook("beforeKeyDown",onBeforeKeyDown)};TextEditor.prototype.close=function(){this.textareaParentStyle.display="none";this.autoResize.unObserve();if(document.activeElement===this.TEXTAREA){this.instance.listen()}this.instance.removeHook("beforeKeyDown",onBeforeKeyDown)};TextEditor.prototype.focus=function(){this.TEXTAREA.focus();Handsontable.Dom.setCaretPosition(this.TEXTAREA,this.TEXTAREA.value.length)};TextEditor.prototype.createElements=function(){this.TEXTAREA=document.createElement("TEXTAREA");Handsontable.Dom.addClass(this.TEXTAREA,"handsontableInput");this.textareaStyle=this.TEXTAREA.style;this.textareaStyle.width=0;this.textareaStyle.height=0;this.TEXTAREA_PARENT=document.createElement("DIV");Handsontable.Dom.addClass(this.TEXTAREA_PARENT,"handsontableInputHolder");this.textareaParentStyle=this.TEXTAREA_PARENT.style;this.textareaParentStyle.top=0;this.textareaParentStyle.left=0;this.textareaParentStyle.display="none";this.TEXTAREA_PARENT.appendChild(this.TEXTAREA);this.instance.rootElement.appendChild(this.TEXTAREA_PARENT);var that=this;this.instance._registerTimeout(setTimeout(function(){that.refreshDimensions()},0))};TextEditor.prototype.checkEditorSection=function(){if(this.row<this.instance.getSettings().fixedRowsTop){if(this.col<this.instance.getSettings().fixedColumnsLeft){return"corner"}else{return"top"}}else{if(this.col<this.instance.getSettings().fixedColumnsLeft){return"left"}}};TextEditor.prototype.getEditedCell=function(){var editorSection=this.checkEditorSection(),editedCell;switch(editorSection){case"top":editedCell=this.instance.view.wt.wtScrollbars.vertical.clone.wtTable.getCell({row:this.row,col:this.col});this.textareaParentStyle.zIndex=101;break;case"corner":editedCell=this.instance.view.wt.wtScrollbars.corner.clone.wtTable.getCell({row:this.row,col:this.col});this.textareaParentStyle.zIndex=103;break;case"left":editedCell=this.instance.view.wt.wtScrollbars.horizontal.clone.wtTable.getCell({row:this.row,col:this.col});this.textareaParentStyle.zIndex=102;break;default:editedCell=this.instance.getCell(this.row,this.col);this.textareaParentStyle.zIndex="";break}return editedCell!=-1&&editedCell!=-2?editedCell:void 0};TextEditor.prototype.refreshDimensions=function(){if(this.state!==Handsontable.EditorState.EDITING){return}this.TD=this.getEditedCell();if(!this.TD){return}var currentOffset=Handsontable.Dom.offset(this.TD);var containerOffset=Handsontable.Dom.offset(this.instance.rootElement);var editTop=currentOffset.top-containerOffset.top-1;var editLeft=currentOffset.left-containerOffset.left-1;var settings=this.instance.getSettings();var rowHeadersCount=settings.rowHeaders===false?0:1;var colHeadersCount=settings.colHeaders===false?0:1;var editorSection=this.checkEditorSection();var cssTransformOffset;switch(editorSection){case"top":cssTransformOffset=Handsontable.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.vertical.clone.wtTable.holder.parentNode);break;case"left":cssTransformOffset=Handsontable.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.horizontal.clone.wtTable.holder.parentNode);break;case"corner":cssTransformOffset=Handsontable.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.corner.clone.wtTable.holder.parentNode);break}if(editTop<0){editTop=0}if(editLeft<0){editLeft=0}if(rowHeadersCount>0&&parseInt(this.TD.style.borderTopWidth,10)>0){editTop+=1}if(colHeadersCount>0&&parseInt(this.TD.style.borderLeftWidth,10)>0){editLeft+=1}if(cssTransformOffset&&cssTransformOffset!=-1){this.textareaParentStyle[cssTransformOffset[0]]=cssTransformOffset[1]}else{Handsontable.Dom.resetCssTransform(this.textareaParentStyle)}this.textareaParentStyle.top=editTop+"px";this.textareaParentStyle.left=editLeft+"px";var cellTopOffset=this.TD.offsetTop-this.instance.view.wt.wtScrollbars.vertical.getScrollPosition(),cellLeftOffset=this.TD.offsetLeft-this.instance.view.wt.wtScrollbars.horizontal.getScrollPosition();var width=Handsontable.Dom.innerWidth(this.TD)-8,maxWidth=this.instance.view.maximumVisibleElementWidth(cellLeftOffset)-10,height=Handsontable.Dom.outerHeight(this.TD)-4,maxHeight=this.instance.view.maximumVisibleElementHeight(cellTopOffset)-2;if(parseInt(this.TD.style.borderTopWidth,10)>0){height-=1}if(parseInt(this.TD.style.borderLeftWidth,10)>0){if(rowHeadersCount>0){width-=1}}this.TEXTAREA.style.fontSize=Handsontable.Dom.getComputedStyle(this.TD).fontSize;this.TEXTAREA.style.fontFamily=Handsontable.Dom.getComputedStyle(this.TD).fontFamily;this.autoResize.init(this.TEXTAREA,{minHeight:Math.min(height,maxHeight),maxHeight:maxHeight,minWidth:Math.min(width,maxWidth),maxWidth:maxWidth});this.textareaParentStyle.display="block"};TextEditor.prototype.bindEvents=function(){var editor=this;this.eventManager.addEventListener(this.TEXTAREA,"cut",function(event){Handsontable.helper.stopPropagation(event)});this.eventManager.addEventListener(this.TEXTAREA,"paste",function(event){Handsontable.helper.stopPropagation(event)});this.instance.addHook("afterScrollVertically",function(){editor.refreshDimensions()});this.instance.addHook("afterDestroy",function(){editor.eventManager.clear()})};TextEditor.prototype.destroy=function(){this.eventManager.clear()};Handsontable.editors.TextEditor=TextEditor;Handsontable.editors.registerEditor("text",Handsontable.editors.TextEditor)})(Handsontable);(function(Handsontable){var MobileTextEditor=Handsontable.editors.BaseEditor.prototype.extend();var domDimensionsCache={};var createControls=function(){this.controls={};this.controls.leftButton=document.createElement("DIV");this.controls.leftButton.className="leftButton";this.controls.rightButton=document.createElement("DIV");this.controls.rightButton.className="rightButton";this.controls.upButton=document.createElement("DIV");this.controls.upButton.className="upButton";this.controls.downButton=document.createElement("DIV");this.controls.downButton.className="downButton";for(var button in this.controls){this.positionControls.appendChild(this.controls[button])}};MobileTextEditor.prototype.valueChanged=function(){return this.initValue!=this.getValue()};MobileTextEditor.prototype.init=function(){var that=this;this.eventManager=new Handsontable.eventManager(this.instance);this.createElements();this.bindEvents();this.instance.addHook("afterDestroy",function(){that.destroy()})};MobileTextEditor.prototype.getValue=function(){return this.TEXTAREA.value};MobileTextEditor.prototype.setValue=function(newValue){this.initValue=newValue;this.TEXTAREA.value=newValue};MobileTextEditor.prototype.createElements=function(){this.editorContainer=document.createElement("DIV");this.editorContainer.className="htMobileEditorContainer";this.cellPointer=document.createElement("DIV");this.cellPointer.className="cellPointer";this.moveHandle=document.createElement("DIV");this.moveHandle.className="moveHandle";this.inputPane=document.createElement("DIV");this.inputPane.className="inputs";this.positionControls=document.createElement("DIV");this.positionControls.className="positionControls";this.TEXTAREA=document.createElement("TEXTAREA");Handsontable.Dom.addClass(this.TEXTAREA,"handsontableInput");this.inputPane.appendChild(this.TEXTAREA);this.editorContainer.appendChild(this.cellPointer);this.editorContainer.appendChild(this.moveHandle);this.editorContainer.appendChild(this.inputPane);this.editorContainer.appendChild(this.positionControls);createControls.call(this);document.body.appendChild(this.editorContainer)};MobileTextEditor.prototype.onBeforeKeyDown=function(event){var instance=this;var that=instance.getActiveEditor();Handsontable.Dom.enableImmediatePropagation(event);if(event.target!==that.TEXTAREA||event.isImmediatePropagationStopped()){return}var keyCodes=Handsontable.helper.keyCode;switch(event.keyCode){case keyCodes.ENTER:that.close();event.preventDefault();break;case keyCodes.BACKSPACE:event.stopImmediatePropagation();break}};MobileTextEditor.prototype.open=function(){this.instance.addHook("beforeKeyDown",this.onBeforeKeyDown);Handsontable.Dom.addClass(this.editorContainer,"active");Handsontable.Dom.removeClass(this.cellPointer,"hidden");this.updateEditorPosition()};MobileTextEditor.prototype.focus=function(){this.TEXTAREA.focus();Handsontable.Dom.setCaretPosition(this.TEXTAREA,this.TEXTAREA.value.length)};MobileTextEditor.prototype.close=function(){this.TEXTAREA.blur();this.instance.removeHook("beforeKeyDown",this.onBeforeKeyDown);Handsontable.Dom.removeClass(this.editorContainer,"active")};MobileTextEditor.prototype.scrollToView=function(){var coords=this.instance.getSelectedRange().highlight;this.instance.view.scrollViewport(coords)};MobileTextEditor.prototype.hideCellPointer=function(){if(!Handsontable.Dom.hasClass(this.cellPointer,"hidden")){Handsontable.Dom.addClass(this.cellPointer,"hidden")}};MobileTextEditor.prototype.updateEditorPosition=function(x,y){if(x&&y){x=parseInt(x,10);y=parseInt(y,10);this.editorContainer.style.top=y+"px";this.editorContainer.style.left=x+"px"}else{var selection=this.instance.getSelected(),selectedCell=this.instance.getCell(selection[0],selection[1]);if(!domDimensionsCache.cellPointer){domDimensionsCache.cellPointer={height:Handsontable.Dom.outerHeight(this.cellPointer),width:Handsontable.Dom.outerWidth(this.cellPointer)}}if(!domDimensionsCache.editorContainer){domDimensionsCache.editorContainer={width:Handsontable.Dom.outerWidth(this.editorContainer)}}if(selectedCell!=undefined){var selectedCellOffset=Handsontable.Dom.offset(selectedCell),selectedCellWidth=Handsontable.Dom.outerWidth(selectedCell),currentScrollPosition={x:this.instance.view.wt.wtScrollbars.horizontal.scrollHandler.scrollLeft,y:this.instance.view.wt.wtScrollbars.vertical.scrollHandler.scrollTop};this.editorContainer.style.top=parseInt(selectedCellOffset.top+Handsontable.Dom.outerHeight(selectedCell)-currentScrollPosition.y+domDimensionsCache.cellPointer.height,10)+"px";this.editorContainer.style.left=parseInt((window.innerWidth/2)-(domDimensionsCache.editorContainer.width/2),10)+"px";if(selectedCellOffset.left+selectedCellWidth/2>parseInt(this.editorContainer.style.left,10)+domDimensionsCache.editorContainer.width){this.editorContainer.style.left=window.innerWidth-domDimensionsCache.editorContainer.width+"px"}else{if(selectedCellOffset.left+selectedCellWidth/2<parseInt(this.editorContainer.style.left,10)+20){this.editorContainer.style.left=0+"px"}}this.cellPointer.style.left=parseInt(selectedCellOffset.left-(domDimensionsCache.cellPointer.width/2)-Handsontable.Dom.offset(this.editorContainer).left+(selectedCellWidth/2)-currentScrollPosition.x,10)+"px"}}};MobileTextEditor.prototype.updateEditorData=function(){var selected=this.instance.getSelected(),selectedValue=this.instance.getDataAtCell(selected[0],selected[1]);this.row=selected[0];this.col=selected[1];this.setValue(selectedValue);this.updateEditorPosition()};MobileTextEditor.prototype.prepareAndSave=function(){if(!this.valueChanged()){return true}var val=[[String.prototype.trim.call(this.getValue())]];this.saveValue(val)};MobileTextEditor.prototype.bindEvents=function(){var that=this;this.eventManager.addEventListener(this.controls.leftButton,"touchend",function(event){that.prepareAndSave();that.instance.selection.transformStart(0,-1,null,true);that.updateEditorData();event.preventDefault()});this.eventManager.addEventListener(this.controls.rightButton,"touchend",function(event){that.prepareAndSave();that.instance.selection.transformStart(0,1,null,true);that.updateEditorData();event.preventDefault()});this.eventManager.addEventListener(this.controls.upButton,"touchend",function(event){that.prepareAndSave();that.instance.selection.transformStart(-1,0,null,true);that.updateEditorData();event.preventDefault()});this.eventManager.addEventListener(this.controls.downButton,"touchend",function(event){that.prepareAndSave();that.instance.selection.transformStart(1,0,null,true);that.updateEditorData();event.preventDefault()});this.eventManager.addEventListener(this.moveHandle,"touchstart",function(event){if(event.touches.length==1){var touch=event.touches[0],onTouchPosition={x:that.editorContainer.offsetLeft,y:that.editorContainer.offsetTop},onTouchOffset={x:touch.pageX-onTouchPosition.x,y:touch.pageY-onTouchPosition.y};that.eventManager.addEventListener(this,"touchmove",function(event){var touch=event.touches[0];that.updateEditorPosition(touch.pageX-onTouchOffset.x,touch.pageY-onTouchOffset.y);that.hideCellPointer();event.preventDefault()})}});this.eventManager.addEventListener(document.body,"touchend",function(event){if(!Handsontable.Dom.isChildOf(event.target,that.editorContainer)&&!Handsontable.Dom.isChildOf(event.target,that.instance.rootElement)){that.close()}});this.eventManager.addEventListener(this.instance.view.wt.wtScrollbars.horizontal.scrollHandler,"scroll",function(event){that.hideCellPointer()});this.eventManager.addEventListener(this.instance.view.wt.wtScrollbars.vertical.scrollHandler,"scroll",function(event){that.hideCellPointer()})};MobileTextEditor.prototype.destroy=function(){this.eventManager.clear();this.editorContainer.parentNode.removeChild(this.editorContainer)};Handsontable.editors.MobileTextEditor=MobileTextEditor;Handsontable.editors.registerEditor("mobile",Handsontable.editors.MobileTextEditor)})(Handsontable);(function(Handsontable){var CheckboxEditor=Handsontable.editors.BaseEditor.prototype.extend();CheckboxEditor.prototype.beginEditing=function(){var checkbox=this.TD.querySelector('input[type="checkbox"]');if(checkbox){checkbox.click()}};CheckboxEditor.prototype.finishEditing=function(){};CheckboxEditor.prototype.init=function(){};CheckboxEditor.prototype.open=function(){};CheckboxEditor.prototype.close=function(){};CheckboxEditor.prototype.getValue=function(){};CheckboxEditor.prototype.setValue=function(){};CheckboxEditor.prototype.focus=function(){};Handsontable.editors.CheckboxEditor=CheckboxEditor;Handsontable.editors.registerEditor("checkbox",CheckboxEditor)})(Handsontable);(function(Handsontable){var DateEditor=Handsontable.editors.TextEditor.prototype.extend();var $;DateEditor.prototype.init=function(){if(typeof jQuery!="undefined"){$=jQuery}else{throw new Error("You need to include jQuery to your project in order to use the jQuery UI Datepicker.")}if(!$.datepicker){throw new Error("jQuery UI Datepicker dependency not found. Did you forget to include jquery-ui.custom.js or its substitute?")}Handsontable.editors.TextEditor.prototype.init.apply(this,arguments);this.isCellEdited=false;var that=this;this.instance.addHook("afterDestroy",function(){that.destroyElements()})};DateEditor.prototype.createElements=function(){Handsontable.editors.TextEditor.prototype.createElements.apply(this,arguments);this.datePicker=document.createElement("DIV");Handsontable.Dom.addClass(this.datePicker,"htDatepickerHolder");this.datePickerStyle=this.datePicker.style;this.datePickerStyle.position="absolute";this.datePickerStyle.top=0;this.datePickerStyle.left=0;this.datePickerStyle.zIndex=99;document.body.appendChild(this.datePicker);this.$datePicker=$(this.datePicker);var that=this;var defaultOptions={dateFormat:"yy-mm-dd",showButtonPanel:true,changeMonth:true,changeYear:true,onSelect:function(dateStr){that.setValue(dateStr);that.finishEditing(false)}};this.$datePicker.datepicker(defaultOptions);var eventManager=Handsontable.eventManager(this);eventManager.addEventListener(this.datePicker,"mousedown",function(event){Handsontable.helper.stopPropagation(event)});this.hideDatepicker()};DateEditor.prototype.destroyElements=function(){this.$datePicker.datepicker("destroy");this.$datePicker.remove()};DateEditor.prototype.open=function(){Handsontable.editors.TextEditor.prototype.open.call(this);this.showDatepicker()};DateEditor.prototype.finishEditing=function(isCancelled,ctrlDown){this.hideDatepicker();Handsontable.editors.TextEditor.prototype.finishEditing.apply(this,arguments)};DateEditor.prototype.showDatepicker=function(){var offset=Handsontable.Dom.offset(this.TD);this.datePickerStyle.top=(offset.top+Handsontable.Dom.outerHeight(this.TD))+"px";this.datePickerStyle.left=offset.left+"px";var DatepickerSettings=function(){};DatepickerSettings.prototype=this.cellProperties;var datepickerSettings=new DatepickerSettings();datepickerSettings.defaultDate=this.originalValue||void 0;this.$datePicker.datepicker("option",datepickerSettings);if(this.originalValue){this.$datePicker.datepicker("setDate",this.originalValue)}this.datePickerStyle.display="block"};DateEditor.prototype.hideDatepicker=function(){this.datePickerStyle.display="none"};Handsontable.editors.DateEditor=DateEditor;Handsontable.editors.registerEditor("date",DateEditor)})(Handsontable);(function(Handsontable){var HandsontableEditor=Handsontable.editors.TextEditor.prototype.extend();HandsontableEditor.prototype.createElements=function(){Handsontable.editors.TextEditor.prototype.createElements.apply(this,arguments);var DIV=document.createElement("DIV");DIV.className="handsontableEditor";this.TEXTAREA_PARENT.appendChild(DIV);this.htContainer=DIV;this.htEditor=new Handsontable(DIV);this.assignHooks()};HandsontableEditor.prototype.prepare=function(td,row,col,prop,value,cellProperties){Handsontable.editors.TextEditor.prototype.prepare.apply(this,arguments);var parent=this;var options={startRows:0,startCols:0,minRows:0,minCols:0,className:"listbox",copyPaste:false,cells:function(){return{readOnly:true}},fillHandle:false,afterOnCellMouseDown:function(){var value=this.getValue();if(value!==void 0){parent.setValue(value)}parent.instance.destroyEditor()}};if(this.cellProperties.handsontable){Handsontable.helper.extend(options,cellProperties.handsontable)}if(this.htEditor){this.htEditor.destroy()}this.htEditor=new Handsontable(this.htContainer,options)};var onBeforeKeyDown=function(event){if(event!=null&&event.isImmediatePropagationEnabled==null){event.stopImmediatePropagation=function(){this.isImmediatePropagationEnabled=false;this.cancelBubble=true};event.isImmediatePropagationEnabled=true;event.isImmediatePropagationStopped=function(){return !this.isImmediatePropagationEnabled}}if(event.isImmediatePropagationStopped()){return}var editor=this.getActiveEditor();var innerHOT=editor.htEditor.getInstance();var rowToSelect;if(event.keyCode==Handsontable.helper.keyCode.ARROW_DOWN){if(!innerHOT.getSelected()){rowToSelect=0}else{var selectedRow=innerHOT.getSelected()[0];var lastRow=innerHOT.countRows()-1;rowToSelect=Math.min(lastRow,selectedRow+1)}}else{if(event.keyCode==Handsontable.helper.keyCode.ARROW_UP){if(innerHOT.getSelected()){var selectedRow=innerHOT.getSelected()[0];rowToSelect=selectedRow-1}}}if(rowToSelect!==void 0){if(rowToSelect<0){innerHOT.deselectCell()}else{innerHOT.selectCell(rowToSelect,0)}event.preventDefault();event.stopImmediatePropagation();editor.instance.listen();editor.TEXTAREA.focus()}};HandsontableEditor.prototype.open=function(){this.instance.addHook("beforeKeyDown",onBeforeKeyDown);Handsontable.editors.TextEditor.prototype.open.apply(this,arguments);this.htEditor.render();if(this.cellProperties.strict){this.htEditor.selectCell(0,0);this.TEXTAREA.style.visibility="hidden"}else{this.htEditor.deselectCell();this.TEXTAREA.style.visibility="visible"}Handsontable.Dom.setCaretPosition(this.TEXTAREA,0,this.TEXTAREA.value.length)};HandsontableEditor.prototype.close=function(){this.instance.removeHook("beforeKeyDown",onBeforeKeyDown);this.instance.listen();Handsontable.editors.TextEditor.prototype.close.apply(this,arguments)};HandsontableEditor.prototype.focus=function(){this.instance.listen();Handsontable.editors.TextEditor.prototype.focus.apply(this,arguments)};HandsontableEditor.prototype.beginEditing=function(initialValue){var onBeginEditing=this.instance.getSettings().onBeginEditing;if(onBeginEditing&&onBeginEditing()===false){return}Handsontable.editors.TextEditor.prototype.beginEditing.apply(this,arguments)};HandsontableEditor.prototype.finishEditing=function(isCancelled,ctrlDown){if(this.htEditor.isListening()){this.instance.listen()}if(this.htEditor.getSelected()){var value=this.htEditor.getInstance().getValue();if(value!==void 0){this.setValue(value)}}return Handsontable.editors.TextEditor.prototype.finishEditing.apply(this,arguments)};HandsontableEditor.prototype.assignHooks=function(){var that=this;this.instance.addHook("afterDestroy",function(){if(that.htEditor){that.htEditor.destroy()}})};Handsontable.editors.HandsontableEditor=HandsontableEditor;Handsontable.editors.registerEditor("handsontable",HandsontableEditor)})(Handsontable);(function(Handsontable){var AutocompleteEditor=Handsontable.editors.HandsontableEditor.prototype.extend();AutocompleteEditor.prototype.init=function(){Handsontable.editors.HandsontableEditor.prototype.init.apply(this,arguments);var choicesListHot=this.htEditor.getInstance();choicesListHot.updateSettings({height:1});this.query=null;this.choices=[]};AutocompleteEditor.prototype.createElements=function(){Handsontable.editors.HandsontableEditor.prototype.createElements.apply(this,arguments);var getSystemSpecificPaddingClass=function(){if(window.navigator.platform.indexOf("Mac")!=-1){return"htMacScroll"}else{return""}};Handsontable.Dom.addClass(this.htContainer,"autocompleteEditor");Handsontable.Dom.addClass(this.htContainer,getSystemSpecificPaddingClass())};var skipOne=false;var onBeforeKeyDown=function(event){skipOne=false;var editor=this.getActiveEditor();var keyCodes=Handsontable.helper.keyCode;if(Handsontable.helper.isPrintableChar(event.keyCode)||event.keyCode===keyCodes.BACKSPACE||event.keyCode===keyCodes.DELETE||event.keyCode===keyCodes.INSERT){var timeOffset=0;if(event.keyCode===keyCodes.C&&(event.ctrlKey||event.metaKey)){return}if(!editor.isOpened()){timeOffset+=10}editor.instance._registerTimeout(setTimeout(function(){editor.queryChoices(editor.TEXTAREA.value);skipOne=true},timeOffset))}};AutocompleteEditor.prototype.prepare=function(){this.instance.addHook("beforeKeyDown",onBeforeKeyDown);Handsontable.editors.HandsontableEditor.prototype.prepare.apply(this,arguments)};AutocompleteEditor.prototype.open=function(){Handsontable.editors.HandsontableEditor.prototype.open.apply(this,arguments);this.TEXTAREA.style.visibility="visible";this.focus();var choicesListHot=this.htEditor.getInstance();var that=this;choicesListHot.updateSettings({colWidths:[Handsontable.Dom.outerWidth(this.TEXTAREA)-2],afterRenderer:function(TD,row,col,prop,value){var caseSensitive=this.getCellMeta(row,col).filteringCaseSensitive===true;if(value){var indexOfMatch=caseSensitive?value.indexOf(this.query):value.toLowerCase().indexOf(that.query.toLowerCase());if(indexOfMatch!=-1){var match=value.substr(indexOfMatch,that.query.length);TD.innerHTML=value.replace(match,"<strong>"+match+"</strong>")}}}});if(skipOne){skipOne=false}that.instance._registerTimeout(setTimeout(function(){that.queryChoices(that.TEXTAREA.value)},0))};AutocompleteEditor.prototype.close=function(){Handsontable.editors.HandsontableEditor.prototype.close.apply(this,arguments)};AutocompleteEditor.prototype.queryChoices=function(query){this.query=query;if(typeof this.cellProperties.source=="function"){var that=this;this.cellProperties.source(query,function(choices){that.updateChoicesList(choices)})}else{if(Handsontable.helper.isArray(this.cellProperties.source)){var choices;if(!query||this.cellProperties.filter===false){choices=this.cellProperties.source}else{var filteringCaseSensitive=this.cellProperties.filteringCaseSensitive===true;var lowerCaseQuery=query.toLowerCase();choices=this.cellProperties.source.filter(function(choice){if(filteringCaseSensitive){return choice.indexOf(query)!=-1}else{return choice.toLowerCase().indexOf(lowerCaseQuery)!=-1}})}this.updateChoicesList(choices)}else{this.updateChoicesList([])}}};AutocompleteEditor.prototype.updateChoicesList=function(choices){var pos=Handsontable.Dom.getCaretPosition(this.TEXTAREA),endPos=Handsontable.Dom.getSelectionEndPosition(this.TEXTAREA);var orderByRelevance=AutocompleteEditor.sortByRelevance(this.getValue(),choices,this.cellProperties.filteringCaseSensitive);var highlightIndex;if(this.cellProperties.filter!=false){var sorted=[];for(var i=0,choicesCount=orderByRelevance.length;i<choicesCount;i++){sorted.push(choices[orderByRelevance[i]])}highlightIndex=0;choices=sorted}else{highlightIndex=orderByRelevance[0]}this.choices=choices;this.htEditor.loadData(Handsontable.helper.pivot([choices]));this.htEditor.updateSettings({height:this.getDropdownHeight()});if(this.cellProperties.strict===true){this.highlightBestMatchingChoice(highlightIndex)}this.instance.listen();this.TEXTAREA.focus();Handsontable.Dom.setCaretPosition(this.TEXTAREA,pos,(pos!=endPos?endPos:void 0))};AutocompleteEditor.prototype.finishEditing=function(restoreOriginalValue){if(!restoreOriginalValue){this.instance.removeHook("beforeKeyDown",onBeforeKeyDown)}Handsontable.editors.HandsontableEditor.prototype.finishEditing.apply(this,arguments)};AutocompleteEditor.prototype.highlightBestMatchingChoice=function(index){if(typeof index==="number"){this.htEditor.selectCell(index,0)}else{this.htEditor.deselectCell()}};AutocompleteEditor.sortByRelevance=function(value,choices,caseSensitive){var choicesRelevance=[],currentItem,valueLength=value.length,valueIndex,charsLeft,result=[],i,choicesCount;if(valueLength===0){for(i=0,choicesCount=choices.length;i<choicesCount;i++){result.push(i)}return result}for(i=0,choicesCount=choices.length;i<choicesCount;i++){currentItem=choices[i];if(caseSensitive){valueIndex=currentItem.indexOf(value)}else{valueIndex=currentItem.toLowerCase().indexOf(value.toLowerCase())}if(valueIndex==-1){continue}charsLeft=currentItem.length-valueIndex-valueLength;choicesRelevance.push({baseIndex:i,index:valueIndex,charsLeft:charsLeft,value:currentItem})}choicesRelevance.sort(function(a,b){if(b.index===-1){return -1}if(a.index===-1){return 1}if(a.index<b.index){return -1}else{if(b.index<a.index){return 1}else{if(a.index===b.index){if(a.charsLeft<b.charsLeft){return -1}else{if(a.charsLeft>b.charsLeft){return 1}else{return 0}}}}}});for(i=0,choicesCount=choicesRelevance.length;i<choicesCount;i++){result.push(choicesRelevance[i].baseIndex)}return result};AutocompleteEditor.prototype.getDropdownHeight=function(){var firstRowHeight=this.htEditor.getInstance().getRowHeight(0)||23;return this.choices.length>=10?10*firstRowHeight:this.choices.length*firstRowHeight+8;return 230};Handsontable.editors.AutocompleteEditor=AutocompleteEditor;Handsontable.editors.registerEditor("autocomplete",AutocompleteEditor)})(Handsontable);(function(Handsontable){var PasswordEditor=Handsontable.editors.TextEditor.prototype.extend();PasswordEditor.prototype.createElements=function(){Handsontable.editors.TextEditor.prototype.createElements.apply(this,arguments);this.TEXTAREA=document.createElement("input");this.TEXTAREA.setAttribute("type","password");this.TEXTAREA.className="handsontableInput";this.textareaStyle=this.TEXTAREA.style;this.textareaStyle.width=0;this.textareaStyle.height=0;Handsontable.Dom.empty(this.TEXTAREA_PARENT);this.TEXTAREA_PARENT.appendChild(this.TEXTAREA)};Handsontable.editors.PasswordEditor=PasswordEditor;Handsontable.editors.registerEditor("password",PasswordEditor)})(Handsontable);(function(Handsontable){var SelectEditor=Handsontable.editors.BaseEditor.prototype.extend();SelectEditor.prototype.init=function(){this.select=document.createElement("SELECT");Handsontable.Dom.addClass(this.select,"htSelectEditor");this.select.style.display="none";this.instance.rootElement.appendChild(this.select)};SelectEditor.prototype.prepare=function(){Handsontable.editors.BaseEditor.prototype.prepare.apply(this,arguments);var selectOptions=this.cellProperties.selectOptions;var options;if(typeof selectOptions=="function"){options=this.prepareOptions(selectOptions(this.row,this.col,this.prop))}else{options=this.prepareOptions(selectOptions)}Handsontable.Dom.empty(this.select);for(var option in options){if(options.hasOwnProperty(option)){var optionElement=document.createElement("OPTION");optionElement.value=option;Handsontable.Dom.fastInnerHTML(optionElement,options[option]);this.select.appendChild(optionElement)}}};SelectEditor.prototype.prepareOptions=function(optionsToPrepare){var preparedOptions={};if(Handsontable.helper.isArray(optionsToPrepare)){for(var i=0,len=optionsToPrepare.length;i<len;i++){preparedOptions[optionsToPrepare[i]]=optionsToPrepare[i]}}else{if(typeof optionsToPrepare=="object"){preparedOptions=optionsToPrepare}}return preparedOptions};SelectEditor.prototype.getValue=function(){return this.select.value};SelectEditor.prototype.setValue=function(value){this.select.value=value};var onBeforeKeyDown=function(event){var instance=this;var editor=instance.getActiveEditor();switch(event.keyCode){case Handsontable.helper.keyCode.ARROW_UP:var previousOption=editor.select.find("option:selected").prev();if(previousOption.length==1){previousOption.prop("selected",true)}event.stopImmediatePropagation();event.preventDefault();break;case Handsontable.helper.keyCode.ARROW_DOWN:var nextOption=editor.select.find("option:selected").next();if(nextOption.length==1){nextOption.prop("selected",true)}event.stopImmediatePropagation();event.preventDefault();break}};SelectEditor.prototype.checkEditorSection=function(){if(this.row<this.instance.getSettings().fixedRowsTop){if(this.col<this.instance.getSettings().fixedColumnsLeft){return"corner"}else{return"top"}}else{if(this.col<this.instance.getSettings().fixedColumnsLeft){return"left"}}};SelectEditor.prototype.open=function(){var width=Handsontable.Dom.outerWidth(this.TD);var height=Handsontable.Dom.outerHeight(this.TD);var rootOffset=Handsontable.Dom.offset(this.instance.rootElement);var tdOffset=Handsontable.Dom.offset(this.TD);var editorSection=this.checkEditorSection();var cssTransformOffset;switch(editorSection){case"top":cssTransformOffset=Handsontable.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.vertical.clone.wtTable.holder.parentNode);break;case"left":cssTransformOffset=Handsontable.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.horizontal.clone.wtTable.holder.parentNode);break;case"corner":cssTransformOffset=Handsontable.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.corner.clone.wtTable.holder.parentNode);break}var selectStyle=this.select.style;if(cssTransformOffset&&cssTransformOffset!=-1){selectStyle[cssTransformOffset[0]]=cssTransformOffset[1]}else{Handsontable.Dom.resetCssTransform(this.select)}selectStyle.height=height+"px";selectStyle.minWidth=width+"px";selectStyle.top=tdOffset.top-rootOffset.top+"px";selectStyle.left=tdOffset.left-rootOffset.left+"px";selectStyle.margin="0px";selectStyle.display="";this.instance.addHook("beforeKeyDown",onBeforeKeyDown)};SelectEditor.prototype.close=function(){this.select.style.display="none";this.instance.removeHook("beforeKeyDown",onBeforeKeyDown)};SelectEditor.prototype.focus=function(){this.select.focus()};Handsontable.editors.SelectEditor=SelectEditor;Handsontable.editors.registerEditor("select",SelectEditor)})(Handsontable);(function(Handsontable){var DropdownEditor=Handsontable.editors.AutocompleteEditor.prototype.extend();DropdownEditor.prototype.prepare=function(){Handsontable.editors.AutocompleteEditor.prototype.prepare.apply(this,arguments);this.cellProperties.filter=false;this.cellProperties.strict=true};Handsontable.editors.DropdownEditor=DropdownEditor;Handsontable.editors.registerEditor("dropdown",DropdownEditor)})(Handsontable);(function(Handsontable){var NumericEditor=Handsontable.editors.TextEditor.prototype.extend();NumericEditor.prototype.beginEditing=function(initialValue){var BaseEditor=Handsontable.editors.TextEditor.prototype;if(typeof(initialValue)==="undefined"&&this.originalValue){var value=""+this.originalValue;if(typeof this.cellProperties.language!=="undefined"){numeral.language(this.cellProperties.language)}var decimalDelimiter=numeral.languageData().delimiters.decimal;value=value.replace(".",decimalDelimiter);BaseEditor.beginEditing.apply(this,[value])}else{BaseEditor.beginEditing.apply(this,arguments)}};Handsontable.editors.NumericEditor=NumericEditor;Handsontable.editors.registerEditor("numeric",NumericEditor)})(Handsontable);Handsontable.NumericValidator=function(value,callback){if(value===null){value=""}callback(/^-?\d*(\.|\,)?\d*$/.test(value))};var process=function(value,callback){var originalVal=value;var lowercaseVal=typeof originalVal==="string"?originalVal.toLowerCase():null;return function(source){var found=false;for(var s=0,slen=source.length;s<slen;s++){if(originalVal===source[s]){found=true;break}else{if(lowercaseVal===source[s].toLowerCase()){found=true;break}}}callback(found)}};Handsontable.AutocompleteValidator=function(value,callback){if(this.strict&&this.source){typeof this.source==="function"?this.source(value,process(value,callback)):process(value,callback)(this.source)}else{callback(true)}};Handsontable.mobileBrowser=Handsontable.helper.isMobileBrowser();Handsontable.AutocompleteCell={editor:Handsontable.editors.AutocompleteEditor,renderer:Handsontable.renderers.AutocompleteRenderer,validator:Handsontable.AutocompleteValidator};Handsontable.CheckboxCell={editor:Handsontable.editors.CheckboxEditor,renderer:Handsontable.renderers.CheckboxRenderer};Handsontable.TextCell={editor:Handsontable.mobileBrowser?Handsontable.editors.MobileTextEditor:Handsontable.editors.TextEditor,renderer:Handsontable.renderers.TextRenderer};Handsontable.NumericCell={editor:Handsontable.editors.NumericEditor,renderer:Handsontable.renderers.NumericRenderer,validator:Handsontable.NumericValidator,dataType:"number"};Handsontable.DateCell={editor:Handsontable.editors.DateEditor,renderer:Handsontable.renderers.AutocompleteRenderer};Handsontable.HandsontableCell={editor:Handsontable.editors.HandsontableEditor,renderer:Handsontable.renderers.AutocompleteRenderer};Handsontable.PasswordCell={editor:Handsontable.editors.PasswordEditor,renderer:Handsontable.renderers.PasswordRenderer,copyable:false};Handsontable.DropdownCell={editor:Handsontable.editors.DropdownEditor,renderer:Handsontable.renderers.AutocompleteRenderer,validator:Handsontable.AutocompleteValidator};Handsontable.cellTypes={text:Handsontable.TextCell,date:Handsontable.DateCell,numeric:Handsontable.NumericCell,checkbox:Handsontable.CheckboxCell,autocomplete:Handsontable.AutocompleteCell,handsontable:Handsontable.HandsontableCell,password:Handsontable.PasswordCell,dropdown:Handsontable.DropdownCell};Handsontable.cellLookup={validator:{numeric:Handsontable.NumericValidator,autocomplete:Handsontable.AutocompleteValidator}};var autoResize=function(){var defaults={minHeight:200,maxHeight:300,minWidth:100,maxWidth:300},el,body=document.body,text=document.createTextNode(""),span=document.createElement("SPAN"),observe=function(element,event,handler){if(window.attachEvent){element.attachEvent("on"+event,handler)}else{element.addEventListener(event,handler,false)}},unObserve=function(element,event,handler){if(window.removeEventListener){element.removeEventListener(event,handler,false)}else{element.detachEvent("on"+event,handler)}},resize=function(){if(text.textContent!==void 0){text.textContent=el.value}else{text.data=el.value}span.style.fontSize=Handsontable.Dom.getComputedStyle(el).fontSize;span.style.fontFamily=Handsontable.Dom.getComputedStyle(el).fontFamily;body.appendChild(span);var width=span.clientWidth;body.removeChild(span);el.style.height=defaults.minHeight+"px";if(defaults.minWidth>width){el.style.width=defaults.minWidth+"px"}else{if(width>defaults.maxWidth){el.style.width=defaults.maxWidth+"px"}else{el.style.width=width+"px"}}var scrollHeight=el.scrollHeight;if(defaults.minHeight>scrollHeight){el.style.height=defaults.minHeight+"px"}else{if(defaults.maxHeight<scrollHeight){el.style.height=defaults.maxHeight+"px";el.style.overflowY="visible"}else{el.style.height=scrollHeight+"px"}}},delayedResize=function(){window.setTimeout(resize,0)},extendDefaults=function(config){if(config&&config.minHeight){if(config.minHeight=="inherit"){defaults.minHeight=el.clientHeight}else{var minHeight=parseInt(config.minHeight);if(!isNaN(minHeight)){defaults.minHeight=minHeight}}}if(config&&config.maxHeight){if(config.maxHeight=="inherit"){defaults.maxHeight=el.clientHeight}else{var maxHeight=parseInt(config.maxHeight);if(!isNaN(maxHeight)){defaults.maxHeight=maxHeight}}}if(config&&config.minWidth){if(config.minWidth=="inherit"){defaults.minWidth=el.clientWidth}else{var minWidth=parseInt(config.minWidth);if(!isNaN(minWidth)){defaults.minWidth=minWidth}}}if(config&&config.maxWidth){if(config.maxWidth=="inherit"){defaults.maxWidth=el.clientWidth}else{var maxWidth=parseInt(config.maxWidth);if(!isNaN(maxWidth)){defaults.maxWidth=maxWidth}}}if(!span.firstChild){span.className="autoResize";span.style.display="inline-block";span.appendChild(text)}},init=function(el_,config){el=el_;extendDefaults(config);if(el.nodeName=="TEXTAREA"){el.style.resize="none";el.style.overflowY="";el.style.height=defaults.minHeight+"px";el.style.minWidth=defaults.minWidth+"px";el.style.maxWidth=defaults.maxWidth+"px";el.style.overflowY="hidden"}observe(el,"change",resize);observe(el,"cut",delayedResize);observe(el,"paste",delayedResize);observe(el,"drop",delayedResize);observe(el,"keydown",delayedResize);resize()};return{init:function(el_,config){init(el_,config)},unObserve:function(){unObserve(el,"change",resize);unObserve(el,"cut",delayedResize);unObserve(el,"paste",delayedResize);unObserve(el,"drop",delayedResize);unObserve(el,"keydown",delayedResize)}}};(function(global){function countQuotes(str){return str.split('"').length-1}global.SheetClip={parse:function(str){var r,rlen,rows,arr=[],a=0,c,clen,multiline,last;rows=str.split("\n");if(rows.length>1&&rows[rows.length-1]===""){rows.pop()}for(r=0,rlen=rows.length;r<rlen;r+=1){rows[r]=rows[r].split("\t");for(c=0,clen=rows[r].length;c<clen;c+=1){if(!arr[a]){arr[a]=[]}if(multiline&&c===0){last=arr[a].length-1;arr[a][last]=arr[a][last]+"\n"+rows[r][0];if(multiline&&(countQuotes(rows[r][0])&1)){multiline=false;arr[a][last]=arr[a][last].substring(0,arr[a][last].length-1).replace(/""/g,'"')}}else{if(c===clen-1&&rows[r][c].indexOf('"')===0){arr[a].push(rows[r][c].substring(1).replace(/""/g,'"'));multiline=true}else{arr[a].push(rows[r][c].replace(/""/g,'"'));multiline=false}}}if(!multiline){a+=1}}return arr},stringify:function(arr){var r,rlen,c,clen,str="",val;for(r=0,rlen=arr.length;r<rlen;r+=1){for(c=0,clen=arr[r].length;c<clen;c+=1){if(c>0){str+="\t"}val=arr[r][c];if(typeof val==="string"){if(val.indexOf("\n")>-1){str+='"'+val.replace(/"/g,'""')+'"'}else{str+=val}}else{if(val===null||val===void 0){str+=""}else{str+=val}}}if(r<rlen-1){str+="\n"}}return str}}}(window));var CopyPaste=(function(){var instance;return{getInstance:function(){if(!instance){instance=new CopyPasteClass()}else{if(instance.hasBeenDestroyed()){instance.init()}}instance.refCounter++;return instance}}})();function CopyPasteClass(){this.refCounter=0;this.init()}CopyPasteClass.prototype.init=function(){var that=this,style,parent;this.copyCallbacks=[];this.cutCallbacks=[];this.pasteCallbacks=[];this._eventManager=Handsontable.eventManager(this);parent=document.body;if(document.getElementById("CopyPasteDiv")){this.elDiv=document.getElementById("CopyPasteDiv");this.elTextarea=this.elDiv.firstChild}else{this.elDiv=document.createElement("DIV");this.elDiv.id="CopyPasteDiv";style=this.elDiv.style;style.position="fixed";style.top="-10000px";style.left="-10000px";parent.appendChild(this.elDiv);this.elTextarea=document.createElement("TEXTAREA");this.elTextarea.className="copyPaste";this.elTextarea.onpaste=function(event){if("WebkitAppearance" in document.documentElement.style){this.value=event.clipboardData.getData("Text");return false}};style=this.elTextarea.style;style.width="10000px";style.height="10000px";style.overflow="hidden";this.elDiv.appendChild(this.elTextarea);if(typeof style.opacity!=="undefined"){style.opacity=0}else{
/*@cc_on @if (@_jscript)
       if(typeof style.filter === 'string') {
       style.filter = 'alpha(opacity=0)';
       }
       @end @*/
}}this.keydownListener=function(event){var isCtrlDown=false;if(event.metaKey){isCtrlDown=true}else{if(event.ctrlKey&&navigator.userAgent.indexOf("Mac")===-1){isCtrlDown=true}}if(isCtrlDown){if(document.activeElement!==that.elTextarea&&(that.getSelectionText()!=""||["INPUT","SELECT","TEXTAREA"].indexOf(document.activeElement.nodeName)!=-1)){return}that.selectNodeText(that.elTextarea);setTimeout(function(){that.selectNodeText(that.elTextarea)},0)}if(isCtrlDown&&(event.keyCode===67||event.keyCode===86||event.keyCode===88)){if(event.keyCode===88){setTimeout(function(){that.triggerCut(event)},0)}else{if(event.keyCode===86){setTimeout(function(){that.triggerPaste(event)},0)}}}};this._eventManager.addEventListener(document.documentElement,"keydown",this.keydownListener,false)};CopyPasteClass.prototype.selectNodeText=function(el){if(el){el.select()}};CopyPasteClass.prototype.getSelectionText=function(){var text="";if(window.getSelection){text=window.getSelection().toString()}else{if(document.selection&&document.selection.type!="Control"){text=document.selection.createRange().text}}return text};CopyPasteClass.prototype.copyable=function(str){if(typeof str!=="string"&&str.toString===void 0){throw new Error("copyable requires string parameter")}this.elTextarea.value=str};CopyPasteClass.prototype.onCut=function(fn){this.cutCallbacks.push(fn)};CopyPasteClass.prototype.onPaste=function(fn){this.pasteCallbacks.push(fn)};CopyPasteClass.prototype.removeCallback=function(fn){var i,ilen;for(i=0,ilen=this.copyCallbacks.length;i<ilen;i++){if(this.copyCallbacks[i]===fn){this.copyCallbacks.splice(i,1);return true}}for(i=0,ilen=this.cutCallbacks.length;i<ilen;i++){if(this.cutCallbacks[i]===fn){this.cutCallbacks.splice(i,1);return true}}for(i=0,ilen=this.pasteCallbacks.length;i<ilen;i++){if(this.pasteCallbacks[i]===fn){this.pasteCallbacks.splice(i,1);return true}}return false};CopyPasteClass.prototype.triggerCut=function(event){var that=this;if(that.cutCallbacks){setTimeout(function(){for(var i=0,ilen=that.cutCallbacks.length;i<ilen;i++){that.cutCallbacks[i](event)}},50)}};CopyPasteClass.prototype.triggerPaste=function(event,str){var that=this;if(that.pasteCallbacks){setTimeout(function(){var val=(str||that.elTextarea.value).replace(/\n$/,"");for(var i=0,ilen=that.pasteCallbacks.length;i<ilen;i++){that.pasteCallbacks[i](val,event)}},50)}};CopyPasteClass.prototype.destroy=function(){if(!this.hasBeenDestroyed()&&--this.refCounter==0){if(this.elDiv&&this.elDiv.parentNode){this.elDiv.parentNode.removeChild(this.elDiv);this.elDiv=null;this.elTextarea=null}this._eventManager.removeEventListener(document.documentElement,"keydown",this.keydownListener,false)}};CopyPasteClass.prototype.hasBeenDestroyed=function(){return !this.refCounter};var jsonpatch;(function(jsonpatch){var objOps={add:function(obj,key){obj[key]=this.value;return true},remove:function(obj,key){delete obj[key];return true},replace:function(obj,key){obj[key]=this.value;return true},move:function(obj,key,tree){var temp={op:"_get",path:this.from};apply(tree,[temp]);apply(tree,[{op:"remove",path:this.from}]);apply(tree,[{op:"add",path:this.path,value:temp.value}]);return true},copy:function(obj,key,tree){var temp={op:"_get",path:this.from};apply(tree,[temp]);apply(tree,[{op:"add",path:this.path,value:temp.value}]);return true},test:function(obj,key){return(JSON.stringify(obj[key])===JSON.stringify(this.value))},_get:function(obj,key){this.value=obj[key]}};var arrOps={add:function(arr,i){arr.splice(i,0,this.value);return true},remove:function(arr,i){arr.splice(i,1);return true},replace:function(arr,i){arr[i]=this.value;return true},move:objOps.move,copy:objOps.copy,test:objOps.test,_get:objOps._get};var observeOps={add:function(patches,path){var patch={op:"add",path:path+escapePathComponent(this.name),value:this.object[this.name]};patches.push(patch)},"delete":function(patches,path){var patch={op:"remove",path:path+escapePathComponent(this.name)};patches.push(patch)},update:function(patches,path){var patch={op:"replace",path:path+escapePathComponent(this.name),value:this.object[this.name]};patches.push(patch)}};function escapePathComponent(str){if(str.indexOf("/")===-1&&str.indexOf("~")===-1){return str}return str.replace(/~/g,"~0").replace(/\//g,"~1")}function _getPathRecursive(root,obj){var found;for(var key in root){if(root.hasOwnProperty(key)){if(root[key]===obj){return escapePathComponent(key)+"/"}else{if(typeof root[key]==="object"){found=_getPathRecursive(root[key],obj);if(found!=""){return escapePathComponent(key)+"/"+found}}}}}return""}function getPath(root,obj){if(root===obj){return"/"}var path=_getPathRecursive(root,obj);if(path===""){throw new Error("Object not found in root")}return"/"+path}var beforeDict=[];jsonpatch.intervals;var Mirror=(function(){function Mirror(obj){this.observers=[];this.obj=obj}return Mirror})();var ObserverInfo=(function(){function ObserverInfo(callback,observer){this.callback=callback;this.observer=observer}return ObserverInfo})();function getMirror(obj){for(var i=0,ilen=beforeDict.length;i<ilen;i++){if(beforeDict[i].obj===obj){return beforeDict[i]}}}function getObserverFromMirror(mirror,callback){for(var j=0,jlen=mirror.observers.length;j<jlen;j++){if(mirror.observers[j].callback===callback){return mirror.observers[j].observer}}}function removeObserverFromMirror(mirror,observer){for(var j=0,jlen=mirror.observers.length;j<jlen;j++){if(mirror.observers[j].observer===observer){mirror.observers.splice(j,1);return}}}function unobserve(root,observer){generate(observer);if(Object.observe){_unobserve(observer,root)}else{clearTimeout(observer.next)}var mirror=getMirror(root);removeObserverFromMirror(mirror,observer)}jsonpatch.unobserve=unobserve;function observe(obj,callback){var patches=[];var root=obj;var observer;var mirror=getMirror(obj);if(!mirror){mirror=new Mirror(obj);beforeDict.push(mirror)}else{observer=getObserverFromMirror(mirror,callback)}if(observer){return observer}if(Object.observe){observer=function(arr){_unobserve(observer,obj);_observe(observer,obj);var a=0,alen=arr.length;while(a<alen){if(!(arr[a].name==="length"&&_isArray(arr[a].object))&&!(arr[a].name==="__Jasmine_been_here_before__")){var type=arr[a].type;switch(type){case"new":type="add";break;case"deleted":type="delete";break;case"updated":type="update";break}observeOps[type].call(arr[a],patches,getPath(root,arr[a].object))}a++}if(patches){if(callback){callback(patches)}}observer.patches=patches;patches=[]}}else{observer={};mirror.value=JSON.parse(JSON.stringify(obj));if(callback){observer.callback=callback;observer.next=null;var intervals=this.intervals||[100,1000,10000,60000];var currentInterval=0;var dirtyCheck=function(){generate(observer)};var fastCheck=function(){clearTimeout(observer.next);observer.next=setTimeout(function(){dirtyCheck();currentInterval=0;observer.next=setTimeout(slowCheck,intervals[currentInterval++])},0)};var slowCheck=function(){dirtyCheck();if(currentInterval==intervals.length){currentInterval=intervals.length-1}observer.next=setTimeout(slowCheck,intervals[currentInterval++])};if(typeof window!=="undefined"){if(window.addEventListener){window.addEventListener("mousedown",fastCheck);window.addEventListener("mouseup",fastCheck);window.addEventListener("keydown",fastCheck)}else{window.attachEvent("onmousedown",fastCheck);window.attachEvent("onmouseup",fastCheck);window.attachEvent("onkeydown",fastCheck)}}observer.next=setTimeout(slowCheck,intervals[currentInterval++])}}observer.patches=patches;observer.object=obj;mirror.observers.push(new ObserverInfo(callback,observer));return _observe(observer,obj)}jsonpatch.observe=observe;function _observe(observer,obj){if(Object.observe){Object.observe(obj,observer);for(var key in obj){if(obj.hasOwnProperty(key)){var v=obj[key];if(v&&typeof(v)==="object"){_observe(observer,v)}}}}return observer}function _unobserve(observer,obj){if(Object.observe){Object.unobserve(obj,observer);for(var key in obj){if(obj.hasOwnProperty(key)){var v=obj[key];if(v&&typeof(v)==="object"){_unobserve(observer,v)}}}}return observer}function generate(observer){if(Object.observe){Object.deliverChangeRecords(observer)}else{var mirror;for(var i=0,ilen=beforeDict.length;i<ilen;i++){if(beforeDict[i].obj===observer.object){mirror=beforeDict[i];break}}_generate(mirror.value,observer.object,observer.patches,"")}var temp=observer.patches;if(temp.length>0){observer.patches=[];if(observer.callback){observer.callback(temp)}}return temp}jsonpatch.generate=generate;var _objectKeys;if(Object.keys){_objectKeys=Object.keys}else{_objectKeys=function(obj){var keys=[];for(var o in obj){if(obj.hasOwnProperty(o)){keys.push(o)}}return keys}}function _generate(mirror,obj,patches,path){var newKeys=_objectKeys(obj);var oldKeys=_objectKeys(mirror);var changed=false;var deleted=false;for(var t=oldKeys.length-1;t>=0;t--){var key=oldKeys[t];var oldVal=mirror[key];if(obj.hasOwnProperty(key)){var newVal=obj[key];if(oldVal instanceof Object){_generate(oldVal,newVal,patches,path+"/"+escapePathComponent(key))}else{if(oldVal!=newVal){changed=true;patches.push({op:"replace",path:path+"/"+escapePathComponent(key),value:newVal});mirror[key]=newVal}}}else{patches.push({op:"remove",path:path+"/"+escapePathComponent(key)});delete mirror[key];deleted=true}}if(!deleted&&newKeys.length==oldKeys.length){return}for(var t=0;t<newKeys.length;t++){var key=newKeys[t];if(!mirror.hasOwnProperty(key)){patches.push({op:"add",path:path+"/"+escapePathComponent(key),value:obj[key]});mirror[key]=JSON.parse(JSON.stringify(obj[key]))}}}var _isArray;if(Array.isArray){_isArray=Array.isArray}else{_isArray=function(obj){return obj.push&&typeof obj.length==="number"}}function apply(tree,patches){var result=false,p=0,plen=patches.length,patch;while(p<plen){patch=patches[p];var keys=patch.path.split("/");var obj=tree;var t=1;var len=keys.length;while(true){if(_isArray(obj)){var index=parseInt(keys[t],10);t++;if(t>=len){result=arrOps[patch.op].call(patch,obj,index,tree);break}obj=obj[index]}else{var key=keys[t];if(key.indexOf("~")!=-1){key=key.replace(/~1/g,"/").replace(/~0/g,"~")}t++;if(t>=len){result=objOps[patch.op].call(patch,obj,key,tree);break}obj=obj[key]}}p++}return result}jsonpatch.apply=apply})(jsonpatch||(jsonpatch={}));if(typeof exports!=="undefined"){exports.apply=jsonpatch.apply;exports.observe=jsonpatch.observe;exports.unobserve=jsonpatch.unobserve;exports.generate=jsonpatch.generate}Handsontable.PluginHookClass=(function(){var Hooks=function(){return{beforeInitWalkontable:[],beforeInit:[],beforeRender:[],beforeSetRangeEnd:[],beforeDrawBorders:[],beforeChange:[],beforeChangeRender:[],beforeRemoveCol:[],beforeRemoveRow:[],beforeValidate:[],beforeGetCellMeta:[],beforeAutofill:[],beforeKeyDown:[],beforeOnCellMouseDown:[],beforeTouchScroll:[],afterInit:[],afterLoadData:[],afterUpdateSettings:[],afterRender:[],afterRenderer:[],afterChange:[],afterValidate:[],afterGetCellMeta:[],afterSetCellMeta:[],afterGetColHeader:[],afterGetRowHeader:[],afterDestroy:[],afterRemoveRow:[],afterCreateRow:[],afterRemoveCol:[],afterCreateCol:[],afterDeselect:[],afterSelection:[],afterSelectionByProp:[],afterSelectionEnd:[],afterSelectionEndByProp:[],afterOnCellMouseDown:[],afterOnCellMouseOver:[],afterOnCellCornerMouseDown:[],afterScrollVertically:[],afterScrollHorizontally:[],afterCellMetaReset:[],afterIsMultipleSelectionCheck:[],afterDocumentKeyDown:[],afterMomentumScroll:[],modifyColWidth:[],modifyRowHeight:[],modifyRow:[],modifyCol:[]}};var legacy={onBeforeChange:"beforeChange",onChange:"afterChange",onCreateRow:"afterCreateRow",onCreateCol:"afterCreateCol",onSelection:"afterSelection",onCopyLimit:"afterCopyLimit",onSelectionEnd:"afterSelectionEnd",onSelectionByProp:"afterSelectionByProp",onSelectionEndByProp:"afterSelectionEndByProp"};function PluginHookClass(){this.hooks=Hooks();this.globalBucket={};this.legacy=legacy}PluginHookClass.prototype.getBucket=function(instance){if(instance){if(!instance.pluginHookBucket){instance.pluginHookBucket={}}return instance.pluginHookBucket}return this.globalBucket};PluginHookClass.prototype.add=function(key,fn,instance){if(Handsontable.helper.isArray(fn)){for(var i=0,len=fn.length;i<len;i++){this.add(key,fn[i])}}else{if(key in legacy){key=legacy[key]}var bucket=this.getBucket(instance);if(typeof bucket[key]==="undefined"){bucket[key]=[]}fn.skip=false;if(bucket[key].indexOf(fn)==-1){bucket[key].push(fn)}}return this};PluginHookClass.prototype.once=function(key,fn,instance){if(Handsontable.helper.isArray(fn)){for(var i=0,len=fn.length;i<len;i++){fn[i].runOnce=true;this.add(key,fn[i],instance)}}else{fn.runOnce=true;this.add(key,fn,instance)}};PluginHookClass.prototype.remove=function(key,fn,instance){var status=false;if(key in legacy){key=legacy[key]}var bucket=this.getBucket(instance);if(typeof bucket[key]!=="undefined"){for(var i=0,leni=bucket[key].length;i<leni;i++){if(bucket[key][i]==fn){bucket[key][i].skip=true;status=true;break}}}return status};PluginHookClass.prototype.run=function(instance,key,p1,p2,p3,p4,p5,p6){if(key in legacy){key=legacy[key]}this._runBucket(this.globalBucket,instance,key,p1,p2,p3,p4,p5,p6);this._runBucket(this.getBucket(instance),instance,key,p1,p2,p3,p4,p5,p6)};PluginHookClass.prototype._runBucket=function(bucket,instance,key,p1,p2,p3,p4,p5,p6){var handlers=bucket[key];if(handlers){for(var i=0,leni=handlers.length;i<leni;i++){if(!handlers[i].skip){handlers[i].call(instance,p1,p2,p3,p4,p5,p6);if(handlers[i].runOnce){this.remove(key,handlers[i],bucket===this.globalBucket?null:instance)}}}}};PluginHookClass.prototype.destroy=function(instance){var bucket=this.getBucket(instance);for(var key in bucket){if(bucket.hasOwnProperty(key)){for(var i=0,leni=bucket[key].length;i<leni;i++){this.remove(key,bucket[key],instance)}}}};PluginHookClass.prototype.execute=function(instance,key,p1,p2,p3,p4,p5,p6){if(key in legacy){key=legacy[key]}p1=this._executeBucket(this.globalBucket,instance,key,p1,p2,p3,p4,p5,p6);p1=this._executeBucket(this.getBucket(instance),instance,key,p1,p2,p3,p4,p5,p6);return p1};PluginHookClass.prototype._executeBucket=function(bucket,instance,key,p1,p2,p3,p4,p5,p6){var res,handlers=bucket[key];if(handlers){for(var i=0,leni=handlers.length;i<leni;i++){if(!handlers[i].skip){res=handlers[i].call(instance,p1,p2,p3,p4,p5,p6);if(res!==void 0){p1=res}if(handlers[i].runOnce){this.remove(key,handlers[i],bucket===this.globalBucket?null:instance)}if(res===false){return false}}}}return p1};PluginHookClass.prototype.register=function(key){if(!this.isRegistered(key)){this.hooks[key]=[]}};PluginHookClass.prototype.deregister=function(key){delete this.hooks[key]};PluginHookClass.prototype.isRegistered=function(key){return(typeof this.hooks[key]!=="undefined")};PluginHookClass.prototype.getRegistered=function(){return Object.keys(this.hooks)};return PluginHookClass})();Handsontable.hooks=new Handsontable.PluginHookClass();Handsontable.PluginHooks=Handsontable.hooks;(function(Handsontable){function HandsontableAutoColumnSize(){var plugin=this,sampleCount=5;this.beforeInit=function(){var instance=this;instance.autoColumnWidths=[];if(instance.getSettings().autoColumnSize!==false){if(!instance.autoColumnSizeTmp){instance.autoColumnSizeTmp={table:null,tableStyle:null,theadTh:null,tbody:null,container:null,containerStyle:null,determineBeforeNextRender:true};instance.addHook("beforeRender",htAutoColumnSize.determineIfChanged);instance.addHook("modifyColWidth",htAutoColumnSize.modifyColWidth);instance.addHook("afterDestroy",htAutoColumnSize.afterDestroy);instance.determineColumnWidth=plugin.determineColumnWidth}}else{if(instance.autoColumnSizeTmp){instance.removeHook("beforeRender",htAutoColumnSize.determineIfChanged);instance.removeHook("modifyColWidth",htAutoColumnSize.modifyColWidth);instance.removeHook("afterDestroy",htAutoColumnSize.afterDestroy);delete instance.determineColumnWidth;plugin.afterDestroy.call(instance)}}};this.determineIfChanged=function(force){if(force){htAutoColumnSize.determineColumnsWidth.apply(this,arguments)}};this.determineColumnWidth=function(col){var instance=this,tmp=instance.autoColumnSizeTmp;if(!tmp.container){createTmpContainer.call(tmp,instance)}tmp.container.className=instance.rootElement.className+" htAutoColumnSize";tmp.table.className=instance.table.className;var rows=instance.countRows();var samples={};var maxLen=0;for(var r=0;r<rows;r++){var value=Handsontable.helper.stringify(instance.getDataAtCell(r,col));var len=value.length;if(len>maxLen){maxLen=len}if(!samples[len]){samples[len]={needed:sampleCount,strings:[]}}if(samples[len].needed){samples[len].strings.push({value:value,row:r});samples[len].needed--}}var settings=instance.getSettings();if(settings.colHeaders){instance.view.appendColHeader(col,tmp.theadTh)}Handsontable.Dom.empty(tmp.tbody);for(var i in samples){if(samples.hasOwnProperty(i)){for(var j=0,jlen=samples[i].strings.length;j<jlen;j++){var row=samples[i].strings[j].row;var cellProperties=instance.getCellMeta(row,col);cellProperties.col=col;cellProperties.row=row;var renderer=instance.getCellRenderer(cellProperties);var tr=document.createElement("tr");var td=document.createElement("td");renderer(instance,td,row,col,instance.colToProp(col),samples[i].strings[j].value,cellProperties);r++;tr.appendChild(td);tmp.tbody.appendChild(tr)}}}var parent=instance.rootElement.parentNode;parent.appendChild(tmp.container);var width=Handsontable.Dom.outerWidth(tmp.table);parent.removeChild(tmp.container);return width};this.determineColumnsWidth=function(){var instance=this;var settings=this.getSettings();if(settings.autoColumnSize||!settings.colWidths){var cols=this.countCols();for(var c=0;c<cols;c++){if(!instance._getColWidthFromSettings(c)){this.autoColumnWidths[c]=plugin.determineColumnWidth.call(instance,c)}}}};this.modifyColWidth=function(width,col){if(this.autoColumnWidths[col]&&this.autoColumnWidths[col]>width){return this.autoColumnWidths[col]}return width};this.afterDestroy=function(){var instance=this;if(instance.autoColumnSizeTmp&&instance.autoColumnSizeTmp.container&&instance.autoColumnSizeTmp.container.parentNode){instance.autoColumnSizeTmp.container.parentNode.removeChild(instance.autoColumnSizeTmp.container)}instance.autoColumnSizeTmp=null};function createTmpContainer(instance){var d=document,tmp=this;tmp.table=d.createElement("table");tmp.theadTh=d.createElement("th");tmp.table.appendChild(d.createElement("thead")).appendChild(d.createElement("tr")).appendChild(tmp.theadTh);tmp.tableStyle=tmp.table.style;tmp.tableStyle.tableLayout="auto";tmp.tableStyle.width="auto";tmp.tbody=d.createElement("tbody");tmp.table.appendChild(tmp.tbody);tmp.container=d.createElement("div");tmp.container.className=instance.rootElement.className+" hidden";tmp.containerStyle=tmp.container.style;tmp.container.appendChild(tmp.table)}}var htAutoColumnSize=new HandsontableAutoColumnSize();Handsontable.hooks.add("beforeInit",htAutoColumnSize.beforeInit);Handsontable.hooks.add("afterUpdateSettings",htAutoColumnSize.beforeInit)})(Handsontable);function HandsontableColumnSorting(){var plugin=this;this.init=function(source){var instance=this;var sortingSettings=instance.getSettings().columnSorting;var sortingColumn,sortingOrder;instance.sortingEnabled=!!(sortingSettings);if(instance.sortingEnabled){instance.sortIndex=[];var loadedSortingState=loadSortingState.call(instance);if(typeof loadedSortingState!="undefined"){sortingColumn=loadedSortingState.sortColumn;sortingOrder=loadedSortingState.sortOrder}else{sortingColumn=sortingSettings.column;sortingOrder=sortingSettings.sortOrder}plugin.sortByColumn.call(instance,sortingColumn,sortingOrder);instance.sort=function(){var args=Array.prototype.slice.call(arguments);return plugin.sortByColumn.apply(instance,args)};if(typeof instance.getSettings().observeChanges=="undefined"){enableObserveChangesPlugin.call(instance)}if(source=="afterInit"){bindColumnSortingAfterClick.call(instance);instance.addHook("afterCreateRow",plugin.afterCreateRow);instance.addHook("afterRemoveRow",plugin.afterRemoveRow);instance.addHook("afterLoadData",plugin.init)}}else{delete instance.sort;instance.removeHook("afterCreateRow",plugin.afterCreateRow);instance.removeHook("afterRemoveRow",plugin.afterRemoveRow);instance.removeHook("afterLoadData",plugin.init)}};this.setSortingColumn=function(col,order){var instance=this;if(typeof col=="undefined"){delete instance.sortColumn;delete instance.sortOrder;return}else{if(instance.sortColumn===col&&typeof order=="undefined"){instance.sortOrder=!instance.sortOrder}else{instance.sortOrder=typeof order!="undefined"?order:true}}instance.sortColumn=col};this.sortByColumn=function(col,order){var instance=this;plugin.setSortingColumn.call(instance,col,order);if(typeof instance.sortColumn=="undefined"){return}Handsontable.hooks.run(instance,"beforeColumnSort",instance.sortColumn,instance.sortOrder);plugin.sort.call(instance);instance.render();saveSortingState.call(instance);Handsontable.hooks.run(instance,"afterColumnSort",instance.sortColumn,instance.sortOrder)};var saveSortingState=function(){var instance=this;var sortingState={};if(typeof instance.sortColumn!="undefined"){sortingState.sortColumn=instance.sortColumn}if(typeof instance.sortOrder!="undefined"){sortingState.sortOrder=instance.sortOrder}if(sortingState.hasOwnProperty("sortColumn")||sortingState.hasOwnProperty("sortOrder")){Handsontable.hooks.run(instance,"persistentStateSave","columnSorting",sortingState)}};var loadSortingState=function(){var instance=this;var storedState={};Handsontable.hooks.run(instance,"persistentStateLoad","columnSorting",storedState);return storedState.value};var bindColumnSortingAfterClick=function(){var instance=this;var eventManager=Handsontable.eventManager(instance);eventManager.addEventListener(instance.rootElement,"click",function(e){if(Handsontable.Dom.hasClass(e.target,"columnSorting")){var col=getColumn(e.target);plugin.sortByColumn.call(instance,col)}});function countRowHeaders(){var THs=instance.view.TBODY.querySelector("tr").querySelectorAll("th");return THs.length}function getColumn(target){var TH=Handsontable.Dom.closest(target,"TH");return Handsontable.Dom.index(TH)-countRowHeaders()}};function enableObserveChangesPlugin(){var instance=this;instance._registerTimeout(setTimeout(function(){instance.updateSettings({observeChanges:true})},0))}function defaultSort(sortOrder){return function(a,b){if(typeof a[1]=="string"){a[1]=a[1].toLowerCase()}if(typeof b[1]=="string"){b[1]=b[1].toLowerCase()}if(a[1]===b[1]){return 0}if(a[1]===null||a[1]===""){return 1}if(b[1]===null||b[1]===""){return -1}if(a[1]<b[1]){return sortOrder?-1:1}if(a[1]>b[1]){return sortOrder?1:-1}return 0}}function dateSort(sortOrder){return function(a,b){if(a[1]===b[1]){return 0}if(a[1]===null){return 1}if(b[1]===null){return -1}var aDate=new Date(a[1]);var bDate=new Date(b[1]);if(aDate<bDate){return sortOrder?-1:1}if(aDate>bDate){return sortOrder?1:-1}return 0}}this.sort=function(){var instance=this;if(typeof instance.sortOrder=="undefined"){return}instance.sortingEnabled=false;instance.sortIndex.length=0;var colOffset=this.colOffset();for(var i=0,ilen=this.countRows()-instance.getSettings()["minSpareRows"];i<ilen;i++){this.sortIndex.push([i,instance.getDataAtCell(i,this.sortColumn+colOffset)])}var colMeta=instance.getCellMeta(0,instance.sortColumn);var sortFunction;switch(colMeta.type){case"date":sortFunction=dateSort;break;default:sortFunction=defaultSort}this.sortIndex.sort(sortFunction(instance.sortOrder));for(var i=this.sortIndex.length;i<instance.countRows();i++){this.sortIndex.push([i,instance.getDataAtCell(i,this.sortColumn+colOffset)])}instance.sortingEnabled=true};this.translateRow=function(row){var instance=this;if(instance.sortingEnabled&&instance.sortIndex&&instance.sortIndex.length&&instance.sortIndex[row]){return instance.sortIndex[row][0]}return row};this.untranslateRow=function(row){var instance=this;if(instance.sortingEnabled&&instance.sortIndex&&instance.sortIndex.length){for(var i=0;i<instance.sortIndex.length;i++){if(instance.sortIndex[i][0]==row){return i}}}};this.getColHeader=function(col,TH){if(this.getSettings().columnSorting&&col>=0){Handsontable.Dom.addClass(TH.querySelector(".colHeader"),"columnSorting")}};function isSorted(instance){return typeof instance.sortColumn!="undefined"}this.afterCreateRow=function(index,amount){var instance=this;if(!isSorted(instance)){return}for(var i=0;i<instance.sortIndex.length;i++){if(instance.sortIndex[i][0]>=index){instance.sortIndex[i][0]+=amount}}for(var i=0;i<amount;i++){instance.sortIndex.splice(index+i,0,[index+i,instance.getData()[index+i][instance.sortColumn+instance.colOffset()]])}saveSortingState.call(instance)};this.afterRemoveRow=function(index,amount){var instance=this;if(!isSorted(instance)){return}var physicalRemovedIndex=plugin.translateRow.call(instance,index);instance.sortIndex.splice(index,amount);for(var i=0;i<instance.sortIndex.length;i++){if(instance.sortIndex[i][0]>physicalRemovedIndex){instance.sortIndex[i][0]-=amount}}saveSortingState.call(instance)};this.afterChangeSort=function(changes){var instance=this;var sortColumnChanged=false;var selection={};if(!changes){return}for(var i=0;i<changes.length;i++){if(changes[i][1]==instance.sortColumn){sortColumnChanged=true;selection.row=plugin.translateRow.call(instance,changes[i][0]);selection.col=changes[i][1];break}}if(sortColumnChanged){instance._registerTimeout(setTimeout(function(){plugin.sort.call(instance);instance.render();instance.selectCell(plugin.untranslateRow.call(instance,selection.row),selection.col)},0))}}}var htSortColumn=new HandsontableColumnSorting();Handsontable.hooks.add("afterInit",function(){htSortColumn.init.call(this,"afterInit")});Handsontable.hooks.add("afterUpdateSettings",function(){htSortColumn.init.call(this,"afterUpdateSettings")});Handsontable.hooks.add("modifyRow",htSortColumn.translateRow);Handsontable.hooks.add("afterGetColHeader",htSortColumn.getColHeader);Handsontable.hooks.register("beforeColumnSort");Handsontable.hooks.register("afterColumnSort");(function(Handsontable){function prepareVerticalAlignClass(className,alignment){if(className.indexOf(alignment)!=-1){return className}className=className.replace("htTop","").replace("htMiddle","").replace("htBottom","").replace("  ","");className+=" "+alignment;return className}function prepareHorizontalAlignClass(className,alignment){if(className.indexOf(alignment)!=-1){return className}className=className.replace("htLeft","").replace("htCenter","").replace("htRight","").replace("htJustify","").replace("  ","");className+=" "+alignment;return className}function doAlign(row,col,type,alignment){var cellMeta=this.getCellMeta(row,col),className=alignment;if(cellMeta.className){if(type==="vertical"){className=prepareVerticalAlignClass(cellMeta.className,alignment)}else{className=prepareHorizontalAlignClass(cellMeta.className,alignment)}}this.setCellMeta(row,col,"className",className);this.render()}function align(range,type,alignment){if(range.from.row==range.to.row&&range.from.col==range.to.col){doAlign.call(this,range.from.row,range.from.col,type,alignment)}else{for(var row=range.from.row;row<=range.to.row;row++){for(var col=range.from.col;col<=range.to.col;col++){doAlign.call(this,row,col,type,alignment)}}}}function ContextMenu(instance,customOptions){this.instance=instance;var contextMenu=this;contextMenu.menus=[];contextMenu.htMenus={};contextMenu.triggerRows=[];contextMenu.eventManager=Handsontable.eventManager(contextMenu);this.enabled=true;this.instance.addHook("afterDestroy",function(){contextMenu.destroy()});this.defaultOptions={items:[{key:"row_above",name:"Insert row above",callback:function(key,selection){this.alter("insert_row",selection.start.row)},disabled:function(){var selected=this.getSelected(),entireColumnSelection=[0,selected[1],this.countRows()-1,selected[1]],columnSelected=entireColumnSelection.join(",")==selected.join(",");return selected[0]<0||this.countRows()>=this.getSettings().maxRows||columnSelected}},{key:"row_below",name:"Insert row below",callback:function(key,selection){this.alter("insert_row",selection.end.row+1)},disabled:function(){var selected=this.getSelected(),entireColumnSelection=[0,selected[1],this.countRows()-1,selected[1]],columnSelected=entireColumnSelection.join(",")==selected.join(",");return this.getSelected()[0]<0||this.countRows()>=this.getSettings().maxRows||columnSelected}},ContextMenu.SEPARATOR,{key:"col_left",name:"Insert column on the left",callback:function(key,selection){this.alter("insert_col",selection.start.col)},disabled:function(){var selected=this.getSelected(),entireRowSelection=[selected[0],0,selected[0],this.countCols()-1],rowSelected=entireRowSelection.join(",")==selected.join(",");return this.getSelected()[1]<0||this.countCols()>=this.getSettings().maxCols||rowSelected}},{key:"col_right",name:"Insert column on the right",callback:function(key,selection){this.alter("insert_col",selection.end.col+1)},disabled:function(){var selected=this.getSelected(),entireRowSelection=[selected[0],0,selected[0],this.countCols()-1],rowSelected=entireRowSelection.join(",")==selected.join(",");return selected[1]<0||this.countCols()>=this.getSettings().maxCols||rowSelected}},ContextMenu.SEPARATOR,{key:"remove_row",name:"Remove row",callback:function(key,selection){var amount=selection.end.row-selection.start.row+1;this.alter("remove_row",selection.start.row,amount)},disabled:function(){var selected=this.getSelected(),entireColumnSelection=[0,selected[1],this.countRows()-1,selected[1]],columnSelected=entireColumnSelection.join(",")==selected.join(",");return(selected[0]<0||columnSelected)}},{key:"remove_col",name:"Remove column",callback:function(key,selection){var amount=selection.end.col-selection.start.col+1;this.alter("remove_col",selection.start.col,amount)},disabled:function(){var selected=this.getSelected(),entireRowSelection=[selected[0],0,selected[0],this.countCols()-1],rowSelected=entireRowSelection.join(",")==selected.join(",");return(selected[1]<0||rowSelected)}},ContextMenu.SEPARATOR,{key:"undo",name:"Undo",callback:function(){this.undo()},disabled:function(){return this.undoRedo&&!this.undoRedo.isUndoAvailable()}},{key:"redo",name:"Redo",callback:function(){this.redo()},disabled:function(){return this.undoRedo&&!this.undoRedo.isRedoAvailable()}},ContextMenu.SEPARATOR,{key:"make_read_only",name:function(){var label="Read only";var atLeastOneReadOnly=contextMenu.checkSelectionReadOnlyConsistency(this);if(atLeastOneReadOnly){label=contextMenu.markSelected(label)}return label},callback:function(){var atLeastOneReadOnly=contextMenu.checkSelectionReadOnlyConsistency(this);var that=this;this.getSelectedRange().forAll(function(r,c){that.getCellMeta(r,c).readOnly=atLeastOneReadOnly?false:true});this.render()}},ContextMenu.SEPARATOR,{key:"alignment",name:"Alignment",submenu:{items:[{name:function(){var label="Left";var hasClass=contextMenu.checkSelectionAlignment(this,"htLeft");if(hasClass){label=contextMenu.markSelected(label)}return label},callback:function(){align.call(this,this.getSelectedRange(),"horizontal","htLeft")},disabled:false},{name:function(){var label="Center";var hasClass=contextMenu.checkSelectionAlignment(this,"htCenter");if(hasClass){label=contextMenu.markSelected(label)}return label},callback:function(){align.call(this,this.getSelectedRange(),"horizontal","htCenter")},disabled:false},{name:function(){var label="Right";var hasClass=contextMenu.checkSelectionAlignment(this,"htRight");if(hasClass){label=contextMenu.markSelected(label)}return label},callback:function(){align.call(this,this.getSelectedRange(),"horizontal","htRight")},disabled:false},{name:function(){var label="Justify";var hasClass=contextMenu.checkSelectionAlignment(this,"htJustify");if(hasClass){label=contextMenu.markSelected(label)}return label},callback:function(){align.call(this,this.getSelectedRange(),"horizontal","htJustify")},disabled:false},ContextMenu.SEPARATOR,{name:function(){var label="Top";var hasClass=contextMenu.checkSelectionAlignment(this,"htTop");if(hasClass){label=contextMenu.markSelected(label)}return label},callback:function(){align.call(this,this.getSelectedRange(),"vertical","htTop")},disabled:false},{name:function(){var label="Middle";var hasClass=contextMenu.checkSelectionAlignment(this,"htMiddle");if(hasClass){label=contextMenu.markSelected(label)}return label},callback:function(){align.call(this,this.getSelectedRange(),"vertical","htMiddle")},disabled:false},{name:function(){var label="Bottom";var hasClass=contextMenu.checkSelectionAlignment(this,"htBottom");if(hasClass){label=contextMenu.markSelected(label)}return label},callback:function(){align.call(this,this.getSelectedRange(),"vertical","htBottom")},disabled:false}]}}]};contextMenu.options={};Handsontable.helper.extend(contextMenu.options,this.options);this.bindMouseEvents();this.markSelected=function(label){return"<span class='selected'>✓</span>"+label};this.checkSelectionAlignment=function(hot,className){var hasAlignment=false;hot.getSelectedRange().forAll(function(r,c){var metaClassName=hot.getCellMeta(r,c).className;if(metaClassName&&metaClassName.indexOf(className)!=-1){hasAlignment=true;return false}});return hasAlignment};if(!this.instance.getSettings().allowInsertRow){var rowAboveIndex=findIndexByKey(this.defaultOptions.items,"row_above");this.defaultOptions.items.splice(rowAboveIndex,1);var rowBelowIndex=findIndexByKey(this.defaultOptions.items,"row_above");this.defaultOptions.items.splice(rowBelowIndex,1);this.defaultOptions.items.splice(rowBelowIndex,1)}if(!this.instance.getSettings().allowInsertColumn){var colLeftIndex=findIndexByKey(this.defaultOptions.items,"col_left");this.defaultOptions.items.splice(colLeftIndex,1);var colRightIndex=findIndexByKey(this.defaultOptions.items,"col_right");this.defaultOptions.items.splice(colRightIndex,1);this.defaultOptions.items.splice(colRightIndex,1)}var removeRow=false;var removeCol=false;var removeRowIndex,removeColumnIndex;if(!this.instance.getSettings().allowRemoveRow){removeRowIndex=findIndexByKey(this.defaultOptions.items,"remove_row");this.defaultOptions.items.splice(removeRowIndex,1);removeRow=true}if(!this.instance.getSettings().allowRemoveColumn){removeColumnIndex=findIndexByKey(this.defaultOptions.items,"remove_col");this.defaultOptions.items.splice(removeColumnIndex,1);removeCol=true}if(removeRow&&removeCol){this.defaultOptions.items.splice(removeColumnIndex,1)}this.checkSelectionReadOnlyConsistency=function(hot){var atLeastOneReadOnly=false;hot.getSelectedRange().forAll(function(r,c){if(hot.getCellMeta(r,c).readOnly){atLeastOneReadOnly=true;return false}});return atLeastOneReadOnly};Handsontable.hooks.run(instance,"afterContextMenuDefaultOptions",this.defaultOptions)}ContextMenu.prototype.createMenu=function(menuName,row){if(menuName){menuName=menuName.replace(/ /g,"_");menuName="htContextSubMenu_"+menuName}var menu;if(menuName){menu=document.querySelector(".htContextMenu."+menuName)}else{menu=document.querySelector(".htContextMenu")}if(!menu){menu=document.createElement("DIV");Handsontable.Dom.addClass(menu,"htContextMenu");if(menuName){Handsontable.Dom.addClass(menu,menuName)}document.getElementsByTagName("body")[0].appendChild(menu)}if(this.menus.indexOf(menu)<0){this.menus.push(menu);row=row||0;this.triggerRows.push(row)}return menu};ContextMenu.prototype.bindMouseEvents=function(){function contextMenuOpenListener(event){var settings=this.instance.getSettings();this.closeAll();event.preventDefault();Handsontable.helper.stopPropagation(event);var showRowHeaders=this.instance.getSettings().rowHeaders,showColHeaders=this.instance.getSettings().colHeaders;if(!(showRowHeaders||showColHeaders)){if(event.target.nodeName!="TD"&&!(Handsontable.Dom.hasClass(event.target,"current")&&Handsontable.Dom.hasClass(event.target,"wtBorder"))){return}}var menu=this.createMenu();var items=this.getItems(settings.contextMenu);this.show(menu,items);this.setMenuPosition(event,menu);this.eventManager.addEventListener(document.documentElement,"mousedown",Handsontable.helper.proxy(ContextMenu.prototype.closeAll,this))}var eventManager=Handsontable.eventManager(this.instance);eventManager.addEventListener(this.instance.rootElement,"contextmenu",Handsontable.helper.proxy(contextMenuOpenListener,this))};ContextMenu.prototype.bindTableEvents=function(){this._afterScrollCallback=function(){};this.instance.addHook("afterScrollVertically",this._afterScrollCallback);this.instance.addHook("afterScrollHorizontally",this._afterScrollCallback)};ContextMenu.prototype.unbindTableEvents=function(){if(this._afterScrollCallback){this.instance.removeHook("afterScrollVertically",this._afterScrollCallback);this.instance.removeHook("afterScrollHorizontally",this._afterScrollCallback);this._afterScrollCallback=null}};ContextMenu.prototype.performAction=function(event,hot){var contextMenu=this;var selectedItemIndex=hot.getSelected()[0];var selectedItem=hot.getData()[selectedItemIndex];if(selectedItem.disabled===true||(typeof selectedItem.disabled=="function"&&selectedItem.disabled.call(this.instance)===true)){return}if(!selectedItem.hasOwnProperty("submenu")){if(typeof selectedItem.callback!="function"){return}var selRange=this.instance.getSelectedRange();var normalizedSelection=ContextMenu.utils.normalizeSelection(selRange);selectedItem.callback.call(this.instance,selectedItem.key,normalizedSelection,event);contextMenu.closeAll()}};ContextMenu.prototype.unbindMouseEvents=function(){this.eventManager.clear();var eventManager=Handsontable.eventManager(this.instance);eventManager.removeEventListener(this.instance.rootElement,"contextmenu")};ContextMenu.prototype.show=function(menu,items){var that=this;menu.removeAttribute("style");menu.style.display="block";var settings={data:items,colHeaders:false,colWidths:[200],readOnly:true,copyPaste:false,columns:[{data:"name",renderer:Handsontable.helper.proxy(this.renderer,this)}],renderAllRows:true};var htContextMenu=new Handsontable(menu,settings);htContextMenu.updateSettings({beforeKeyDown:function(event){that.onBeforeKeyDown(event,htContextMenu)},afterOnCellMouseOver:function(event,coords,TD){that.onCellMouseOver(event,coords,TD,htContextMenu)}});this.eventManager.removeEventListener(menu,"mousedown");this.eventManager.addEventListener(menu,"mousedown",function(event){that.performAction(event,htContextMenu)});this.bindTableEvents();htContextMenu.listen();this.htMenus[htContextMenu.guid]=htContextMenu};ContextMenu.prototype.close=function(menu){this.hide(menu);this.eventManager.clear();this.unbindTableEvents();this.instance.listen()};ContextMenu.prototype.closeAll=function(){while(this.menus.length>0){var menu=this.menus.pop();if(menu){this.close(menu)}}this.triggerRows=[]};ContextMenu.prototype.closeLastOpenedSubMenu=function(){var menu=this.menus.pop();if(menu){this.hide(menu)}};ContextMenu.prototype.hide=function(menu){menu.style.display="none";var instance=this.htMenus[menu.id];instance.destroy();delete this.htMenus[menu.id]};ContextMenu.prototype.renderer=function(instance,TD,row,col,prop,value){var contextMenu=this;var item=instance.getData()[row];var wrapper=document.createElement("DIV");if(typeof value==="function"){value=value.call(this.instance)}Handsontable.Dom.empty(TD);TD.appendChild(wrapper);if(itemIsSeparator(item)){Handsontable.Dom.addClass(TD,"htSeparator")}else{Handsontable.Dom.fastInnerHTML(wrapper,value)}if(itemIsDisabled(item)){Handsontable.Dom.addClass(TD,"htDisabled");this.eventManager.addEventListener(wrapper,"mouseenter",function(){instance.deselectCell()})}else{if(isSubMenu(item)){Handsontable.Dom.addClass(TD,"htSubmenu");this.eventManager.addEventListener(wrapper,"mouseenter",function(){instance.selectCell(row,col)})}else{Handsontable.Dom.removeClass(TD,"htSubmenu");Handsontable.Dom.removeClass(TD,"htDisabled");this.eventManager.addEventListener(wrapper,"mouseenter",function(){instance.selectCell(row,col)})}}function isSubMenu(item){return item.hasOwnProperty("submenu")}function itemIsSeparator(item){return new RegExp(ContextMenu.SEPARATOR.name,"i").test(item.name)}function itemIsDisabled(item){return item.disabled===true||(typeof item.disabled=="function"&&item.disabled.call(contextMenu.instance)===true)}};ContextMenu.prototype.onCellMouseOver=function(event,coords,TD,hot){var menusLength=this.menus.length;if(menusLength>0){var lastMenu=this.menus[menusLength-1];if(lastMenu.id!=hot.guid){this.closeLastOpenedSubMenu()}}else{this.closeLastOpenedSubMenu()}if(TD.className.indexOf("htSubmenu")!=-1){var selectedItem=hot.getData()[coords.row];var items=this.getItems(selectedItem.submenu);var subMenu=this.createMenu(selectedItem.name,coords.row);var tdCoords=TD.getBoundingClientRect();this.show(subMenu,items);this.setSubMenuPosition(tdCoords,subMenu)}};ContextMenu.prototype.onBeforeKeyDown=function(event,instance){Handsontable.Dom.enableImmediatePropagation(event);var contextMenu=this;var selection=instance.getSelected();switch(event.keyCode){case Handsontable.helper.keyCode.ESCAPE:contextMenu.closeAll();event.preventDefault();event.stopImmediatePropagation();break;case Handsontable.helper.keyCode.ENTER:if(selection){contextMenu.performAction(event,instance)}break;case Handsontable.helper.keyCode.ARROW_DOWN:if(!selection){selectFirstCell(instance,contextMenu)}else{selectNextCell(selection[0],selection[1],instance,contextMenu)}event.preventDefault();event.stopImmediatePropagation();break;case Handsontable.helper.keyCode.ARROW_UP:if(!selection){selectLastCell(instance,contextMenu)}else{selectPrevCell(selection[0],selection[1],instance,contextMenu)}event.preventDefault();event.stopImmediatePropagation();break;case Handsontable.helper.keyCode.ARROW_RIGHT:if(selection){var row=selection[0];var cell=instance.getCell(selection[0],0);if(ContextMenu.utils.hasSubMenu(cell)){openSubMenu(instance,contextMenu,cell,row)}}event.preventDefault();event.stopImmediatePropagation();break;case Handsontable.helper.keyCode.ARROW_LEFT:if(selection){if(instance.rootElement.className.indexOf("htContextSubMenu_")!=-1){contextMenu.closeLastOpenedSubMenu();var index=contextMenu.menus.length;if(index>0){var menu=contextMenu.menus[index-1];var triggerRow=contextMenu.triggerRows.pop();instance=this.htMenus[menu.id];instance.selectCell(triggerRow,0)}}event.preventDefault();event.stopImmediatePropagation()}break}function selectFirstCell(instance){var firstCell=instance.getCell(0,0);if(ContextMenu.utils.isSeparator(firstCell)||ContextMenu.utils.isDisabled(firstCell)){selectNextCell(0,0,instance)}else{instance.selectCell(0,0)}}function selectLastCell(instance){var lastRow=instance.countRows()-1;var lastCell=instance.getCell(lastRow,0);if(ContextMenu.utils.isSeparator(lastCell)||ContextMenu.utils.isDisabled(lastCell)){selectPrevCell(lastRow,0,instance)}else{instance.selectCell(lastRow,0)}}function selectNextCell(row,col,instance){var nextRow=row+1;var nextCell=nextRow<instance.countRows()?instance.getCell(nextRow,col):null;if(!nextCell){return}if(ContextMenu.utils.isSeparator(nextCell)||ContextMenu.utils.isDisabled(nextCell)){selectNextCell(nextRow,col,instance)}else{instance.selectCell(nextRow,col)}}function selectPrevCell(row,col,instance){var prevRow=row-1;var prevCell=prevRow>=0?instance.getCell(prevRow,col):null;if(!prevCell){return}if(ContextMenu.utils.isSeparator(prevCell)||ContextMenu.utils.isDisabled(prevCell)){selectPrevCell(prevRow,col,instance)}else{instance.selectCell(prevRow,col)}}function openSubMenu(instance,contextMenu,cell,row){var selectedItem=instance.getData()[row];var items=contextMenu.getItems(selectedItem.submenu);var subMenu=contextMenu.createMenu(selectedItem.name,row);var coords=cell.getBoundingClientRect();var subMenuInstance=contextMenu.show(subMenu,items);contextMenu.setSubMenuPosition(coords,subMenu);subMenuInstance.selectCell(0,0)}};function findByKey(items,key){for(var i=0,ilen=items.length;i<ilen;i++){if(items[i].key===key){return items[i]}}}function findIndexByKey(items,key){for(var i=0,ilen=items.length;i<ilen;i++){if(items[i].key===key){return i}}}ContextMenu.prototype.getItems=function(items){var menu,item;function ContextMenuItem(rawItem){if(typeof rawItem=="string"){this.name=rawItem}else{Handsontable.helper.extend(this,rawItem)}}ContextMenuItem.prototype=items;if(items&&items.items){items=items.items}if(items===true){items=this.defaultOptions.items}if(1==1){menu=[];for(var key in items){if(items.hasOwnProperty(key)){if(typeof items[key]==="string"){item=findByKey(this.defaultOptions.items,items[key])}else{item=findByKey(this.defaultOptions.items,key)}if(!item){item=items[key]}item=new ContextMenuItem(item);if(typeof items[key]==="object"){Handsontable.helper.extend(item,items[key])}if(!item.key){item.key=key}menu.push(item)}}}return menu};ContextMenu.prototype.setSubMenuPosition=function(coords,menu){var scrollTop=Handsontable.Dom.getWindowScrollTop();var scrollLeft=Handsontable.Dom.getWindowScrollLeft();var cursor={top:scrollTop+coords.top,topRelative:coords.top,left:coords.left,leftRelative:coords.left-scrollLeft,scrollTop:scrollTop,scrollLeft:scrollLeft,cellHeight:coords.height,cellWidth:coords.width};if(this.menuFitsBelowCursor(cursor,menu)){this.positionMenuBelowCursor(cursor,menu,true)}else{if(this.menuFitsAboveCursor(cursor,menu)){this.positionMenuAboveCursor(cursor,menu,true)}else{this.positionMenuBelowCursor(cursor,menu,true)}}if(this.menuFitsOnRightOfCursor(cursor,menu)){this.positionMenuOnRightOfCursor(cursor,menu,true)}else{this.positionMenuOnLeftOfCursor(cursor,menu,true)}};ContextMenu.prototype.setMenuPosition=function(event,menu){var scrollTop=Handsontable.Dom.getWindowScrollTop();var scrollLeft=Handsontable.Dom.getWindowScrollLeft();var cursorY=event.pageY||(event.clientY+scrollTop);var cursorX=event.pageX||(event.clientX+scrollLeft);var cursor={top:cursorY,topRelative:cursorY-scrollTop,left:cursorX,leftRelative:cursorX-scrollLeft,scrollTop:scrollTop,scrollLeft:scrollLeft,cellHeight:event.target.clientHeight,cellWidth:event.target.clientWidth};if(this.menuFitsBelowCursor(cursor,menu)){this.positionMenuBelowCursor(cursor,menu)}else{if(this.menuFitsAboveCursor(cursor,menu)){this.positionMenuAboveCursor(cursor,menu)}else{this.positionMenuBelowCursor(cursor,menu)}}if(this.menuFitsOnRightOfCursor(cursor,menu)){this.positionMenuOnRightOfCursor(cursor,menu)}else{this.positionMenuOnLeftOfCursor(cursor,menu)}};ContextMenu.prototype.menuFitsAboveCursor=function(cursor,menu){return cursor.topRelative>=menu.offsetHeight};ContextMenu.prototype.menuFitsBelowCursor=function(cursor,menu){return cursor.topRelative+menu.offsetHeight<=cursor.scrollTop+document.body.clientHeight};ContextMenu.prototype.menuFitsOnRightOfCursor=function(cursor,menu){return cursor.leftRelative+menu.offsetWidth<=cursor.scrollLeft+document.body.clientWidth};ContextMenu.prototype.positionMenuBelowCursor=function(cursor,menu){menu.style.top=cursor.top+"px"};ContextMenu.prototype.positionMenuAboveCursor=function(cursor,menu,subMenu){if(subMenu){menu.style.top=(cursor.top+cursor.cellHeight-menu.offsetHeight)+"px"}else{menu.style.top=(cursor.top-menu.offsetHeight)+"px"}};ContextMenu.prototype.positionMenuOnRightOfCursor=function(cursor,menu,subMenu){if(subMenu){menu.style.left=1+cursor.left+cursor.cellWidth+"px"}else{menu.style.left=1+cursor.left+"px"}};ContextMenu.prototype.positionMenuOnLeftOfCursor=function(cursor,menu,subMenu){if(subMenu){menu.style.left=(cursor.left-menu.offsetWidth)+"px"}else{menu.style.left=(cursor.left-menu.offsetWidth)+"px"}};ContextMenu.utils={};ContextMenu.utils.normalizeSelection=function(selRange){return{start:selRange.getTopLeftCorner(),end:selRange.getBottomRightCorner()}};ContextMenu.utils.isSeparator=function(cell){return Handsontable.Dom.hasClass(cell,"htSeparator")};ContextMenu.utils.hasSubMenu=function(cell){return Handsontable.Dom.hasClass(cell,"htSubmenu")};ContextMenu.utils.isDisabled=function(cell){return Handsontable.Dom.hasClass(cell,"htDisabled")};ContextMenu.prototype.enable=function(){if(!this.enabled){this.enabled=true;this.bindMouseEvents()}};ContextMenu.prototype.disable=function(){if(this.enabled){this.enabled=false;this.closeAll();this.unbindMouseEvents();this.unbindTableEvents()}};ContextMenu.prototype.destroy=function(){this.closeAll();while(this.menus.length>0){var menu=this.menus.pop();this.triggerRows.pop();if(menu){this.close(menu);if(!this.isMenuEnabledByOtherHotInstance()){this.removeMenu(menu)}}}this.unbindMouseEvents();this.unbindTableEvents()};ContextMenu.prototype.isMenuEnabledByOtherHotInstance=function(){var hotContainers=document.querySelectorAll(".handsontable");var menuEnabled=false;for(var i=0,len=hotContainers.length;i<len;i++){var instance=this.htMenus[hotContainers[i].id];if(instance&&instance.getSettings().contextMenu){menuEnabled=true;break}}return menuEnabled};ContextMenu.prototype.removeMenu=function(menu){if(menu.parentNode){this.menu.parentNode.removeChild(menu)}};ContextMenu.SEPARATOR={name:"---------"};function updateHeight(){if(this.rootElement.className.indexOf("htContextMenu")){return}var realSeparatorHeight=0,realEntrySize=0,dataSize=this.getSettings().data.length;for(var i=0;i<dataSize;i++){if(this.getSettings().data[i].name==ContextMenu.SEPARATOR.name){realSeparatorHeight+=2}else{realEntrySize+=26}}this.view.wt.wtScrollbars.vertical.fixedContainer.style.height=realEntrySize+realSeparatorHeight+"px"}function init(){var instance=this;var contextMenuSetting=instance.getSettings().contextMenu;var customOptions=Handsontable.helper.isObject(contextMenuSetting)?contextMenuSetting:{};if(contextMenuSetting){if(!instance.contextMenu){instance.contextMenu=new ContextMenu(instance,customOptions)}instance.contextMenu.enable()}else{if(instance.contextMenu){instance.contextMenu.destroy();delete instance.contextMenu}}}Handsontable.hooks.add("afterInit",init);Handsontable.hooks.add("afterUpdateSettings",init);Handsontable.hooks.add("afterInit",updateHeight);Handsontable.PluginHooks.register("afterContextMenuDefaultOptions");Handsontable.ContextMenu=ContextMenu})(Handsontable);function Comments(instance){var eventManager=Handsontable.eventManager(instance),doSaveComment=function(row,col,comment,instance){instance.setCellMeta(row,col,"comment",comment);instance.render()},saveComment=function(range,comment,instance){doSaveComment(range.from.row,range.from.col,comment,instance)},hideCommentTextArea=function(){var commentBox=createCommentBox();commentBox.style.display="none";commentBox.value=""},bindMouseEvent=function(range){function commentsListener(event){eventManager.removeEventListener(document,"mouseover");if(!(event.target.className=="htCommentTextArea"||event.target.innerHTML.indexOf("Comment")!=-1)){var value=document.querySelector(".htCommentTextArea").value;if(value.trim().length>1){saveComment(range,value,instance)}unBindMouseEvent();hideCommentTextArea()}}eventManager.addEventListener(document,"mousedown",Handsontable.helper.proxy(commentsListener))},unBindMouseEvent=function(){eventManager.removeEventListener(document,"mousedown");eventManager.addEventListener(document,"mousedown",Handsontable.helper.proxy(commentsMouseOverListener))},placeCommentBox=function(range,commentBox){var TD=instance.view.wt.wtTable.getCell(range.from),offset=Handsontable.Dom.offset(TD),lastColWidth=instance.getColWidth(range.from.col);commentBox.style.position="absolute";commentBox.style.left=offset.left+lastColWidth+"px";commentBox.style.top=offset.top+"px";commentBox.style.zIndex=2;bindMouseEvent(range,commentBox)},createCommentBox=function(value){var comments=document.querySelector(".htComments");if(!comments){comments=document.createElement("DIV");var textArea=document.createElement("TEXTAREA");Handsontable.Dom.addClass(textArea,"htCommentTextArea");comments.appendChild(textArea);Handsontable.Dom.addClass(comments,"htComments");document.getElementsByTagName("body")[0].appendChild(comments)}value=value||"";document.querySelector(".htCommentTextArea").value=value;return comments},commentsMouseOverListener=function(event){if(event.target.className.indexOf("htCommentCell")!=-1){unBindMouseEvent();var coords=instance.view.wt.wtTable.getCoords(event.target);var range={from:new WalkontableCellCoords(coords.row,coords.col)};Handsontable.Comments.showComment(range)}else{if(event.target.className!="htCommentTextArea"){hideCommentTextArea()}}};return{init:function(){eventManager.addEventListener(document,"mouseover",Handsontable.helper.proxy(commentsMouseOverListener))},showComment:function(range){var meta=instance.getCellMeta(range.from.row,range.from.col),value="";if(meta.comment){value=meta.comment}var commentBox=createCommentBox(value);commentBox.style.display="block";placeCommentBox(range,commentBox)},removeComment:function(row,col){instance.removeCellMeta(row,col,"comment");instance.render()},checkSelectionCommentsConsistency:function(){var hasComment=false;var cell=instance.getSelectedRange().from;if(instance.getCellMeta(cell.row,cell.col).comment){hasComment=true}return hasComment}}}var init=function(){var instance=this;var commentsSetting=instance.getSettings().comments;if(commentsSetting){Handsontable.Comments=new Comments(instance);Handsontable.Comments.init()}},afterRenderer=function(TD,row,col,prop,value,cellProperties){if(cellProperties.comment){Handsontable.Dom.addClass(TD,cellProperties.commentedCellClassName)}},addCommentsActionsToContextMenu=function(defaultOptions){var instance=this;if(!instance.getSettings().comments){return}defaultOptions.items.push(Handsontable.ContextMenu.SEPARATOR);defaultOptions.items.push({key:"commentsAddEdit",name:function(){var hasComment=Handsontable.Comments.checkSelectionCommentsConsistency();return hasComment?"Edit Comment":"Add Comment"},callback:function(key,selection,event){Handsontable.Comments.showComment(this.getSelectedRange())},disabled:function(){return false}});defaultOptions.items.push({key:"commentsRemove",name:function(){return"Delete Comment"},callback:function(key,selection,event){Handsontable.Comments.removeComment(selection.start.row,selection.start.col)},disabled:function(){var hasComment=Handsontable.Comments.checkSelectionCommentsConsistency();return !hasComment}})};Handsontable.hooks.add("beforeInit",init);Handsontable.hooks.add("afterContextMenuDefaultOptions",addCommentsActionsToContextMenu);Handsontable.hooks.add("afterRenderer",afterRenderer);(function(Handsontable){function HandsontableManualColumnMove(){var startCol,endCol,startX,startOffset,currentCol,instance,currentTH,handle=document.createElement("DIV"),guide=document.createElement("DIV"),eventManager=Handsontable.eventManager(this);handle.className="manualColumnMover";guide.className="manualColumnMoverGuide";var saveManualColumnPositions=function(){var instance=this;Handsontable.hooks.run(instance,"persistentStateSave","manualColumnPositions",instance.manualColumnPositions)};var loadManualColumnPositions=function(){var instance=this;var storedState={};Handsontable.hooks.run(instance,"persistentStateLoad","manualColumnPositions",storedState);return storedState.value};function setupHandlePosition(TH){instance=this;currentTH=TH;var col=this.view.wt.wtTable.getCoords(TH).col;if(col>=0){currentCol=col;var box=currentTH.getBoundingClientRect();startOffset=box.left;handle.style.top=box.top+"px";handle.style.left=startOffset+"px";instance.rootElement.appendChild(handle)}}function refreshHandlePosition(TH,delta){var box=TH.getBoundingClientRect();var handleWidth=6;if(delta>0){handle.style.left=(box.left+box.width-handleWidth)+"px"}else{handle.style.left=box.left+"px"}}function setupGuidePosition(){var instance=this;Handsontable.Dom.addClass(handle,"active");Handsontable.Dom.addClass(guide,"active");var box=currentTH.getBoundingClientRect();guide.style.width=box.width+"px";guide.style.height=instance.view.maximumVisibleElementHeight(0)+"px";guide.style.top=handle.style.top;guide.style.left=startOffset+"px";instance.rootElement.appendChild(guide)}function refreshGuidePosition(diff){guide.style.left=startOffset+diff+"px"}function hideHandleAndGuide(){Handsontable.Dom.removeClass(handle,"active");Handsontable.Dom.removeClass(guide,"active")}var checkColumnHeader=function(element){if(element.tagName!="BODY"){if(element.parentNode.tagName=="THEAD"){return true}else{element=element.parentNode;return checkColumnHeader(element)}}return false};var getTHFromTargetElement=function(element){if(element.tagName!="TABLE"){if(element.tagName=="TH"){return element}else{return getTHFromTargetElement(element.parentNode)}}return null};var bindEvents=function(){var instance=this;var pressed;eventManager.addEventListener(instance.rootElement,"mouseover",function(e){if(checkColumnHeader(e.target)){var th=getTHFromTargetElement(e.target);if(th){if(pressed){var col=instance.view.wt.wtTable.getCoords(th).col;if(col>=0){endCol=col;refreshHandlePosition(e.target,endCol-startCol)}}else{setupHandlePosition.call(instance,th)}}}});eventManager.addEventListener(instance.rootElement,"mousedown",function(e){if(Handsontable.Dom.hasClass(e.target,"manualColumnMover")){startX=Handsontable.helper.pageX(e);setupGuidePosition.call(instance);pressed=instance;startCol=currentCol;endCol=currentCol}});eventManager.addEventListener(window,"mousemove",function(e){if(pressed){refreshGuidePosition(Handsontable.helper.pageX(e)-startX)}});eventManager.addEventListener(window,"mouseup",function(e){if(pressed){hideHandleAndGuide();pressed=false;createPositionData(instance.manualColumnPositions,instance.countCols());instance.manualColumnPositions.splice(endCol,0,instance.manualColumnPositions.splice(startCol,1)[0]);instance.forceFullRender=true;instance.view.render();saveManualColumnPositions.call(instance);Handsontable.hooks.run(instance,"afterColumnMove",startCol,endCol);setupHandlePosition.call(instance,currentTH)}});instance.addHook("afterDestroy",unbindEvents)};var unbindEvents=function(){eventManager.clear()};var createPositionData=function(positionArr,len){if(positionArr.length<len){for(var i=positionArr.length;i<len;i++){positionArr[i]=i}}};this.beforeInit=function(){this.manualColumnPositions=[]};this.init=function(source){var instance=this;var manualColMoveEnabled=!!(this.getSettings().manualColumnMove);if(manualColMoveEnabled){var initialManualColumnPositions=this.getSettings().manualColumnMove;var loadedManualColumnPositions=loadManualColumnPositions.call(instance);if(typeof loadedManualColumnPositions!="undefined"){this.manualColumnPositions=loadedManualColumnPositions}else{if(initialManualColumnPositions instanceof Array){this.manualColumnPositions=initialManualColumnPositions}else{this.manualColumnPositions=[]}}if(source=="afterInit"){bindEvents.call(this);if(this.manualColumnPositions.length>0){this.forceFullRender=true;this.render()}}}else{unbindEvents.call(this);this.manualColumnPositions=[]}};this.modifyCol=function(col){if(this.getSettings().manualColumnMove){if(typeof this.manualColumnPositions[col]==="undefined"){createPositionData(this.manualColumnPositions,col+1)}return this.manualColumnPositions[col]}return col};this.afterRemoveCol=function(index,amount){if(!this.getSettings().manualColumnMove){return}var rmindx,colpos=this.manualColumnPositions;rmindx=colpos.splice(index,amount);colpos=colpos.map(function(colpos){var i,newpos=colpos;for(i=0;i<rmindx.length;i++){if(colpos>rmindx[i]){newpos--}}return newpos});this.manualColumnPositions=colpos};this.afterCreateCol=function(index,amount){if(!this.getSettings().manualColumnMove){return}var colpos=this.manualColumnPositions;if(!colpos.length){return}var addindx=[];for(var i=0;i<amount;i++){addindx.push(index+i)}if(index>=colpos.length){colpos.concat(addindx)}else{colpos=colpos.map(function(colpos){return(colpos>=index)?(colpos+amount):colpos});colpos.splice.apply(colpos,[index,0].concat(addindx))}this.manualColumnPositions=colpos}}var htManualColumnMove=new HandsontableManualColumnMove();Handsontable.hooks.add("beforeInit",htManualColumnMove.beforeInit);Handsontable.hooks.add("afterInit",function(){htManualColumnMove.init.call(this,"afterInit")});Handsontable.hooks.add("afterUpdateSettings",function(){htManualColumnMove.init.call(this,"afterUpdateSettings")});Handsontable.hooks.add("modifyCol",htManualColumnMove.modifyCol);Handsontable.hooks.add("afterRemoveCol",htManualColumnMove.afterRemoveCol);Handsontable.hooks.add("afterCreateCol",htManualColumnMove.afterCreateCol);Handsontable.hooks.register("afterColumnMove")})(Handsontable);(function(Handsontable){function HandsontableManualColumnResize(){var currentTH,currentCol,currentWidth,instance,newSize,startX,startWidth,startOffset,handle=document.createElement("DIV"),guide=document.createElement("DIV"),eventManager=Handsontable.eventManager(this);handle.className="manualColumnResizer";guide.className="manualColumnResizerGuide";var saveManualColumnWidths=function(){var instance=this;Handsontable.hooks.run(instance,"persistentStateSave","manualColumnWidths",instance.manualColumnWidths)};var loadManualColumnWidths=function(){var instance=this;var storedState={};Handsontable.hooks.run(instance,"persistentStateLoad","manualColumnWidths",storedState);return storedState.value};function setupHandlePosition(TH){instance=this;currentTH=TH;var col=this.view.wt.wtTable.getCoords(TH).col;if(col>=0){currentCol=col;var box=currentTH.getBoundingClientRect();startOffset=box.left-6;startWidth=parseInt(box.width,10);handle.style.top=box.top+"px";handle.style.left=startOffset+startWidth+"px";instance.rootElement.appendChild(handle)}}function refreshHandlePosition(){handle.style.left=startOffset+currentWidth+"px"}function setupGuidePosition(){var instance=this;Handsontable.Dom.addClass(handle,"active");Handsontable.Dom.addClass(guide,"active");guide.style.top=handle.style.top;guide.style.left=handle.style.left;guide.style.height=instance.view.maximumVisibleElementHeight(0)+"px";instance.rootElement.appendChild(guide)}function refreshGuidePosition(){guide.style.left=handle.style.left}function hideHandleAndGuide(){Handsontable.Dom.removeClass(handle,"active");Handsontable.Dom.removeClass(guide,"active")}var checkColumnHeader=function(element){if(element.tagName!="BODY"){if(element.parentNode.tagName=="THEAD"){return true}else{element=element.parentNode;return checkColumnHeader(element)}}return false};var getTHFromTargetElement=function(element){if(element.tagName!="TABLE"){if(element.tagName=="TH"){return element}else{return getTHFromTargetElement(element.parentNode)}}return null};var bindEvents=function(){var instance=this;var pressed;var dblclick=0;var autoresizeTimeout=null;eventManager.addEventListener(instance.rootElement,"mouseover",function(e){if(checkColumnHeader(e.target)){var th=getTHFromTargetElement(e.target);if(th){if(!pressed){setupHandlePosition.call(instance,th)}}}});eventManager.addEventListener(instance.rootElement,"mousedown",function(e){if(Handsontable.Dom.hasClass(e.target,"manualColumnResizer")){setupGuidePosition.call(instance);pressed=instance;if(autoresizeTimeout==null){autoresizeTimeout=setTimeout(function(){if(dblclick>=2){newSize=instance.determineColumnWidth.call(instance,currentCol);setManualSize(currentCol,newSize);instance.forceFullRender=true;instance.view.render();Handsontable.hooks.run(instance,"afterColumnResize",currentCol,newSize)}dblclick=0;autoresizeTimeout=null},500);instance._registerTimeout(autoresizeTimeout)}dblclick++;startX=Handsontable.helper.pageX(e);newSize=startWidth}});eventManager.addEventListener(window,"mousemove",function(e){if(pressed){currentWidth=startWidth+(Handsontable.helper.pageX(e)-startX);newSize=setManualSize(currentCol,currentWidth);refreshHandlePosition();refreshGuidePosition()}});eventManager.addEventListener(window,"mouseup",function(){if(pressed){hideHandleAndGuide();pressed=false;if(newSize!=startWidth){instance.forceFullRender=true;instance.view.render();saveManualColumnWidths.call(instance);Handsontable.hooks.run(instance,"afterColumnResize",currentCol,newSize)}setupHandlePosition.call(instance,currentTH)}});instance.addHook("afterDestroy",unbindEvents)};var unbindEvents=function(){eventManager.clear()};this.beforeInit=function(){this.manualColumnWidths=[]};this.init=function(source){var instance=this;var manualColumnWidthEnabled=!!(this.getSettings().manualColumnResize);if(manualColumnWidthEnabled){var initialColumnWidths=this.getSettings().manualColumnResize;var loadedManualColumnWidths=loadManualColumnWidths.call(instance);if(typeof loadedManualColumnWidths!="undefined"){this.manualColumnWidths=loadedManualColumnWidths}else{if(initialColumnWidths instanceof Array){this.manualColumnWidths=initialColumnWidths}else{this.manualColumnWidths=[]}}if(source=="afterInit"){bindEvents.call(this);if(this.manualColumnWidths.length>0){this.forceFullRender=true;this.render()}}}else{unbindEvents.call(this);this.manualColumnWidths=[]}};var setManualSize=function(col,width){width=Math.max(width,20);col=Handsontable.hooks.execute(instance,"modifyCol",col);instance.manualColumnWidths[col]=width;return width};this.modifyColWidth=function(width,col){col=this.runHooksAndReturn("modifyCol",col);if(this.getSettings().manualColumnResize&&this.manualColumnWidths[col]){return this.manualColumnWidths[col]}return width}}var htManualColumnResize=new HandsontableManualColumnResize();Handsontable.hooks.add("beforeInit",htManualColumnResize.beforeInit);Handsontable.hooks.add("afterInit",function(){htManualColumnResize.init.call(this,"afterInit")});Handsontable.hooks.add("afterUpdateSettings",function(){htManualColumnResize.init.call(this,"afterUpdateSettings")});Handsontable.hooks.add("modifyColWidth",htManualColumnResize.modifyColWidth);Handsontable.hooks.register("afterColumnResize")})(Handsontable);(function(Handsontable){function HandsontableManualRowResize(){var currentTH,currentRow,currentHeight,instance,newSize,startY,startHeight,startOffset,handle=document.createElement("DIV"),guide=document.createElement("DIV"),eventManager=Handsontable.eventManager(this);handle.className="manualRowResizer";guide.className="manualRowResizerGuide";var saveManualRowHeights=function(){var instance=this;Handsontable.hooks.run(instance,"persistentStateSave","manualRowHeights",instance.manualRowHeights)};var loadManualRowHeights=function(){var instance=this,storedState={};Handsontable.hooks.run(instance,"persistentStateLoad","manualRowHeights",storedState);return storedState.value};function setupHandlePosition(TH){instance=this;currentTH=TH;var row=this.view.wt.wtTable.getCoords(TH).row;if(row>=0){currentRow=row;var box=currentTH.getBoundingClientRect();startOffset=box.top-6;startHeight=parseInt(box.height,10);handle.style.left=box.left+"px";handle.style.top=startOffset+startHeight+"px";instance.rootElement.appendChild(handle)}}function refreshHandlePosition(){handle.style.top=startOffset+currentHeight+"px"}function setupGuidePosition(){var instance=this;Handsontable.Dom.addClass(handle,"active");Handsontable.Dom.addClass(guide,"active");guide.style.top=handle.style.top;guide.style.left=handle.style.left;guide.style.width=instance.view.maximumVisibleElementWidth(0)+"px";instance.rootElement.appendChild(guide)}function refreshGuidePosition(){guide.style.top=handle.style.top}function hideHandleAndGuide(){Handsontable.Dom.removeClass(handle,"active");Handsontable.Dom.removeClass(guide,"active")}var checkRowHeader=function(element){if(element.tagName!="BODY"){if(element.parentNode.tagName=="TBODY"){return true}else{element=element.parentNode;return checkRowHeader(element)}}return false};var getTHFromTargetElement=function(element){if(element.tagName!="TABLE"){if(element.tagName=="TH"){return element}else{return getTHFromTargetElement(element.parentNode)}}return null};var bindEvents=function(){var instance=this;var pressed;var dblclick=0;var autoresizeTimeout=null;eventManager.addEventListener(instance.rootElement,"mouseover",function(e){if(checkRowHeader(e.target)){var th=getTHFromTargetElement(e.target);if(th){if(!pressed){setupHandlePosition.call(instance,th)}}}});eventManager.addEventListener(instance.rootElement,"mousedown",function(e){if(Handsontable.Dom.hasClass(e.target,"manualRowResizer")){setupGuidePosition.call(instance);pressed=instance;if(autoresizeTimeout==null){autoresizeTimeout=setTimeout(function(){if(dblclick>=2){setManualSize(currentRow,null);instance.forceFullRender=true;instance.view.render();Handsontable.hooks.run(instance,"afterRowResize",currentRow,newSize)}dblclick=0;autoresizeTimeout=null},500);instance._registerTimeout(autoresizeTimeout)}dblclick++;startY=Handsontable.helper.pageY(e);newSize=startHeight}});eventManager.addEventListener(window,"mousemove",function(e){if(pressed){currentHeight=startHeight+(Handsontable.helper.pageY(e)-startY);newSize=setManualSize(currentRow,currentHeight);refreshHandlePosition();refreshGuidePosition()}});eventManager.addEventListener(window,"mouseup",function(e){if(pressed){hideHandleAndGuide();pressed=false;if(newSize!=startHeight){instance.forceFullRender=true;instance.view.render();saveManualRowHeights.call(instance);Handsontable.hooks.run(instance,"afterRowResize",currentRow,newSize)}setupHandlePosition.call(instance,currentTH)}});instance.addHook("afterDestroy",unbindEvents)};var unbindEvents=function(){eventManager.clear()};this.beforeInit=function(){this.manualRowHeights=[]};this.init=function(source){var instance=this;var manualColumnHeightEnabled=!!(this.getSettings().manualRowResize);if(manualColumnHeightEnabled){var initialRowHeights=this.getSettings().manualRowResize;var loadedManualRowHeights=loadManualRowHeights.call(instance);if(typeof loadedManualRowHeights!="undefined"){this.manualRowHeights=loadedManualRowHeights}else{if(initialRowHeights instanceof Array){this.manualRowHeights=initialRowHeights}else{this.manualRowHeights=[]}}if(source==="afterInit"){bindEvents.call(this);if(this.manualRowHeights.length>0){this.forceFullRender=true;this.render()}}else{this.forceFullRender=true;this.render()}}else{unbindEvents.call(this);this.manualRowHeights=[]}};var setManualSize=function(row,height){row=Handsontable.hooks.execute(instance,"modifyRow",row);instance.manualRowHeights[row]=height;return height};this.modifyRowHeight=function(height,row){if(this.getSettings().manualRowResize){row=this.runHooksAndReturn("modifyRow",row);if(this.manualRowHeights[row]!==void 0){return this.manualRowHeights[row]}}return height}}var htManualRowResize=new HandsontableManualRowResize();Handsontable.hooks.add("beforeInit",htManualRowResize.beforeInit);Handsontable.hooks.add("afterInit",function(){htManualRowResize.init.call(this,"afterInit")});Handsontable.hooks.add("afterUpdateSettings",function(){htManualRowResize.init.call(this,"afterUpdateSettings")});Handsontable.hooks.add("modifyRowHeight",htManualRowResize.modifyRowHeight);Handsontable.hooks.register("afterRowResize")})(Handsontable);(function HandsontableObserveChanges(){Handsontable.hooks.add("afterLoadData",init);Handsontable.hooks.add("afterUpdateSettings",init);Handsontable.hooks.register("afterChangesObserved");function init(){var instance=this;var pluginEnabled=instance.getSettings().observeChanges;if(pluginEnabled){if(instance.observer){destroy.call(instance)}createObserver.call(instance);bindEvents.call(instance)}else{if(!pluginEnabled){destroy.call(instance)}}}function createObserver(){var instance=this;instance.observeChangesActive=true;instance.pauseObservingChanges=function(){instance.observeChangesActive=false};instance.resumeObservingChanges=function(){instance.observeChangesActive=true};instance.observedData=instance.getData();instance.observer=jsonpatch.observe(instance.observedData,function(patches){if(instance.observeChangesActive){runHookForOperation.call(instance,patches);instance.render()}instance.runHooks("afterChangesObserved")})}function runHookForOperation(rawPatches){var instance=this;var patches=cleanPatches(rawPatches);for(var i=0,len=patches.length;i<len;i++){var patch=patches[i];var parsedPath=parsePath(patch.path);switch(patch.op){case"add":if(isNaN(parsedPath.col)){instance.runHooks("afterCreateRow",parsedPath.row)}else{instance.runHooks("afterCreateCol",parsedPath.col)}break;case"remove":if(isNaN(parsedPath.col)){instance.runHooks("afterRemoveRow",parsedPath.row,1)}else{instance.runHooks("afterRemoveCol",parsedPath.col,1)}break;case"replace":instance.runHooks("afterChange",[parsedPath.row,parsedPath.col,null,patch.value],"external");break}}function cleanPatches(rawPatches){var patches;patches=removeLengthRelatedPatches(rawPatches);patches=removeMultipleAddOrRemoveColPatches(patches);return patches}function removeMultipleAddOrRemoveColPatches(rawPatches){var newOrRemovedColumns=[];return rawPatches.filter(function(patch){var parsedPath=parsePath(patch.path);if(["add","remove"].indexOf(patch.op)!=-1&&!isNaN(parsedPath.col)){if(newOrRemovedColumns.indexOf(parsedPath.col)!=-1){return false}else{newOrRemovedColumns.push(parsedPath.col)}}return true})}function removeLengthRelatedPatches(rawPatches){return rawPatches.filter(function(patch){return !/[/]length/ig.test(patch.path)})}function parsePath(path){var match=path.match(/^\/(\d+)\/?(.*)?$/);return{row:parseInt(match[1],10),col:/^\d*$/.test(match[2])?parseInt(match[2],10):match[2]}}}function destroy(){var instance=this;if(instance.observer){destroyObserver.call(instance);unbindEvents.call(instance)}}function destroyObserver(){var instance=this;jsonpatch.unobserve(instance.observedData,instance.observer);delete instance.observeChangesActive;delete instance.pauseObservingChanges;delete instance.resumeObservingChanges}function bindEvents(){var instance=this;instance.addHook("afterDestroy",destroy);instance.addHook("afterCreateRow",afterTableAlter);instance.addHook("afterRemoveRow",afterTableAlter);instance.addHook("afterCreateCol",afterTableAlter);instance.addHook("afterRemoveCol",afterTableAlter);instance.addHook("afterChange",function(changes,source){if(source!="loadData"){afterTableAlter.call(this)}})}function unbindEvents(){var instance=this;instance.removeHook("afterDestroy",destroy);instance.removeHook("afterCreateRow",afterTableAlter);instance.removeHook("afterRemoveRow",afterTableAlter);instance.removeHook("afterCreateCol",afterTableAlter);instance.removeHook("afterRemoveCol",afterTableAlter);instance.removeHook("afterChange",afterTableAlter)}function afterTableAlter(){var instance=this;instance.pauseObservingChanges();instance.addHookOnce("afterChangesObserved",function(){instance.resumeObservingChanges()})}})();function Storage(prefix){var savedKeys;var saveSavedKeys=function(){window.localStorage[prefix+"__persistentStateKeys"]=JSON.stringify(savedKeys)};var loadSavedKeys=function(){var keysJSON=window.localStorage[prefix+"__persistentStateKeys"];var keys=typeof keysJSON=="string"?JSON.parse(keysJSON):void 0;savedKeys=keys?keys:[]};var clearSavedKeys=function(){savedKeys=[];saveSavedKeys()};loadSavedKeys();this.saveValue=function(key,value){window.localStorage[prefix+"_"+key]=JSON.stringify(value);if(savedKeys.indexOf(key)==-1){savedKeys.push(key);saveSavedKeys()}};this.loadValue=function(key,defaultValue){key=typeof key!="undefined"?key:defaultValue;var value=window.localStorage[prefix+"_"+key];return typeof value=="undefined"?void 0:JSON.parse(value)};this.reset=function(key){window.localStorage.removeItem(prefix+"_"+key)};this.resetAll=function(){for(var index=0;index<savedKeys.length;index++){window.localStorage.removeItem(prefix+"_"+savedKeys[index])}clearSavedKeys()}}(function(StorageClass){function HandsontablePersistentState(){var plugin=this;this.init=function(){var instance=this,pluginSettings=instance.getSettings()["persistentState"];plugin.enabled=!!(pluginSettings);if(!plugin.enabled){removeHooks.call(instance);return}if(!instance.storage){instance.storage=new StorageClass(instance.rootElement.id)}instance.resetState=plugin.resetValue;addHooks.call(instance)};this.saveValue=function(key,value){var instance=this;instance.storage.saveValue(key,value)};this.loadValue=function(key,saveTo){var instance=this;saveTo.value=instance.storage.loadValue(key)};this.resetValue=function(key){var instance=this;if(typeof key!="undefined"){instance.storage.reset(key)}else{instance.storage.resetAll()}};var hooks={persistentStateSave:plugin.saveValue,persistentStateLoad:plugin.loadValue,persistentStateReset:plugin.resetValue};for(var hookName in hooks){if(hooks.hasOwnProperty(hookName)){Handsontable.hooks.register(hookName)}}function addHooks(){var instance=this;for(var hookName in hooks){if(hooks.hasOwnProperty(hookName)){instance.addHook(hookName,hooks[hookName])}}}function removeHooks(){var instance=this;for(var hookName in hooks){if(hooks.hasOwnProperty(hookName)){instance.removeHook(hookName,hooks[hookName])}}}}var htPersistentState=new HandsontablePersistentState();Handsontable.hooks.add("beforeInit",htPersistentState.init);Handsontable.hooks.add("afterUpdateSettings",htPersistentState.init)})(Storage);(function(Handsontable){Handsontable.UndoRedo=function(instance){var plugin=this;this.instance=instance;this.doneActions=[];this.undoneActions=[];this.ignoreNewActions=false;instance.addHook("afterChange",function(changes,origin){if(changes){var action=new Handsontable.UndoRedo.ChangeAction(changes);plugin.done(action)}});instance.addHook("afterCreateRow",function(index,amount,createdAutomatically){if(createdAutomatically){return}var action=new Handsontable.UndoRedo.CreateRowAction(index,amount);plugin.done(action)});instance.addHook("beforeRemoveRow",function(index,amount){var originalData=plugin.instance.getData();index=(originalData.length+index)%originalData.length;var removedData=originalData.slice(index,index+amount);var action=new Handsontable.UndoRedo.RemoveRowAction(index,removedData);plugin.done(action)});instance.addHook("afterCreateCol",function(index,amount,createdAutomatically){if(createdAutomatically){return}var action=new Handsontable.UndoRedo.CreateColumnAction(index,amount);plugin.done(action)});instance.addHook("beforeRemoveCol",function(index,amount){var originalData=plugin.instance.getData();index=(plugin.instance.countCols()+index)%plugin.instance.countCols();var removedData=[];for(var i=0,len=originalData.length;i<len;i++){removedData[i]=originalData[i].slice(index,index+amount)}var headers;if(Handsontable.helper.isArray(instance.getSettings().colHeaders)){headers=instance.getSettings().colHeaders.slice(index,index+removedData.length)}var action=new Handsontable.UndoRedo.RemoveColumnAction(index,removedData,headers);plugin.done(action)})};Handsontable.UndoRedo.prototype.done=function(action){if(!this.ignoreNewActions){this.doneActions.push(action);this.undoneActions.length=0}};Handsontable.UndoRedo.prototype.undo=function(){if(this.isUndoAvailable()){var action=this.doneActions.pop();this.ignoreNewActions=true;var that=this;action.undo(this.instance,function(){that.ignoreNewActions=false;that.undoneActions.push(action)})}};Handsontable.UndoRedo.prototype.redo=function(){if(this.isRedoAvailable()){var action=this.undoneActions.pop();this.ignoreNewActions=true;var that=this;action.redo(this.instance,function(){that.ignoreNewActions=false;that.doneActions.push(action)})}};Handsontable.UndoRedo.prototype.isUndoAvailable=function(){return this.doneActions.length>0};Handsontable.UndoRedo.prototype.isRedoAvailable=function(){return this.undoneActions.length>0};Handsontable.UndoRedo.prototype.clear=function(){this.doneActions.length=0;this.undoneActions.length=0};Handsontable.UndoRedo.Action=function(){};Handsontable.UndoRedo.Action.prototype.undo=function(){};Handsontable.UndoRedo.Action.prototype.redo=function(){};Handsontable.UndoRedo.ChangeAction=function(changes){this.changes=changes};Handsontable.helper.inherit(Handsontable.UndoRedo.ChangeAction,Handsontable.UndoRedo.Action);Handsontable.UndoRedo.ChangeAction.prototype.undo=function(instance,undoneCallback){var data=Handsontable.helper.deepClone(this.changes),emptyRowsAtTheEnd=instance.countEmptyRows(true),emptyColsAtTheEnd=instance.countEmptyCols(true);for(var i=0,len=data.length;i<len;i++){data[i].splice(3,1)}instance.addHookOnce("afterChange",undoneCallback);instance.setDataAtRowProp(data,null,null,"undo");for(var i=0,len=data.length;i<len;i++){if(instance.getSettings().minSpareRows&&data[i][0]+1+instance.getSettings().minSpareRows===instance.countRows()&&emptyRowsAtTheEnd==instance.getSettings().minSpareRows){instance.alter("remove_row",parseInt(data[i][0]+1,10),instance.getSettings().minSpareRows);instance.undoRedo.doneActions.pop()}if(instance.getSettings().minSpareCols&&data[i][1]+1+instance.getSettings().minSpareCols===instance.countCols()&&emptyColsAtTheEnd==instance.getSettings().minSpareCols){instance.alter("remove_col",parseInt(data[i][1]+1,10),instance.getSettings().minSpareCols);instance.undoRedo.doneActions.pop()}}};Handsontable.UndoRedo.ChangeAction.prototype.redo=function(instance,onFinishCallback){var data=Handsontable.helper.deepClone(this.changes);for(var i=0,len=data.length;i<len;i++){data[i].splice(2,1)}instance.addHookOnce("afterChange",onFinishCallback);instance.setDataAtRowProp(data,null,null,"redo")};Handsontable.UndoRedo.CreateRowAction=function(index,amount){this.index=index;this.amount=amount};Handsontable.helper.inherit(Handsontable.UndoRedo.CreateRowAction,Handsontable.UndoRedo.Action);Handsontable.UndoRedo.CreateRowAction.prototype.undo=function(instance,undoneCallback){instance.addHookOnce("afterRemoveRow",undoneCallback);instance.alter("remove_row",this.index,this.amount)};Handsontable.UndoRedo.CreateRowAction.prototype.redo=function(instance,redoneCallback){instance.addHookOnce("afterCreateRow",redoneCallback);instance.alter("insert_row",this.index+1,this.amount)};Handsontable.UndoRedo.RemoveRowAction=function(index,data){this.index=index;this.data=data};Handsontable.helper.inherit(Handsontable.UndoRedo.RemoveRowAction,Handsontable.UndoRedo.Action);Handsontable.UndoRedo.RemoveRowAction.prototype.undo=function(instance,undoneCallback){var spliceArgs=[this.index,0];Array.prototype.push.apply(spliceArgs,this.data);Array.prototype.splice.apply(instance.getData(),spliceArgs);instance.addHookOnce("afterRender",undoneCallback);instance.render()};Handsontable.UndoRedo.RemoveRowAction.prototype.redo=function(instance,redoneCallback){instance.addHookOnce("afterRemoveRow",redoneCallback);instance.alter("remove_row",this.index,this.data.length)};Handsontable.UndoRedo.CreateColumnAction=function(index,amount){this.index=index;this.amount=amount};Handsontable.helper.inherit(Handsontable.UndoRedo.CreateColumnAction,Handsontable.UndoRedo.Action);Handsontable.UndoRedo.CreateColumnAction.prototype.undo=function(instance,undoneCallback){instance.addHookOnce("afterRemoveCol",undoneCallback);instance.alter("remove_col",this.index,this.amount)};Handsontable.UndoRedo.CreateColumnAction.prototype.redo=function(instance,redoneCallback){instance.addHookOnce("afterCreateCol",redoneCallback);instance.alter("insert_col",this.index+1,this.amount)};Handsontable.UndoRedo.RemoveColumnAction=function(index,data,headers){this.index=index;this.data=data;this.amount=this.data[0].length;this.headers=headers};Handsontable.helper.inherit(Handsontable.UndoRedo.RemoveColumnAction,Handsontable.UndoRedo.Action);Handsontable.UndoRedo.RemoveColumnAction.prototype.undo=function(instance,undoneCallback){var row,spliceArgs;for(var i=0,len=instance.getData().length;i<len;i++){row=instance.getSourceDataAtRow(i);spliceArgs=[this.index,0];Array.prototype.push.apply(spliceArgs,this.data[i]);Array.prototype.splice.apply(row,spliceArgs)}if(typeof this.headers!="undefined"){spliceArgs=[this.index,0];Array.prototype.push.apply(spliceArgs,this.headers);Array.prototype.splice.apply(instance.getSettings().colHeaders,spliceArgs)}instance.addHookOnce("afterRender",undoneCallback);instance.render()};Handsontable.UndoRedo.RemoveColumnAction.prototype.redo=function(instance,redoneCallback){instance.addHookOnce("afterRemoveCol",redoneCallback);instance.alter("remove_col",this.index,this.amount)}})(Handsontable);(function(Handsontable){function init(){var instance=this;var pluginEnabled=typeof instance.getSettings().undo=="undefined"||instance.getSettings().undo;if(pluginEnabled){if(!instance.undoRedo){instance.undoRedo=new Handsontable.UndoRedo(instance);exposeUndoRedoMethods(instance);instance.addHook("beforeKeyDown",onBeforeKeyDown);instance.addHook("afterChange",onAfterChange)}}else{if(instance.undoRedo){delete instance.undoRedo;removeExposedUndoRedoMethods(instance);instance.removeHook("beforeKeyDown",onBeforeKeyDown);instance.removeHook("afterChange",onAfterChange)}}}function onBeforeKeyDown(event){var instance=this;var ctrlDown=(event.ctrlKey||event.metaKey)&&!event.altKey;if(ctrlDown){if(event.keyCode===89||(event.shiftKey&&event.keyCode===90)){instance.undoRedo.redo();event.stopImmediatePropagation()}else{if(event.keyCode===90){instance.undoRedo.undo();event.stopImmediatePropagation()}}}}function onAfterChange(changes,source){var instance=this;if(source=="loadData"){return instance.undoRedo.clear()}}function exposeUndoRedoMethods(instance){instance.undo=function(){return instance.undoRedo.undo()};instance.redo=function(){return instance.undoRedo.redo()};instance.isUndoAvailable=function(){return instance.undoRedo.isUndoAvailable()};instance.isRedoAvailable=function(){return instance.undoRedo.isRedoAvailable()};instance.clearUndo=function(){return instance.undoRedo.clear()}}function removeExposedUndoRedoMethods(instance){delete instance.undo;delete instance.redo;delete instance.isUndoAvailable;delete instance.isRedoAvailable;delete instance.clearUndo}Handsontable.hooks.add("afterInit",init);Handsontable.hooks.add("afterUpdateSettings",init)})(Handsontable);function DragToScroll(){this.boundaries=null;this.callback=null}DragToScroll.prototype.setBoundaries=function(boundaries){this.boundaries=boundaries};DragToScroll.prototype.setCallback=function(callback){this.callback=callback};DragToScroll.prototype.check=function(x,y){var diffX=0;var diffY=0;if(y<this.boundaries.top){diffY=y-this.boundaries.top}else{if(y>this.boundaries.bottom){diffY=y-this.boundaries.bottom}}if(x<this.boundaries.left){diffX=x-this.boundaries.left}else{if(x>this.boundaries.right){diffX=x-this.boundaries.right}}this.callback(diffX,diffY)};var dragToScroll;var instance;if(typeof Handsontable!=="undefined"){var setupListening=function(instance){instance.dragToScrollListening=false;var scrollHandler=instance.view.wt.wtScrollbars.vertical.scrollHandler;dragToScroll=new DragToScroll();if(scrollHandler===window){return}else{dragToScroll.setBoundaries(scrollHandler.getBoundingClientRect())}dragToScroll.setCallback(function(scrollX,scrollY){if(scrollX<0){scrollHandler.scrollLeft-=50}else{if(scrollX>0){scrollHandler.scrollLeft+=50}}if(scrollY<0){scrollHandler.scrollTop-=20}else{if(scrollY>0){scrollHandler.scrollTop+=20}}});instance.dragToScrollListening=true};Handsontable.hooks.add("afterInit",function(){var instance=this;var eventManager=Handsontable.eventManager(this);eventManager.addEventListener(document,"mouseup",function(){instance.dragToScrollListening=false});eventManager.addEventListener(document,"mousemove",function(){if(instance.dragToScrollListening){dragToScroll.check(event.clientX,event.clientY)}})});Handsontable.hooks.add("afterDestroy",function(){var eventManager=Handsontable.eventManager(this);eventManager.clear()});Handsontable.hooks.add("afterOnCellMouseDown",function(){setupListening(this)});Handsontable.hooks.add("afterOnCellCornerMouseDown",function(){setupListening(this)});Handsontable.plugins.DragToScroll=DragToScroll}(function(Handsontable,CopyPaste,SheetClip){function CopyPastePlugin(instance){this.copyPasteInstance=CopyPaste.getInstance();this.copyPasteInstance.onCut(onCut);this.copyPasteInstance.onPaste(onPaste);var plugin=this;instance.addHook("beforeKeyDown",onBeforeKeyDown);function onCut(){if(!instance.isListening()){return}instance.selection.empty()}function onPaste(str){if(!instance.isListening()||!instance.selection.isSelected()){return}var input=str.replace(/^[\r\n]*/g,"").replace(/[\r\n]*$/g,""),inputArray=SheetClip.parse(input),selected=instance.getSelected(),coordsFrom=new WalkontableCellCoords(selected[0],selected[1]),coordsTo=new WalkontableCellCoords(selected[2],selected[3]),cellRange=new WalkontableCellRange(coordsFrom,coordsFrom,coordsTo),topLeftCorner=cellRange.getTopLeftCorner(),bottomRightCorner=cellRange.getBottomRightCorner(),areaStart=topLeftCorner,areaEnd=new WalkontableCellCoords(Math.max(bottomRightCorner.row,inputArray.length-1+topLeftCorner.row),Math.max(bottomRightCorner.col,inputArray[0].length-1+topLeftCorner.col));instance.addHookOnce("afterChange",function(changes,source){if(changes&&changes.length){this.selectCell(areaStart.row,areaStart.col,areaEnd.row,areaEnd.col)}});instance.populateFromArray(areaStart.row,areaStart.col,inputArray,areaEnd.row,areaEnd.col,"paste",instance.getSettings().pasteMode)}function onBeforeKeyDown(event){if(instance.getSelected()){if(Handsontable.helper.isCtrlKey(event.keyCode)){plugin.setCopyableText();event.stopImmediatePropagation();return}var ctrlDown=(event.ctrlKey||event.metaKey)&&!event.altKey;if(event.keyCode==Handsontable.helper.keyCode.A&&ctrlDown){instance._registerTimeout(setTimeout(Handsontable.helper.proxy(plugin.setCopyableText,plugin),0))}}}this.destroy=function(){this.copyPasteInstance.removeCallback(onCut);this.copyPasteInstance.removeCallback(onPaste);this.copyPasteInstance.destroy();instance.removeHook("beforeKeyDown",onBeforeKeyDown)};instance.addHook("afterDestroy",Handsontable.helper.proxy(this.destroy,this));this.triggerPaste=Handsontable.helper.proxy(this.copyPasteInstance.triggerPaste,this.copyPasteInstance);this.triggerCut=Handsontable.helper.proxy(this.copyPasteInstance.triggerCut,this.copyPasteInstance);this.setCopyableText=function(){var settings=instance.getSettings();var copyRowsLimit=settings.copyRowsLimit;var copyColsLimit=settings.copyColsLimit;var selRange=instance.getSelectedRange();var topLeft=selRange.getTopLeftCorner();var bottomRight=selRange.getBottomRightCorner();var startRow=topLeft.row;var startCol=topLeft.col;var endRow=bottomRight.row;var endCol=bottomRight.col;var finalEndRow=Math.min(endRow,startRow+copyRowsLimit-1);var finalEndCol=Math.min(endCol,startCol+copyColsLimit-1);instance.copyPaste.copyPasteInstance.copyable(instance.getCopyableData(startRow,startCol,finalEndRow,finalEndCol));if(endRow!==finalEndRow||endCol!==finalEndCol){Handsontable.hooks.run(instance,"afterCopyLimit",endRow-startRow+1,endCol-startCol+1,copyRowsLimit,copyColsLimit)}}}function init(){var instance=this;var pluginEnabled=instance.getSettings().copyPaste!==false;if(pluginEnabled&&!instance.copyPaste){instance.copyPaste=new CopyPastePlugin(instance)}else{if(!pluginEnabled&&instance.copyPaste){instance.copyPaste.destroy();delete instance.copyPaste}}}Handsontable.hooks.add("afterInit",init);Handsontable.hooks.add("afterUpdateSettings",init);Handsontable.hooks.register("afterCopyLimit")})(Handsontable,CopyPaste,SheetClip);(function(Handsontable){Handsontable.Search=function Search(instance){this.query=function(queryStr,callback,queryMethod){var rowCount=instance.countRows();var colCount=instance.countCols();var queryResult=[];if(!callback){callback=Handsontable.Search.global.getDefaultCallback()}if(!queryMethod){queryMethod=Handsontable.Search.global.getDefaultQueryMethod()}for(var rowIndex=0;rowIndex<rowCount;rowIndex++){for(var colIndex=0;colIndex<colCount;colIndex++){var cellData=instance.getDataAtCell(rowIndex,colIndex);var cellProperties=instance.getCellMeta(rowIndex,colIndex);var cellCallback=cellProperties.search.callback||callback;var cellQueryMethod=cellProperties.search.queryMethod||queryMethod;var testResult=cellQueryMethod(queryStr,cellData);if(testResult){var singleResult={row:rowIndex,col:colIndex,data:cellData};queryResult.push(singleResult)}if(cellCallback){cellCallback(instance,rowIndex,colIndex,cellData,testResult)}}}return queryResult}};Handsontable.Search.DEFAULT_CALLBACK=function(instance,row,col,data,testResult){instance.getCellMeta(row,col).isSearchResult=testResult};Handsontable.Search.DEFAULT_QUERY_METHOD=function(query,value){if(typeof query=="undefined"||query==null||!query.toLowerCase||query.length==0){return false}if(typeof value=="undefined"||value==null){return false}return value.toString().toLowerCase().indexOf(query.toLowerCase())!=-1};Handsontable.Search.DEFAULT_SEARCH_RESULT_CLASS="htSearchResult";Handsontable.Search.global=(function(){var defaultCallback=Handsontable.Search.DEFAULT_CALLBACK;var defaultQueryMethod=Handsontable.Search.DEFAULT_QUERY_METHOD;var defaultSearchResultClass=Handsontable.Search.DEFAULT_SEARCH_RESULT_CLASS;return{getDefaultCallback:function(){return defaultCallback},setDefaultCallback:function(newDefaultCallback){defaultCallback=newDefaultCallback},getDefaultQueryMethod:function(){return defaultQueryMethod},setDefaultQueryMethod:function(newDefaultQueryMethod){defaultQueryMethod=newDefaultQueryMethod},getDefaultSearchResultClass:function(){return defaultSearchResultClass},setDefaultSearchResultClass:function(newSearchResultClass){defaultSearchResultClass=newSearchResultClass}}})();Handsontable.SearchCellDecorator=function(instance,TD,row,col,prop,value,cellProperties){var searchResultClass=(typeof cellProperties.search=="object"&&cellProperties.search.searchResultClass)||Handsontable.Search.global.getDefaultSearchResultClass();if(cellProperties.isSearchResult){Handsontable.Dom.addClass(TD,searchResultClass)}else{Handsontable.Dom.removeClass(TD,searchResultClass)}};var originalDecorator=Handsontable.renderers.cellDecorator;Handsontable.renderers.cellDecorator=function(instance,TD,row,col,prop,value,cellProperties){originalDecorator.apply(this,arguments);Handsontable.SearchCellDecorator.apply(this,arguments)};function init(){var instance=this;var pluginEnabled=!!instance.getSettings().search;if(pluginEnabled){instance.search=new Handsontable.Search(instance)}else{delete instance.search}}Handsontable.hooks.add("afterInit",init);Handsontable.hooks.add("afterUpdateSettings",init)})(Handsontable);function CellInfoCollection(){var collection=[];collection.getInfo=function(row,col){for(var i=0,ilen=this.length;i<ilen;i++){if(this[i].row<=row&&this[i].row+this[i].rowspan-1>=row&&this[i].col<=col&&this[i].col+this[i].colspan-1>=col){return this[i]}}};collection.setInfo=function(info){for(var i=0,ilen=this.length;i<ilen;i++){if(this[i].row===info.row&&this[i].col===info.col){this[i]=info;return}}this.push(info)};collection.removeInfo=function(row,col){for(var i=0,ilen=this.length;i<ilen;i++){if(this[i].row===row&&this[i].col===col){this.splice(i,1);break}}};return collection}function MergeCells(mergeCellsSetting){this.mergedCellInfoCollection=new CellInfoCollection();if(Handsontable.helper.isArray(mergeCellsSetting)){for(var i=0,ilen=mergeCellsSetting.length;i<ilen;i++){this.mergedCellInfoCollection.setInfo(mergeCellsSetting[i])}}}MergeCells.prototype.canMergeRange=function(cellRange){return !cellRange.isSingle()};MergeCells.prototype.mergeRange=function(cellRange){if(!this.canMergeRange(cellRange)){return}var topLeft=cellRange.getTopLeftCorner();var bottomRight=cellRange.getBottomRightCorner();var mergeParent={};mergeParent.row=topLeft.row;mergeParent.col=topLeft.col;mergeParent.rowspan=bottomRight.row-topLeft.row+1;mergeParent.colspan=bottomRight.col-topLeft.col+1;this.mergedCellInfoCollection.setInfo(mergeParent)};MergeCells.prototype.mergeOrUnmergeSelection=function(cellRange){var info=this.mergedCellInfoCollection.getInfo(cellRange.from.row,cellRange.from.col);if(info){this.unmergeSelection(cellRange.from)}else{this.mergeSelection(cellRange)}};MergeCells.prototype.mergeSelection=function(cellRange){this.mergeRange(cellRange)};MergeCells.prototype.unmergeSelection=function(cellRange){var info=this.mergedCellInfoCollection.getInfo(cellRange.row,cellRange.col);this.mergedCellInfoCollection.removeInfo(info.row,info.col)};MergeCells.prototype.applySpanProperties=function(TD,row,col){var info=this.mergedCellInfoCollection.getInfo(row,col);if(info){if(info.row===row&&info.col===col){TD.setAttribute("rowspan",info.rowspan);TD.setAttribute("colspan",info.colspan)}else{TD.style.display="none"}}else{TD.removeAttribute("rowspan");TD.removeAttribute("colspan")}};MergeCells.prototype.modifyTransform=function(hook,currentSelectedRange,delta){var sameRowspan=function(merged,coords){if(coords.row>=merged.row&&coords.row<=(merged.row+merged.rowspan-1)){return true}return false},sameColspan=function(merged,coords){if(coords.col>=merged.col&&coords.col<=(merged.col+merged.colspan-1)){return true}return false},getNextPosition=function(newDelta){return new WalkontableCellCoords(currentSelectedRange.to.row+newDelta.row,currentSelectedRange.to.col+newDelta.col)};var newDelta={row:delta.row,col:delta.col};if(hook=="modifyTransformStart"){if(!this.lastDesiredCoords){this.lastDesiredCoords=new WalkontableCellCoords(null,null)}var currentPosition=new WalkontableCellCoords(currentSelectedRange.highlight.row,currentSelectedRange.highlight.col),mergedParent=this.mergedCellInfoCollection.getInfo(currentPosition.row,currentPosition.col),currentRangeContainsMerge;for(var i=0,mergesLength=this.mergedCellInfoCollection.length;i<mergesLength;i++){var range=this.mergedCellInfoCollection[i];range=new WalkontableCellCoords(range.row+range.rowspan-1,range.col+range.colspan-1);if(currentSelectedRange.includes(range)){currentRangeContainsMerge=true;break}}if(mergedParent){var mergeTopLeft=new WalkontableCellCoords(mergedParent.row,mergedParent.col),mergeBottomRight=new WalkontableCellCoords(mergedParent.row+mergedParent.rowspan-1,mergedParent.col+mergedParent.colspan-1),mergeRange=new WalkontableCellRange(mergeTopLeft,mergeTopLeft,mergeBottomRight);if(!mergeRange.includes(this.lastDesiredCoords)){this.lastDesiredCoords=new WalkontableCellCoords(null,null)}newDelta.row=this.lastDesiredCoords.row?this.lastDesiredCoords.row-currentPosition.row:newDelta.row;newDelta.col=this.lastDesiredCoords.col?this.lastDesiredCoords.col-currentPosition.col:newDelta.col;if(delta.row>0){newDelta.row=mergedParent.row+mergedParent.rowspan-1-currentPosition.row+delta.row}else{if(delta.row<0){newDelta.row=currentPosition.row-mergedParent.row+delta.row}}if(delta.col>0){newDelta.col=mergedParent.col+mergedParent.colspan-1-currentPosition.col+delta.col}else{if(delta.col<0){newDelta.col=currentPosition.col-mergedParent.col+delta.col}}}var nextPosition=new WalkontableCellCoords(currentSelectedRange.highlight.row+newDelta.row,currentSelectedRange.highlight.col+newDelta.col),nextParentIsMerged=this.mergedCellInfoCollection.getInfo(nextPosition.row,nextPosition.col);if(nextParentIsMerged){this.lastDesiredCoords=nextPosition;newDelta={row:nextParentIsMerged.row-currentPosition.row,col:nextParentIsMerged.col-currentPosition.col}}}else{if(hook=="modifyTransformEnd"){for(var i=0,mergesLength=this.mergedCellInfoCollection.length;i<mergesLength;i++){var currentMerge=this.mergedCellInfoCollection[i],mergeTopLeft=new WalkontableCellCoords(currentMerge.row,currentMerge.col),mergeBottomRight=new WalkontableCellCoords(currentMerge.row+currentMerge.rowspan-1,currentMerge.col+currentMerge.colspan-1),mergedRange=new WalkontableCellRange(mergeTopLeft,mergeTopLeft,mergeBottomRight),sharedBorders=currentSelectedRange.getBordersSharedWith(mergedRange);if(mergedRange.isEqual(currentSelectedRange)){currentSelectedRange.setDirection("NW-SE")}else{if(sharedBorders.length>0){var mergeHighlighted=(currentSelectedRange.highlight.isEqual(mergedRange.from));if(sharedBorders.indexOf("top")>-1){if(currentSelectedRange.to.isSouthEastOf(mergedRange.from)&&mergeHighlighted){currentSelectedRange.setDirection("NW-SE")}else{if(currentSelectedRange.to.isSouthWestOf(mergedRange.from)&&mergeHighlighted){currentSelectedRange.setDirection("NE-SW")}}}else{if(sharedBorders.indexOf("bottom")>-1){if(currentSelectedRange.to.isNorthEastOf(mergedRange.from)&&mergeHighlighted){currentSelectedRange.setDirection("SW-NE")}else{if(currentSelectedRange.to.isNorthWestOf(mergedRange.from)&&mergeHighlighted){currentSelectedRange.setDirection("SE-NW")}}}}}}var nextPosition=getNextPosition(newDelta),withinRowspan=sameRowspan(currentMerge,nextPosition),withinColspan=sameColspan(currentMerge,nextPosition);if(currentSelectedRange.includesRange(mergedRange)&&(mergedRange.includes(nextPosition)||withinRowspan||withinColspan)){if(withinRowspan){if(newDelta.row<0){newDelta.row-=currentMerge.rowspan-1}else{if(newDelta.row>0){newDelta.row+=currentMerge.rowspan-1}}}if(withinColspan){if(newDelta.col<0){newDelta.col-=currentMerge.colspan-1}else{if(newDelta.col>0){newDelta.col+=currentMerge.colspan-1}}}}}}}if(newDelta.row!=0){delta.row=newDelta.row}if(newDelta.col!=0){delta.col=newDelta.col}};if(typeof Handsontable=="undefined"){throw new Error("Handsontable is not defined")}var beforeInit=function(){var instance=this;var mergeCellsSetting=instance.getSettings().mergeCells;if(mergeCellsSetting){if(!instance.mergeCells){instance.mergeCells=new MergeCells(mergeCellsSetting)}}};var afterInit=function(){var instance=this;if(instance.mergeCells){instance.view.wt.wtTable.getCell=function(coords){if(instance.getSettings().mergeCells){var mergeParent=instance.mergeCells.mergedCellInfoCollection.getInfo(coords.row,coords.col);if(mergeParent){coords=mergeParent}}return WalkontableTable.prototype.getCell.call(this,coords)}}};var onBeforeKeyDown=function(event){if(!this.mergeCells){return}var ctrlDown=(event.ctrlKey||event.metaKey)&&!event.altKey;if(ctrlDown){if(event.keyCode===77){this.mergeCells.mergeOrUnmergeSelection(this.getSelectedRange());this.render();event.stopImmediatePropagation()}}};var addMergeActionsToContextMenu=function(defaultOptions){if(!this.getSettings().mergeCells){return}defaultOptions.items.push(Handsontable.ContextMenu.SEPARATOR);defaultOptions.items.push({key:"mergeCells",name:function(){var sel=this.getSelected();var info=this.mergeCells.mergedCellInfoCollection.getInfo(sel[0],sel[1]);if(info){return"Unmerge cells"}else{return"Merge cells"}},callback:function(){this.mergeCells.mergeOrUnmergeSelection(this.getSelectedRange());this.render()},disabled:function(){return false}})};var afterRenderer=function(TD,row,col,prop,value,cellProperties){if(this.mergeCells){this.mergeCells.applySpanProperties(TD,row,col)}};var modifyTransformFactory=function(hook){return function(delta){var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var currentSelectedRange=this.getSelectedRange();this.mergeCells.modifyTransform(hook,currentSelectedRange,delta);if(hook==="modifyTransformEnd"){var totalRows=this.countRows();var totalCols=this.countCols();if(currentSelectedRange.from.row<0){currentSelectedRange.from.row=0}else{if(currentSelectedRange.from.row>0&&currentSelectedRange.from.row>=totalRows){currentSelectedRange.from.row=currentSelectedRange.from-1}}if(currentSelectedRange.from.col<0){currentSelectedRange.from.col=0}else{if(currentSelectedRange.from.col>0&&currentSelectedRange.from.col>=totalCols){currentSelectedRange.from.col=totalCols-1}}}}}};var beforeSetRangeEnd=function(coords){this.lastDesiredCoords=null;var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var selRange=this.getSelectedRange();selRange.highlight=new WalkontableCellCoords(selRange.highlight.row,selRange.highlight.col);selRange.to=coords;var rangeExpanded=false;do{rangeExpanded=false;for(var i=0,ilen=this.mergeCells.mergedCellInfoCollection.length;i<ilen;i++){var cellInfo=this.mergeCells.mergedCellInfoCollection[i];var mergedCellTopLeft=new WalkontableCellCoords(cellInfo.row,cellInfo.col);var mergedCellBottomRight=new WalkontableCellCoords(cellInfo.row+cellInfo.rowspan-1,cellInfo.col+cellInfo.colspan-1);var mergedCellRange=new WalkontableCellRange(mergedCellTopLeft,mergedCellTopLeft,mergedCellBottomRight);if(selRange.expandByRange(mergedCellRange)){coords.row=selRange.to.row;coords.col=selRange.to.col;rangeExpanded=true}}}while(rangeExpanded)}};var beforeDrawAreaBorders=function(corners,className){if(className&&className=="area"){var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var selRange=this.getSelectedRange();var startRange=new WalkontableCellRange(selRange.from,selRange.from,selRange.from);var stopRange=new WalkontableCellRange(selRange.to,selRange.to,selRange.to);for(var i=0,ilen=this.mergeCells.mergedCellInfoCollection.length;i<ilen;i++){var cellInfo=this.mergeCells.mergedCellInfoCollection[i];var mergedCellTopLeft=new WalkontableCellCoords(cellInfo.row,cellInfo.col);var mergedCellBottomRight=new WalkontableCellCoords(cellInfo.row+cellInfo.rowspan-1,cellInfo.col+cellInfo.colspan-1);var mergedCellRange=new WalkontableCellRange(mergedCellTopLeft,mergedCellTopLeft,mergedCellBottomRight);if(startRange.expandByRange(mergedCellRange)){corners[0]=startRange.from.row;corners[1]=startRange.from.col}if(stopRange.expandByRange(mergedCellRange)){corners[2]=stopRange.from.row;corners[3]=stopRange.from.col}}}}};var afterGetCellMeta=function(row,col,cellProperties){var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var mergeParent=this.mergeCells.mergedCellInfoCollection.getInfo(row,col);if(mergeParent&&(mergeParent.row!=row||mergeParent.col!=col)){cellProperties.copyable=false}}};var afterViewportRowCalculatorOverride=function(calc){var mergeCellsSetting=this.getSettings().mergeCells;if(mergeCellsSetting){var colCount=this.countCols();var mergeParent;for(var c=0;c<colCount;c++){mergeParent=this.mergeCells.mergedCellInfoCollection.getInfo(calc.renderStartRow,c);if(mergeParent){if(mergeParent.row<calc.renderStartRow){calc.renderStartRow=mergeParent.row;return afterViewportRowCalculatorOverride.call(this,calc)}}mergeParent=this.mergeCells.mergedCellInfoCollection.getInfo(calc.renderEndRow,c);if(mergeParent){var mergeEnd=mergeParent.row+mergeParent.rowspan-1;if(mergeEnd>calc.renderEndRow){calc.renderEndRow=mergeEnd;return afterViewportRowCalculatorOverride.call(this,calc)}}}}};var isMultipleSelection=function(isMultiple){if(isMultiple&&this.mergeCells){var mergedCells=this.mergeCells.mergedCellInfoCollection,selectionRange=this.getSelectedRange();for(var group in mergedCells){if(selectionRange.highlight.row==mergedCells[group].row&&selectionRange.highlight.col==mergedCells[group].col&&selectionRange.to.row==mergedCells[group].row+mergedCells[group].rowspan-1&&selectionRange.to.col==mergedCells[group].col+mergedCells[group].colspan-1){return false}}}return isMultiple};Handsontable.hooks.add("beforeInit",beforeInit);Handsontable.hooks.add("afterInit",afterInit);Handsontable.hooks.add("beforeKeyDown",onBeforeKeyDown);Handsontable.hooks.add("modifyTransformStart",modifyTransformFactory("modifyTransformStart"));Handsontable.hooks.add("modifyTransformEnd",modifyTransformFactory("modifyTransformEnd"));Handsontable.hooks.add("beforeSetRangeEnd",beforeSetRangeEnd);Handsontable.hooks.add("beforeDrawBorders",beforeDrawAreaBorders);Handsontable.hooks.add("afterIsMultipleSelection",isMultipleSelection);Handsontable.hooks.add("afterRenderer",afterRenderer);Handsontable.hooks.add("afterContextMenuDefaultOptions",addMergeActionsToContextMenu);Handsontable.hooks.add("afterGetCellMeta",afterGetCellMeta);Handsontable.hooks.add("afterViewportRowCalculatorOverride",afterViewportRowCalculatorOverride);Handsontable.MergeCells=MergeCells;(function(){function CustomBorders(){}var instance;var checkEnable=function(customBorders){if(typeof customBorders==="boolean"){if(customBorders==true){return true}}if(typeof customBorders==="object"){if(customBorders.length>0){return true}}return false};var init=function(){if(checkEnable(this.getSettings().customBorders)){if(!this.customBorders){instance=this;this.customBorders=new CustomBorders()}}};var getSettingIndex=function(className){for(var i=0;i<instance.view.wt.selections.length;i++){if(instance.view.wt.selections[i].settings.className==className){return i}}return -1};var insertBorderIntoSettings=function(border){var coordinates={row:border.row,col:border.col};var selection=new WalkontableSelection(border,new WalkontableCellRange(coordinates,coordinates,coordinates));var index=getSettingIndex(border.className);if(index>=0){instance.view.wt.selections[index]=selection}else{instance.view.wt.selections.push(selection)}};var prepareBorderFromCustomAdded=function(row,col,borderObj){var border=createEmptyBorders(row,col);border=extendDefaultBorder(border,borderObj);this.setCellMeta(row,col,"borders",border);insertBorderIntoSettings(border)};var prepareBorderFromCustomAddedRange=function(rowObj){var range=rowObj.range;for(var row=range.from.row;row<=range.to.row;row++){for(var col=range.from.col;col<=range.to.col;col++){var border=createEmptyBorders(row,col);var add=0;if(row==range.from.row){add++;if(rowObj.hasOwnProperty("top")){border.top=rowObj.top}}if(row==range.to.row){add++;if(rowObj.hasOwnProperty("bottom")){border.bottom=rowObj.bottom}}if(col==range.from.col){add++;if(rowObj.hasOwnProperty("left")){border.left=rowObj.left}}if(col==range.to.col){add++;if(rowObj.hasOwnProperty("right")){border.right=rowObj.right}}if(add>0){this.setCellMeta(row,col,"borders",border);insertBorderIntoSettings(border)}}}};var createClassName=function(row,col){return"border_row"+row+"col"+col};var createDefaultCustomBorder=function(){return{width:1,color:"#000"}};var createSingleEmptyBorder=function(){return{hide:true}};var createDefaultHtBorder=function(){return{width:1,color:"#000",cornerVisible:false}};var createEmptyBorders=function(row,col){return{className:createClassName(row,col),border:createDefaultHtBorder(),row:row,col:col,top:createSingleEmptyBorder(),right:createSingleEmptyBorder(),bottom:createSingleEmptyBorder(),left:createSingleEmptyBorder()}};var extendDefaultBorder=function(defaultBorder,customBorder){if(customBorder.hasOwnProperty("border")){defaultBorder.border=customBorder.border}if(customBorder.hasOwnProperty("top")){defaultBorder.top=customBorder.top}if(customBorder.hasOwnProperty("right")){defaultBorder.right=customBorder.right}if(customBorder.hasOwnProperty("bottom")){defaultBorder.bottom=customBorder.bottom}if(customBorder.hasOwnProperty("left")){defaultBorder.left=customBorder.left}return defaultBorder};var removeBordersFromDom=function(borderClassName){var borders=document.querySelectorAll("."+borderClassName);for(var i=0;i<borders.length;i++){if(borders[i]){if(borders[i].nodeName!="TD"){var parent=borders[i].parentNode;if(parent.parentNode){parent.parentNode.removeChild(parent)}}}}};var removeAllBorders=function(row,col){var borderClassName=createClassName(row,col);removeBordersFromDom(borderClassName);this.removeCellMeta(row,col,"borders")};var setBorder=function(row,col,place,remove){var bordersMeta=this.getCellMeta(row,col).borders;if(!bordersMeta||bordersMeta.border==undefined){bordersMeta=createEmptyBorders(row,col)}if(remove){bordersMeta[place]=createSingleEmptyBorder()}else{bordersMeta[place]=createDefaultCustomBorder()}this.setCellMeta(row,col,"borders",bordersMeta);var borderClassName=createClassName(row,col);removeBordersFromDom(borderClassName);insertBorderIntoSettings(bordersMeta);this.render()};var prepareBorder=function(range,place,remove){if(range.from.row==range.to.row&&range.from.col==range.to.col){if(place=="noBorders"){removeAllBorders.call(this,range.from.row,range.from.col)}else{setBorder.call(this,range.from.row,range.from.col,place,remove)}}else{switch(place){case"noBorders":for(var column=range.from.col;column<=range.to.col;column++){for(var row=range.from.row;row<=range.to.row;row++){removeAllBorders.call(this,row,column)}}break;case"top":for(var topCol=range.from.col;topCol<=range.to.col;topCol++){setBorder.call(this,range.from.row,topCol,place,remove)}break;case"right":for(var rowRight=range.from.row;rowRight<=range.to.row;rowRight++){setBorder.call(this,rowRight,range.to.col,place)}break;case"bottom":for(var bottomCol=range.from.col;bottomCol<=range.to.col;bottomCol++){setBorder.call(this,range.to.row,bottomCol,place)}break;case"left":for(var rowLeft=range.from.row;rowLeft<=range.to.row;rowLeft++){setBorder.call(this,rowLeft,range.from.col,place)}break}}};var checkSelectionBorders=function(hot,direction){var atLeastOneHasBorder=false;hot.getSelectedRange().forAll(function(r,c){var metaBorders=hot.getCellMeta(r,c).borders;if(metaBorders){if(direction){if(!metaBorders[direction].hasOwnProperty("hide")){atLeastOneHasBorder=true;return false}}else{atLeastOneHasBorder=true;return false}}});return atLeastOneHasBorder};var markSelected=function(label){return"<span class='selected'>✓</span>"+label};var addBordersOptionsToContextMenu=function(defaultOptions){if(!this.getSettings().customBorders){return}defaultOptions.items.push(Handsontable.ContextMenu.SEPARATOR);defaultOptions.items.push({key:"borders",name:"Borders",submenu:{items:{top:{name:function(){var label="Top";var hasBorder=checkSelectionBorders(this,"top");if(hasBorder){label=markSelected(label)}return label},callback:function(){var hasBorder=checkSelectionBorders(this,"top");prepareBorder.call(this,this.getSelectedRange(),"top",hasBorder)},disabled:false},right:{name:function(){var label="Right";var hasBorder=checkSelectionBorders(this,"right");if(hasBorder){label=markSelected(label)}return label},callback:function(){var hasBorder=checkSelectionBorders(this,"right");prepareBorder.call(this,this.getSelectedRange(),"right",hasBorder)},disabled:false},bottom:{name:function(){var label="Bottom";var hasBorder=checkSelectionBorders(this,"bottom");if(hasBorder){label=markSelected(label)}return label},callback:function(){var hasBorder=checkSelectionBorders(this,"bottom");prepareBorder.call(this,this.getSelectedRange(),"bottom",hasBorder)},disabled:false},left:{name:function(){var label="Left";var hasBorder=checkSelectionBorders(this,"left");if(hasBorder){label=markSelected(label)}return label},callback:function(){var hasBorder=checkSelectionBorders(this,"left");prepareBorder.call(this,this.getSelectedRange(),"left",hasBorder)},disabled:false},remove:{name:"Remove border(s)",callback:function(){prepareBorder.call(this,this.getSelectedRange(),"noBorders")},disabled:function(){return !checkSelectionBorders(this)}}}}})};Handsontable.hooks.add("beforeInit",init);Handsontable.hooks.add("afterContextMenuDefaultOptions",addBordersOptionsToContextMenu);Handsontable.hooks.add("afterInit",function(){var customBorders=this.getSettings().customBorders;if(customBorders){for(var i=0;i<customBorders.length;i++){if(customBorders[i].range){prepareBorderFromCustomAddedRange.call(this,customBorders[i])}else{prepareBorderFromCustomAdded.call(this,customBorders[i].row,customBorders[i].col,customBorders[i])}}this.render();this.view.wt.draw(true)}});Handsontable.CustomBorders=CustomBorders}());(function(Handsontable){function HandsontableManualRowMove(){var startRow,endRow,startY,startOffset,currentRow,currentTH,handle=document.createElement("DIV"),guide=document.createElement("DIV"),eventManager=Handsontable.eventManager(this);handle.className="manualRowMover";guide.className="manualRowMoverGuide";var saveManualRowPositions=function(){var instance=this;Handsontable.hooks.run(instance,"persistentStateSave","manualRowPositions",instance.manualRowPositions)};var loadManualRowPositions=function(){var instance=this,storedState={};Handsontable.hooks.run(instance,"persistentStateLoad","manualRowPositions",storedState);return storedState.value};function setupHandlePosition(TH){instance=this;currentTH=TH;var row=this.view.wt.wtTable.getCoords(TH).row;if(row>=0){currentRow=row;var box=currentTH.getBoundingClientRect();startOffset=box.top;handle.style.top=startOffset+"px";handle.style.left=box.left+"px";instance.rootElement.appendChild(handle)}}function refreshHandlePosition(TH,delta){var box=TH.getBoundingClientRect();var handleHeight=6;if(delta>0){handle.style.top=(box.top+box.height-handleHeight)+"px"}else{handle.style.top=box.top+"px"}}function setupGuidePosition(){var instance=this;Handsontable.Dom.addClass(handle,"active");Handsontable.Dom.addClass(guide,"active");var box=currentTH.getBoundingClientRect();guide.style.width=instance.view.maximumVisibleElementWidth(0)+"px";guide.style.height=box.height+"px";guide.style.top=startOffset+"px";guide.style.left=handle.style.left;instance.rootElement.appendChild(guide)}function refreshGuidePosition(diff){guide.style.top=startOffset+diff+"px"}function hideHandleAndGuide(){Handsontable.Dom.removeClass(handle,"active");Handsontable.Dom.removeClass(guide,"active")}var checkRowHeader=function(element){if(element.tagName!="BODY"){if(element.parentNode.tagName=="TBODY"){return true}else{element=element.parentNode;return checkRowHeader(element)}}return false};var getTHFromTargetElement=function(element){if(element.tagName!="TABLE"){if(element.tagName=="TH"){return element}else{return getTHFromTargetElement(element.parentNode)}}return null};var bindEvents=function(){var instance=this;var pressed;eventManager.addEventListener(instance.rootElement,"mouseover",function(e){if(checkRowHeader(e.target)){var th=getTHFromTargetElement(e.target);if(th){if(pressed){endRow=instance.view.wt.wtTable.getCoords(th).row;refreshHandlePosition(th,endRow-startRow)}else{setupHandlePosition.call(instance,th)}}}});eventManager.addEventListener(instance.rootElement,"mousedown",function(e){if(Handsontable.Dom.hasClass(e.target,"manualRowMover")){startY=Handsontable.helper.pageY(e);setupGuidePosition.call(instance);pressed=instance;startRow=currentRow;endRow=currentRow}});eventManager.addEventListener(window,"mousemove",function(e){if(pressed){refreshGuidePosition(Handsontable.helper.pageY(e)-startY)}});eventManager.addEventListener(window,"mouseup",function(e){if(pressed){hideHandleAndGuide();pressed=false;createPositionData(instance.manualRowPositions,instance.countRows());instance.manualRowPositions.splice(endRow,0,instance.manualRowPositions.splice(startRow,1)[0]);instance.forceFullRender=true;instance.view.render();saveManualRowPositions.call(instance);Handsontable.hooks.run(instance,"afterRowMove",startRow,endRow);setupHandlePosition.call(instance,currentTH)}});instance.addHook("afterDestroy",unbindEvents)};var unbindEvents=function(){eventManager.clear()};var createPositionData=function(positionArr,len){if(positionArr.length<len){for(var i=positionArr.length;i<len;i++){positionArr[i]=i}}};this.beforeInit=function(){this.manualRowPositions=[]};this.init=function(source){var instance=this;var manualRowMoveEnabled=!!(instance.getSettings().manualRowMove);if(manualRowMoveEnabled){var initialManualRowPositions=instance.getSettings().manualRowMove;var loadedManualRowPostions=loadManualRowPositions.call(instance);if(typeof loadedManualRowPostions!="undefined"){this.manualRowPositions=loadedManualRowPostions}else{if(initialManualRowPositions instanceof Array){this.manualRowPositions=initialManualRowPositions}else{this.manualRowPositions=[]}}if(source==="afterInit"){bindEvents.call(this);if(this.manualRowPositions.length>0){instance.forceFullRender=true;instance.render()}}}else{unbindEvents.call(this);instance.manualRowPositions=[]}};this.modifyRow=function(row){var instance=this;if(instance.getSettings().manualRowMove){if(typeof instance.manualRowPositions[row]==="undefined"){createPositionData(this.manualRowPositions,row+1)}return instance.manualRowPositions[row]}return row}}var htManualRowMove=new HandsontableManualRowMove();Handsontable.hooks.add("beforeInit",htManualRowMove.beforeInit);Handsontable.hooks.add("afterInit",function(){htManualRowMove.init.call(this,"afterInit")});Handsontable.hooks.add("afterUpdateSettings",function(){htManualRowMove.init.call(this,"afterUpdateSettings")});Handsontable.hooks.add("modifyRow",htManualRowMove.modifyRow);Handsontable.hooks.register("afterRowMove")})(Handsontable);(function(Handsontable){function Autofill(instance){this.instance=instance;this.addingStarted=false;var wtOnCellCornerMouseDown,wtOnCellMouseOver,mouseDownOnCellCorner=false,plugin=this,eventManager=Handsontable.eventManager(instance);var mouseUpCallback=function(event){if(!instance.autofill){return true}if(instance.autofill.handle&&instance.autofill.handle.isDragged){if(instance.autofill.handle.isDragged>1){instance.autofill.apply()}instance.autofill.handle.isDragged=0;mouseDownOnCellCorner=false}};eventManager.addEventListener(document,"mouseup",function(event){mouseUpCallback(event)});eventManager.addEventListener(document,"mousemove",function(event){if(!plugin.instance.autofill){return 0}var tableBottom=Handsontable.Dom.offset(plugin.instance.table).top-(window.pageYOffset||document.documentElement.scrollTop)+Handsontable.Dom.outerHeight(plugin.instance.table),tableRight=Handsontable.Dom.offset(plugin.instance.table).left-(window.pageXOffset||document.documentElement.scrollLeft)+Handsontable.Dom.outerWidth(plugin.instance.table);if(plugin.addingStarted===false&&plugin.instance.autofill.handle.isDragged>0&&event.clientY>tableBottom&&event.clientX<=tableRight){this.mouseDragOutside=true;plugin.addingStarted=true}else{this.mouseDragOutside=false}if(this.mouseDragOutside){setTimeout(function(){plugin.addingStarted=false;plugin.instance.alter("insert_row")},200)}});wtOnCellCornerMouseDown=this.instance.view.wt.wtSettings.settings.onCellCornerMouseDown;this.instance.view.wt.wtSettings.settings.onCellCornerMouseDown=function(event){instance.autofill.handle.isDragged=1;mouseDownOnCellCorner=true;wtOnCellCornerMouseDown(event)};wtOnCellMouseOver=this.instance.view.wt.wtSettings.settings.onCellMouseOver;this.instance.view.wt.wtSettings.settings.onCellMouseOver=function(event,coords,TD,wt){if(instance.autofill&&(mouseDownOnCellCorner&&!instance.view.isMouseDown()&&instance.autofill.handle&&instance.autofill.handle.isDragged)){instance.autofill.handle.isDragged++;instance.autofill.showBorder(coords);instance.autofill.checkIfNewRowNeeded()}wtOnCellMouseOver(event,coords,TD,wt)};this.instance.view.wt.wtSettings.settings.onCellCornerDblClick=function(){instance.autofill.selectAdjacent()}}Autofill.prototype.init=function(){this.handle={}},Autofill.prototype.disable=function(){this.handle.disabled=true},Autofill.prototype.selectAdjacent=function(){var select,data,r,maxR,c;if(this.instance.selection.isMultiple()){select=this.instance.view.wt.selections.area.getCorners()}else{select=this.instance.view.wt.selections.current.getCorners()}data=this.instance.getData();rows:for(r=select[2]+1;r<this.instance.countRows();r++){for(c=select[1];c<=select[3];c++){if(data[r][c]){break rows}}if(!!data[r][select[1]-1]||!!data[r][select[3]+1]){maxR=r}}if(maxR){this.instance.view.wt.selections.fill.clear();this.instance.view.wt.selections.fill.add(new WalkontableCellCoords(select[0],select[1]));this.instance.view.wt.selections.fill.add(new WalkontableCellCoords(maxR,select[3]));this.apply()}},Autofill.prototype.apply=function(){var drag,select,start,end,_data;this.handle.isDragged=0;drag=this.instance.view.wt.selections.fill.getCorners();if(!drag){return}var getDeltas=function(start,end,data,direction){var rlength=data.length,clength=data?data[0].length:0;var deltas=[];var diffRow=end.row-start.row,diffCol=end.col-start.col;var startValue,endValue,delta;var arr=[];if(["down","up"].indexOf(direction)!==-1){for(var col=0;col<=diffCol;col++){startValue=parseInt(data[0][col],10);endValue=parseInt(data[rlength-1][col],10);delta=(direction==="down"?(endValue-startValue):(startValue-endValue))/(rlength-1)||0;arr.push(delta)}deltas.push(arr)}if(["right","left"].indexOf(direction)!==-1){for(var row=0;row<=diffRow;row++){startValue=parseInt(data[row][0],10);endValue=parseInt(data[row][clength-1],10);delta=(direction==="right"?(endValue-startValue):(startValue-endValue))/(clength-1)||0;arr=[];arr.push(delta);deltas.push(arr)}}return deltas};this.instance.view.wt.selections.fill.clear();if(this.instance.selection.isMultiple()){select=this.instance.view.wt.selections.area.getCorners()}else{select=this.instance.view.wt.selections.current.getCorners()}var direction;if(drag[0]===select[0]&&drag[1]<select[1]){direction="left";start=new WalkontableCellCoords(drag[0],drag[1]);end=new WalkontableCellCoords(drag[2],select[1]-1)}else{if(drag[0]===select[0]&&drag[3]>select[3]){direction="right";start=new WalkontableCellCoords(drag[0],select[3]+1);end=new WalkontableCellCoords(drag[2],drag[3])}else{if(drag[0]<select[0]&&drag[1]===select[1]){direction="up";start=new WalkontableCellCoords(drag[0],drag[1]);end=new WalkontableCellCoords(select[0]-1,drag[3])}else{if(drag[2]>select[2]&&drag[1]===select[1]){direction="down";start=new WalkontableCellCoords(select[2]+1,drag[1]);end=new WalkontableCellCoords(drag[2],drag[3])}}}}if(start&&start.row>-1&&start.col>-1){var selRange={from:this.instance.getSelectedRange().from,to:this.instance.getSelectedRange().to};_data=this.instance.getData(selRange.from.row,selRange.from.col,selRange.to.row,selRange.to.col);var deltas=getDeltas(start,end,_data,direction);Handsontable.hooks.run(this.instance,"beforeAutofill",start,end,_data);this.instance.populateFromArray(start.row,start.col,_data,end.row,end.col,"autofill",null,direction,deltas);this.instance.selection.setRangeStart(new WalkontableCellCoords(drag[0],drag[1]));this.instance.selection.setRangeEnd(new WalkontableCellCoords(drag[2],drag[3]))}else{this.instance.selection.refreshBorders()}},Autofill.prototype.showBorder=function(coords){var topLeft=this.instance.getSelectedRange().getTopLeftCorner();var bottomRight=this.instance.getSelectedRange().getBottomRightCorner();if(this.instance.getSettings().fillHandle!=="horizontal"&&(bottomRight.row<coords.row||topLeft.row>coords.row)){coords=new WalkontableCellCoords(coords.row,bottomRight.col)}else{if(this.instance.getSettings().fillHandle!=="vertical"){coords=new WalkontableCellCoords(bottomRight.row,coords.col)}else{return}}this.instance.view.wt.selections.fill.clear();this.instance.view.wt.selections.fill.add(this.instance.getSelectedRange().from);this.instance.view.wt.selections.fill.add(this.instance.getSelectedRange().to);this.instance.view.wt.selections.fill.add(coords);this.instance.view.render()};Autofill.prototype.checkIfNewRowNeeded=function(){var fillCorners,selection,tableRows=this.instance.countRows(),that=this;if(this.instance.view.wt.selections.fill.cellRange&&this.addingStarted===false){selection=this.instance.getSelected();fillCorners=this.instance.view.wt.selections.fill.getCorners();if(selection[2]<tableRows-1&&fillCorners[2]===tableRows-1){this.addingStarted=true;this.instance._registerTimeout(setTimeout(function(){that.instance.alter("insert_row");that.addingStarted=false},200))}}};Handsontable.hooks.add("afterInit",function(){var autofill=new Autofill(this);if(typeof this.getSettings().fillHandle!=="undefined"){if(autofill.handle&&this.getSettings().fillHandle===false){autofill.disable()}else{if(!autofill.handle&&this.getSettings().fillHandle!==false){this.autofill=autofill;this.autofill.init()}}}});Handsontable.Autofill=Autofill})(Handsontable);var Grouping=function(instance){var groups=[];var item={id:"",level:0,hidden:0,rows:[],cols:[]};var counters={rows:0,cols:0};var levels={rows:0,cols:0};var hiddenRows=[];var hiddenCols=[];var classes={groupIndicatorContainer:"htGroupIndicatorContainer",groupIndicator:function(direction){return"ht"+direction+"Group"},groupStart:"htGroupStart",collapseButton:"htCollapseButton",expandButton:"htExpandButton",collapseGroupId:function(id){return"htCollapse-"+id},collapseFromLevel:function(direction,level){return"htCollapse"+direction+"FromLevel-"+level},clickable:"clickable",levelTrigger:"htGroupLevelTrigger"};var compare=function(property,orderDirection){return function(item1,item2){return typeof(orderDirection)==="undefined"||orderDirection==="asc"?item1[property]-item2[property]:item2[property]-item1[property]}};var range=function(from,to){var arr=[];while(from<=to){arr.push(from++)}return arr};var getRangeGroups=function(dataType,from,to){var cells=[],cell={row:null,col:null};if(dataType=="cols"){while(from<=to){cell={row:-1,col:from++};cells.push(cell)}}else{while(from<=to){cell={row:from++,col:-1};cells.push(cell)}}var cellsGroups=getCellsGroups(cells),totalRows=0,totalCols=0;for(var i=0;i<cellsGroups.length;i++){totalRows+=cellsGroups[i].filter(function(item){return item.rows}).length;totalCols+=cellsGroups[i].filter(function(item){return item.cols}).length}return{total:{rows:totalRows,cols:totalCols},groups:cellsGroups}};var getCellsGroups=function(cells){var _groups=[];for(var i=0;i<cells.length;i++){_groups.push(getCellGroups(cells[i]))}return _groups};var getCellGroups=function(coords,groupLevel,groupType){var row=coords.row,col=coords.col;var tmpRow=(row===-1?0:row),tmpCol=(col===-1?0:col);var _groups=[];for(var i=0;i<groups.length;i++){var group=groups[i],id=group.id,level=group.level,rows=group.rows||[],cols=group.cols||[];if(_groups.indexOf(id)===-1){if(rows.indexOf(tmpRow)!==-1||cols.indexOf(tmpCol)!==-1){_groups.push(group)}}}if(col===-1){_groups=_groups.concat(getColGroups())}else{if(row===-1){_groups=_groups.concat(getRowGroups())}}if(groupLevel){_groups=_groups.filter(function(item){return item.level===groupLevel})}if(groupType){if(groupType==="cols"){_groups=_groups.filter(function(item){return item.cols})}else{if(groupType==="rows"){_groups=_groups.filter(function(item){return item.rows})}}}var tmp=[];return _groups.filter(function(item){if(tmp.indexOf(item.id)===-1){tmp.push(item.id);return item}})};var getGroupById=function(id){for(var i=0,groupsLength=groups.length;i<groupsLength;i++){if(groups[i].id==id){return groups[i]}}return false};var getGroupByRowAndLevel=function(row,level){for(var i=0,groupsLength=groups.length;i<groupsLength;i++){if(groups[i].level==level&&groups[i].rows&&groups[i].rows.indexOf(row)>-1){return groups[i]}}return false};var getGroupByColAndLevel=function(col,level){for(var i=0,groupsLength=groups.length;i<groupsLength;i++){if(groups[i].level==level&&groups[i].cols&&groups[i].cols.indexOf(col)>-1){return groups[i]}}return false};var getColGroups=function(){var result=[];for(var i=0,groupsLength=groups.length;i<groupsLength;i++){if(groups[i]["cols"] instanceof Array){result.push(groups[i])}}return result};var getColGroupsByLevel=function(level){var result=[];for(var i=0,groupsLength=groups.length;i<groupsLength;i++){if(groups[i]["cols"]&&groups[i]["level"]===level){result.push(groups[i])}}return result};var getRowGroups=function(){var result=[];for(var i=0,groupsLength=groups.length;i<groupsLength;i++){if(groups[i]["rows"] instanceof Array){result.push(groups[i])}}return result};var getRowGroupsByLevel=function(level){var result=[];for(var i=0,groupsLength=groups.length;i<groupsLength;i++){if(groups[i]["rows"]&&groups[i]["level"]===level){result.push(groups[i])}}return result};var getLastLevelColsInRange=function(rangeGroups){var level=0;if(rangeGroups.length){rangeGroups.forEach(function(items){items=items.filter(function(item){return item.cols});if(items.length){var sortedGroup=items.sort(compare("level","desc")),lastLevel=sortedGroup[0].level;if(level<lastLevel){level=lastLevel}}})}return level};var getLastLevelRowsInRange=function(rangeGroups){var level=0;if(rangeGroups.length){rangeGroups.forEach(function(items){items=items.filter(function(item){return item.rows});if(items.length){var sortedGroup=items.sort(compare("level","desc")),lastLevel=sortedGroup[0].level;if(level<lastLevel){level=lastLevel}}})}return level};var groupCols=function(from,to){var rangeGroups=getRangeGroups("cols",from,to),lastLevel=getLastLevelColsInRange(rangeGroups.groups);if(lastLevel===levels.cols){levels.cols++}else{if(lastLevel>levels.cols){levels.cols=lastLevel+1}}if(!counters.cols){counters.cols=getColGroups().length}counters.cols++;groups.push({id:"c"+counters.cols,level:lastLevel+1,cols:range(from,to),hidden:0})};var groupRows=function(from,to){var rangeGroups=getRangeGroups("rows",from,to),lastLevel=getLastLevelRowsInRange(rangeGroups.groups);levels.rows=Math.max(levels.rows,lastLevel+1);if(!counters.rows){counters.rows=getRowGroups().length}counters.rows++;groups.push({id:"r"+counters.rows,level:lastLevel+1,rows:range(from,to),hidden:0})};var showHideGroups=function(hidden,groups){var level;for(var i=0,groupsLength=groups.length;i<groupsLength;i++){groups[i].hidden=hidden;level=groups[i].level;if(!hiddenRows[level]){hiddenRows[level]=[]}if(!hiddenCols[level]){hiddenCols[level]=[]}if(groups[i].rows){for(var j=0,rowsLength=groups[i].rows.length;j<rowsLength;j++){if(hidden>0){hiddenRows[level][groups[i].rows[j]]=true}else{hiddenRows[level][groups[i].rows[j]]=void 0}}}else{if(groups[i].cols){for(var j=0,colsLength=groups[i].cols.length;j<colsLength;j++){if(hidden>0){hiddenCols[level][groups[i].cols[j]]=true}else{hiddenCols[level][groups[i].cols[j]]=void 0}}}}}};var nextIndexSharesLevel=function(dimension,currentPosition,level,currentGroupId){var nextCellGroupId,levelsByOrder;switch(dimension){case"rows":nextCellGroupId=getGroupByRowAndLevel(currentPosition+1,level).id;levelsByOrder=Handsontable.Grouping.getGroupLevelsByRows();break;case"cols":nextCellGroupId=getGroupByColAndLevel(currentPosition+1,level).id;levelsByOrder=Handsontable.Grouping.getGroupLevelsByCols();break}return !!(levelsByOrder[currentPosition+1]&&levelsByOrder[currentPosition+1].indexOf(level)>-1&&currentGroupId==nextCellGroupId)};var previousIndexSharesLevel=function(dimension,currentPosition,level,currentGroupId){var previousCellGroupId,levelsByOrder;switch(dimension){case"rows":previousCellGroupId=getGroupByRowAndLevel(currentPosition-1,level).id;levelsByOrder=Handsontable.Grouping.getGroupLevelsByRows();break;case"cols":previousCellGroupId=getGroupByColAndLevel(currentPosition-1,level).id;levelsByOrder=Handsontable.Grouping.getGroupLevelsByCols();break}return !!(levelsByOrder[currentPosition-1]&&levelsByOrder[currentPosition-1].indexOf(level)>-1&&currentGroupId==previousCellGroupId)};var isLastIndexOfTheLine=function(dimension,index,level,currentGroupId){if(index===0){return false}var levelsByOrder,entriesLength,previousSharesLevel=previousIndexSharesLevel(dimension,index,level,currentGroupId),nextSharesLevel=nextIndexSharesLevel(dimension,index,level,currentGroupId),nextIsHidden=false;switch(dimension){case"rows":levelsByOrder=Handsontable.Grouping.getGroupLevelsByRows();entriesLength=instance.countRows();for(var i=0;i<=levels.rows;i++){if(hiddenRows[i]&&hiddenRows[i][index+1]){nextIsHidden=true;break}}break;case"cols":levelsByOrder=Handsontable.Grouping.getGroupLevelsByCols();entriesLength=instance.countCols();for(var i=0;i<=levels.cols;i++){if(hiddenCols[i]&&hiddenCols[i][index+1]){nextIsHidden=true;break}}break}if(previousSharesLevel){if(index==entriesLength-1){return true}else{if(!nextSharesLevel||(nextSharesLevel&&nextIsHidden)){return true}else{if(!levelsByOrder[index+1]){return true}}}}return false};var isLastHidden=function(dataType){var levelAmount;switch(dataType){case"rows":levelAmount=levels.rows;for(var j=0;j<=levelAmount;j++){if(hiddenRows[j]&&hiddenRows[j][instance.countRows()-1]){return true}}break;case"cols":levelAmount=levels.cols;for(var j=0;j<=levelAmount;j++){if(hiddenCols[j]&&hiddenCols[j][instance.countCols()-1]){return true}}break}return false};var isFirstIndexOfTheLine=function(dimension,index,level,currentGroupId){var levelsByOrder,entriesLength,currentGroup=getGroupById(currentGroupId),previousAreHidden=false,arePreviousHidden=function(dimension){var hidden=false,hiddenArr=dimension=="rows"?hiddenRows:hiddenCols;for(var i=0;i<=levels[dimension];i++){tempInd=index;while(currentGroup[dimension].indexOf(tempInd)>-1){hidden=!!(hiddenArr[i]&&hiddenArr[i][tempInd]);tempInd--}if(hidden){break}}return hidden},previousSharesLevel=previousIndexSharesLevel(dimension,index,level,currentGroupId),nextSharesLevel=nextIndexSharesLevel(dimension,index,level,currentGroupId),tempInd;switch(dimension){case"rows":levelsByOrder=Handsontable.Grouping.getGroupLevelsByRows();entriesLength=instance.countRows();previousAreHidden=arePreviousHidden(dimension);break;case"cols":levelsByOrder=Handsontable.Grouping.getGroupLevelsByCols();entriesLength=instance.countCols();previousAreHidden=arePreviousHidden(dimension);break}if(index==entriesLength-1){return false}else{if(index==0){if(nextSharesLevel){return true}}else{if(!previousSharesLevel||(previousSharesLevel&&previousAreHidden)){if(nextSharesLevel){return true}}else{if(!levelsByOrder[index-1]){if(nextSharesLevel){return true}}}}}return false};var addGroupExpander=function(dataType,index,level,id,elem){var previousIndexGroupId;switch(dataType){case"rows":previousIndexGroupId=getGroupByRowAndLevel(index-1,level).id;break;case"cols":previousIndexGroupId=getGroupByColAndLevel(index-1,level).id;break}if(!previousIndexGroupId){return null}if(index>0){if(previousIndexSharesLevel(dataType,index-1,level,previousIndexGroupId)&&previousIndexGroupId!=id){var expanderButton=document.createElement("DIV");Handsontable.Dom.addClass(expanderButton,classes.expandButton);expanderButton.id="htExpand-"+previousIndexGroupId;expanderButton.appendChild(document.createTextNode("+"));expanderButton.setAttribute("data-level",level);expanderButton.setAttribute("data-type",dataType);expanderButton.setAttribute("data-hidden","1");elem.appendChild(expanderButton);return expanderButton}}return null};var isCollapsed=function(currentPosition){var rowGroups=getRowGroups(),colGroups=getColGroups();for(var i=0,rowGroupsCount=rowGroups.length;i<rowGroupsCount;i++){if(rowGroups[i].rows.indexOf(currentPosition.row)>-1&&rowGroups[i].hidden){return true}}if(currentPosition.col===null){return false}for(var i=0,colGroupsCount=colGroups.length;i<colGroupsCount;i++){if(colGroups[i].cols.indexOf(currentPosition.col)>-1&&colGroups[i].hidden){return true}}return false};return{getGroups:function(){return groups},getLevels:function(){return levels},instance:instance,baseSpareRows:instance.getSettings().minSpareRows,baseSpareCols:instance.getSettings().minSpareCols,getRowGroups:getRowGroups,getColGroups:getColGroups,init:function(){var groupsSetting=instance.getSettings().groups;if(groupsSetting){if(groupsSetting instanceof Array){Handsontable.Grouping.initGroups(groupsSetting)}}},initGroups:function(initialGroups){var that=this;groups=[];initialGroups.forEach(function(item){var _group=[],isRow=false,isCol=false;if(item.rows instanceof Array){_group=item.rows;isRow=true}else{if(item.cols instanceof Array){_group=item.cols;isCol=true}}var from=_group[0],to=_group[_group.length-1];if(isRow){groupRows(from,to)}else{if(isCol){groupCols(from,to)}}})},resetGroups:function(){groups=[];counters={rows:0,cols:0};levels={rows:0,cols:0};var allOccurrences;for(var i in classes){if(typeof classes[i]!="function"){allOccurrences=document.querySelectorAll("."+classes[i]);for(var j=0,occurrencesLength=allOccurrences.length;j<occurrencesLength;j++){Handsontable.Dom.removeClass(allOccurrences[j],classes[i])}}}var otherClasses=["htGroupColClosest","htGroupCol"];for(var i=0,otherClassesLength=otherClasses.length;i<otherClassesLength;i++){allOccurrences=document.querySelectorAll("."+otherClasses[i]);for(var j=0,occurrencesLength=allOccurrences.length;j<occurrencesLength;j++){Handsontable.Dom.removeClass(allOccurrences[j],otherClasses[i])}}},updateGroups:function(){var groupSettings=this.getSettings().groups;Handsontable.Grouping.resetGroups();Handsontable.Grouping.initGroups(groupSettings)},afterGetRowHeader:function(row,TH){var currentRowHidden=false;for(var i=0,levels=hiddenRows.length;i<levels;i++){if(hiddenRows[i]&&hiddenRows[i][row]===true){currentRowHidden=true}}if(currentRowHidden){Handsontable.Dom.addClass(TH.parentNode,"hidden")}else{if(!currentRowHidden&&Handsontable.Dom.hasClass(TH.parentNode,"hidden")){Handsontable.Dom.removeClass(TH.parentNode,"hidden")}}},afterGetColHeader:function(col,TH){var rowHeaders=this.view.wt.wtSettings.getSetting("rowHeaders").length,thisColgroup=instance.rootElement.querySelectorAll("colgroup col:nth-child("+parseInt(col+rowHeaders+1,10)+")");if(thisColgroup.length===0){return}var currentColHidden=false;for(var i=0,levels=hiddenCols.length;i<levels;i++){if(hiddenCols[i]&&hiddenCols[i][col]===true){currentColHidden=true}}if(currentColHidden){for(var i=0,colsAmount=thisColgroup.length;i<colsAmount;i++){Handsontable.Dom.addClass(thisColgroup[i],"hidden")}}else{if(!currentColHidden&&Handsontable.Dom.hasClass(thisColgroup[0],"hidden")){for(var i=0,colsAmount=thisColgroup.length;i<colsAmount;i++){Handsontable.Dom.removeClass(thisColgroup[i],"hidden")}}}},groupIndicatorsFactory:function(renderersArr,direction){var groupsLevelsList,getCurrentLevel,getCurrentGroupId,dataType,getGroupByIndexAndLevel,headersType,currentHeaderModifier,createLevelTriggers;switch(direction){case"horizontal":groupsLevelsList=Handsontable.Grouping.getGroupLevelsByCols();getCurrentLevel=function(elem){return Array.prototype.indexOf.call(elem.parentNode.parentNode.childNodes,elem.parentNode)+1};getCurrentGroupId=function(col,level){return getGroupByColAndLevel(col,level).id};dataType="cols";getGroupByIndexAndLevel=function(col,level){return getGroupByColAndLevel(col-1,level)};headersType="columnHeaders";currentHeaderModifier=function(headerRenderers){if(headerRenderers.length===1){var oldFn=headerRenderers[0];headerRenderers[0]=function(index,elem,level){if(index<-1){makeGroupIndicatorsForLevel()(index,elem,level)}else{Handsontable.Dom.removeClass(elem,classes.groupIndicatorContainer);oldFn(index,elem,level)}}}return function(){return headerRenderers}};createLevelTriggers=true;break;case"vertical":groupsLevelsList=Handsontable.Grouping.getGroupLevelsByRows();getCurrentLevel=function(elem){return Handsontable.Dom.index(elem)+1};getCurrentGroupId=function(row,level){return getGroupByRowAndLevel(row,level).id};dataType="rows";getGroupByIndexAndLevel=function(row,level){return getGroupByRowAndLevel(row-1,level)};headersType="rowHeaders";currentHeaderModifier=function(headerRenderers){return headerRenderers};break}var createButton=function(parent){var button=document.createElement("div");parent.appendChild(button);return{button:button,addClass:function(className){Handsontable.Dom.addClass(button,className)}}};var makeGroupIndicatorsForLevel=function(){var directionClassname=direction.charAt(0).toUpperCase()+direction.slice(1);return function(index,elem,level){level++;var child,collapseButton;while(child=elem.lastChild){elem.removeChild(child)}Handsontable.Dom.addClass(elem,classes.groupIndicatorContainer);var currentGroupId=getCurrentGroupId(index,level);if(index>-1&&(groupsLevelsList[index]&&groupsLevelsList[index].indexOf(level)>-1)){collapseButton=createButton(elem);collapseButton.addClass(classes.groupIndicator(directionClassname));if(isFirstIndexOfTheLine(dataType,index,level,currentGroupId)){collapseButton.addClass(classes.groupStart)}if(isLastIndexOfTheLine(dataType,index,level,currentGroupId)){collapseButton.button.appendChild(document.createTextNode("-"));collapseButton.addClass(classes.collapseButton);collapseButton.button.id=classes.collapseGroupId(currentGroupId);collapseButton.button.setAttribute("data-level",level);collapseButton.button.setAttribute("data-type",dataType)}}if(createLevelTriggers){var rowInd=Handsontable.Dom.index(elem.parentNode);if(index===-1||(index<-1&&rowInd===Handsontable.Grouping.getLevels().cols+1)||(rowInd==0&&Handsontable.Grouping.getLevels().cols==0)){collapseButton=createButton(elem);collapseButton.addClass(classes.levelTrigger);if(index===-1){collapseButton.button.id=classes.collapseFromLevel("Cols",level);collapseButton.button.appendChild(document.createTextNode(level))}else{if(index<-1&&rowInd===Handsontable.Grouping.getLevels().cols+1||(rowInd==0&&Handsontable.Grouping.getLevels().cols==0)){var colInd=Handsontable.Dom.index(elem)+1;collapseButton.button.id=classes.collapseFromLevel("Rows",colInd);collapseButton.button.appendChild(document.createTextNode(colInd))}}}}var expanderButton=addGroupExpander(dataType,index,level,currentGroupId,elem);if(index>0){var previousGroupObj=getGroupByIndexAndLevel(index-1,level);if(expanderButton&&previousGroupObj.hidden){Handsontable.Dom.addClass(expanderButton,classes.clickable)}}updateHeaderWidths()}};renderersArr=currentHeaderModifier(renderersArr);if(counters[dataType]>0){for(var i=0;i<levels[dataType]+1;i++){if(!(renderersArr instanceof Array)){renderersArr=typeof renderersArr==="function"?renderersArr():new Array(renderersArr)}renderersArr.unshift(makeGroupIndicatorsForLevel())}}},getGroupLevelsByRows:function(){var rowGroups=getRowGroups(),result=[];for(var i=0,groupsLength=rowGroups.length;i<groupsLength;i++){if(rowGroups[i].rows){for(var j=0,groupRowsLength=rowGroups[i].rows.length;j<groupRowsLength;j++){if(!result[rowGroups[i].rows[j]]){result[rowGroups[i].rows[j]]=[]}result[rowGroups[i].rows[j]].push(rowGroups[i].level)}}}return result},getGroupLevelsByCols:function(){var colGroups=getColGroups(),result=[];for(var i=0,groupsLength=colGroups.length;i<groupsLength;i++){if(colGroups[i].cols){for(var j=0,groupColsLength=colGroups[i].cols.length;j<groupColsLength;j++){if(!result[colGroups[i].cols[j]]){result[colGroups[i].cols[j]]=[]}result[colGroups[i].cols[j]].push(colGroups[i].level)}}}return result},toggleGroupVisibility:function(event,coords,TD){if(Handsontable.Dom.hasClass(event.target,classes.expandButton)||Handsontable.Dom.hasClass(event.target,classes.collapseButton)||Handsontable.Dom.hasClass(event.target,classes.levelTrigger)){var element=event.target,elemIdSplit=element.id.split("-");var groups=[],id,level,type,hidden;var prepareGroupData=function(componentElement){if(componentElement){element=componentElement}elemIdSplit=element.id.split("-");id=elemIdSplit[1];level=parseInt(element.getAttribute("data-level"),10);type=element.getAttribute("data-type");hidden=parseInt(element.getAttribute("data-hidden"));if(isNaN(hidden)){hidden=1}else{hidden=(hidden?0:1)}element.setAttribute("data-hidden",hidden.toString());groups.push(getGroupById(id))};if(element.className.indexOf(classes.levelTrigger)>-1){var groupsInLevel,groupsToExpand=[],groupsToCollapse=[],levelType=element.id.indexOf("Rows")>-1?"rows":"cols";for(var i=1,levelsCount=levels[levelType];i<=levelsCount;i++){groupsInLevel=levelType=="rows"?getRowGroupsByLevel(i):getColGroupsByLevel(i);if(i>=parseInt(elemIdSplit[1],10)){for(var j=0,groupCount=groupsInLevel.length;j<groupCount;j++){groupsToCollapse.push(groupsInLevel[j])}}else{for(var j=0,groupCount=groupsInLevel.length;j<groupCount;j++){groupsToExpand.push(groupsInLevel[j])}}}showHideGroups(true,groupsToCollapse);showHideGroups(false,groupsToExpand)}else{prepareGroupData();showHideGroups(hidden,groups)}type=type||levelType;var lastHidden=isLastHidden(type),typeUppercase=type.charAt(0).toUpperCase()+type.slice(1),spareElements=Handsontable.Grouping["baseSpare"+typeUppercase];if(lastHidden){if(spareElements==0){instance.alter("insert_"+type.slice(0,-1),instance["count"+typeUppercase]());Handsontable.Grouping["dummy"+type.slice(0,-1)]=true}}else{if(spareElements==0){if(Handsontable.Grouping["dummy"+type.slice(0,-1)]){instance.alter("remove_"+type.slice(0,-1),instance["count"+typeUppercase]()-1);Handsontable.Grouping["dummy"+type.slice(0,-1)]=false}}}instance.render();event.stopImmediatePropagation()}},modifySelectionFactory:function(position){var instance=this.instance;var currentlySelected,nextPosition=new WalkontableCellCoords(0,0),nextVisible=function(direction,currentPosition){var updateDelta=0;switch(direction){case"down":while(isCollapsed(currentPosition)){updateDelta++;currentPosition.row+=1}break;case"up":while(isCollapsed(currentPosition)){updateDelta--;currentPosition.row-=1}break;case"right":while(isCollapsed(currentPosition)){updateDelta++;currentPosition.col+=1}break;case"left":while(isCollapsed(currentPosition)){updateDelta--;currentPosition.col-=1}break}return updateDelta},updateDelta=function(delta,nextPosition){if(delta.row>0){if(isCollapsed(nextPosition)){delta.row+=nextVisible("down",nextPosition)}}else{if(delta.row<0){if(isCollapsed(nextPosition)){delta.row+=nextVisible("up",nextPosition)}}}if(delta.col>0){if(isCollapsed(nextPosition)){delta.col+=nextVisible("right",nextPosition)}}else{if(delta.col<0){if(isCollapsed(nextPosition)){delta.col+=nextVisible("left",nextPosition)}}}};switch(position){case"start":return function(delta){currentlySelected=instance.getSelected();nextPosition.row=currentlySelected[0]+delta.row;nextPosition.col=currentlySelected[1]+delta.col;updateDelta(delta,nextPosition)};break;case"end":return function(delta){currentlySelected=instance.getSelected();nextPosition.row=currentlySelected[2]+delta.row;nextPosition.col=currentlySelected[3]+delta.col;updateDelta(delta,nextPosition)};break}},modifyRowHeight:function(height,row){if(instance.view.wt.wtTable.rowFilter&&isCollapsed({row:row,col:null})){return 0}},validateGroups:function(){var areRangesOverlapping=function(a,b){if((a[0]<b[0]&&a[1]<b[1]&&b[0]<=a[1])||(a[0]>b[0]&&b[1]<a[1]&&a[0]<=b[1])){return true}};var configGroups=instance.getSettings().groups,cols=[],rows=[];for(var i=0,groupsLength=configGroups.length;i<groupsLength;i++){if(configGroups[i].rows){if(configGroups[i].rows.length===1){throw new Error("Grouping error:  Group {"+configGroups[i].rows[0]+"} is invalid. Cannot define single-entry groups.");return false}else{if(configGroups[i].rows.length===0){throw new Error("Grouping error:  Cannot define empty groups.");return false}}rows.push(configGroups[i].rows);for(var j=0,rowsLength=rows.length;j<rowsLength;j++){if(areRangesOverlapping(configGroups[i].rows,rows[j])){throw new Error("Grouping error:  ranges {"+configGroups[i].rows[0]+", "+configGroups[i].rows[1]+"} and {"+rows[j][0]+", "+rows[j][1]+"} are overlapping.");return false}}}else{if(configGroups[i].cols){if(configGroups[i].cols.length===1){throw new Error("Grouping error:  Group {"+configGroups[i].cols[0]+"} is invalid. Cannot define single-entry groups.");return false}else{if(configGroups[i].cols.length===0){throw new Error("Grouping error:  Cannot define empty groups.");return false}}cols.push(configGroups[i].cols);for(var j=0,colsLength=cols.length;j<colsLength;j++){if(areRangesOverlapping(configGroups[i].cols,cols[j])){throw new Error("Grouping error:  ranges {"+configGroups[i].cols[0]+", "+configGroups[i].cols[1]+"} and {"+cols[j][0]+", "+cols[j][1]+"} are overlapping.");return false}}}}}return true},afterGetRowHeaderRenderers:function(arr){Handsontable.Grouping.groupIndicatorsFactory(arr,"vertical")},afterGetColumnHeaderRenderers:function(arr){Handsontable.Grouping.groupIndicatorsFactory(arr,"horizontal")},hookProxy:function(fn,arg){return function(){if(instance.getSettings().groups){return arg?Handsontable.Grouping[fn](arg).apply(this,arguments):Handsontable.Grouping[fn].apply(this,arguments)}else{return void 0}}}}};var init=function(){var instance=this,groupingSetting=!!(instance.getSettings().groups);if(groupingSetting){var headerUpdates={};Handsontable.Grouping=new Grouping(instance);if(!instance.getSettings().rowHeaders){headerUpdates.rowHeaders=true}if(!instance.getSettings().colHeaders){headerUpdates.colHeaders=true}if(headerUpdates.colHeaders||headerUpdates.rowHeaders){instance.updateSettings(headerUpdates)}var groupConfigValid=Handsontable.Grouping.validateGroups();if(!groupConfigValid){return}instance.addHook("beforeInit",Handsontable.Grouping.hookProxy("init"));instance.addHook("afterUpdateSettings",Handsontable.Grouping.hookProxy("updateGroups"));instance.addHook("afterGetColumnHeaderRenderers",Handsontable.Grouping.hookProxy("afterGetColumnHeaderRenderers"));instance.addHook("afterGetRowHeaderRenderers",Handsontable.Grouping.hookProxy("afterGetRowHeaderRenderers"));instance.addHook("afterGetRowHeader",Handsontable.Grouping.hookProxy("afterGetRowHeader"));instance.addHook("afterGetColHeader",Handsontable.Grouping.hookProxy("afterGetColHeader"));instance.addHook("beforeOnCellMouseDown",Handsontable.Grouping.hookProxy("toggleGroupVisibility"));instance.addHook("modifyTransformStart",Handsontable.Grouping.hookProxy("modifySelectionFactory","start"));instance.addHook("modifyTransformEnd",Handsontable.Grouping.hookProxy("modifySelectionFactory","end"));instance.addHook("modifyRowHeight",Handsontable.Grouping.hookProxy("modifyRowHeight"))}};var updateHeaderWidths=function(){var colgroups=document.querySelectorAll("colgroup");for(var i=0,colgroupsLength=colgroups.length;i<colgroupsLength;i++){var rowHeaders=colgroups[i].querySelectorAll("col.rowHeader");if(rowHeaders.length==0){return}for(var j=0,rowHeadersLength=rowHeaders.length+1;j<rowHeadersLength;j++){if(rowHeadersLength==2){return}if(j<Handsontable.Grouping.getLevels().rows+1){if(j==Handsontable.Grouping.getLevels().rows){Handsontable.Dom.addClass(rowHeaders[j],"htGroupColClosest")}else{Handsontable.Dom.addClass(rowHeaders[j],"htGroupCol")}}}}};Handsontable.hooks.add("beforeInit",init);Handsontable.hooks.add("afterUpdateSettings",function(){if(this.getSettings().groups&&!Handsontable.Grouping){init.call(this,arguments)}else{if(!this.getSettings().groups&&Handsontable.Grouping){Handsontable.Grouping.resetGroups();Handsontable.Grouping=void 0}}});Handsontable.plugins.Grouping=Grouping;(function(Handsontable){function ContextMenuCopyPaste(){this.zeroClipboardInstance=null;this.instance=null}ContextMenuCopyPaste.prototype.prepareZeroClipboard=function(){if(this.swfPath){ZeroClipboard.config({swfPath:this.swfPath})}};ContextMenuCopyPaste.prototype.copy=function(){this.instance.copyPaste.setCopyableText();return this.instance.copyPaste.copyPasteInstance.elTextarea.value};ContextMenuCopyPaste.prototype.addToContextMenu=function(defaultOptions){if(!this.getSettings().contextMenuCopyPaste){return}defaultOptions.items.unshift({key:"copy",name:"Copy"},{key:"paste",name:"Paste",callback:function(){this.copyPaste.triggerPaste()}},Handsontable.ContextMenu.SEPARATOR)};ContextMenuCopyPaste.prototype.setupZeroClipboard=function(cmInstance){var plugin=this;this.cmInstance=cmInstance;if(!Handsontable.Dom.hasClass(this.cmInstance.rootElement,"htContextMenu")){return}var data=cmInstance.getData();for(var i=0,ilen=data.length;i<ilen;i++){if(data[i].key==="copy"){this.zeroClipboardInstance=new ZeroClipboard(cmInstance.getCell(i,0));this.zeroClipboardInstance.off();this.zeroClipboardInstance.on("copy",function(event){var clipboard=event.clipboardData;clipboard.setData("text/plain",plugin.copy());plugin.instance.getSettings().outsideClickDeselects=plugin.outsideClickDeselectsCache});cmCopyPaste.bindEvents();break}}};ContextMenuCopyPaste.prototype.bindEvents=function(){var plugin=this;if(plugin.cmInstance){var eventManager=new Handsontable.eventManager(this.instance);var removeCurrenClass=function(event){var hadClass=plugin.cmInstance.rootElement.querySelector("td.current");if(hadClass){Handsontable.Dom.removeClass(hadClass,"current")}plugin.outsideClickDeselectsCache=plugin.instance.getSettings().outsideClickDeselects;plugin.instance.getSettings().outsideClickDeselects=false};var removeZeroClipboardClass=function(event){var hadClass=plugin.cmInstance.rootElement.querySelector("td.zeroclipboard-is-hover");if(hadClass){Handsontable.Dom.removeClass(hadClass,"zeroclipboard-is-hover")}plugin.instance.getSettings().outsideClickDeselects=plugin.outsideClickDeselectsCache};eventManager.removeEventListener(document,"mouseenter",function(){removeCurrenClass()});eventManager.addEventListener(document,"mouseenter",function(e){removeCurrenClass()});eventManager.removeEventListener(document,"mouseleave",function(){removeZeroClipboardClass()});eventManager.addEventListener(document,"mouseleave",function(e){removeZeroClipboardClass()})}};ContextMenuCopyPaste.prototype.init=function(){if(!this.getSettings().contextMenuCopyPaste){return}else{if(typeof this.getSettings().contextMenuCopyPaste=="object"){cmCopyPaste.swfPath=this.getSettings().contextMenuCopyPaste.swfPath}}if(typeof ZeroClipboard==="undefined"){throw new Error("To be able to use the Copy/Paste feature from the context menu, you need to manualy include ZeroClipboard.js file to your website.");return false}try{var flashTest=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(exception){if(!("undefined"!=typeof navigator.mimeTypes["application/x-shockwave-flash"])){throw new Error("To be able to use the Copy/Paste feature from the context menu, your browser needs to have Flash Plugin installed.");return false}}cmCopyPaste.instance=this;cmCopyPaste.prepareZeroClipboard()};var cmCopyPaste=new ContextMenuCopyPaste();Handsontable.hooks.add("afterRender",function(){cmCopyPaste.setupZeroClipboard(this)});Handsontable.hooks.add("afterInit",cmCopyPaste.init);Handsontable.hooks.add("afterContextMenuDefaultOptions",cmCopyPaste.addToContextMenu);Handsontable.ContextMenuCopyPaste=ContextMenuCopyPaste})(Handsontable);(function(Handsontable){function MultipleSelectionHandles(instance){this.instance=instance;this.dragged=[];this.eventManager=Handsontable.eventManager(instance);this.bindTouchEvents()}MultipleSelectionHandles.prototype.getCurrentRangeCoords=function(selectedRange,currentTouch,touchStartDirection,currentDirection,draggedHandle){var topLeftCorner=selectedRange.getTopLeftCorner(),bottomRightCorner=selectedRange.getBottomRightCorner(),bottomLeftCorner=selectedRange.getBottomLeftCorner(),topRightCorner=selectedRange.getTopRightCorner();var newCoords={start:null,end:null};switch(touchStartDirection){case"NE-SW":switch(currentDirection){case"NE-SW":case"NW-SE":if(draggedHandle=="topLeft"){newCoords={start:new WalkontableCellCoords(currentTouch.row,selectedRange.highlight.col),end:new WalkontableCellCoords(bottomLeftCorner.row,currentTouch.col)}}else{newCoords={start:new WalkontableCellCoords(selectedRange.highlight.row,currentTouch.col),end:new WalkontableCellCoords(currentTouch.row,topLeftCorner.col)}}break;case"SE-NW":if(draggedHandle=="bottomRight"){newCoords={start:new WalkontableCellCoords(bottomRightCorner.row,currentTouch.col),end:new WalkontableCellCoords(currentTouch.row,topLeftCorner.col)}}break}break;case"NW-SE":switch(currentDirection){case"NE-SW":if(draggedHandle=="topLeft"){newCoords={start:currentTouch,end:bottomLeftCorner}}else{newCoords.end=currentTouch}break;case"NW-SE":if(draggedHandle=="topLeft"){newCoords={start:currentTouch,end:bottomRightCorner}}else{newCoords.end=currentTouch}break;case"SE-NW":if(draggedHandle=="topLeft"){newCoords={start:currentTouch,end:topLeftCorner}}else{newCoords.end=currentTouch}break;case"SW-NE":if(draggedHandle=="topLeft"){newCoords={start:currentTouch,end:topRightCorner}}else{newCoords.end=currentTouch}break}break;case"SW-NE":switch(currentDirection){case"NW-SE":if(draggedHandle=="bottomRight"){newCoords={start:new WalkontableCellCoords(currentTouch.row,topLeftCorner.col),end:new WalkontableCellCoords(bottomLeftCorner.row,currentTouch.col)}}else{newCoords={start:new WalkontableCellCoords(topLeftCorner.row,currentTouch.col),end:new WalkontableCellCoords(currentTouch.row,bottomRightCorner.col)}}break;case"SW-NE":if(draggedHandle=="topLeft"){newCoords={start:new WalkontableCellCoords(selectedRange.highlight.row,currentTouch.col),end:new WalkontableCellCoords(currentTouch.row,bottomRightCorner.col)}}else{newCoords={start:new WalkontableCellCoords(currentTouch.row,topLeftCorner.col),end:new WalkontableCellCoords(topLeftCorner.row,currentTouch.col)}}break;case"SE-NW":if(draggedHandle=="bottomRight"){newCoords={start:new WalkontableCellCoords(currentTouch.row,topRightCorner.col),end:new WalkontableCellCoords(topLeftCorner.row,currentTouch.col)}}else{if(draggedHandle=="topLeft"){newCoords={start:bottomLeftCorner,end:currentTouch}}}break}break;case"SE-NW":switch(currentDirection){case"NW-SE":case"NE-SW":case"SW-NE":if(draggedHandle=="topLeft"){newCoords.end=currentTouch}break;case"SE-NW":if(draggedHandle=="topLeft"){newCoords.end=currentTouch}else{newCoords={start:currentTouch,end:topLeftCorner}}break}break}return newCoords};MultipleSelectionHandles.prototype.bindTouchEvents=function(){var that=this;var removeFromDragged=function(query){if(this.dragged.length==1){this.dragged=[];return true}var entryPosition=this.dragged.indexOf(query);if(entryPosition==-1){return false}else{if(entryPosition==0){this.dragged=this.dragged.slice(0,1)}else{if(entryPosition==1){this.dragged=this.dragged.slice(-1)}}}};this.eventManager.addEventListener(this.instance.rootElement,"touchstart",function(event){if(Handsontable.Dom.hasClass(event.target,"topLeftSelectionHandle-HitArea")){that.dragged.push("topLeft");var selectedRange=that.instance.getSelectedRange();that.touchStartRange={width:selectedRange.getWidth(),height:selectedRange.getHeight(),direction:selectedRange.getDirection()};event.preventDefault();return false}else{if(Handsontable.Dom.hasClass(event.target,"bottomRightSelectionHandle-HitArea")){that.dragged.push("bottomRight");var selectedRange=that.instance.getSelectedRange();that.touchStartRange={width:selectedRange.getWidth(),height:selectedRange.getHeight(),direction:selectedRange.getDirection()};event.preventDefault();return false}}});this.eventManager.addEventListener(this.instance.rootElement,"touchend",function(event){if(Handsontable.Dom.hasClass(event.target,"topLeftSelectionHandle-HitArea")){removeFromDragged.call(that,"topLeft");that.touchStartRange=void 0;event.preventDefault();return false}else{if(Handsontable.Dom.hasClass(event.target,"bottomRightSelectionHandle-HitArea")){removeFromDragged.call(that,"bottomRight");that.touchStartRange=void 0;event.preventDefault();return false}}});this.eventManager.addEventListener(this.instance.rootElement,"touchmove",function(event){var scrollTop=Handsontable.Dom.getWindowScrollTop(),scrollLeft=Handsontable.Dom.getWindowScrollLeft();if(that.dragged.length>0){var endTarget=document.elementFromPoint(event.touches[0].screenX-scrollLeft,event.touches[0].screenY-scrollTop);if(!endTarget){return}if(endTarget.nodeName=="TD"||endTarget.nodeName=="TH"){var targetCoords=that.instance.getCoords(endTarget);if(targetCoords.col==-1){targetCoords.col=0}var selectedRange=that.instance.getSelectedRange(),rangeWidth=selectedRange.getWidth(),rangeHeight=selectedRange.getHeight(),rangeDirection=selectedRange.getDirection();if(rangeWidth==1&&rangeHeight==1){that.instance.selection.setRangeEnd(targetCoords)}var newRangeCoords=that.getCurrentRangeCoords(selectedRange,targetCoords,that.touchStartRange.direction,rangeDirection,that.dragged[0]);if(newRangeCoords.start!=null){that.instance.selection.setRangeStart(newRangeCoords.start)}that.instance.selection.setRangeEnd(newRangeCoords.end)}event.preventDefault()}})};MultipleSelectionHandles.prototype.isDragged=function(){if(this.dragged.length==0){return false}else{return true}};var init=function(){var instance=this;Handsontable.plugins.multipleSelectionHandles=new MultipleSelectionHandles(instance)};Handsontable.hooks.add("afterInit",init)})(Handsontable);var TouchScroll=(function(instance){function TouchScroll(instance){}TouchScroll.prototype.init=function(instance){this.instance=instance;this.bindEvents();this.scrollbars=[this.instance.view.wt.wtScrollbars.vertical,this.instance.view.wt.wtScrollbars.horizontal,this.instance.view.wt.wtScrollbars.corner];this.clones=[this.instance.view.wt.wtScrollbars.vertical.clone.wtTable.holder.parentNode,this.instance.view.wt.wtScrollbars.horizontal.clone.wtTable.holder.parentNode,this.instance.view.wt.wtScrollbars.corner.clone.wtTable.holder.parentNode]};TouchScroll.prototype.bindEvents=function(){var that=this;this.instance.addHook("beforeTouchScroll",function(){Handsontable.freezeOverlays=true;for(var i=0,cloneCount=that.clones.length;i<cloneCount;i++){Handsontable.Dom.addClass(that.clones[i],"hide-tween")}});this.instance.addHook("afterMomentumScroll",function(){Handsontable.freezeOverlays=false;for(var i=0,cloneCount=that.clones.length;i<cloneCount;i++){Handsontable.Dom.removeClass(that.clones[i],"hide-tween")}for(var i=0,cloneCount=that.clones.length;i<cloneCount;i++){Handsontable.Dom.addClass(that.clones[i],"show-tween")}setTimeout(function(){for(var i=0,cloneCount=that.clones.length;i<cloneCount;i++){Handsontable.Dom.removeClass(that.clones[i],"show-tween")}},400);for(var i=0,cloneCount=that.scrollbars.length;i<cloneCount;i++){that.scrollbars[i].refresh();that.scrollbars[i].resetFixedPosition()}})};return TouchScroll}());var touchScrollHandler=new TouchScroll();Handsontable.hooks.add("afterInit",function(){touchScrollHandler.init.call(touchScrollHandler,this)});function WalkontableOverlay(){}WalkontableOverlay.prototype.init=function(){this.TABLE=this.instance.wtTable.TABLE;this.fixed=this.instance.wtTable.hider;this.fixedContainer=this.instance.wtTable.holder;this.scrollHandler=this.getScrollableElement(this.TABLE)};WalkontableOverlay.prototype.makeClone=function(direction){var clone=document.createElement("DIV");clone.className="ht_clone_"+direction+" handsontable";clone.style.position="absolute";clone.style.top=0;clone.style.left=0;clone.style.overflow="hidden";var table2=document.createElement("TABLE");table2.className=this.instance.wtTable.TABLE.className;clone.appendChild(table2);this.instance.wtTable.holder.parentNode.appendChild(clone);return new Walkontable({cloneSource:this.instance,cloneOverlay:this,table:table2})};WalkontableOverlay.prototype.getScrollableElement=function(TABLE){var el=TABLE.parentNode;while(el&&el.style){if(el.style.overflow!=="visible"&&el.style.overflow!==""){return el}if(this instanceof WalkontableHorizontalScrollbarNative&&el.style.overflowX!=="visible"&&el.style.overflowX!==""){return el}el=el.parentNode}return window};WalkontableOverlay.prototype.refresh=function(selectionsOnly){this.clone&&this.clone.draw(selectionsOnly)};WalkontableOverlay.prototype.destroy=function(){var eventManager=Handsontable.eventManager(this.clone);eventManager.clear()};function WalkontableBorder(instance,settings){var style;var createMultipleSelectorHandles=function(){this.selectionHandles={topLeft:document.createElement("DIV"),topLeftHitArea:document.createElement("DIV"),bottomRight:document.createElement("DIV"),bottomRightHitArea:document.createElement("DIV")};var width=10,hitAreaWidth=40;this.selectionHandles.topLeft.className="topLeftSelectionHandle";this.selectionHandles.topLeftHitArea.className="topLeftSelectionHandle-HitArea";this.selectionHandles.bottomRight.className="bottomRightSelectionHandle";this.selectionHandles.bottomRightHitArea.className="bottomRightSelectionHandle-HitArea";this.selectionHandles.styles={topLeft:this.selectionHandles.topLeft.style,topLeftHitArea:this.selectionHandles.topLeftHitArea.style,bottomRight:this.selectionHandles.bottomRight.style,bottomRightHitArea:this.selectionHandles.bottomRightHitArea.style};var hitAreaStyle={position:"absolute",height:hitAreaWidth+"px",width:hitAreaWidth+"px","border-radius":parseInt(hitAreaWidth/1.5,10)+"px"};for(var prop in hitAreaStyle){this.selectionHandles.styles.bottomRightHitArea[prop]=hitAreaStyle[prop];this.selectionHandles.styles.topLeftHitArea[prop]=hitAreaStyle[prop]}var handleStyle={position:"absolute",height:width+"px",width:width+"px","border-radius":parseInt(width/1.5,10)+"px",background:"#F5F5FF",border:"1px solid #4285c8"};for(var prop in handleStyle){this.selectionHandles.styles.bottomRight[prop]=handleStyle[prop];this.selectionHandles.styles.topLeft[prop]=handleStyle[prop]}this.main.appendChild(this.selectionHandles.topLeft);this.main.appendChild(this.selectionHandles.bottomRight);this.main.appendChild(this.selectionHandles.topLeftHitArea);this.main.appendChild(this.selectionHandles.bottomRightHitArea)};if(!settings){return}var eventManager=Handsontable.eventManager(instance);this.instance=instance;this.settings=settings;this.main=document.createElement("div");style=this.main.style;style.position="absolute";style.top=0;style.left=0;var borderDivs=["top","left","bottom","right","corner"];for(var i=0;i<5;i++){var position=borderDivs[i];var DIV=document.createElement("DIV");DIV.className="wtBorder "+(this.settings.className||"");if(this.settings[position]&&this.settings[position].hide){DIV.className+=" hidden"}style=DIV.style;style.backgroundColor=(this.settings[position]&&this.settings[position].color)?this.settings[position].color:settings.border.color;style.height=(this.settings[position]&&this.settings[position].width)?this.settings[position].width+"px":settings.border.width+"px";style.width=(this.settings[position]&&this.settings[position].width)?this.settings[position].width+"px":settings.border.width+"px";this.main.appendChild(DIV)}this.top=this.main.childNodes[0];this.left=this.main.childNodes[1];this.bottom=this.main.childNodes[2];this.right=this.main.childNodes[3];this.topStyle=this.top.style;this.leftStyle=this.left.style;this.bottomStyle=this.bottom.style;this.rightStyle=this.right.style;this.corner=this.main.childNodes[4];this.corner.className+=" corner";this.cornerStyle=this.corner.style;this.cornerStyle.width="5px";this.cornerStyle.height="5px";this.cornerStyle.border="2px solid #FFF";if(Handsontable.mobileBrowser){createMultipleSelectorHandles.call(this)}this.disappear();if(!instance.wtTable.bordersHolder){instance.wtTable.bordersHolder=document.createElement("div");instance.wtTable.bordersHolder.className="htBorders";instance.wtTable.hider.appendChild(instance.wtTable.bordersHolder)}instance.wtTable.bordersHolder.insertBefore(this.main,instance.wtTable.bordersHolder.firstChild);var down=false;eventManager.addEventListener(document.body,"mousedown",function(){down=true});eventManager.addEventListener(document.body,"mouseup",function(){down=false});for(var c=0,len=this.main.childNodes.length;c<len;c++){eventManager.addEventListener(this.main.childNodes[c],"mouseenter",function(event){if(!down||!instance.getSetting("hideBorderOnMouseDownOver")){return}event.preventDefault();event.stopImmediatePropagation();var bounds=this.getBoundingClientRect();this.style.display="none";var isOutside=function(event){if(event.clientY<Math.floor(bounds.top)){return true}if(event.clientY>Math.ceil(bounds.top+bounds.height)){return true}if(event.clientX<Math.floor(bounds.left)){return true}if(event.clientX>Math.ceil(bounds.left+bounds.width)){return true}};var handler=function(event){if(isOutside(event)){eventManager.removeEventListener(document.body,"mousemove",handler);this.style.display="block"}};eventManager.addEventListener(document.body,"mousemove",handler)})}}WalkontableBorder.prototype.appear=function(corners){var isMultiple,fromTD,toTD,fromOffset,toOffset,containerOffset,top,minTop,left,minLeft,height,width;if(this.disabled){return}var instance=this.instance;var fromRow,fromColumn,toRow,toColumn,i,ilen,s;var isPartRange=function(){if(this.instance.selections.area.cellRange){if(toRow!=this.instance.selections.area.cellRange.to.row||toColumn!=this.instance.selections.area.cellRange.to.col){return true}}return false};var updateMultipleSelectionHandlesPosition=function(top,left,width,height){var handleWidth=parseInt(this.selectionHandles.styles.topLeft.width,10),hitAreaWidth=parseInt(this.selectionHandles.styles.topLeftHitArea.width,10);this.selectionHandles.styles.topLeft.top=parseInt(top-handleWidth,10)+"px";this.selectionHandles.styles.topLeft.left=parseInt(left-handleWidth,10)+"px";this.selectionHandles.styles.topLeftHitArea.top=parseInt(top-(hitAreaWidth/4)*3,10)+"px";this.selectionHandles.styles.topLeftHitArea.left=parseInt(left-(hitAreaWidth/4)*3,10)+"px";this.selectionHandles.styles.bottomRight.top=parseInt(top+height,10)+"px";this.selectionHandles.styles.bottomRight.left=parseInt(left+width,10)+"px";this.selectionHandles.styles.bottomRightHitArea.top=parseInt(top+height-hitAreaWidth/4,10)+"px";this.selectionHandles.styles.bottomRightHitArea.left=parseInt(left+width-hitAreaWidth/4,10)+"px";if(this.settings.border.multipleSelectionHandlesVisible&&this.settings.border.multipleSelectionHandlesVisible()){this.selectionHandles.styles.topLeft.display="block";this.selectionHandles.styles.topLeftHitArea.display="block";if(!isPartRange.call(this)){this.selectionHandles.styles.bottomRight.display="block";this.selectionHandles.styles.bottomRightHitArea.display="block"}else{this.selectionHandles.styles.bottomRight.display="none";this.selectionHandles.styles.bottomRightHitArea.display="none"}}else{this.selectionHandles.styles.topLeft.display="none";this.selectionHandles.styles.bottomRight.display="none";this.selectionHandles.styles.topLeftHitArea.display="none";this.selectionHandles.styles.bottomRightHitArea.display="none"}if(fromRow==this.instance.wtSettings.getSetting("fixedRowsTop")||fromColumn==this.instance.wtSettings.getSetting("fixedColumnsLeft")){this.selectionHandles.styles.topLeft.zIndex="9999";this.selectionHandles.styles.topLeftHitArea.zIndex="9999"}else{this.selectionHandles.styles.topLeft.zIndex="";this.selectionHandles.styles.topLeftHitArea.zIndex=""}};if(instance.cloneOverlay instanceof WalkontableVerticalScrollbarNative||instance.cloneOverlay instanceof WalkontableCornerScrollbarNative){ilen=instance.getSetting("fixedRowsTop")}else{ilen=instance.wtTable.getRenderedRowsCount()}for(i=0;i<ilen;i++){s=instance.wtTable.rowFilter.renderedToSource(i);if(s>=corners[0]&&s<=corners[2]){fromRow=s;break}}for(i=ilen-1;i>=0;i--){s=instance.wtTable.rowFilter.renderedToSource(i);if(s>=corners[0]&&s<=corners[2]){toRow=s;break}}ilen=instance.wtTable.getRenderedColumnsCount();for(i=0;i<ilen;i++){s=instance.wtTable.columnFilter.renderedToSource(i);if(s>=corners[1]&&s<=corners[3]){fromColumn=s;break}}for(i=ilen-1;i>=0;i--){s=instance.wtTable.columnFilter.renderedToSource(i);if(s>=corners[1]&&s<=corners[3]){toColumn=s;break}}if(fromRow!==void 0&&fromColumn!==void 0){isMultiple=(fromRow!==toRow||fromColumn!==toColumn);fromTD=instance.wtTable.getCell(new WalkontableCellCoords(fromRow,fromColumn));toTD=isMultiple?instance.wtTable.getCell(new WalkontableCellCoords(toRow,toColumn)):fromTD;fromOffset=Handsontable.Dom.offset(fromTD);toOffset=isMultiple?Handsontable.Dom.offset(toTD):fromOffset;containerOffset=Handsontable.Dom.offset(instance.wtTable.TABLE);minTop=fromOffset.top;height=toOffset.top+Handsontable.Dom.outerHeight(toTD)-minTop;minLeft=fromOffset.left;width=toOffset.left+Handsontable.Dom.outerWidth(toTD)-minLeft;top=minTop-containerOffset.top-1;left=minLeft-containerOffset.left-1;var style=Handsontable.Dom.getComputedStyle(fromTD);if(parseInt(style.borderTopWidth,10)>0){top+=1;height=height>0?height-1:0}if(parseInt(style.borderLeftWidth,10)>0){left+=1;width=width>0?width-1:0}}else{this.disappear();return}this.topStyle.top=top+"px";this.topStyle.left=left+"px";this.topStyle.width=width+"px";this.topStyle.display="block";this.leftStyle.top=top+"px";this.leftStyle.left=left+"px";this.leftStyle.height=height+"px";this.leftStyle.display="block";var delta=Math.floor(this.settings.border.width/2);this.bottomStyle.top=top+height-delta+"px";this.bottomStyle.left=left+"px";this.bottomStyle.width=width+"px";this.bottomStyle.display="block";this.rightStyle.top=top+"px";this.rightStyle.left=left+width-delta+"px";this.rightStyle.height=height+1+"px";this.rightStyle.display="block";if(Handsontable.mobileBrowser||(!this.hasSetting(this.settings.border.cornerVisible)||isPartRange.call(this))){this.cornerStyle.display="none"}else{this.cornerStyle.top=top+height-4+"px";this.cornerStyle.left=left+width-4+"px";this.cornerStyle.display="block"}if(Handsontable.mobileBrowser){updateMultipleSelectionHandlesPosition.call(this,top,left,width,height)}};WalkontableBorder.prototype.disappear=function(){this.topStyle.display="none";this.leftStyle.display="none";this.bottomStyle.display="none";this.rightStyle.display="none";this.cornerStyle.display="none";if(Handsontable.mobileBrowser){this.selectionHandles.styles.topLeft.display="none";this.selectionHandles.styles.bottomRight.display="none"}};WalkontableBorder.prototype.hasSetting=function(setting){if(typeof setting==="function"){return setting()}return !!setting};function WalkontableCellCoords(row,col){if(typeof row!=="undefined"&&typeof col!=="undefined"){this.row=row;this.col=col}else{this.row=null;this.col=null}}WalkontableCellCoords.prototype.isValid=function(instance){if(this.row<0||this.col<0){return false}if(this.row>=instance.getSetting("totalRows")||this.col>=instance.getSetting("totalColumns")){return false}return true};WalkontableCellCoords.prototype.isEqual=function(cellCoords){if(cellCoords===this){return true}return(this.row===cellCoords.row&&this.col===cellCoords.col)};WalkontableCellCoords.prototype.isSouthEastOf=function(testedCoords){return this.row>=testedCoords.row&&this.col>=testedCoords.col};WalkontableCellCoords.prototype.isNorthWestOf=function(testedCoords){return this.row<=testedCoords.row&&this.col<=testedCoords.col};WalkontableCellCoords.prototype.isSouthWestOf=function(testedCoords){return this.row>=testedCoords.row&&this.col<=testedCoords.col};WalkontableCellCoords.prototype.isNorthEastOf=function(testedCoords){return this.row<=testedCoords.row&&this.col>=testedCoords.col};window.WalkontableCellCoords=WalkontableCellCoords;function WalkontableCellRange(highlight,from,to){this.highlight=highlight;this.from=from;this.to=to}WalkontableCellRange.prototype.isValid=function(instance){return(this.from.isValid(instance)&&this.to.isValid(instance))};WalkontableCellRange.prototype.isSingle=function(){return(this.from.row===this.to.row&&this.from.col===this.to.col)};WalkontableCellRange.prototype.getHeight=function(){return Math.max(this.from.row,this.to.row)-Math.min(this.from.row,this.to.row)+1};WalkontableCellRange.prototype.getWidth=function(){return Math.max(this.from.col,this.to.col)-Math.min(this.from.col,this.to.col)+1};WalkontableCellRange.prototype.includes=function(cellCoords){var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();if(cellCoords.row<0){cellCoords.row=0}if(cellCoords.col<0){cellCoords.col=0}return(topLeft.row<=cellCoords.row&&bottomRight.row>=cellCoords.row&&topLeft.col<=cellCoords.col&&bottomRight.col>=cellCoords.col)};WalkontableCellRange.prototype.includesRange=function(testedRange){return this.includes(testedRange.getTopLeftCorner())&&this.includes(testedRange.getBottomRightCorner())};WalkontableCellRange.prototype.isEqual=function(testedRange){return(Math.min(this.from.row,this.to.row)==Math.min(testedRange.from.row,testedRange.to.row))&&(Math.max(this.from.row,this.to.row)==Math.max(testedRange.from.row,testedRange.to.row))&&(Math.min(this.from.col,this.to.col)==Math.min(testedRange.from.col,testedRange.to.col))&&(Math.max(this.from.col,this.to.col)==Math.max(testedRange.from.col,testedRange.to.col))};WalkontableCellRange.prototype.overlaps=function(testedRange){return testedRange.isSouthEastOf(this.getTopLeftCorner())&&testedRange.isNorthWestOf(this.getBottomRightCorner())};WalkontableCellRange.prototype.isSouthEastOf=function(testedCoords){return this.getTopLeftCorner().isSouthEastOf(testedCoords)||this.getBottomRightCorner().isSouthEastOf(testedCoords)};WalkontableCellRange.prototype.isNorthWestOf=function(testedCoords){return this.getTopLeftCorner().isNorthWestOf(testedCoords)||this.getBottomRightCorner().isNorthWestOf(testedCoords)};WalkontableCellRange.prototype.expand=function(cellCoords){var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();if(cellCoords.row<topLeft.row||cellCoords.col<topLeft.col||cellCoords.row>bottomRight.row||cellCoords.col>bottomRight.col){this.from=new WalkontableCellCoords(Math.min(topLeft.row,cellCoords.row),Math.min(topLeft.col,cellCoords.col));this.to=new WalkontableCellCoords(Math.max(bottomRight.row,cellCoords.row),Math.max(bottomRight.col,cellCoords.col));return true}return false};WalkontableCellRange.prototype.expandByRange=function(expandingRange){if(this.includesRange(expandingRange)||!this.overlaps(expandingRange)){return false}var topLeft=this.getTopLeftCorner(),bottomRight=this.getBottomRightCorner(),topRight=this.getTopRightCorner(),bottomLeft=this.getBottomLeftCorner();var expandingTopLeft=expandingRange.getTopLeftCorner();var expandingBottomRight=expandingRange.getBottomRightCorner();var resultTopRow=Math.min(topLeft.row,expandingTopLeft.row);var resultTopCol=Math.min(topLeft.col,expandingTopLeft.col);var resultBottomRow=Math.max(bottomRight.row,expandingBottomRight.row);var resultBottomCol=Math.max(bottomRight.col,expandingBottomRight.col);var finalFrom=new WalkontableCellCoords(resultTopRow,resultTopCol),finalTo=new WalkontableCellCoords(resultBottomRow,resultBottomCol);var isCorner=new WalkontableCellRange(finalFrom,finalFrom,finalTo).isCorner(this.from,expandingRange),onlyMerge=expandingRange.isEqual(new WalkontableCellRange(finalFrom,finalFrom,finalTo));if(isCorner&&!onlyMerge){if(this.from.col>finalFrom.col){finalFrom.col=resultBottomCol;finalTo.col=resultTopCol}if(this.from.row>finalFrom.row){finalFrom.row=resultBottomRow;finalTo.row=resultTopRow}}this.from=finalFrom;this.to=finalTo;return true};WalkontableCellRange.prototype.getDirection=function(){if(this.from.isNorthWestOf(this.to)){return"NW-SE"}else{if(this.from.isNorthEastOf(this.to)){return"NE-SW"}else{if(this.from.isSouthEastOf(this.to)){return"SE-NW"}else{if(this.from.isSouthWestOf(this.to)){return"SW-NE"}}}}};WalkontableCellRange.prototype.setDirection=function(direction){switch(direction){case"NW-SE":this.from=this.getTopLeftCorner();this.to=this.getBottomRightCorner();break;case"NE-SW":this.from=this.getTopRightCorner();this.to=this.getBottomLeftCorner();break;case"SE-NW":this.from=this.getBottomRightCorner();this.to=this.getTopLeftCorner();break;case"SW-NE":this.from=this.getBottomLeftCorner();this.to=this.getTopRightCorner();break}};WalkontableCellRange.prototype.getTopLeftCorner=function(){return new WalkontableCellCoords(Math.min(this.from.row,this.to.row),Math.min(this.from.col,this.to.col))};WalkontableCellRange.prototype.getBottomRightCorner=function(){return new WalkontableCellCoords(Math.max(this.from.row,this.to.row),Math.max(this.from.col,this.to.col))};WalkontableCellRange.prototype.getTopRightCorner=function(){return new WalkontableCellCoords(Math.min(this.from.row,this.to.row),Math.max(this.from.col,this.to.col))};WalkontableCellRange.prototype.getBottomLeftCorner=function(){return new WalkontableCellCoords(Math.max(this.from.row,this.to.row),Math.min(this.from.col,this.to.col))};WalkontableCellRange.prototype.isCorner=function(coords,expandedRange){if(expandedRange){if(expandedRange.includes(coords)){if(this.getTopLeftCorner().isEqual(new WalkontableCellCoords(expandedRange.from.row,expandedRange.from.col))||this.getTopRightCorner().isEqual(new WalkontableCellCoords(expandedRange.from.row,expandedRange.to.col))||this.getBottomLeftCorner().isEqual(new WalkontableCellCoords(expandedRange.to.row,expandedRange.from.col))||this.getBottomRightCorner().isEqual(new WalkontableCellCoords(expandedRange.to.row,expandedRange.to.col))){return true}}}return coords.isEqual(this.getTopLeftCorner())||coords.isEqual(this.getTopRightCorner())||coords.isEqual(this.getBottomLeftCorner())||coords.isEqual(this.getBottomRightCorner())};WalkontableCellRange.prototype.getOppositeCorner=function(coords,expandedRange){if(!(coords instanceof WalkontableCellCoords)){return false}if(expandedRange){if(expandedRange.includes(coords)){if(this.getTopLeftCorner().isEqual(new WalkontableCellCoords(expandedRange.from.row,expandedRange.from.col))){return this.getBottomRightCorner()}if(this.getTopRightCorner().isEqual(new WalkontableCellCoords(expandedRange.from.row,expandedRange.to.col))){return this.getBottomLeftCorner()}if(this.getBottomLeftCorner().isEqual(new WalkontableCellCoords(expandedRange.to.row,expandedRange.from.col))){return this.getTopRightCorner()}if(this.getBottomRightCorner().isEqual(new WalkontableCellCoords(expandedRange.to.row,expandedRange.to.col))){return this.getTopLeftCorner()}}}if(coords.isEqual(this.getBottomRightCorner())){return this.getTopLeftCorner()}else{if(coords.isEqual(this.getTopLeftCorner())){return this.getBottomRightCorner()}else{if(coords.isEqual(this.getTopRightCorner())){return this.getBottomLeftCorner()}else{if(coords.isEqual(this.getBottomLeftCorner())){return this.getTopRightCorner()}}}}};WalkontableCellRange.prototype.getBordersSharedWith=function(range){if(!this.includesRange(range)){return[]}var thisBorders={top:Math.min(this.from.row,this.to.row),bottom:Math.max(this.from.row,this.to.row),left:Math.min(this.from.col,this.to.col),right:Math.max(this.from.col,this.to.col)},rangeBorders={top:Math.min(range.from.row,range.to.row),bottom:Math.max(range.from.row,range.to.row),left:Math.min(range.from.col,range.to.col),right:Math.max(range.from.col,range.to.col)},result=[];if(thisBorders.top==rangeBorders.top){result.push("top")}if(thisBorders.right==rangeBorders.right){result.push("right")}if(thisBorders.bottom==rangeBorders.bottom){result.push("bottom")}if(thisBorders.left==rangeBorders.left){result.push("left")}return result};WalkontableCellRange.prototype.getInner=function(){var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();var out=[];for(var r=topLeft.row;r<=bottomRight.row;r++){for(var c=topLeft.col;c<=bottomRight.col;c++){if(!(this.from.row===r&&this.from.col===c)&&!(this.to.row===r&&this.to.col===c)){out.push(new WalkontableCellCoords(r,c))}}}return out};WalkontableCellRange.prototype.getAll=function(){var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();var out=[];for(var r=topLeft.row;r<=bottomRight.row;r++){for(var c=topLeft.col;c<=bottomRight.col;c++){if(topLeft.row===r&&topLeft.col===c){out.push(topLeft)}else{if(bottomRight.row===r&&bottomRight.col===c){out.push(bottomRight)}else{out.push(new WalkontableCellCoords(r,c))}}}}return out};WalkontableCellRange.prototype.forAll=function(callback){var topLeft=this.getTopLeftCorner();var bottomRight=this.getBottomRightCorner();for(var r=topLeft.row;r<=bottomRight.row;r++){for(var c=topLeft.col;c<=bottomRight.col;c++){var breakIteration=callback(r,c);if(breakIteration===false){return}}}};window.WalkontableCellRange=WalkontableCellRange;function WalkontableColumnFilter(total,countTH){this.total=total;this.countTH=countTH}WalkontableColumnFilter.prototype.renderedToSource=function(n){return n};WalkontableColumnFilter.prototype.sourceToRendered=function(n){return n};WalkontableColumnFilter.prototype.offsettedTH=function(n){return n-this.countTH};WalkontableColumnFilter.prototype.unOffsettedTH=function(n){return n+this.countTH};WalkontableColumnFilter.prototype.visibleRowHeadedColumnToSourceColumn=function(n){return this.renderedToSource(this.offsettedTH(n))};WalkontableColumnFilter.prototype.sourceColumnToVisibleRowHeadedColumn=function(n){return this.unOffsettedTH(this.sourceToRendered(n))};function WalkontableColumnStrategy(instance,containerSizeFn,sizeAtIndex,strategy){var size,i=0;this.instance=instance;this.containerSizeFn=containerSizeFn;this.cellSizesSum=0;this.cellSizes=[];this.cellStretch=[];this.cellCount=0;this.visibleCellCount=0;this.remainingSize=0;this.strategy=strategy;while(true){size=sizeAtIndex(i);if(size===void 0){break}if(this.cellSizesSum<this.getContainerSize()){this.visibleCellCount++}this.cellSizes.push(size);this.cellSizesSum+=size;this.cellCount++;i++}var containerSize=this.getContainerSize();this.remainingSize=this.cellSizesSum-containerSize}WalkontableColumnStrategy.prototype.getContainerSize=function(){return typeof this.containerSizeFn==="function"?this.containerSizeFn():this.containerSizeFn};WalkontableColumnStrategy.prototype.getSize=function(index){return this.cellSizes[index]+(this.cellStretch[index]||0)};WalkontableColumnStrategy.prototype.stretch=function(){var containerSize=this.getContainerSize(),i=0;this.remainingSize=this.cellSizesSum-containerSize;this.cellStretch.length=0;if(this.strategy==="all"){if(this.remainingSize<0){var ratio=containerSize/this.cellSizesSum;var newSize;while(i<this.cellCount-1){newSize=Math.floor(ratio*this.cellSizes[i]);this.remainingSize+=newSize-this.cellSizes[i];this.cellStretch[i]=newSize-this.cellSizes[i];i++}this.cellStretch[this.cellCount-1]=-this.remainingSize;this.remainingSize=0}}else{if(this.strategy==="last"){if(this.remainingSize<0&&containerSize!==Infinity){this.cellStretch[this.cellCount-1]=-this.remainingSize;this.remainingSize=0}}}};WalkontableColumnStrategy.prototype.countVisible=function(){return this.visibleCellCount};WalkontableColumnStrategy.prototype.isLastIncomplete=function(){var firstRow=this.instance.wtTable.getFirstVisibleRow();var lastCol=this.instance.wtTable.getLastVisibleColumn();var cell=this.instance.wtTable.getCell(new WalkontableCellCoords(firstRow,lastCol));var cellOffset=Handsontable.Dom.offset(cell);var cellWidth=Handsontable.Dom.outerWidth(cell);var cellEnd=cellOffset.left+cellWidth;var viewportOffsetLeft=this.instance.wtScrollbars.vertical.getScrollPosition();var viewportWitdh=this.instance.wtViewport.getViewportWidth();var viewportEnd=viewportOffsetLeft+viewportWitdh;return viewportEnd>=cellEnd};function Walkontable(settings){var originalHeaders=[];this.guid="wt_"+walkontableRandomString();if(settings.cloneSource){this.cloneSource=settings.cloneSource;this.cloneOverlay=settings.cloneOverlay;this.wtSettings=settings.cloneSource.wtSettings;this.wtTable=new WalkontableTable(this,settings.table);this.wtScroll=new WalkontableScroll(this);this.wtViewport=settings.cloneSource.wtViewport;this.wtEvent=new WalkontableEvent(this);this.selections=this.cloneSource.selections}else{this.wtSettings=new WalkontableSettings(this,settings);this.wtTable=new WalkontableTable(this,settings.table);this.wtScroll=new WalkontableScroll(this);this.wtViewport=new WalkontableViewport(this);this.wtEvent=new WalkontableEvent(this);this.selections=this.getSetting("selections");this.wtScrollbars=new WalkontableScrollbars(this)}if(this.wtTable.THEAD.childNodes.length&&this.wtTable.THEAD.childNodes[0].childNodes.length){for(var c=0,clen=this.wtTable.THEAD.childNodes[0].childNodes.length;c<clen;c++){originalHeaders.push(this.wtTable.THEAD.childNodes[0].childNodes[c].innerHTML)}if(!this.getSetting("columnHeaders").length){this.update("columnHeaders",[function(column,TH){Handsontable.Dom.fastInnerText(TH,originalHeaders[column])}])}}this.drawn=false;this.drawInterrupted=false}Walkontable.prototype.draw=function(fastDraw){this.drawInterrupted=false;if(!fastDraw&&!Handsontable.Dom.isVisible(this.wtTable.TABLE)){this.drawInterrupted=true;return}this.wtTable.draw(fastDraw);return this};Walkontable.prototype.getCell=function(coords,topmost){if(!topmost){return this.wtTable.getCell(coords)}else{var fixedRows=this.wtSettings.getSetting("fixedRowsTop"),fixedColumns=this.wtSettings.getSetting("fixedColumnsLeft");if(coords.row<fixedRows&&coords.col<fixedColumns){return this.wtScrollbars.corner.clone.wtTable.getCell(coords)}else{if(coords.row<fixedRows){return this.wtScrollbars.vertical.clone.wtTable.getCell(coords)}else{if(coords.col<fixedColumns){return this.wtScrollbars.horizontal.clone.wtTable.getCell(coords)}else{return this.wtTable.getCell(coords)}}}}};Walkontable.prototype.update=function(settings,value){return this.wtSettings.update(settings,value)};Walkontable.prototype.scrollVertical=function(row){this.wtScrollbars.vertical.scrollTo(row);this.getSetting("onScrollVertically");return this};Walkontable.prototype.scrollHorizontal=function(column){this.wtScrollbars.horizontal.scrollTo(column);this.getSetting("onScrollHorizontally");return this};Walkontable.prototype.scrollViewport=function(coords){this.wtScroll.scrollViewport(coords);return this};Walkontable.prototype.getViewport=function(){return[this.wtTable.getFirstVisibleRow(),this.wtTable.getFirstVisibleColumn(),this.wtTable.getLastVisibleRow(),this.wtTable.getLastVisibleColumn()]};Walkontable.prototype.getSetting=function(key,param1,param2,param3,param4){return this.wtSettings.getSetting(key,param1,param2,param3,param4)};Walkontable.prototype.hasSetting=function(key){return this.wtSettings.has(key)};Walkontable.prototype.destroy=function(){this.wtScrollbars.destroy();this.wtEvent&&this.wtEvent.destroy()};function WalkontableDebugOverlay(instance){this.instance=instance;this.init();this.clone=this.makeClone("debug");this.clone.wtTable.holder.style.opacity=0.4;this.clone.wtTable.holder.style.textShadow="0 0 2px #ff0000";this.lastTimeout=null;Handsontable.Dom.addClass(this.clone.wtTable.holder.parentNode,"wtDebugVisible")}WalkontableDebugOverlay.prototype=new WalkontableOverlay();WalkontableDebugOverlay.prototype.destroy=function(){WalkontableOverlay.prototype.destroy.call(this);clearTimeout(this.lastTimeout)};function WalkontableEvent(instance){var that=this;var eventManager=Handsontable.eventManager(instance);this.instance=instance;var dblClickOrigin=[null,null];this.dblClickTimeout=[null,null];var onMouseDown=function(event){var cell=that.parentCell(event.target);if(Handsontable.Dom.hasClass(event.target,"corner")){that.instance.getSetting("onCellCornerMouseDown",event,event.target)}else{if(cell.TD){if(that.instance.hasSetting("onCellMouseDown")){that.instance.getSetting("onCellMouseDown",event,cell.coords,cell.TD,that.instance)}}}if(event.button!==2){if(cell.TD){dblClickOrigin[0]=cell.TD;clearTimeout(that.dblClickTimeout[0]);that.dblClickTimeout[0]=setTimeout(function(){dblClickOrigin[0]=null},1000)}}};var onTouchMove=function(event){that.instance.touchMoving=true};var longTouchTimeout;var onTouchStart=function(event){var container=this;eventManager.addEventListener(this,"touchmove",onTouchMove);that.checkIfTouchMove=setTimeout(function(){if(that.instance.touchMoving==true){that.instance.touchMoving=void 0;eventManager.removeEventListener("touchmove",onTouchMove,false);return}else{onMouseDown(event)}},30)};var lastMouseOver;var onMouseOver=function(event){if(that.instance.hasSetting("onCellMouseOver")){var TABLE=that.instance.wtTable.TABLE;var TD=Handsontable.Dom.closest(event.target,["TD","TH"],TABLE);if(TD&&TD!==lastMouseOver&&Handsontable.Dom.isChildOf(TD,TABLE)){lastMouseOver=TD;that.instance.getSetting("onCellMouseOver",event,that.instance.wtTable.getCoords(TD),TD,that.instance)}}};var onMouseUp=function(event){if(event.button!==2){var cell=that.parentCell(event.target);if(cell.TD===dblClickOrigin[0]&&cell.TD===dblClickOrigin[1]){if(Handsontable.Dom.hasClass(event.target,"corner")){that.instance.getSetting("onCellCornerDblClick",event,cell.coords,cell.TD,that.instance)}else{that.instance.getSetting("onCellDblClick",event,cell.coords,cell.TD,that.instance)}dblClickOrigin[0]=null;dblClickOrigin[1]=null}else{if(cell.TD===dblClickOrigin[0]){dblClickOrigin[1]=cell.TD;clearTimeout(that.dblClickTimeout[1]);that.dblClickTimeout[1]=setTimeout(function(){dblClickOrigin[1]=null},500)}}}};var onTouchEnd=function(event){clearTimeout(longTouchTimeout);event.preventDefault();onMouseUp(event)};eventManager.addEventListener(this.instance.wtTable.holder,"mousedown",onMouseDown);eventManager.addEventListener(this.instance.wtTable.TABLE,"mouseover",onMouseOver);eventManager.addEventListener(this.instance.wtTable.holder,"mouseup",onMouseUp);if(this.instance.wtTable.holder.parentNode.parentNode&&Handsontable.mobileBrowser){var classSelector="."+this.instance.wtTable.holder.parentNode.className.split(" ").join(".");eventManager.addEventListener(this.instance.wtTable.holder.parentNode.parentNode,"touchstart",function(event){that.instance.touchApplied=true;if(Handsontable.Dom.isChildOf(event.target,classSelector)){onTouchStart.call(event.target,event)}});eventManager.addEventListener(this.instance.wtTable.holder.parentNode.parentNode,"touchend",function(event){that.instance.touchApplied=false;if(Handsontable.Dom.isChildOf(event.target,classSelector)){onTouchEnd.call(event.target,event)}});if(!that.instance.momentumScrolling){that.instance.momentumScrolling={}}eventManager.addEventListener(this.instance.wtTable.holder.parentNode.parentNode,"scroll",function(event){clearTimeout(that.instance.momentumScrolling._timeout);if(!that.instance.momentumScrolling.ongoing){that.instance.getSetting("onBeforeTouchScroll")}that.instance.momentumScrolling.ongoing=true;that.instance.momentumScrolling._timeout=setTimeout(function(){if(!that.instance.touchApplied){that.instance.momentumScrolling.ongoing=false;that.instance.getSetting("onAfterMomentumScroll")}},200)})}eventManager.addEventListener(window,"resize",function(){that.instance.draw()});this.destroy=function(){clearTimeout(this.dblClickTimeout[0]);clearTimeout(this.dblClickTimeout[1]);eventManager.clear()}}WalkontableEvent.prototype.parentCell=function(elem){var cell={};var TABLE=this.instance.wtTable.TABLE;var TD=Handsontable.Dom.closest(elem,["TD","TH"],TABLE);if(TD&&Handsontable.Dom.isChildOf(TD,TABLE)){cell.coords=this.instance.wtTable.getCoords(TD);cell.TD=TD}else{if(Handsontable.Dom.hasClass(elem,"wtBorder")&&Handsontable.Dom.hasClass(elem,"current")){cell.coords=this.instance.selections.current.cellRange.highlight;cell.TD=this.instance.wtTable.getCell(cell.coords)}else{if(Handsontable.Dom.hasClass(elem,"wtBorder")&&Handsontable.Dom.hasClass(elem,"area")){if(this.instance.selections.area.cellRange){cell.coords=this.instance.selections.area.cellRange.to;cell.TD=this.instance.wtTable.getCell(cell.coords)}}}}return cell};function walkontableRangesIntersect(){var from=arguments[0];var to=arguments[1];for(var i=1,ilen=arguments.length/2;i<ilen;i++){if(from<=arguments[2*i+1]&&to>=arguments[2*i]){return true}}return false}function walkontableRandomString(){function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return s4()+s4()+s4()+s4()}window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){return window.setTimeout(callback,1000/60)}})();window.cancelRequestAnimFrame=(function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout})();if(!window.getComputedStyle){(function(){var elem;var styleObj={getPropertyValue:function getPropertyValue(prop){if(prop=="float"){prop="styleFloat"}return elem.currentStyle[prop.toUpperCase()]||null}};window.getComputedStyle=function(el){elem=el;return styleObj}})()}if(!String.prototype.trim){var trimRegex=/^\s+|\s+$/g;String.prototype.trim=function(){return this.replace(trimRegex,"")}}function WalkontableRowFilter(offset,total,countTH){this.offset=offset;this.total=total;this.countTH=countTH}WalkontableRowFilter.prototype.offsetted=function(n){return n+this.offset};WalkontableRowFilter.prototype.unOffsetted=function(n){return n-this.offset};WalkontableRowFilter.prototype.renderedToSource=function(n){return this.offsetted(n)};WalkontableRowFilter.prototype.sourceToRendered=function(n){return this.unOffsetted(n)};WalkontableRowFilter.prototype.offsettedTH=function(n){return n-this.countTH};WalkontableRowFilter.prototype.visibleColHeadedRowToSourceRow=function(n){return this.renderedToSource(this.offsettedTH(n))};WalkontableRowFilter.prototype.sourceRowToVisibleColHeadedRow=function(n){return this.unOffsettedTH(this.sourceToRendered(n))};function WalkontableScroll(instance){this.instance=instance}WalkontableScroll.prototype.scrollViewport=function(coords){if(!this.instance.drawn){return}var totalRows=this.instance.getSetting("totalRows"),totalColumns=this.instance.getSetting("totalColumns");if(coords.row<0||coords.row>totalRows-1){throw new Error("row "+coords.row+" does not exist")}if(coords.col<0||coords.col>totalColumns-1){throw new Error("column "+coords.col+" does not exist")}var TD=this.instance.wtTable.getCell(coords);if(typeof TD==="object"){if(coords.col>=this.instance.getSetting("fixedColumnsLeft")){this.scrollToRenderedCell(TD)}}else{if(coords.row>=this.instance.wtTable.getLastVisibleRow()){this.instance.wtScrollbars.vertical.scrollTo(coords.row,true)}else{if(coords.row>=this.instance.getSetting("fixedRowsTop")){this.instance.wtScrollbars.vertical.scrollTo(coords.row)}}}};WalkontableScroll.prototype.scrollToRenderedCell=function(TD){var cellOffset=Handsontable.Dom.offset(TD);var cellWidth=Handsontable.Dom.outerWidth(TD);var cellHeight=Handsontable.Dom.outerHeight(TD);var workspaceOffset=Handsontable.Dom.offset(this.instance.wtTable.TABLE);var viewportScrollPosition={left:this.instance.wtScrollbars.horizontal.getScrollPosition(),top:this.instance.wtScrollbars.vertical.getScrollPosition()};var workspaceWidth=this.instance.wtViewport.getWorkspaceWidth();var workspaceHeight=this.instance.wtViewport.getWorkspaceHeight();var leftCloneWidth=Handsontable.Dom.outerWidth(this.instance.wtScrollbars.horizontal.clone.wtTable.TABLE);var topCloneHeight=Handsontable.Dom.outerHeight(this.instance.wtScrollbars.vertical.clone.wtTable.TABLE);if(this.instance.wtScrollbars.horizontal.scrollHandler!==window){workspaceOffset.left=0;cellOffset.left-=Handsontable.Dom.offset(this.instance.wtScrollbars.horizontal.scrollHandler).left}if(this.instance.wtScrollbars.vertical.scrollHandler!==window){workspaceOffset.top=0;cellOffset.top=cellOffset.top-Handsontable.Dom.offset(this.instance.wtScrollbars.vertical.scrollHandler).top}if(cellWidth<workspaceWidth){if(cellOffset.left<viewportScrollPosition.left+leftCloneWidth){this.instance.wtScrollbars.horizontal.setScrollPosition(cellOffset.left-leftCloneWidth)}else{if(cellOffset.left+cellWidth>workspaceOffset.left+viewportScrollPosition.left+workspaceWidth){var delta=(cellOffset.left+cellWidth)-(workspaceOffset.left+viewportScrollPosition.left+workspaceWidth);this.instance.wtScrollbars.horizontal.setScrollPosition(viewportScrollPosition.left+delta)}}}if(cellHeight<workspaceHeight){if(cellOffset.top<viewportScrollPosition.top+topCloneHeight){this.instance.wtScrollbars.vertical.setScrollPosition(cellOffset.top-topCloneHeight);this.instance.wtScrollbars.vertical.onScroll()}else{if(cellOffset.top+cellHeight>viewportScrollPosition.top+workspaceHeight){this.instance.wtScrollbars.vertical.setScrollPosition(cellOffset.top-workspaceHeight+cellHeight);this.instance.wtScrollbars.vertical.onScroll()}}}};function WalkontableCornerScrollbarNative(instance){this.instance=instance;this.type="corner";this.init();this.clone=this.makeClone("corner")}WalkontableCornerScrollbarNative.prototype=new WalkontableOverlay();WalkontableCornerScrollbarNative.prototype.resetFixedPosition=function(){if(!this.instance.wtTable.holder.parentNode){return}var elem=this.clone.wtTable.holder.parentNode;if(this.scrollHandler===window){var box=this.instance.wtTable.holder.getBoundingClientRect();var top=Math.ceil(box.top);var left=Math.ceil(box.left);var finalLeft,finalTop;var bottom=Math.ceil(box.bottom);if(left<0&&(left+Handsontable.Dom.outerWidth(this.instance.wtTable.TABLE))>0){finalLeft=-left+"px"}else{finalLeft="0"}if(top<0&&(bottom-elem.offsetHeight)>0){finalTop=-top+"px"}else{finalTop="0"}}else{if(!Handsontable.freezeOverlays){finalLeft=this.instance.wtScrollbars.horizontal.getScrollPosition()+"px";finalTop=this.instance.wtScrollbars.vertical.getScrollPosition()+"px"}}Handsontable.Dom.setOverlayPosition(elem,finalLeft,finalTop);elem.style.width=Handsontable.Dom.outerWidth(this.clone.wtTable.TABLE)+4+"px";elem.style.height=Handsontable.Dom.outerHeight(this.clone.wtTable.TABLE)+4+"px"};function WalkontableHorizontalScrollbarNative(instance){this.instance=instance;this.type="horizontal";this.cellSize=50;this.offset=0;this.init();this.clone=this.makeClone("left")}WalkontableHorizontalScrollbarNative.prototype=new WalkontableOverlay();WalkontableHorizontalScrollbarNative.prototype.resetFixedPosition=function(){if(!this.instance.wtTable.holder.parentNode){return}var elem=this.clone.wtTable.holder.parentNode;if(this.scrollHandler===window){var box=this.instance.wtTable.holder.getBoundingClientRect();var left=Math.ceil(box.left);var finalLeft,finalTop;if(left<0&&(left+Handsontable.Dom.outerWidth(this.instance.wtTable.TABLE))>0){finalLeft=-left+"px"}else{finalLeft="0"}finalTop=this.instance.wtTable.hider.style.top}else{if(!Handsontable.freezeOverlays){finalLeft=this.getScrollPosition()+"px";finalTop=this.instance.wtTable.hider.style.top}}Handsontable.Dom.setOverlayPosition(elem,finalLeft,finalTop);elem.style.height=Handsontable.Dom.outerHeight(this.clone.wtTable.TABLE)+"px";elem.style.width=Handsontable.Dom.outerWidth(this.clone.wtTable.TABLE)+4+"px"};WalkontableHorizontalScrollbarNative.prototype.refresh=function(selectionsOnly){WalkontableOverlay.prototype.refresh.call(this,selectionsOnly)};WalkontableHorizontalScrollbarNative.prototype.getScrollPosition=function(){return Handsontable.Dom.getScrollLeft(this.scrollHandler)};WalkontableHorizontalScrollbarNative.prototype.setScrollPosition=function(pos){if(this.scrollHandler===window){window.scrollTo(pos,Handsontable.Dom.getWindowScrollTop())}else{this.scrollHandler.scrollLeft=pos}};WalkontableHorizontalScrollbarNative.prototype.onScroll=function(){this.readSettings();this.instance.getSetting("onScrollHorizontally")};WalkontableHorizontalScrollbarNative.prototype.getLastCell=function(){return this.instance.wtTable.getLastVisibleColumn()};WalkontableHorizontalScrollbarNative.prototype.applyToDOM=function(){};WalkontableHorizontalScrollbarNative.prototype.scrollTo=function(sourceCol){this.setScrollPosition(this.getTableParentOffset()+sourceCol*this.cellSize)};WalkontableHorizontalScrollbarNative.prototype.getTableParentOffset=function(){if(this.scrollHandler===window){return this.instance.wtTable.holderOffset.left}else{return 0}};WalkontableHorizontalScrollbarNative.prototype.readSettings=function(){this.total=this.instance.getSetting("totalColumns")};function WalkontableVerticalScrollbarNative(instance){this.instance=instance;this.type="vertical";this.init();this.clone=this.makeClone("top")}WalkontableVerticalScrollbarNative.prototype=new WalkontableOverlay();WalkontableVerticalScrollbarNative.prototype.resetFixedPosition=function(){if(!this.instance.wtTable.holder.parentNode){return}var elem=this.clone.wtTable.holder.parentNode;if(this.scrollHandler===window){var box=this.instance.wtTable.holder.getBoundingClientRect();var top=Math.ceil(box.top);var finalLeft,finalTop;var bottom=Math.ceil(box.bottom);finalLeft="0";if(top<0&&(bottom-elem.offsetHeight)>0){finalTop=-top+"px"}else{finalTop="0"}}else{if(!Handsontable.freezeOverlays){finalTop=this.getScrollPosition()+"px";finalLeft="0"}}Handsontable.Dom.setOverlayPosition(elem,finalLeft,finalTop);if(this.instance.wtScrollbars.horizontal.scrollHandler===window){elem.style.width=this.instance.wtViewport.getWorkspaceActualWidth()+"px"}else{elem.style.width=Handsontable.Dom.outerWidth(this.clone.wtTable.TABLE)+"px"}elem.style.height=Handsontable.Dom.outerHeight(this.clone.wtTable.TABLE)+4+"px"};WalkontableVerticalScrollbarNative.prototype.getScrollPosition=function(){return Handsontable.Dom.getScrollTop(this.scrollHandler)};WalkontableVerticalScrollbarNative.prototype.setScrollPosition=function(pos){if(this.scrollHandler===window){window.scrollTo(Handsontable.Dom.getWindowScrollLeft(),pos)}else{this.scrollHandler.scrollTop=pos}};WalkontableVerticalScrollbarNative.prototype.onScroll=function(){this.readSettings();this.instance.draw(true);this.instance.getSetting("onScrollVertically")};WalkontableVerticalScrollbarNative.prototype.getLastCell=function(){return this.instance.wtViewport.rowsPreCalculator.renderEndRow};WalkontableVerticalScrollbarNative.prototype.sumCellSizes=function(from,length){var sum=0;while(from<length){sum+=this.instance.wtTable.getRowHeight(from)||this.instance.wtSettings.settings.defaultRowHeight;from++}return sum};WalkontableVerticalScrollbarNative.prototype.refresh=function(selectionsOnly){this.applyToDOM();WalkontableOverlay.prototype.refresh.call(this,selectionsOnly)};WalkontableVerticalScrollbarNative.prototype.applyToDOM=function(){var total=this.instance.getSetting("totalRows");var headerSize=this.instance.wtViewport.getColumnHeaderHeight();this.fixedContainer.style.height=headerSize+this.sumCellSizes(0,total)+4+"px";if(typeof this.instance.wtViewport.rowsCalculator.renderStartPosition==="number"){this.fixed.style.top=this.instance.wtViewport.rowsCalculator.renderStartPosition+"px"}else{if(total===0){this.fixed.style.top="0"}else{throw new Error("Incorrect value of the rowCalculator")}}this.fixed.style.bottom=""};WalkontableVerticalScrollbarNative.prototype.scrollTo=function(sourceRow,bottomEdge){var newY=this.getTableParentOffset();if(bottomEdge){newY+=this.sumCellSizes(0,sourceRow+1);newY-=this.instance.wtViewport.getViewportHeight()}else{newY+=this.sumCellSizes(0,sourceRow)}this.setScrollPosition(newY)};WalkontableVerticalScrollbarNative.prototype.getTableParentOffset=function(){if(this.scrollHandler===window){return this.instance.wtTable.holderOffset.top}else{return 0}};WalkontableVerticalScrollbarNative.prototype.readSettings=function(){};function WalkontableScrollbars(instance){this.instance=instance;instance.update("scrollbarWidth",Handsontable.Dom.getScrollbarWidth());instance.update("scrollbarHeight",Handsontable.Dom.getScrollbarWidth());this.vertical=new WalkontableVerticalScrollbarNative(instance);this.horizontal=new WalkontableHorizontalScrollbarNative(instance);this.corner=new WalkontableCornerScrollbarNative(instance);if(instance.getSetting("debug")){this.debug=new WalkontableDebugOverlay(instance)}this.registerListeners()}WalkontableScrollbars.prototype.registerListeners=function(){var that=this;this.refreshAll=function refreshAll(){if(!that.instance.drawn){return}if(!that.instance.wtTable.holder.parentNode){that.destroy();return}that.vertical.onScroll();that.horizontal.onScroll()};var eventManager=Handsontable.eventManager(that.instance);eventManager.addEventListener(this.vertical.scrollHandler,"scroll",this.refreshAll);if(this.vertical.scrollHandler!==this.horizontal.scrollHandler){eventManager.addEventListener(this.horizontal.scrollHandler,"scroll",this.refreshAll)}if(this.vertical.scrollHandler!==window&&this.horizontal.scrollHandler!==window){eventManager.addEventListener(window,"scroll",this.refreshAll)}};WalkontableScrollbars.prototype.destroy=function(){var eventManager=Handsontable.eventManager(this.instance);if(this.vertical){this.vertical.destroy();eventManager.removeEventListener(this.vertical.scrollHandler,"scroll",this.refreshAll)}if(this.horizontal){this.horizontal.destroy();eventManager.removeEventListener(this.horizontal.scrollHandler,"scroll",this.refreshAll)}eventManager.removeEventListener(window,"scroll",this.refreshAll);this.corner&&this.corner.destroy();this.debug&&this.debug.destroy()};WalkontableScrollbars.prototype.refresh=function(selectionsOnly){this.horizontal&&this.horizontal.readSettings();this.vertical&&this.vertical.readSettings();this.horizontal&&this.horizontal.refresh(selectionsOnly);this.vertical&&this.vertical.refresh(selectionsOnly);this.corner&&this.corner.refresh(selectionsOnly);this.debug&&this.debug.refresh(selectionsOnly)};WalkontableScrollbars.prototype.applyToDOM=function(){this.horizontal&&this.horizontal.applyToDOM();this.vertical&&this.vertical.applyToDOM()};function WalkontableSelection(settings,cellRange){this.settings=settings;this.cellRange=cellRange||null;this.instanceBorders={}}WalkontableSelection.prototype.getBorder=function(instance){if(this.instanceBorders[instance.guid]){return this.instanceBorders[instance.guid]}this.instanceBorders[instance.guid]=new WalkontableBorder(instance,this.settings)};WalkontableSelection.prototype.isEmpty=function(){return(this.cellRange===null)};WalkontableSelection.prototype.add=function(coords){if(this.isEmpty()){this.cellRange=new WalkontableCellRange(coords,coords,coords)}else{this.cellRange.expand(coords)}};WalkontableSelection.prototype.replace=function(oldCoords,newCoords){if(!this.isEmpty()){if(this.cellRange.from.isEqual(oldCoords)){this.cellRange.from=newCoords;return true}if(this.cellRange.to.isEqual(oldCoords)){this.cellRange.to=newCoords;return true}}return false};WalkontableSelection.prototype.clear=function(){this.cellRange=null};WalkontableSelection.prototype.getCorners=function(){var topLeft=this.cellRange.getTopLeftCorner();var bottomRight=this.cellRange.getBottomRightCorner();return[topLeft.row,topLeft.col,bottomRight.row,bottomRight.col]};WalkontableSelection.prototype.addClassAtCoords=function(instance,source_r,source_c,cls){var TD=instance.wtTable.getCell(new WalkontableCellCoords(source_r,source_c));if(typeof TD==="object"){Handsontable.Dom.addClass(TD,cls)}};WalkontableSelection.prototype.draw=function(instance){var corners,r,c,source_r,source_c,visibleRows=instance.wtTable.getRenderedRowsCount(),renderedColumns=instance.wtTable.getRenderedColumnsCount();if(!this.isEmpty()){corners=this.getCorners();for(r=0;r<visibleRows;r++){source_r=instance.wtTable.rowFilter.renderedToSource(r);for(c=0;c<renderedColumns;c++){source_c=instance.wtTable.columnFilter.renderedToSource(c);if(source_r>=corners[0]&&source_r<=corners[2]&&source_c>=corners[1]&&source_c<=corners[3]){if(this.settings.className){this.addClassAtCoords(instance,source_r,source_c,this.settings.className)}if(source_c===corners[1]){var TH=instance.wtTable.getRowHeader(source_r);if(TH&&this.settings.highlightRowClassName){Handsontable.Dom.addClass(TH,this.settings.highlightRowClassName)}}if(source_r===corners[0]||(source_r>corners[0]&&r==0)){var TH=instance.wtTable.getColumnHeader(source_c);if(TH&&this.settings.highlightColumnClassName){Handsontable.Dom.addClass(TH,this.settings.highlightColumnClassName)}}}else{if(source_r>=corners[0]&&source_r<=corners[2]){if(this.settings.highlightRowClassName){this.addClassAtCoords(instance,source_r,source_c,this.settings.highlightRowClassName)}}else{if(source_c>=corners[1]&&source_c<=corners[3]){if(this.settings.highlightColumnClassName){this.addClassAtCoords(instance,source_r,source_c,this.settings.highlightColumnClassName)}}}}}}instance.getSetting("onBeforeDrawBorders",corners,this.settings.className);if(this.settings.border){var border=this.getBorder(instance);if(border){border.appear(corners)}}}else{if(this.settings.border){var border=this.getBorder(instance);if(border){border.disappear()}}}};function WalkontableSettings(instance,settings){var that=this;this.instance=instance;this.defaults={table:void 0,debug:false,stretchH:"none",currentRowClassName:null,currentColumnClassName:null,data:void 0,fixedColumnsLeft:0,fixedRowsTop:0,rowHeaders:function(){return[]},columnHeaders:function(){return[]},totalRows:void 0,totalColumns:void 0,cellRenderer:function(row,column,TD){var cellData=that.getSetting("data",row,column);Handsontable.Dom.fastInnerText(TD,cellData===void 0||cellData===null?"":cellData)},columnWidth:50,rowHeight:function(row){return},defaultRowHeight:23,selections:null,hideBorderOnMouseDownOver:false,viewportRowCalculatorOverride:null,onCellMouseDown:null,onCellMouseOver:null,onCellDblClick:null,onCellCornerMouseDown:null,onCellCornerDblClick:null,beforeDraw:null,onDraw:null,onBeforeDrawBorders:null,onScrollVertically:null,onScrollHorizontally:null,onBeforeTouchScroll:null,onAfterMomentumScroll:null,scrollbarWidth:10,scrollbarHeight:10,renderAllRows:false,groups:false};this.settings={};for(var i in this.defaults){if(this.defaults.hasOwnProperty(i)){if(settings[i]!==void 0){this.settings[i]=settings[i]}else{if(this.defaults[i]===void 0){throw new Error('A required setting "'+i+'" was not provided')}else{this.settings[i]=this.defaults[i]}}}}}WalkontableSettings.prototype.update=function(settings,value){if(value===void 0){for(var i in settings){if(settings.hasOwnProperty(i)){this.settings[i]=settings[i]}}}else{this.settings[settings]=value}return this.instance};WalkontableSettings.prototype.getSetting=function(key,param1,param2,param3,param4){if(typeof this.settings[key]==="function"){return this.settings[key](param1,param2,param3,param4)}else{if(param1!==void 0&&Object.prototype.toString.call(this.settings[key])==="[object Array]"){return this.settings[key][param1]}else{return this.settings[key]}}};WalkontableSettings.prototype.has=function(key){return !!this.settings[key]};function WalkontableTable(instance,table){this.instance=instance;this.TABLE=table;Handsontable.Dom.removeTextNodes(this.TABLE);var parent=this.TABLE.parentNode;if(!parent||parent.nodeType!==1||!Handsontable.Dom.hasClass(parent,"wtHolder")){var spreader=document.createElement("DIV");spreader.className="wtSpreader";if(parent){parent.insertBefore(spreader,this.TABLE)}spreader.appendChild(this.TABLE)}this.spreader=this.TABLE.parentNode;parent=this.spreader.parentNode;if(!parent||parent.nodeType!==1||!Handsontable.Dom.hasClass(parent,"wtHolder")){var hider=document.createElement("DIV");hider.className="wtHider";if(parent){parent.insertBefore(hider,this.spreader)}hider.appendChild(this.spreader)}this.hider=this.spreader.parentNode;this.hiderStyle=this.hider.style;this.hiderStyle.position="relative";parent=this.hider.parentNode;if(!parent||parent.nodeType!==1||!Handsontable.Dom.hasClass(parent,"wtHolder")){var holder=document.createElement("DIV");holder.style.position="relative";holder.className="wtHolder";if(!instance.cloneSource){holder.className+=" ht_master"}if(parent){parent.insertBefore(holder,this.hider)}holder.appendChild(this.hider)}this.holder=this.hider.parentNode;if(!this.isWorkingOnClone()){this.holder.parentNode.style.position="relative"}this.TBODY=this.TABLE.getElementsByTagName("TBODY")[0];if(!this.TBODY){this.TBODY=document.createElement("TBODY");this.TABLE.appendChild(this.TBODY)}this.THEAD=this.TABLE.getElementsByTagName("THEAD")[0];if(!this.THEAD){this.THEAD=document.createElement("THEAD");this.TABLE.insertBefore(this.THEAD,this.TBODY)}this.COLGROUP=this.TABLE.getElementsByTagName("COLGROUP")[0];if(!this.COLGROUP){this.COLGROUP=document.createElement("COLGROUP");this.TABLE.insertBefore(this.COLGROUP,this.THEAD)}if(this.instance.getSetting("columnHeaders").length){if(!this.THEAD.childNodes.length){var TR=document.createElement("TR");this.THEAD.appendChild(TR)}}this.colgroupChildrenLength=this.COLGROUP.childNodes.length;this.theadChildrenLength=this.THEAD.firstChild?this.THEAD.firstChild.childNodes.length:0;this.tbodyChildrenLength=this.TBODY.childNodes.length;this.rowFilter=null;this.columnFilter=null;this.columnWidthCache=[]}WalkontableTable.prototype.getColumnStrategy=function(){return this.isWorkingOnClone()?this.instance.cloneSource.wtTable.columnStrategy:this.columnStrategy};WalkontableTable.prototype.isWorkingOnClone=function(){return !!this.instance.cloneSource};WalkontableTable.prototype.refreshHiderDimensions=function(){var spreaderStyle=this.spreader.style;spreaderStyle.position="relative";spreaderStyle.width="auto";spreaderStyle.height="auto"};WalkontableTable.prototype.draw=function(fastDraw){if(!this.isWorkingOnClone()){this.holderOffset=Handsontable.Dom.offset(this.holder);this.instance.wtViewport.createPreCalculators()}if(fastDraw){if(!this.instance.wtViewport.areAllProposedVisibleRowsAlreadyRendered()){fastDraw=false}}if(!this.isWorkingOnClone()){var oldRowsCalculator=this.instance.wtViewport.rowsCalculator;this.instance.wtViewport.rowsCalculator=null}if(!fastDraw){if(this.isWorkingOnClone()){this.tableOffset=this.instance.cloneSource.wtTable.tableOffset}else{this.tableOffset=Handsontable.Dom.offset(this.TABLE);this.instance.wtScrollbars.vertical.readSettings();this.instance.wtScrollbars.horizontal.readSettings()}var renderStartRow;if(this.instance.cloneOverlay instanceof WalkontableDebugOverlay||this.instance.cloneOverlay instanceof WalkontableVerticalScrollbarNative||this.instance.cloneOverlay instanceof WalkontableCornerScrollbarNative){renderStartRow=0}else{renderStartRow=this.instance.wtViewport.rowsPreCalculator.renderStartRow}this.rowFilter=new WalkontableRowFilter(renderStartRow,this.instance.getSetting("totalRows"),this.instance.getSetting("columnHeaders").length);this.columnFilter=new WalkontableColumnFilter(this.instance.getSetting("totalColumns"),this.instance.getSetting("rowHeaders").length);this._doDraw()}else{if(!this.isWorkingOnClone()){this.instance.wtViewport.createCalculators(oldRowsCalculator)}this.instance.wtScrollbars&&this.instance.wtScrollbars.refresh(true)}this.refreshPositions(fastDraw);if(!this.isWorkingOnClone()){this.instance.wtScrollbars.vertical.resetFixedPosition();this.instance.wtScrollbars.horizontal.resetFixedPosition();this.instance.wtScrollbars.corner.resetFixedPosition()}this.instance.drawn=true;return this};WalkontableTable.prototype._doDraw=function(){var wtRenderer=new WalkontableTableRenderer(this);wtRenderer.render()};WalkontableTable.prototype.refreshPositions=function(fastDraw){this.refreshHiderDimensions();this.refreshSelections(fastDraw)};WalkontableTable.prototype.removeClassFromCells=function(className){var nodes=this.TABLE.querySelectorAll("."+className);for(var i=0,ilen=nodes.length;i<ilen;i++){Handsontable.Dom.removeClass(nodes[i],className)}};WalkontableTable.prototype.refreshSelections=function(fastDraw){var i,ilen;if(this.instance.selections){if(fastDraw){for(i=0,ilen=this.instance.selections.length;i<ilen;i++){if(this.instance.selections[i].settings.className){this.removeClassFromCells(this.instance.selections[i].settings.className)}if(this.instance.selections[i].settings.highlightRowClassName){this.removeClassFromCells(this.instance.selections[i].settings.highlightRowClassName)}if(this.instance.selections[i].settings.highlightColumnClassName){this.removeClassFromCells(this.instance.selections[i].settings.highlightColumnClassName)}}}for(i=0,ilen=this.instance.selections.length;i<ilen;i++){this.instance.selections[i].draw(this.instance,fastDraw)}}};WalkontableTable.prototype.getCell=function(coords){if(this.isRowBeforeRenderedRows(coords.row)){return -1}else{if(this.isRowAfterRenderedRows(coords.row)){return -2}}var TR=this.TBODY.childNodes[this.rowFilter.sourceToRendered(coords.row)];if(TR){return TR.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(coords.col)]}};WalkontableTable.prototype.getColumnHeader=function(col){var THEAD=this.THEAD.childNodes[0];if(THEAD){return THEAD.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(col)]}};WalkontableTable.prototype.getRowHeader=function(row){if(this.columnFilter.sourceColumnToVisibleRowHeadedColumn(0)==0){return null}var TR=this.TBODY.childNodes[this.rowFilter.sourceToRendered(row)];if(TR){return TR.childNodes[0]}};WalkontableTable.prototype.getCoords=function(TD){var TR=TD.parentNode;var row=Handsontable.Dom.index(TR);if(TR.parentNode===this.THEAD){row=this.rowFilter.visibleColHeadedRowToSourceRow(row)}else{row=this.rowFilter.renderedToSource(row)}return new WalkontableCellCoords(row,this.columnFilter.visibleRowHeadedColumnToSourceColumn(TD.cellIndex))};WalkontableTable.prototype.getTrForRow=function(row){return this.TBODY.childNodes[this.rowFilter.sourceToRendered(row)]};WalkontableTable.prototype.getFirstRenderedRow=function(){return this.instance.wtViewport.rowsPreCalculator.renderStartRow};WalkontableTable.prototype.getFirstVisibleRow=function(){return this.instance.wtViewport.rowsCalculator.visibleStartRow};WalkontableTable.prototype.getFirstRenderedColumn=function(){return 0};WalkontableTable.prototype.getFirstVisibleColumn=function(){if(this.isWorkingOnClone()){if(this.instance.cloneOverlay instanceof WalkontableHorizontalScrollbarNative||this.instance.cloneOverlay instanceof WalkontableCornerScrollbarNative){return 0}else{return this.instance.cloneSource.wtTable.getFirstVisibleColumn()}}var leftOffset=this.instance.wtScrollbars.horizontal.getScrollPosition();var columnCount=this.getColumnStrategy().cellCount;var firstTR=this.TBODY.firstChild;if(!firstTR){return 0}for(var colIndex=0;colIndex<columnCount;colIndex++){leftOffset-=firstTR.childNodes[colIndex].offsetWidth;if(leftOffset<0){return colIndex}}return -1};WalkontableTable.prototype.getLastRenderedRow=function(){return this.instance.wtViewport.rowsPreCalculator.renderEndRow};WalkontableTable.prototype.getLastVisibleRow=function(){return this.instance.wtViewport.rowsCalculator.visibleEndRow};WalkontableTable.prototype.getLastVisibleColumn=function(){var instance=this.instance;if(this.isWorkingOnClone()){if(instance.cloneOverlay instanceof WalkontableHorizontalScrollbarNative||instance.cloneOverlay instanceof WalkontableCornerScrollbarNative){var lastVisibleColumn=this.getColumnStrategy().countVisible()-1;var fixedColumnsLeft=instance.getSetting("fixedColumnsLeft");return Math.min(fixedColumnsLeft-1,lastVisibleColumn)}else{return this.instance.cloneSource.wtTable.getLastVisibleColumn()}}var leftOffset=this.instance.wtScrollbars.horizontal.getScrollPosition();var leftPartOfTable=leftOffset+this.instance.wtViewport.getWorkspaceWidth();var columnCount=this.getColumnStrategy().cellCount;var rowHeaderCount=this.instance.getSetting("rowHeaders").length||0;var firstTR=this.TBODY.firstChild;if(!columnCount){return -1}for(var colIndex=0;colIndex<columnCount+rowHeaderCount;colIndex++){leftPartOfTable-=firstTR.childNodes[colIndex].offsetWidth;if(leftPartOfTable<=0){return colIndex-rowHeaderCount}}return colIndex-rowHeaderCount-1};WalkontableTable.prototype.isRowBeforeRenderedRows=function(r){return(this.rowFilter.sourceToRendered(r)<0&&r>=0)};WalkontableTable.prototype.isRowAfterViewport=function(r){return(r>this.getLastVisibleRow())};WalkontableTable.prototype.isRowAfterRenderedRows=function(r){return(r>this.getLastRenderedRow())};WalkontableTable.prototype.isColumnBeforeViewport=function(c){return(this.columnFilter.sourceToRendered(c)<0&&c>=0)};WalkontableTable.prototype.isColumnAfterViewport=function(c){return(c>this.getLastVisibleColumn())};WalkontableTable.prototype.isLastRowFullyVisible=function(){return(this.getLastVisibleRow()===this.getLastRenderedRow())};WalkontableTable.prototype.isLastColumnFullyVisible=function(){return(this.getLastVisibleColumn()===this.instance.getSetting("totalColumns")-1&&!this.getColumnStrategy().isLastIncomplete())};WalkontableTable.prototype.getRenderedColumnsCount=function(){var isClone=this.isWorkingOnClone();if(isClone&&this.instance.cloneOverlay instanceof WalkontableDebugOverlay){return 1}if(isClone&&(this.instance.cloneOverlay instanceof WalkontableHorizontalScrollbarNative||this.instance.cloneOverlay instanceof WalkontableCornerScrollbarNative)){return this.instance.getSetting("fixedColumnsLeft")}else{return this.getColumnStrategy().cellCount}};WalkontableTable.prototype.getRenderedRowsCount=function(){return this.instance.wtViewport.rowsPreCalculator.countRendered};WalkontableTable.prototype.getVisibleRowsCount=function(){return this.instance.wtViewport.rowsCalculator.countVisible};WalkontableTable.prototype.allRowsInViewport=function(){return this.instance.getSetting("totalRows")==this.getVisibleRowsCount()};WalkontableTable.prototype.getRowHeight=function(sourceRow){var height=this.instance.wtSettings.settings.rowHeight(sourceRow);var oversizedHeight=this.instance.wtViewport.oversizedRows[sourceRow];if(oversizedHeight!==void 0){height=height?Math.max(height,oversizedHeight):oversizedHeight}return height};function WalkontableTableRenderer(wtTable){this.wtTable=wtTable;this.instance=wtTable.instance;this.rowFilter=wtTable.rowFilter;this.columnFilter=wtTable.columnFilter;this.TABLE=wtTable.TABLE;this.THEAD=wtTable.THEAD;this.TBODY=wtTable.TBODY;this.COLGROUP=wtTable.COLGROUP;this.utils=WalkontableTableRenderer.utils}WalkontableTableRenderer.prototype.render=function(){if(!this.wtTable.isWorkingOnClone()){this.instance.getSetting("beforeDraw",true)}this.rowHeaders=this.instance.getSetting("rowHeaders");this.rowHeaderCount=this.rowHeaders.length;this.fixedRowsTop=this.instance.getSetting("fixedRowsTop");this.columnHeaders=this.instance.getSetting("columnHeaders");this.columnHeaderCount=this.columnHeaders.length;var visibleColIndex,totalRows=this.instance.getSetting("totalRows"),totalColumns=this.instance.getSetting("totalColumns"),displayTds,adjusted=false,workspaceWidth,cloneLimit=this.instance.wtViewport.rowsPreCalculator.countRendered;if(totalColumns>0){if(this.wtTable.isWorkingOnClone()){if(this.instance.cloneOverlay instanceof WalkontableVerticalScrollbarNative||this.instance.cloneOverlay instanceof WalkontableCornerScrollbarNative){cloneLimit=this.fixedRowsTop}else{if(this.instance.cloneOverlay instanceof WalkontableDebugOverlay){cloneLimit=totalRows}}}this.adjustAvailableNodes();adjusted=true;this.renderColGroups();this.renderColumnHeaders();displayTds=this.wtTable.getRenderedColumnsCount();this.renderRows(totalRows,cloneLimit,displayTds);if(!this.wtTable.isWorkingOnClone()){workspaceWidth=this.instance.wtViewport.getWorkspaceWidth();this.instance.wtViewport.containerWidth=null;this.wtTable.getColumnStrategy().stretch()}this.adjustColumnWidths(displayTds)}if(!adjusted){this.adjustAvailableNodes()}this.removeRedundantRows(cloneLimit);if(!this.wtTable.isWorkingOnClone()){this.markOversizedRows();this.instance.wtViewport.createCalculators();this.instance.wtScrollbars.applyToDOM();if(workspaceWidth!==this.instance.wtViewport.getWorkspaceWidth()){this.instance.wtViewport.containerWidth=null;this.wtTable.getColumnStrategy().stretch();var cache=this.instance.wtTable.columnWidthCache;for(visibleColIndex=0;visibleColIndex<this.wtTable.getColumnStrategy().cellCount;visibleColIndex++){var width=this.wtTable.getColumnStrategy().getSize(visibleColIndex);this.COLGROUP.childNodes[visibleColIndex+this.rowHeaderCount].style.width=width+"px";cache[visibleColIndex]=width}}this.instance.wtScrollbars.refresh(false);this.instance.getSetting("onDraw",true)}};WalkontableTableRenderer.prototype.removeRedundantRows=function(renderedRowsCount){while(this.wtTable.tbodyChildrenLength>renderedRowsCount){this.TBODY.removeChild(this.TBODY.lastChild);this.wtTable.tbodyChildrenLength--}};WalkontableTableRenderer.prototype.renderRows=function(totalRows,cloneLimit,displayTds){var lastTD,TR;var visibleRowIndex=0;var sourceRowIndex=this.rowFilter.renderedToSource(visibleRowIndex);var isWorkingOnClone=this.wtTable.isWorkingOnClone();while(sourceRowIndex<totalRows&&sourceRowIndex>=0){if(visibleRowIndex>1000){throw new Error("Security brake: Too much TRs. Please define height for your table, which will enforce scrollbars.")}if(cloneLimit!==void 0&&visibleRowIndex===cloneLimit){break}TR=this.getOrCreateTrForRow(visibleRowIndex,TR);this.renderRowHeaders(sourceRowIndex,TR);this.adjustColumns(TR,displayTds+this.rowHeaderCount);lastTD=this.renderCells(sourceRowIndex,TR,displayTds);if(!isWorkingOnClone){this.resetOversizedRow(sourceRowIndex)}if(TR.firstChild){var height=this.instance.wtTable.getRowHeight(sourceRowIndex);if(height){TR.firstChild.style.height=height+"px"}else{TR.firstChild.style.height=""}}visibleRowIndex++;sourceRowIndex=this.rowFilter.renderedToSource(visibleRowIndex)}};WalkontableTableRenderer.prototype.resetOversizedRow=function(sourceRow){if(this.instance.wtViewport.oversizedRows&&this.instance.wtViewport.oversizedRows[sourceRow]){this.instance.wtViewport.oversizedRows[sourceRow]=void 0}};WalkontableTableRenderer.prototype.markOversizedRows=function(){var previousRowHeight,trInnerHeight,sourceRowIndex,currentTr;var rowCount=this.instance.wtTable.TBODY.childNodes.length;while(rowCount){rowCount--;sourceRowIndex=this.instance.wtTable.rowFilter.renderedToSource(rowCount);previousRowHeight=this.instance.wtTable.getRowHeight(sourceRowIndex);currentTr=this.instance.wtTable.getTrForRow(sourceRowIndex);trInnerHeight=Handsontable.Dom.innerHeight(currentTr)-1;if((!previousRowHeight&&this.instance.wtSettings.settings.defaultRowHeight<trInnerHeight||previousRowHeight<trInnerHeight)){this.instance.wtViewport.oversizedRows[sourceRowIndex]=trInnerHeight}}};WalkontableTableRenderer.prototype.renderCells=function(sourceRowIndex,TR,displayTds){var TD,sourceColIndex;for(var visibleColIndex=0;visibleColIndex<displayTds;visibleColIndex++){sourceColIndex=this.columnFilter.renderedToSource(visibleColIndex);if(visibleColIndex===0){TD=TR.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(sourceColIndex)]}else{TD=TD.nextSibling}if(TD.nodeName=="TH"){TD=this.utils.replaceThWithTd(TD,TR)}if(!Handsontable.Dom.hasClass(TD,"hide")){TD.className=""}TD.removeAttribute("style");this.instance.getSetting("cellRenderer",sourceRowIndex,sourceColIndex,TD)}return TD};WalkontableTableRenderer.prototype.adjustColumnWidths=function(displayTds){var cache=this.instance.wtTable.columnWidthCache;var cacheChanged=false;var width;for(var visibleColIndex=0;visibleColIndex<displayTds;visibleColIndex++){if(this.wtTable.isWorkingOnClone()){width=this.instance.cloneSource.wtTable.columnWidthCache[visibleColIndex]}else{width=this.wtTable.getColumnStrategy().getSize(visibleColIndex)}if(width!==cache[visibleColIndex]){this.COLGROUP.childNodes[visibleColIndex+this.rowHeaderCount].style.width=width+"px";cache[visibleColIndex]=width;cacheChanged=true}}};WalkontableTableRenderer.prototype.appendToTbody=function(TR){this.TBODY.appendChild(TR);this.wtTable.tbodyChildrenLength++};WalkontableTableRenderer.prototype.getOrCreateTrForRow=function(rowIndex,currentTr){var TR;if(rowIndex>=this.wtTable.tbodyChildrenLength){TR=this.createRow();this.appendToTbody(TR)}else{if(rowIndex===0){TR=this.TBODY.firstChild}else{TR=currentTr.nextSibling}}return TR};WalkontableTableRenderer.prototype.createRow=function(){var TR=document.createElement("TR");for(var visibleColIndex=0;visibleColIndex<this.rowHeaderCount;visibleColIndex++){TR.appendChild(document.createElement("TH"))}return TR};WalkontableTableRenderer.prototype.renderRowHeader=function(row,col,TH){TH.className="";TH.removeAttribute("style");this.rowHeaders[col](row,TH,col)};WalkontableTableRenderer.prototype.renderRowHeaders=function(row,TR){for(var TH=TR.firstChild,visibleColIndex=0;visibleColIndex<this.rowHeaderCount;visibleColIndex++){if(!TH){TH=document.createElement("TH");TR.appendChild(TH)}else{if(TH.nodeName=="TD"){TH=this.utils.replaceTdWithTh(TH,TR)}}this.renderRowHeader(row,visibleColIndex,TH);TH=TH.nextSibling}};WalkontableTableRenderer.prototype.adjustAvailableNodes=function(){this.refreshStretching();this.adjustColGroups();this.adjustThead()};WalkontableTableRenderer.prototype.renderColumnHeaders=function(){if(!this.columnHeaderCount){return}var columnCount=this.wtTable.getRenderedColumnsCount(),TR;for(var i=0;i<this.columnHeaderCount;i++){TR=this.getTrForColumnHeaders(i);for(var columnIndex=(-1)*this.rowHeaderCount;columnIndex<columnCount;columnIndex++){this.renderColumnHeader(i,columnIndex,TR.childNodes[columnIndex+this.rowHeaderCount])}}};WalkontableTableRenderer.prototype.adjustColGroups=function(){var columnCount=this.wtTable.getRenderedColumnsCount();while(this.wtTable.colgroupChildrenLength<columnCount+this.rowHeaderCount){this.COLGROUP.appendChild(document.createElement("COL"));this.wtTable.colgroupChildrenLength++}while(this.wtTable.colgroupChildrenLength>columnCount+this.rowHeaderCount){this.COLGROUP.removeChild(this.COLGROUP.lastChild);this.wtTable.colgroupChildrenLength--;if(this.wtTable.columnWidthCache){this.wtTable.columnWidthCache.splice(-1,1)}}};WalkontableTableRenderer.prototype.adjustThead=function(){var columnCount=this.wtTable.getRenderedColumnsCount();var TR=this.THEAD.firstChild;if(this.columnHeaders.length){for(var i=0,columnHeadersLength=this.columnHeaders.length;i<columnHeadersLength;i++){TR=this.THEAD.childNodes[i];if(!TR){TR=document.createElement("TR");this.THEAD.appendChild(TR)}this.theadChildrenLength=TR.childNodes.length;while(this.theadChildrenLength<columnCount+this.rowHeaderCount){TR.appendChild(document.createElement("TH"));this.theadChildrenLength++}while(this.theadChildrenLength>columnCount+this.rowHeaderCount){TR.removeChild(TR.lastChild);this.theadChildrenLength--}}var theadChildrenLength=this.THEAD.childNodes.length;if(theadChildrenLength>this.columnHeaders.length){for(var i=this.columnHeaders.length;i<theadChildrenLength;i++){this.THEAD.removeChild(this.THEAD.lastChild)}}}else{if(TR){Handsontable.Dom.empty(TR)}}};WalkontableTableRenderer.prototype.getTrForColumnHeaders=function(index){var TR=this.THEAD.childNodes[index];return TR};WalkontableTableRenderer.prototype.renderColumnHeader=function(row,col,TH){TH.className="";TH.removeAttribute("style");return this.columnHeaders[row](col,TH,row)};WalkontableTableRenderer.prototype.renderColGroups=function(){for(var colIndex=0;colIndex<this.wtTable.colgroupChildrenLength;colIndex++){if(colIndex<this.rowHeaderCount){Handsontable.Dom.addClass(this.COLGROUP.childNodes[colIndex],"rowHeader")}else{Handsontable.Dom.removeClass(this.COLGROUP.childNodes[colIndex],"rowHeader")}}};WalkontableTableRenderer.prototype.adjustColumns=function(TR,desiredCount){var count=TR.childNodes.length;while(count<desiredCount){var TD=document.createElement("TD");TR.appendChild(TD);count++}while(count>desiredCount){TR.removeChild(TR.lastChild);count--}};WalkontableTableRenderer.prototype.refreshStretching=function(){if(this.wtTable.isWorkingOnClone()){return}var instance=this.instance,stretchH=instance.getSetting("stretchH"),totalColumns=instance.getSetting("totalColumns");var containerWidthFn=function(){var viewportWidth=that.instance.wtViewport.getViewportWidth();return viewportWidth};var that=this;var columnWidthFn=function(i){var source_c=that.columnFilter.renderedToSource(i);if(source_c<totalColumns){return instance.getSetting("columnWidth",source_c)}};this.wtTable.columnStrategy=new WalkontableColumnStrategy(instance,containerWidthFn,columnWidthFn,stretchH)};WalkontableTableRenderer.utils={};WalkontableTableRenderer.utils.replaceTdWithTh=function(TD,TR){var TH;TH=document.createElement("TH");TR.insertBefore(TH,TD);TR.removeChild(TD);return TH};WalkontableTableRenderer.utils.replaceThWithTd=function(TH,TR){var TD=document.createElement("TD");TR.insertBefore(TD,TH);TR.removeChild(TH);return TD};function WalkontableViewport(instance){this.instance=instance;this.oversizedRows=[];var that=this;var eventManager=Handsontable.eventManager(instance);eventManager.addEventListener(window,"resize",function(){that.clientHeight=that.getWorkspaceHeight()})}WalkontableViewport.prototype.getWorkspaceHeight=function(){var scrollHandler=this.instance.wtScrollbars.vertical.scrollHandler;if(scrollHandler===window){return document.documentElement.clientHeight}else{var elemHeight=Handsontable.Dom.outerHeight(scrollHandler);var height=(elemHeight>0&&scrollHandler.clientHeight>0)?scrollHandler.clientHeight:Infinity;return height}};WalkontableViewport.prototype.getWorkspaceWidth=function(){var width;if(Handsontable.freezeOverlays){width=Math.min(document.documentElement.offsetWidth-this.getWorkspaceOffset().left,document.documentElement.offsetWidth)}else{width=Math.min(this.getContainerFillWidth(),document.documentElement.offsetWidth-this.getWorkspaceOffset().left,document.documentElement.offsetWidth)}var scrollHandler=this.instance.wtScrollbars.horizontal.scrollHandler;if(scrollHandler!=window){var overflow=this.instance.wtScrollbars.horizontal.scrollHandler.style.overflow;if(overflow=="scroll"||overflow=="hidden"||overflow=="auto"){return Math.max(width,scrollHandler.clientWidth)}}return Math.max(width,Handsontable.Dom.outerWidth(this.instance.wtTable.TABLE))};WalkontableViewport.prototype.getContainerFillWidth=function(){if(this.containerWidth){return this.containerWidth}var mainContainer=this.instance.wtTable.holder,fillWidth,dummyElement;while(mainContainer.parentNode!=document.body&&mainContainer.parentNode!=null&&mainContainer.className.indexOf("handsontable")===-1){mainContainer=mainContainer.parentNode}dummyElement=document.createElement("DIV");dummyElement.style.width="100%";dummyElement.style.height="1px";mainContainer.appendChild(dummyElement);fillWidth=dummyElement.offsetWidth;this.containerWidth=fillWidth;mainContainer.removeChild(dummyElement);return fillWidth};WalkontableViewport.prototype.getWorkspaceOffset=function(){return Handsontable.Dom.offset(this.instance.wtTable.TABLE)};WalkontableViewport.prototype.getWorkspaceActualHeight=function(){return Handsontable.Dom.outerHeight(this.instance.wtTable.TABLE)};WalkontableViewport.prototype.getWorkspaceActualWidth=function(){return Handsontable.Dom.outerWidth(this.instance.wtTable.TABLE)||Handsontable.Dom.outerWidth(this.instance.wtTable.TBODY)||Handsontable.Dom.outerWidth(this.instance.wtTable.THEAD)};WalkontableViewport.prototype.getColumnHeaderHeight=function(){if(isNaN(this.columnHeaderHeight)){this.columnHeaderHeight=Handsontable.Dom.outerHeight(this.instance.wtTable.THEAD)}return this.columnHeaderHeight};WalkontableViewport.prototype.getViewportHeight=function(){var containerHeight=this.getWorkspaceHeight();if(containerHeight===Infinity){return containerHeight}var columnHeaderHeight=this.getColumnHeaderHeight();if(columnHeaderHeight>0){containerHeight-=columnHeaderHeight}return containerHeight};WalkontableViewport.prototype.getRowHeaderWidth=function(){if(this.instance.cloneSource){return this.instance.cloneSource.wtViewport.getRowHeaderWidth()}if(isNaN(this.rowHeaderWidth)){var rowHeaders=this.instance.getSetting("rowHeaders");if(rowHeaders.length){var TH=this.instance.wtTable.TABLE.querySelector("TH");this.rowHeaderWidth=0;for(var i=0,ilen=rowHeaders.length;i<ilen;i++){if(TH){this.rowHeaderWidth+=Handsontable.Dom.outerWidth(TH);TH=TH.nextSibling}else{this.rowHeaderWidth+=50}}}else{this.rowHeaderWidth=0}}return this.rowHeaderWidth};WalkontableViewport.prototype.getViewportWidth=function(){var containerWidth=this.getWorkspaceWidth();if(containerWidth===Infinity){return containerWidth}var rowHeaderWidth=this.getRowHeaderWidth();if(rowHeaderWidth>0){return containerWidth-rowHeaderWidth}else{return containerWidth}};WalkontableViewport.prototype.createRowsCalculator=function(){this.rowHeaderWidth=NaN;this.columnHeaderHeight=NaN;var height;if(this.instance.cloneOverlay instanceof WalkontableDebugOverlay||this.instance.wtSettings.settings.renderAllRows){height=Infinity}else{height=this.getViewportHeight()}var pos=this.instance.wtScrollbars.vertical.getScrollPosition()-this.instance.wtScrollbars.vertical.getTableParentOffset();if(pos<0){pos=0}var that=this;return new WalkontableViewportRowsCalculator(height,pos,this.instance.getSetting("totalRows"),function(sourceRow){return that.instance.wtTable.getRowHeight(sourceRow)},this.instance.wtSettings.settings.viewportRowCalculatorOverride)};WalkontableViewport.prototype.createPreCalculators=function(){this.rowsPreCalculator=this.createRowsCalculator()};WalkontableViewport.prototype.createCalculators=function(oldRowCalculator){if(oldRowCalculator){var tmp=this.createRowsCalculator();this.rowsCalculator=oldRowCalculator;this.rowsCalculator.visibleStartRow=tmp.visibleStartRow;this.rowsCalculator.visibleEndRow=tmp.visibleEndRow;this.rowsCalculator.visibleCellCount=tmp.visibleCellCount}else{this.rowsCalculator=this.createRowsCalculator()}};WalkontableViewport.prototype.areAllProposedVisibleRowsAlreadyRendered=function(){if(this.rowsCalculator){if(this.rowsPreCalculator.visibleStartRow<this.rowsCalculator.renderStartRow||this.rowsPreCalculator.visibleEndRow>this.rowsCalculator.renderEndRow){return false}else{if(this.rowsPreCalculator.scrollOffset!==this.rowsCalculator.scrollOffset&&(this.rowsPreCalculator.visibleStartRow<=this.rowsCalculator.renderStartRow||this.rowsPreCalculator.visibleEndRow>=this.rowsCalculator.renderEndRow)){return false}else{return true}}}return false};function WalkontableViewportRowsCalculator(height,scrollOffset,totalRows,rowHeightFn,overrideFn){this.scrollOffset=scrollOffset;this.renderStartRow=null;this.renderStartPosition=null;this.renderEndRow=null;this.countRendered=0;this.visibleStartRow=null;this.visibleEndRow=null;this.countVisible=0;var sum=0;var rowHeight;var needReverse=true;var defaultRowHeight=23;var startPositions=[];for(var i=0;i<totalRows;i++){rowHeight=rowHeightFn(i);if(rowHeight===undefined){rowHeight=defaultRowHeight}if(sum<=scrollOffset){this.renderStartRow=i}if(sum>=scrollOffset&&sum+rowHeight<=scrollOffset+height){if(this.visibleStartRow==null){this.visibleStartRow=i}this.visibleEndRow=i}startPositions.push(sum);sum+=rowHeight;this.renderEndRow=i;if(sum>=scrollOffset+height){needReverse=false;break}}if(this.renderEndRow==totalRows-1&&needReverse){this.renderStartRow=this.renderEndRow;this.visibleStartRow=this.renderEndRow;this.visibleEndRow=this.renderEndRow;while(this.renderStartRow>0){this.renderStartRow--;var viewportSum=startPositions[this.renderEndRow]+rowHeight-startPositions[this.renderStartRow];if(viewportSum<=height){this.visibleStartRow=this.renderStartRow}if(viewportSum>=height){break}}}if(this.renderStartRow!==null&&overrideFn){overrideFn(this)}this.renderStartPosition=startPositions[this.renderStartRow];if(this.renderStartPosition==void 0){this.renderStartPosition=null}if(this.renderStartRow!=null){this.countRendered=this.renderEndRow-this.renderStartRow+1}if(this.visibleStartRow!=null){this.countVisible=this.visibleEndRow-this.visibleStartRow+1}}if(window.jQuery){(function(window,$,Handsontable){$.fn.handsontable=function(action){var i,ilen,args,output,userSettings,$this=this.first(),instance=$this.data("handsontable");if(typeof action!=="string"){userSettings=action||{};if(instance){instance.updateSettings(userSettings)}else{instance=new Handsontable.Core($this[0],userSettings);$this.data("handsontable",instance);instance.init()}return $this}else{args=[];if(arguments.length>1){for(i=1,ilen=arguments.length;i<ilen;i++){args.push(arguments[i])}}if(instance){if(typeof instance[action]!=="undefined"){output=instance[action].apply(instance,args);if(action==="destroy"){$this.removeData()}}else{throw new Error("Handsontable do not provide action: "+action)}}return output}}})(window,jQuery,Handsontable)}})(window,Handsontable);